var gs=Object.defineProperty;var _s=(r,e,t)=>e in r?gs(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var d=(r,e,t)=>(_s(r,typeof e!="symbol"?e+"":e,t),t);import{S as Y,i as G,s as q,C as Re,k as P,l as M,m as x,h as $,n as R,b as O,P as J,D as Ee,E as Se,F as Te,f as b,t as y,X as $e,Y as _e,a as D,c as N,p as pe,G as E,B as W,o as Me,Z as He,Q as tt,R as nt,q as ee,r as te,u as de,e as kt,g as xe,d as Pe,j as Er,_ as Un,$ as Sr,w as T,x as k,y as F,z as A,N as en,T as Tr,H as Xt,M as vs}from"../../../../chunks/index-3155a5b5.js";import{w as st}from"../../../../chunks/index-b763cd81.js";function $s(r){let e,t,n,s;const o=r[3].default,l=Re(o,r,r[2],null);return{c(){e=P("button"),l&&l.c(),this.h()},l(a){e=M(a,"BUTTON",{title:!0,class:!0});var i=x(e);l&&l.l(i),i.forEach($),this.h()},h(){R(e,"title",r[0]),R(e,"class","ddefault svelte-hichw")},m(a,i){O(a,e,i),l&&l.m(e,null),t=!0,n||(s=J(e,"click",r[4]),n=!0)},p(a,[i]){l&&l.p&&(!t||i&4)&&Ee(l,o,a,a[2],t?Te(o,a[2],i,null):Se(a[2]),null),(!t||i&1)&&R(e,"title",a[0])},i(a){t||(b(l,a),t=!0)},o(a){y(l,a),t=!1},d(a){a&&$(e),l&&l.d(a),n=!1,s()}}}function bs(r,e,t){let{$$slots:n={},$$scope:s}=e,{title:o=void 0}=e;const l=$e(),a=()=>l("click");return r.$$set=i=>{"title"in i&&t(0,o=i.title),"$$scope"in i&&t(2,s=i.$$scope)},[o,l,s,n,a]}class tn extends Y{constructor(e){super(),G(this,e,bs,$s,q,{title:0})}}function ys(r){let e,t,n,s;const o=r[3].default,l=Re(o,r,r[2],null);return{c(){e=P("button"),l&&l.c(),this.h()},l(a){e=M(a,"BUTTON",{title:!0,class:!0});var i=x(e);l&&l.l(i),i.forEach($),this.h()},h(){R(e,"title",r[0]),R(e,"class","primary svelte-1atnns5")},m(a,i){O(a,e,i),l&&l.m(e,null),t=!0,n||(s=J(e,"click",r[4]),n=!0)},p(a,[i]){l&&l.p&&(!t||i&4)&&Ee(l,o,a,a[2],t?Te(o,a[2],i,null):Se(a[2]),null),(!t||i&1)&&R(e,"title",a[0])},i(a){t||(b(l,a),t=!0)},o(a){y(l,a),t=!1},d(a){a&&$(e),l&&l.d(a),n=!1,s()}}}function ws(r,e,t){let{$$slots:n={},$$scope:s}=e,{title:o=void 0}=e;const l=$e(),a=()=>l("click");return r.$$set=i=>{"title"in i&&t(0,o=i.title),"$$scope"in i&&t(2,s=i.$$scope)},[o,l,s,n,a]}class kr extends Y{constructor(e){super(),G(this,e,ws,ys,q,{title:0})}}function Rs(r){let e,t,n,s,o;const l=r[4].default,a=Re(l,r,r[3],null);return{c(){e=P("button"),a&&a.c(),this.h()},l(i){e=M(i,"BUTTON",{title:!0,class:!0});var c=x(e);a&&a.l(c),c.forEach($),this.h()},h(){R(e,"title",r[0]),R(e,"class",t=_e(r[1]?"sinkableSunk":"sinkableUnsunk")+" svelte-2hvqwf")},m(i,c){O(i,e,c),a&&a.m(e,null),n=!0,s||(o=J(e,"click",r[2]),s=!0)},p(i,[c]){a&&a.p&&(!n||c&8)&&Ee(a,l,i,i[3],n?Te(l,i[3],c,null):Se(i[3]),null),(!n||c&1)&&R(e,"title",i[0]),(!n||c&2&&t!==(t=_e(i[1]?"sinkableSunk":"sinkableUnsunk")+" svelte-2hvqwf"))&&R(e,"class",t)},i(i){n||(b(a,i),n=!0)},o(i){y(a,i),n=!1},d(i){i&&$(e),a&&a.d(i),s=!1,o()}}}function Es(r,e,t){let{$$slots:n={},$$scope:s}=e,{title:o=void 0}=e,{isDown:l}=e;const a=$e(),i=()=>{l||a("click")};return r.$$set=c=>{"title"in c&&t(0,o=c.title),"isDown"in c&&t(1,l=c.isDown),"$$scope"in c&&t(3,s=c.$$scope)},[o,l,i,s,n]}class Yt extends Y{constructor(e){super(),G(this,e,Es,Rs,q,{title:0,isDown:1})}}function Ss(r){let e,t,n,s,o,l;return{c(){e=P("div"),t=P("span"),n=D(),s=P("span"),this.h()},l(a){e=M(a,"DIV",{class:!0});var i=x(e);t=M(i,"SPAN",{class:!0,style:!0}),x(t).forEach($),n=N(i),s=M(i,"SPAN",{class:!0,style:!0}),x(s).forEach($),i.forEach($),this.h()},h(){R(t,"class","secondary svelte-1whbsbw"),pe(t,"background-color",r[1].toStyle()),R(s,"class","primary svelte-1whbsbw"),pe(s,"background-color",r[0].toStyle()),R(e,"class","container svelte-1whbsbw")},m(a,i){O(a,e,i),E(e,t),E(e,n),E(e,s),o||(l=J(e,"click",r[3]),o=!0)},p(a,[i]){i&2&&pe(t,"background-color",a[1].toStyle()),i&1&&pe(s,"background-color",a[0].toStyle())},i:W,o:W,d(a){a&&$(e),o=!1,l()}}}function Ts(r,e,t){let{color:n}=e,{colorSecondary:s}=e;const o=$e(),l=()=>o("click");return r.$$set=a=>{"color"in a&&t(0,n=a.color),"colorSecondary"in a&&t(1,s=a.colorSecondary)},[n,s,o,l]}class ks extends Y{constructor(e){super(),G(this,e,Ts,Ss,q,{color:0,colorSecondary:1})}}var X={};Object.defineProperty(X,"__esModule",{value:!0});class Ce{constructor(e,t,n){this.r=e,this.g=t,this.b=n}static fromCss(e){return e=e.replace(/[ \t]/,""),e.startsWith("rgb(")?Fs(e.substr(4,e.length-5)):e.startsWith("#")?Vn(e.substr(1)):Vn(e)}is(e){return this.r===e.r&&this.g===e.g&&this.b===e.b}toRgb(){return this}with({r:e,g:t,b:n}){return new Ce(e!==void 0?e:this.r,t!==void 0?t:this.g,n!==void 0?n:this.b)}toStyle(){return`rgb(${Kt(this.r)},${Kt(this.g)},${Kt(this.b)})`}toLinear(){return new he(Gt(this.r),Gt(this.g),Gt(this.b))}toString(){return"Rgb("+this.r+", "+this.g+", "+this.b+")"}}class he{constructor(e,t,n){this.r=e,this.g=t,this.b=n}is(e){return this.r===e.r&&this.g===e.g&&this.b===e.b}with({r:e,g:t,b:n}){return new he(e!==void 0?e:this.r,t!==void 0?t:this.g,n!==void 0?n:this.b)}mix(e,t){return new he(Zt(e,this.r,t.r),Zt(e,this.g,t.g),Zt(e,this.b,t.b))}lighten(e){return this.mix(e,he.White)}darken(e){return this.mix(e,he.Black)}fromLinear(){return new Ce(qt(this.r),qt(this.g),qt(this.b))}toString(){return"LinearRgb("+this.r+", "+this.g+", "+this.b+")"}}he.White=new he(1,1,1);he.Black=new he(0,0,0);function Gt(r){return r>.04045?Math.pow((r+.055)/1.055,2.4):r/12.92}function qt(r){return r<=.0031308?r*12.92:Math.pow(r*1.055,1/2.4)-.055}function Kt(r){return r*255.9999999|0}function nn(r,e,t){return isNaN(r)||!isFinite(r)||isNaN(e)||!isFinite(e)||isNaN(t)||!isFinite(t)?null:new Ce(r,e,t)}function Fs(r){const e=r.split(",");if(e.length!==3)return null;const t=Number.parseFloat(e[0])/255,n=Number.parseFloat(e[1])/255,s=Number.parseFloat(e[2])/255;return nn(t,n,s)}function Vn(r){if(r.length===3){const e=ut(r[0])/15,t=ut(r[1])/15,n=ut(r[2])/15;return nn(e,t,n)}if(r.length===6){const e=Wt(r[0],r[1]),t=Wt(r[2],r[3]),n=Wt(r[4],r[5]);return nn(e,t,n)}return null}function Wt(r,e){return(ut(r)*16+ut(e))/255}function ut(r){switch(r.toLowerCase()){case"0":return 0;case"1":return 1;case"2":return 2;case"3":return 3;case"4":return 4;case"5":return 5;case"6":return 6;case"7":return 7;case"8":return 8;case"9":return 9;case"a":return 10;case"b":return 11;case"c":return 12;case"d":return 13;case"e":return 14;case"f":return 15;default:return NaN}}function Zt(r,e,t){return e+r*(t-e)}class Bt{constructor(e,t,n){this.h=e,this.s=t,this.v=n,this.__cachedRgb=null}is(e){return this.h===e.h&&this.s===e.s&&this.v===e.v}toRgb(){return this.__cachedRgb===null&&(this.__cachedRgb=Fr(this)),this.__cachedRgb}toStyle(){return this.toRgb().toStyle()}with({h:e,s:t,v:n}){return new Bt(e!==void 0?e:this.h,t!==void 0?t:this.s,n!==void 0?n:this.v)}toString(){return"Hsv("+this.h+", "+this.s+", "+this.v+")"}}function As({r,g:e,b:t}){const n=Math.max(r,e,t),s=Math.min(r,e,t),o=n-s,l=n===0?0:o/n;let a;switch(n){case s:a=0;break;case r:a=(e-t)/o+(e<t?6:0);break;case e:a=(t-r)/o+2;break;default:a=(r-e)/o+4;break}return new Bt(a/6,l,n)}function Fr({h:r,s:e,v:t}){const n=r*6|0,s=r*6-n,o=t*(1-e),l=t*(1-s*e),a=t*(1-(1-s)*e);let i,c,u;switch(n%6){case 0:i=t,c=a,u=o;break;case 1:i=l,c=t,u=o;break;case 2:i=o,c=t,u=a;break;case 3:i=o,c=l,u=t;break;case 4:i=a,c=o,u=t;break;default:i=t,c=o,u=l;break}return new Ce(i,c,u)}class Ls{constructor(e,t){this.x=e,this.y=t}}class ft{constructor(e,t,n){this.l=e,this.u=t,this.v=n}}class We{constructor(e,t,n){this.h=e,this.s=t,this.l=n,this.__cachedRgb=null}is(e){return this.h===e.h&&this.s===e.s&&this.l===e.l}with({h:e,s:t,l:n}){return new We(e!==void 0?e:this.h,t!==void 0?t:this.s,n!==void 0?n:this.l)}toRgb(){return this.__cachedRgb===null&&(this.__cachedRgb=Ur(this)),this.__cachedRgb}toStyle(){return this.toRgb().toStyle()}toString(){return"Hsluv("+this.h+", "+this.s+", "+this.l+")"}}class Ze{constructor(e,t,n){this.h=e,this.p=t,this.l=n,this.__cachedRgb=null}is(e){return this.h===e.h&&this.p===e.p&&this.l===e.l}with({h:e,p:t,l:n}){return new Ze(e!==void 0?e:this.h,t!==void 0?t:this.p,n!==void 0?n:this.l)}toRgb(){return this.__cachedRgb===null&&(this.__cachedRgb=Vr(this)),this.__cachedRgb}toStyle(){return this.toRgb().toStyle()}toString(){return"Hsv("+this.h+", "+this.p+", "+this.l+")"}}class ge{constructor(e,t,n){this.l=e,this.c=t,this.h=n}}class Ft{constructor(e,t,n){this.x=e,this.y=t,this.z=n}}const rn=3.240969941904521,sn=-1.537383177570093,on=-.498610760293,ln=-.96924363628087,an=1.87596750150772,cn=.041555057407175,un=.055630079696993,fn=-.20397695888897,hn=1.056971514242878,xs=.41239079926595,Ps=.35758433938387,Ms=.18048078840183,Cs=.21263900587151,Bs=.71516867876775,Is=.072192315360733,Ds=.019330818715591,Ns=.11919477979462,Hs=.95053215224966,pt=1,Ar=.19783000664283,Lr=.46831999493879,bn=903.2962962,xr=.0088564516;function Os(r){return r*Math.PI/180}function zs(r){return r*180/Math.PI}function Ye(r,e,t,n,s,o){const l=(284517*r-94839*t)*s,a=(838422*t+769860*e+731718*r)*n*s-769860*o*n,i=(632260*t-126452*e)*s+126452*o;return new Ls(l/i,a/i)}function Pr(r){const e=Math.pow(r+16,3)/1560896,t=e>xr?e:r/bn;return[Ye(rn,sn,on,r,t,0),Ye(rn,sn,on,r,t,1),Ye(ln,an,cn,r,t,0),Ye(ln,an,cn,r,t,1),Ye(un,fn,hn,r,t,0),Ye(un,fn,hn,r,t,1)]}function Mr(r){const e=Pr(r);let t=Number.MAX_VALUE;for(let n=0;n<2;++n){const s=e[n],o=s.y/(-1/s.x-s.x),l=s.y+o*s.x,a=Math.sqrt(o*o+l*l);a<t&&(t=a)}return t}function Cr(r,e){const t=e/360*Math.PI*2,n=Pr(r);let s=Number.MAX_VALUE;for(let o=0;o<n.length;o++){const l=n[o],a=l.y/(Math.sin(t)-l.x*Math.cos(t));a>=0&&a<s&&(s=a)}return s}function Us(r){return r>xr?116*Math.pow(r/pt,1/3)-16:r/pt*bn}function Vs(r){return r>8?Math.pow(pt*((r+16)/116),3):pt*r/bn}function Br({l:r,u:e,v:t}){const n=Math.sqrt(e*e+t*t);if(n<1e-8)return new ge(r,n,0);const s=zs(Math.atan2(t,e));return s<0?new ge(r,n,s+360):new ge(r,n,s)}function Ir({l:r,c:e,h:t}){const n=Os(t),s=Math.cos(n)*e,o=Math.sin(n)*e;return new ft(r,s,o)}function Dr(r){const e=r.toLinear(),t=e.r*xs+e.g*Ps+e.b*Ms,n=e.r*Cs+e.g*Bs+e.b*Is,s=e.r*Ds+e.g*Ns+e.b*Hs;return new Ft(t,n,s)}function jt(r){return r<=.0031308?12.92*r:1.055*Math.pow(r,1/2.4)-.055}function yn(r){const e=jt(r.x*rn+r.y*sn+r.z*on),t=jt(r.x*ln+r.y*an+r.z*cn),n=jt(r.x*un+r.y*fn+r.z*hn);return new Ce(e,t,n)}function Nr({l:r,c:e,h:t}){if(r>99.9999999)return new We(t,0,100);if(r<1e-8)return new We(t,0,0);const n=Cr(r,t),s=e/n*100;return new We(t,s,r)}function Hr({h:r,s:e,l:t}){if(t>99.9999999)return new ge(100,0,r);if(t<1e-8)return new ge(0,0,r);const s=Cr(t,r)/100*e;return new ge(t,s,r)}function Or({l:r,c:e,h:t}){if(r>99.9999999)return new Ze(t,0,100);if(r<1e-8)return new Ze(t,0,0);const n=Mr(r),s=e/n*100;return new Ze(t,s,r)}function zr({h:r,p:e,l:t}){if(t>99.9999999)return new ge(100,0,r);if(t<1e-8)return new ge(0,0,r);const s=Mr(t)/100*e;return new ge(t,s,r)}function Xs(r){return yn(En(r))}function wn(r){return Br(Xr(Dr(r)))}function Rn(r){return yn(En(Ir(r)))}function Ys(r){return Nr(wn(r))}function Ur(r){return Rn(Hr(r))}function Gs(r){return Or(wn(r))}function Vr(r){return Rn(zr(r))}function Xr({x:r,y:e,z:t}){if(r===0&&e===0&&t===0)return new ft(0,0,0);const n=Us(e);if(n===0)return new ft(0,0,0);const s=13*n*(4*r/(r+15*e+3*t)-Ar),o=13*n*(9*e/(r+15*e+3*t)-Lr);return new ft(n,s,o)}function En({l:r,u:e,v:t}){if(r===0)return new Ft(0,0,0);const n=e/(13*r)+Ar,s=t/(13*r)+Lr,o=Vs(r)*pt,l=0-9*o*n/((n-4)*s-n*s),a=(9*o-15*s*o-s*l)/(3*s);return new Ft(l,o,a)}function qs({r,g:e,b:t}){const n=Math.sqrt(.299*r*r+.587*e*e+.114*t*t);return new Ce(n,n,n)}var Ks=X.Rgb=Ce,At=X.RgbLinear=he,Ws=X.Hsv=Bt,Oe=X.rgbToHsv=As,Zs=X.hsvToRgb=Fr;X.Luv=ft;var Lt=X.Hsluv=We;X.Hpluv=Ze;X.Lch=ge;X.Xyz=Ft;X.luvToLch=Br;X.lchToLuv=Ir;X.rgbToXyz=Dr;X.xyzToRgb=yn;X.lchToHsluv=Nr;X.hsluvToLch=Hr;X.lchToHpluv=Or;X.hpluvToLch=zr;X.luvToRgb=Xs;X.rgbToLch=wn;X.lchToRgb=Rn;var be=X.rgbToHsluv=Ys,Yr=X.hsluvToRgb=Ur;X.rgbToHpluv=Gs;X.hpluvToRgb=Vr;X.xyzToLuv=Xr;X.luvToXyz=En;X.toGray=qs;const re=class{constructor(e,t){d(this,"x");d(this,"y");this.x=e,this.y=t}eq(e){return re.eq(this,e)}add(e){return new re(this.x+e.x,this.y+e.y)}addScalar(e){return new re(this.x+e,this.y+e)}addScalars(e,t){return new re(this.x+e,this.y+t)}subtract(e){return new re(this.x-e.x,this.y-e.y)}subtractScalar(e){return new re(this.x-e,this.y-e)}subtractScalars(e,t){return new re(this.x-e,this.y-t)}multiply(e){return new re(this.x*e.x,this.y*e.y)}multiplyScalar(e){return new re(this.x*e,this.y*e)}multiplyScalars(e,t){return new re(this.x*e,this.y*t)}divide(e){return new re(this.x/e.x,this.y/e.y)}divideScalar(e){return new re(this.x/e,this.y/e)}toString(){return"Vec2("+this.x+", "+this.y+")"}static eq(e,t){return e.x===t.x&&e.y===t.y}static lerp(e,t,n){return new re(t.x+(n.x-t.x)*e,t.y+(n.y-t.y)*e)}static distance(e,t){const n=t.x-e.x,s=t.y-e.y;return Math.sqrt(n*n+s*s)}};let ne=re;d(ne,"zeroes",new re(0,0));function js(r){const{effectsHandler:e,initialState:t,initialEphemeral:n,forceRender:s,update:o}=r;let l=t,a=n;function i(c){const u=l;let h;try{const[f,m,p]=o(l,a,c);l!==f&&(l=f,s(f,m)),h=p,a=m}catch(f){l=u,console.error("[ERROR][Store.update]",l,c,f);return}try{e(h)}catch(f){l=u,console.error("[ERROR][Store.effectsHandler]",l,c,h,f)}}return{send:i,getState:()=>l,getEphemeral:()=>a}}class Gr{constructor(){d(this,"value",null);d(this,"error",null)}}class xt extends Gr{constructor(t){super();d(this,"value");d(this,"error");this.value=t,this.error=null}isOk(){return!0}isErr(){return!1}map(t){return new xt(t(this.value))}mapError(){return new xt(this.value)}andThen(t){return t(this.value)}}class fe extends Gr{constructor(t){super();d(this,"value");d(this,"error");this.value=null,this.error=t}isOk(){return!1}isErr(){return!0}map(){return new fe(this.error)}mapError(t){return new fe(t(this.error))}andThen(){return new fe(this.error)}}class rt{constructor(e,t,n,s){d(this,"x");d(this,"y");d(this,"z");d(this,"w");this.x=e,this.y=t,this.z=n,this.w=s}eq(e){return rt.eq(this,e)}static fromRgba(e,t){return new rt(e.r*t,e.g*t,e.b*t,t)}static eq(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w}}const Qs={make:r=>{let e=!1;window.painterStop=()=>e=!0;let t=requestAnimationFrame(function n(){if(!e){try{r(performance.now())}catch(s){console.error(s)}t=requestAnimationFrame(n)}});return()=>cancelAnimationFrame(t)}};class Js{constructor(e){d(this,"maxSamples");d(this,"onSamples");d(this,"samples");d(this,"nextIdx");d(this,"startTimeMs");this.maxSamples=e.maxSamples,this.onSamples=e.onSamples,this.samples=new Array(e.maxSamples),this.nextIdx=0,this.startTimeMs=null}start(){this.startTimeMs!==null&&console.error("Performance tracker should not already be in use"),this.startTimeMs=performance.now()}end(){this.startTimeMs===null&&console.error("Performance tracker should be started");const e=performance.now(),t=this.startTimeMs;this.startTimeMs=null,this.samples[this.nextIdx++]={startMs:t,endMs:e},this.nextIdx===this.maxSamples&&(this.onSamples(this.samples),this.samples=new Array(this.maxSamples),this.nextIdx=0)}}const qr=[];function eo({width:r,height:e}){let t=qr.pop();return t===void 0&&(t=document.createElement("canvas")),t.width=r,t.height=e,t}function Kr(r){qr.push(r)}function B(r,e){return{tag:r,val:e}}function je(r,e){return r!==void 0?r:e}function Xn(r,e,t,n){const s=t-r,o=n-e;return Math.sqrt(s*s+o*o)}function Ie(r,e,t){return e+(t-e)*r}function se(r,e,t){return r<e?e:r>t?t:r}function ot(r){const e=parseFloat(r);return isNaN(e)?null:e}function $t(r,e,t){const n=r.slice();return n.splice(e,1,t),n}function to(r,e,t){const n=r.slice();return n.splice(e,0,t),n}function no(r,e){const t=r.slice();return t.splice(e,1),t}var Z;(function(r){r[r.Hsv=0]="Hsv",r[r.Hsluv=1]="Hsluv"})(Z||(Z={}));function ro(r){switch(r){case Z.Hsv:return"Hsv";case Z.Hsluv:return"Hsluv"}}function so(r,e,t){const n=r*360*(Math.PI/180),s=Math.cos(n)*(t.x-e.x)-Math.sin(n)*(t.y-e.y)+e.x,o=Math.sin(n)*(t.x-e.x)+Math.cos(n)*(t.y-e.y)+e.y;return new ne(s,o)}const oo=`#ifndef TAU
    #define TAU 6.283185307179586
#endif`,lo=`
float from_linear(float c) {
    return c <= 0.0031308 
        ? c * 12.92
        : pow(c * 1.055, 1.0 / 2.4) - 0.055;
}

vec3 from_linear(vec3 color) {
    return vec3(from_linear(color.x), from_linear(color.y), from_linear(color.z));
}
`,Wr=`
vec3 hsvToRgb(in vec3 c) {
    vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
    vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
    return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}`,Zr=`
vec3 hsluv_intersectLineLine(vec3 line1x, vec3 line1y, vec3 line2x, vec3 line2y) {
    return (line1y - line2y) / (line2x - line1x);
}

vec3 hsluv_distanceFromPole(vec3 pointx,vec3 pointy) {
    return sqrt(pointx*pointx + pointy*pointy);
}

vec3 hsluv_lengthOfRayUntilIntersect(float theta, vec3 x, vec3 y) {
    vec3 len = y / (sin(theta) - x * cos(theta));
    if (len.r < 0.0) {len.r=1000.0;}
    if (len.g < 0.0) {len.g=1000.0;}
    if (len.b < 0.0) {len.b=1000.0;}
    return len;
}

float hsluv_maxSafeChromaForL(float L){
    mat3 m2 = mat3(
         3.2409699419045214  ,-0.96924363628087983 , 0.055630079696993609,
        -1.5373831775700935  , 1.8759675015077207  ,-0.20397695888897657 ,
        -0.49861076029300328 , 0.041555057407175613, 1.0569715142428786  
    );
    float sub0 = L + 16.0;
    float sub1 = sub0 * sub0 * sub0 * .000000641;
    float sub2 = sub1 > 0.0088564516790356308 ? sub1 : L / 903.2962962962963;

    vec3 top1   = (284517.0 * m2[0] - 94839.0  * m2[2]) * sub2;
    vec3 bottom = (632260.0 * m2[2] - 126452.0 * m2[1]) * sub2;
    vec3 top2   = (838422.0 * m2[2] + 769860.0 * m2[1] + 731718.0 * m2[0]) * L * sub2;

    vec3 bounds0x = top1 / bottom;
    vec3 bounds0y = top2 / bottom;

    vec3 bounds1x =              top1 / (bottom+126452.0);
    vec3 bounds1y = (top2-769860.0*L) / (bottom+126452.0);

    vec3 xs0 = hsluv_intersectLineLine(bounds0x, bounds0y, -1.0/bounds0x, vec3(0.0) );
    vec3 xs1 = hsluv_intersectLineLine(bounds1x, bounds1y, -1.0/bounds1x, vec3(0.0) );

    vec3 lengths0 = hsluv_distanceFromPole( xs0, bounds0y + xs0 * bounds0x );
    vec3 lengths1 = hsluv_distanceFromPole( xs1, bounds1y + xs1 * bounds1x );

    return  min(lengths0.r,
            min(lengths1.r,
            min(lengths0.g,
            min(lengths1.g,
            min(lengths0.b,
                lengths1.b)))));
}

float hsluv_maxChromaForLH(float L, float H) {

    float hrad = radians(H);

    mat3 m2 = mat3(
         3.2409699419045214  ,-0.96924363628087983 , 0.055630079696993609,
        -1.5373831775700935  , 1.8759675015077207  ,-0.20397695888897657 ,
        -0.49861076029300328 , 0.041555057407175613, 1.0569715142428786  
    );
    float sub1 = pow(L + 16.0, 3.0) / 1560896.0;
    float sub2 = sub1 > 0.0088564516790356308 ? sub1 : L / 903.2962962962963;

    vec3 top1   = (284517.0 * m2[0] - 94839.0  * m2[2]) * sub2;
    vec3 bottom = (632260.0 * m2[2] - 126452.0 * m2[1]) * sub2;
    vec3 top2   = (838422.0 * m2[2] + 769860.0 * m2[1] + 731718.0 * m2[0]) * L * sub2;

    vec3 bound0x = top1 / bottom;
    vec3 bound0y = top2 / bottom;

    vec3 bound1x =              top1 / (bottom+126452.0);
    vec3 bound1y = (top2-769860.0*L) / (bottom+126452.0);

    vec3 lengths0 = hsluv_lengthOfRayUntilIntersect(hrad, bound0x, bound0y );
    vec3 lengths1 = hsluv_lengthOfRayUntilIntersect(hrad, bound1x, bound1y );

    return  min(lengths0.r,
            min(lengths1.r,
            min(lengths0.g,
            min(lengths1.g,
            min(lengths0.b,
                lengths1.b)))));
}

float hsluv_fromLinear(float c) {
    return c <= 0.0031308 ? 12.92 * c : 1.055 * pow(c, 1.0 / 2.4) - 0.055;
}
vec3 hsluv_fromLinear(vec3 c) {
    return vec3( hsluv_fromLinear(c.r), hsluv_fromLinear(c.g), hsluv_fromLinear(c.b) );
}

float hsluv_toLinear(float c) {
    return c > 0.04045 ? pow((c + 0.055) / (1.0 + 0.055), 2.4) : c / 12.92;
}

vec3 hsluv_toLinear(vec3 c) {
    return vec3( hsluv_toLinear(c.r), hsluv_toLinear(c.g), hsluv_toLinear(c.b) );
}

float hsluv_yToL(float Y){
    return Y <= 0.0088564516790356308 ? Y * 903.2962962962963 : 116.0 * pow(Y, 1.0 / 3.0) - 16.0;
}

float hsluv_lToY(float L) {
    return L <= 8.0 ? L / 903.2962962962963 : pow((L + 16.0) / 116.0, 3.0);
}

vec3 xyzToRgb(vec3 tuple) {
    const mat3 m = mat3( 
        3.2409699419045214  ,-1.5373831775700935 ,-0.49861076029300328 ,
       -0.96924363628087983 , 1.8759675015077207 , 0.041555057407175613,
        0.055630079696993609,-0.20397695888897657, 1.0569715142428786  );
    
    return hsluv_fromLinear(tuple*m);
}

vec3 rgbToXyz(vec3 tuple) {
    const mat3 m = mat3(
        0.41239079926595948 , 0.35758433938387796, 0.18048078840183429 ,
        0.21263900587151036 , 0.71516867876775593, 0.072192315360733715,
        0.019330818715591851, 0.11919477979462599, 0.95053215224966058 
    );
    return hsluv_toLinear(tuple) * m;
}

vec3 xyzToLuv(vec3 tuple){
    float X = tuple.x;
    float Y = tuple.y;
    float Z = tuple.z;

    float L = hsluv_yToL(Y);
    
    float div = 1./dot(tuple,vec3(1,15,3)); 

    return vec3(
        1.,
        (52. * (X*div) - 2.57179),
        (117.* (Y*div) - 6.08816)
    ) * L;
}


vec3 luvToXyz(vec3 tuple) {
    float L = tuple.x;

    float U = tuple.y / (13.0 * L) + 0.19783000664283681;
    float V = tuple.z / (13.0 * L) + 0.468319994938791;

    float Y = hsluv_lToY(L);
    float X = 2.25 * U * Y / V;
    float Z = (3./V - 5.)*Y - (X/3.);

    return vec3(X, Y, Z);
}

vec3 luvToLch(vec3 tuple) {
    float L = tuple.x;
    float U = tuple.y;
    float V = tuple.z;

    float C = length(tuple.yz);
    float H = degrees(atan(V,U));
    if (H < 0.0) {
        H = 360.0 + H;
    }
    
    return vec3(L, C, H);
}

vec3 lchToLuv(vec3 tuple) {
    float hrad = radians(tuple.b);
    return vec3(
        tuple.r,
        cos(hrad) * tuple.g,
        sin(hrad) * tuple.g
    );
}

vec3 hsluvToLch(vec3 tuple) {
    tuple.g *= hsluv_maxChromaForLH(tuple.b, tuple.r) * .01;
    return tuple.bgr;
}

vec3 lchToHsluv(vec3 tuple) {
    tuple.g /= hsluv_maxChromaForLH(tuple.r, tuple.b) * .01;
    return tuple.bgr;
}

vec3 hpluvToLch(vec3 tuple) {
    tuple.g *= hsluv_maxSafeChromaForL(tuple.b) * .01;
    return tuple.bgr;
}

vec3 lchToHpluv(vec3 tuple) {
    tuple.g /= hsluv_maxSafeChromaForL(tuple.r) * .01;
    return tuple.bgr;
}

vec3 lchToRgb(vec3 tuple) {
    return xyzToRgb(luvToXyz(lchToLuv(tuple)));
}

vec3 rgbToLch(vec3 tuple) {
    return luvToLch(xyzToLuv(rgbToXyz(tuple)));
}

vec3 hsluvToRgb(vec3 tuple) {
    return lchToRgb(hsluvToLch(tuple));
}

vec3 rgbToHsluv(vec3 tuple) {
    return lchToHsluv(rgbToLch(tuple));
}

vec3 hpluvToRgb(vec3 tuple) {
    return lchToRgb(hpluvToLch(tuple));
}

vec3 rgbToHpluv(vec3 tuple) {
    return lchToHpluv(rgbToLch(tuple));
}

vec3 luvToRgb(vec3 tuple){
    return xyzToRgb(luvToXyz(tuple));
}
`;var De;(function(r){r[r.Normal=0]="Normal",r[r.Erase=1]="Erase"})(De||(De={}));const ze=r=>({sfact:r.ONE,dfact:r.ONE_MINUS_SRC_ALPHA}),ao=r=>({sfact:r.ZERO,dfact:r.ONE_MINUS_SRC_ALPHA});function io(r,e){switch(e){case De.Normal:return ze(r);case De.Erase:return ao(r)}}function ve(r,e,t){const n=Yn(r,e,r.VERTEX_SHADER),s=Yn(r,t,r.FRAGMENT_SHADER);if(n===null||s===null)return null;const o=r.createProgram();if(o===null)return console.error("Failed to create program"),null;r.attachShader(o,n),r.attachShader(o,s);const l=co(r,o);return r.deleteShader(n),r.deleteShader(s),l}function Yn(r,e,t){const n=r.createShader(t);if(n===null)return console.error("Failed to create shader."),null;if(r.shaderSource(n,e),r.compileShader(n),r.getShaderParameter(n,r.COMPILE_STATUS))return n;console.group("Failed to compile shader"),console.error("shader info log: ",r.getShaderInfoLog(n));const s=uo(e);return console.info(s),console.groupEnd(),r.deleteShader(n),null}function co(r,e){return r.linkProgram(e),e!==null||r.getProgramParameter(e,r.LINK_STATUS)?e:(console.group("Failed to link program"),console.error("error: ",r.getError()),console.info("validate status: ",r.getProgramParameter(e,r.VALIDATE_STATUS)),console.info("program info log: ",r.getProgramInfoLog(e)),console.groupEnd(),r.deleteProgram(e),null)}function uo(r){const e=r.split(`
`),t=e.length.toString().length;return e.map((n,s)=>fo(s.toString(10),t,"0")+"| "+n).join(`
`)}function fo(r,e,t){const n=e-r.length;if(n<=0)return r;const s=[];for(let o=0;o<n;o++)s.push(t);return s.push(r),s.join("")}var Q;(function(r){r[r.I1=0]="I1",r[r.F1=1]="F1",r[r.F2=2]="F2",r[r.F3=3]="F3",r[r.F4=4]="F4"})(Q||(Q={}));class ho{constructor(e,t){d(this,"location");d(this,"type");this.location=e,this.type=t}}function lt(r,e,t){const n={},s=[];for(const l in t){if(!t.hasOwnProperty(l))continue;const a=r.getUniformLocation(e,l);a===null?s.push(l):n[l]=new ho(a,t[l])}if(s.length===0)return n;let o="Failed to find location for uniforms";for(let l=0;l<s.length;l++)o+=`
 - `+s[l];return console.error(o),null}function at(r,e,t){for(const n in e){if(!t.hasOwnProperty(n))continue;const s=e[n];switch(s.type){case Q.I1:{const o=t[n];r.uniform1i(s.location,o);break}case Q.F1:{const o=t[n];r.uniform1f(s.location,o);break}case Q.F2:{const o=t[n];r.uniform2f(s.location,o.x,o.y);break}case Q.F3:{const o=t[n];r.uniform3f(s.location,o.x,o.y,o.z);break}case Q.F4:{const o=t[n];r.uniform4f(s.location,o.x,o.y,o.z,o.w);break}default:throw s.type,{"unexpected type":s}}}}var ce;(function(r){r[r.Float=0]="Float"})(ce||(ce={}));class mo{constructor(e,t){d(this,"name");d(this,"size");d(this,"glType");d(this,"bytes");switch(this.name=t.name,this.size=t.size,t.type){case ce.Float:this.glType=e.FLOAT,this.bytes=t.size*4;break;default:throw t.type,{"Unexpected type on attribute":t}}}}class it{constructor(e,t){d(this,"size");d(this,"stride");d(this,"attributes");{const n=new Array(t.length);for(let s=0;s<t.length;s++){const o=t[s];n[s]=new mo(e,o)}this.attributes=n}{let n=0;for(let s=0;s<this.attributes.length;s++)n+=this.attributes[s].size;this.size=n,this.stride=n*4}}bindAttribLocations(e,t){const{attributes:n}=this;for(let s=0;s<n.length;s++)e.bindAttribLocation(t,s,n[s].name)}vertexAttrib(e){const{attributes:t}=this;let n=0;for(let s=0;s<t.length;s++){const o=t[s];e.vertexAttribPointer(s,o.size,o.glType,!1,this.stride,n),n+=o.bytes}for(let s=0;s<t.length;s++)e.enableVertexAttribArray(s)}getDrawCount(e){return e/this.size}}class po{constructor(e){d(this,"canvas");d(this,"gl");d(this,"ringRenderer");d(this,"satValRenderer");this.canvas=e;const t=e.getContext("webgl");if(t===null)throw new Error("Failed to init webgl");t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA),t.enable(t.BLEND),t.disable(t.DEPTH_TEST),this.gl=t,this.ringRenderer=new vo(t),this.satValRenderer=new yo(t)}render(e,t){this.gl.clearColor(0,0,0,0),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.ringRenderer.render(e,t),this.satValRenderer.render(e,t)}getThumbPositions(e,t){const n=this.canvas.getBoundingClientRect();let s,o,l;if(e===Z.Hsluv)s=(t.h+180)%360,o=t.s/100,l=t.l/100;else{const h=Oe(t.toRgb());s=(h.h*360+180)%360,o=h.s,l=h.v}let a=0,i=0;if(n!==null){const f=n.left+80,m=n.top+80,p=s*Math.PI/180,g=(80-8)*Math.cos(p),_=(80-8)*Math.sin(p);a=f+g,i=m+_}let c=0,u=0;if(n!==null){const h=n.width*.225,f=n.width*.55;c=n.left+h+f*o,u=n.top+h+f*(1-l)}return{angle:s,circleThumbX:a,circleThumbY:i,areaThumbX:c,areaThumbY:u}}dispose(){this.ringRenderer.dispose(),this.satValRenderer.dispose(),Kr(this.canvas)}}const Gn=`
precision highp float;

attribute vec2 a_position;

varying vec2 v_position;

void main() {
    gl_Position = vec4(a_position, 0.0, 1.0);

    v_position = a_position;
}
`;function jr(r){return`
    precision highp float;
    
    ${oo}

    ${r}
    
    #define INNER_RAD1 0.83
    #define INNER_RAD2 0.85
    #define OUTER_RAD1 0.98
    #define OUTER_RAD2 1.00
    
    varying vec2 v_position;
    
    uniform vec3 u_color;
    
    void main() {
        vec2 pos = v_position * vec2(1.0, -1.0);
        float dist = sqrt(dot(pos, pos));
    
        float a = smoothstep(INNER_RAD1, INNER_RAD2, dist) - smoothstep(OUTER_RAD1, OUTER_RAD2, dist);
    
        float radians = atan(pos.y, pos.x);
        float hue = (radians / TAU) + 0.5;
    
        vec3 hsluv = vec3(hue, 1.0, a);
    
        gl_FragColor = vec4(toRgb(u_color, hsluv) * a, a);
    }
    `}const go=jr(`
${Wr}

vec3 toRgb(vec3 color, vec3 xyz) {
    return hsvToRgb(xyz * vec3(1.0, color.y, color.z));
}
`),_o=jr(`
${Zr}

vec3 toRgb(vec3 color, vec3 xyz) {
    return hsluvToRgb(xyz * vec3(360.0, color.y, color.z));
}
`);class vo{constructor(e){d(this,"gl");d(this,"buffer");d(this,"program",null);d(this,"colorLocation",null);d(this,"prevColorType",null);this.gl=e,this.buffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.buffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array([1,1,-1,1,1,-1,-1,-1]),e.STATIC_DRAW)}render(e,t){if(!this.program||this.prevColorType!==e){switch(this.program&&this.gl.deleteProgram(this.program),e){case Z.Hsv:this.program=ve(this.gl,Gn,go);break;case Z.Hsluv:this.program=ve(this.gl,Gn,_o);break}this.gl.bindAttribLocation(this.program,0,"a_position"),this.colorLocation=this.gl.getUniformLocation(this.program,"u_color"),this.prevColorType=e}switch(this.gl.useProgram(this.program),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.buffer),this.gl.vertexAttribPointer(0,2,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(0),e){case Z.Hsv:{const n=Oe(Yr(t));this.gl.uniform3f(this.colorLocation,n.h,n.s,n.v);break}case Z.Hsluv:{this.gl.uniform3f(this.colorLocation,t.h,t.s,t.l);break}}this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4)}dispose(){this.gl.deleteBuffer(this.buffer),this.gl.deleteProgram(this.program)}}const le=.55,qn=`
precision highp float;

attribute vec2 a_position;

varying vec2 v_tex_position;

void main() {
    gl_Position = vec4(a_position, 0.0, 1.0);

    v_tex_position = ((a_position / ${le.toFixed(2)}) + 1.0) / 2.0;
}
`;function Qr(r){return`
    precision highp float;

    ${r}
    
    varying vec2 v_tex_position;
    
    uniform vec3 u_color;
    
    void main() {
        // mix saturation from left to right [0, 1]
        // mix value from bottom to top: [0, 1]
        float x = v_tex_position.x;
        float y = v_tex_position.y;
    
        gl_FragColor = vec4(
            toRgb(u_color.x, x, y),
            1.0
        );
    }
    `}const $o=Qr(`
${Wr}

vec3 toRgb(float hue, float x, float y) {
    return hsvToRgb(vec3(hue, x, y));
}
`),bo=Qr(`
${Zr}

vec3 toRgb(float hue, float x, float y) {
    return hsluvToRgb(vec3(hue, x * 100.0, y * 100.0));
}
`);class yo{constructor(e){d(this,"gl");d(this,"buffer");d(this,"colorLocation",null);d(this,"program",null);d(this,"prevColorMode",null);this.gl=e,this.buffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.buffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array([le,le,-le,le,le,-le,-le,le,le,-le,-le,-le]),e.STATIC_DRAW)}render(e,t){const n=this.gl;if(!this.program||this.prevColorMode!==e){switch(this.program&&n.deleteProgram(this.program),e){case Z.Hsv:this.program=ve(n,qn,$o);break;case Z.Hsluv:this.program=ve(n,qn,bo);break;default:throw{"unexpected color mode":e}}n.bindAttribLocation(this.program,0,"a_position"),this.colorLocation=n.getUniformLocation(this.program,"u_color")}switch(n.useProgram(this.program),n.bindBuffer(n.ARRAY_BUFFER,this.buffer),n.vertexAttribPointer(0,2,n.FLOAT,!1,0,0),n.enableVertexAttribArray(0),e){case Z.Hsv:{const s=Oe(Yr(t));this.gl.uniform3f(this.colorLocation,s.h,s.s,s.v);break}case Z.Hsluv:{this.gl.uniform3f(this.colorLocation,t.h,t.s,t.l);break}}n.drawArrays(n.TRIANGLES,0,6),this.prevColorMode=e}dispose(){const e=this.gl;e.deleteBuffer(this.buffer),e.deleteProgram(this.program)}}function wo(r){let e,t,n,s,o,l,a,i,c,u,h;return{c(){e=P("div"),t=P("div"),n=P("div"),s=D(),o=P("div"),a=D(),i=P("div"),this.h()},l(f){e=M(f,"DIV",{class:!0});var m=x(e);t=M(m,"DIV",{});var p=x(t);n=M(p,"DIV",{}),x(n).forEach($),s=N(p),o=M(p,"DIV",{class:!0,style:!0}),x(o).forEach($),a=N(p),i=M(p,"DIV",{class:!0,style:!0}),x(i).forEach($),p.forEach($),m.forEach($),this.h()},h(){R(o,"class","circleThumb svelte-wwm2hq"),R(o,"style",l=r[3]==null?void 0:`left: ${r[3].circleThumbX}px; top: ${r[3].circleThumbY}px; background-color: ${r[0].toStyle()}; border-color: ${r[0].l>50?"black":"white"}; transform: rotate(${r[3].angle}deg)`),R(i,"class","areaThumb svelte-wwm2hq"),R(i,"style",c=r[3]==null?void 0:`left: ${r[3].areaThumbX}px; top: ${r[3].areaThumbY}px; background-color: ${r[0].toStyle()}; border-color: ${r[0].l>50?"black":"white"}`),R(e,"class","container svelte-wwm2hq")},m(f,m){O(f,e,m),E(e,t),E(t,n),r[7](n),E(t,s),E(t,o),E(t,a),E(t,i),r[8](e),u||(h=J(e,"mousedown",r[4]),u=!0)},p(f,[m]){m&9&&l!==(l=f[3]==null?void 0:`left: ${f[3].circleThumbX}px; top: ${f[3].circleThumbY}px; background-color: ${f[0].toStyle()}; border-color: ${f[0].l>50?"black":"white"}; transform: rotate(${f[3].angle}deg)`)&&R(o,"style",l),m&9&&c!==(c=f[3]==null?void 0:`left: ${f[3].areaThumbX}px; top: ${f[3].areaThumbY}px; background-color: ${f[0].toStyle()}; border-color: ${f[0].l>50?"black":"white"}`)&&R(i,"style",c)},i:W,o:W,d(f){f&&$(e),r[7](null),r[8](null),u=!1,h()}}}function Kn(r,e,t){return r>=e&&r<=t}function Ro(r,e,t){let n,{color:s}=e,{colorType:o}=e;const l=$e(),a=w=>{l("colorChange",w)};var i;(function(w){w[w.Default=0]="Default",w[w.DownOnInner=1]="DownOnInner",w[w.DownOnOuter=2]="DownOnOuter"})(i||(i={}));const c=(1-.55)/2;let u,h,f,m=i.Default;function p(w){if(!u)return;const L=u.getBoundingClientRect(),C=w.clientX-L.left-L.width*.5,z=w.clientY-L.top-L.height*.5,V=Math.atan2(z,C)/(Math.PI*2)+.5;switch(o){case Z.Hsv:{const oe=Oe(s.toRgb());a(be(oe.with({h:V}).toRgb()));break}case Z.Hsluv:{a(s.with({h:V*360}));break}}}function g(w){if(!u)return;const L=u.getBoundingClientRect(),C=L.width*c,z=L.height*c,I=L.width-C*2,V=L.height-z*2,oe=se(w.clientX-L.left-C,0,I),me=se(w.clientY-L.top-z,0,V),Ue=oe/I,ae=1-me/V;switch(o){case Z.Hsv:{const ke=Oe(s.toRgb()).h;a(be(Zs(new Ws(ke,Ue,ae))));break}case Z.Hsluv:{const ke=s.h;a(new Lt(ke,Ue*100,ae*100));break}}}Me(()=>{const w=h;if(w==null)throw{"canvas container ref not found":h};const L=eo({width:160,height:160});return w.appendChild(L),t(6,f=new po(L)),f.render(o,s),t(3,n=f.getThumbPositions(o,s)),()=>{!f||(h==null||h.removeChild(f.canvas),f.dispose(),Kr(f.canvas))}}),Me(()=>{const w=C=>{C.preventDefault(),m=i.Default},L=C=>{switch(m){case i.Default:break;case i.DownOnInner:C.preventDefault(),g(C);break;case i.DownOnOuter:C.preventDefault(),p(C);break}};return window.addEventListener("mouseup",w),window.addEventListener("mouseleave",w),window.addEventListener("mousemove",L),()=>{m=i.Default,window.removeEventListener("mouseup",w),window.removeEventListener("mouseleave",w),window.removeEventListener("mousemove",L)}});function _(w){if(!u)return;const L=u.getBoundingClientRect(),C=se(w.clientX-L.left,0,L.width),z=se(w.clientY-L.top,0,L.height),I=L.width*c,V=L.height*c;Kn(C,I,L.width-I)&&Kn(z,V,L.height-V)?(m=i.DownOnInner,g(w)):(m=i.DownOnOuter,p(w))}function v(w){He[w?"unshift":"push"](()=>{h=w,t(2,h)})}function S(w){He[w?"unshift":"push"](()=>{u=w,t(1,u)})}return r.$$set=w=>{"color"in w&&t(0,s=w.color),"colorType"in w&&t(5,o=w.colorType)},r.$$.update=()=>{r.$$.dirty&97&&t(3,n=f==null?void 0:f.getThumbPositions(o,s)),r.$$.dirty&97&&f&&f.render(o,s)},[s,u,h,n,_,o,f,v,S]}class Eo extends Y{constructor(e){super(),G(this,e,Ro,wo,q,{color:0,colorType:5})}}function So(r){let e,t;return{c(){e=tt("svg"),t=tt("path"),this.h()},l(n){e=nt(n,"svg",{width:!0,height:!0,viewBox:!0,xmlns:!0,class:!0});var s=x(e);t=nt(s,"path",{d:!0}),x(t).forEach($),s.forEach($),this.h()},h(){R(t,"d","M7 14c-1.66 0-3 1.34-3 3 0 1.31-1.16 2-2 2 .92 1.22 2.49 2 4 2 2.21 0 4-1.79 4-4 0-1.66-1.34-3-3-3zm13.71-9.37l-1.34-1.34c-.39-.39-1.02-.39-1.41 0L9 12.25 11.75 15l8.96-8.96c.39-.39.39-1.02 0-1.41z"),R(e,"width","24"),R(e,"height","24"),R(e,"viewBox","0 0 24 24"),R(e,"xmlns","http://www.w3.org/2000/svg"),R(e,"class","svelte-uxfzd6")},m(n,s){O(n,e,s),E(e,t)},p:W,i:W,o:W,d(n){n&&$(e)}}}class To extends Y{constructor(e){super(),G(this,e,null,So,q,{})}}function ko(r){let e,t;return{c(){e=tt("svg"),t=tt("path"),this.h()},l(n){e=nt(n,"svg",{width:!0,height:!0,viewBox:!0,xmlns:!0,class:!0});var s=x(e);t=nt(s,"path",{d:!0}),x(t).forEach($),s.forEach($),this.h()},h(){R(t,"d","M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"),R(e,"width","24"),R(e,"height","24"),R(e,"viewBox","0 0 24 24"),R(e,"xmlns","http://www.w3.org/2000/svg"),R(e,"class","svelte-uxfzd6")},m(n,s){O(n,e,s),E(e,t)},p:W,i:W,o:W,d(n){n&&$(e)}}}class Fo extends Y{constructor(e){super(),G(this,e,null,ko,q,{})}}function Ao(r){let e,t;return{c(){e=tt("svg"),t=tt("path"),this.h()},l(n){e=nt(n,"svg",{width:!0,height:!0,viewBox:!0,xmlns:!0,class:!0});var s=x(e);t=nt(s,"path",{d:!0}),x(t).forEach($),s.forEach($),this.h()},h(){R(t,"d","M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"),R(e,"width","24"),R(e,"height","24"),R(e,"viewBox","0 0 24 24"),R(e,"xmlns","http://www.w3.org/2000/svg"),R(e,"class","svelte-uxfzd6")},m(n,s){O(n,e,s),E(e,t)},p:W,i:W,o:W,d(n){n&&$(e)}}}class Lo extends Y{constructor(e){super(),G(this,e,null,Ao,q,{})}}function xo(r){let e,t,n,s,o;const l=r[2].default,a=Re(l,r,r[1],null);return{c(){e=P("div"),t=P("div"),n=ee(r[0]),s=D(),a&&a.c(),this.h()},l(i){e=M(i,"DIV",{class:!0});var c=x(e);t=M(c,"DIV",{class:!0});var u=x(t);n=te(u,r[0]),u.forEach($),s=N(c),a&&a.l(c),c.forEach($),this.h()},h(){R(t,"class","label svelte-19lfj27"),R(e,"class","container svelte-19lfj27")},m(i,c){O(i,e,c),E(e,t),E(t,n),E(e,s),a&&a.m(e,null),o=!0},p(i,[c]){(!o||c&1)&&de(n,i[0]),a&&a.p&&(!o||c&2)&&Ee(a,l,i,i[1],o?Te(l,i[1],c,null):Se(i[1]),null)},i(i){o||(b(a,i),o=!0)},o(i){y(a,i),o=!1},d(i){i&&$(e),a&&a.d(i)}}}function Po(r,e,t){let{$$slots:n={},$$scope:s}=e,{label:o}=e;return r.$$set=l=>{"label"in l&&t(0,o=l.label),"$$scope"in l&&t(1,s=l.$$scope)},[o,s,n]}class Wn extends Y{constructor(e){super(),G(this,e,Po,xo,q,{label:0})}}const Mo=r=>({}),Zn=r=>({}),Co=r=>({}),jn=r=>({});function Qn(r){let e,t,n,s,o,l,a,i,c,u;const h=r[5].body,f=Re(h,r,r[4],jn),m=r[5].footer,p=Re(m,r,r[4],Zn);return{c(){e=P("div"),t=P("div"),n=P("div"),f&&f.c(),s=D(),o=P("div"),l=D(),a=P("div"),p&&p.c(),this.h()},l(g){e=M(g,"DIV",{class:!0});var _=x(e);t=M(_,"DIV",{class:!0});var v=x(t);n=M(v,"DIV",{class:!0});var S=x(n);f&&f.l(S),S.forEach($),s=N(v),o=M(v,"DIV",{class:!0}),x(o).forEach($),l=N(v),a=M(v,"DIV",{class:!0});var w=x(a);p&&p.l(w),w.forEach($),v.forEach($),_.forEach($),this.h()},h(){R(n,"class","content svelte-fn9vql"),R(o,"class","divider svelte-fn9vql"),R(a,"class","footer svelte-fn9vql"),R(t,"class","container svelte-fn9vql"),R(e,"class","backgroundLayer svelte-fn9vql")},m(g,_){O(g,e,_),E(e,t),E(t,n),f&&f.m(n,null),E(t,s),E(t,o),E(t,l),E(t,a),p&&p.m(a,null),r[6](e),i=!0,c||(u=J(e,"click",r[2]),c=!0)},p(g,_){f&&f.p&&(!i||_&16)&&Ee(f,h,g,g[4],i?Te(h,g[4],_,Co):Se(g[4]),jn),p&&p.p&&(!i||_&16)&&Ee(p,m,g,g[4],i?Te(m,g[4],_,Mo):Se(g[4]),Zn)},i(g){i||(b(f,g),b(p,g),i=!0)},o(g){y(f,g),y(p,g),i=!1},d(g){g&&$(e),f&&f.d(g),p&&p.d(g),r[6](null),c=!1,u()}}}function Bo(r){let e,t,n=r[0]&&Qn(r);return{c(){n&&n.c(),e=kt()},l(s){n&&n.l(s),e=kt()},m(s,o){n&&n.m(s,o),O(s,e,o),t=!0},p(s,[o]){s[0]?n?(n.p(s,o),o&1&&b(n,1)):(n=Qn(s),n.c(),b(n,1),n.m(e.parentNode,e)):n&&(xe(),y(n,1,1,()=>{n=null}),Pe())},i(s){t||(b(n),t=!0)},o(s){y(n),t=!1},d(s){n&&n.d(s),s&&$(e)}}}function Io(r,e,t){let{$$slots:n={},$$scope:s}=e,{isOpen:o}=e,{onClose:l}=e,a;const i=u=>{u.target===a&&l()};Er(()=>{o?document.body.style.overflow="hidden":document.body.style.overflow=""});function c(u){He[u?"unshift":"push"](()=>{a=u,t(1,a)})}return r.$$set=u=>{"isOpen"in u&&t(0,o=u.isOpen),"onClose"in u&&t(3,l=u.onClose),"$$scope"in u&&t(4,s=u.$$scope)},[o,a,i,l,s,n,c]}class Do extends Y{constructor(e){super(),G(this,e,Io,Bo,q,{isOpen:0,onClose:3})}}function No(r){let e,t;const n=r[2].default,s=Re(n,r,r[1],null);return{c(){e=P("div"),s&&s.c(),this.h()},l(o){e=M(o,"DIV",{class:!0,style:!0});var l=x(e);s&&s.l(l),l.forEach($),this.h()},h(){R(e,"class","row svelte-1r2824"),pe(e,"gap",r[0]+"rem")},m(o,l){O(o,e,l),s&&s.m(e,null),t=!0},p(o,[l]){s&&s.p&&(!t||l&2)&&Ee(s,n,o,o[1],t?Te(n,o[1],l,null):Se(o[1]),null),(!t||l&1)&&pe(e,"gap",o[0]+"rem")},i(o){t||(b(s,o),t=!0)},o(o){y(s,o),t=!1},d(o){o&&$(e),s&&s.d(o)}}}function Ho(r,e,t){let{$$slots:n={},$$scope:s}=e,{spacing:o}=e;return r.$$set=l=>{"spacing"in l&&t(0,o=l.spacing),"$$scope"in l&&t(1,s=l.$$scope)},[o,s,n]}class Jr extends Y{constructor(e){super(),G(this,e,Ho,No,q,{spacing:0})}}function Oo(r){let e,t,n;return{c(){e=P("input"),this.h()},l(s){e=M(s,"INPUT",{class:!0,type:!0}),this.h()},h(){R(e,"class","textInput svelte-x1veui"),R(e,"type","text")},m(s,o){O(s,e,o),r[6](e),Un(e,r[1]),t||(n=[J(e,"input",r[7]),J(e,"paste",r[2]),J(e,"change",r[2]),J(e,"keydown",r[3])],t=!0)},p(s,[o]){o&2&&e.value!==s[1]&&Un(e,s[1])},i:W,o:W,d(s){s&&$(e),r[6](null),t=!1,Sr(n)}}}function zo(r,e,t){let{initialValue:n}=e,{autoFocus:s=!1}=e;const o=$e();let l=null,a=n;function i(f){o("change",f.target.value)}function c(f){f.key==="Enter"&&o("enter",a)}Me(()=>{s&&(l==null||l.focus())});function u(f){He[f?"unshift":"push"](()=>{l=f,t(0,l)})}function h(){a=this.value,t(1,a)}return r.$$set=f=>{"initialValue"in f&&t(4,n=f.initialValue),"autoFocus"in f&&t(5,s=f.autoFocus)},[l,a,i,c,n,s,u,h]}class es extends Y{constructor(e){super(),G(this,e,zo,Oo,q,{initialValue:4,autoFocus:5})}}function Uo(r){let e,t,n,s,o;return s=new es({props:{initialValue:r[3],autoFocus:!0}}),s.$on("change",r[12]),s.$on("enter",r[13]),{c(){e=P("div"),t=ee(r[0]),n=D(),T(s.$$.fragment),this.h()},l(l){e=M(l,"DIV",{class:!0});var a=x(e);t=te(a,r[0]),a.forEach($),n=N(l),k(s.$$.fragment,l),this.h()},h(){R(e,"class","title-text svelte-1tm4qf2")},m(l,a){O(l,e,a),E(e,t),O(l,n,a),F(s,l,a),o=!0},p(l,a){(!o||a&1)&&de(t,l[0]);const i={};a&8&&(i.initialValue=l[3]),s.$set(i)},i(l){o||(b(s.$$.fragment,l),o=!0)},o(l){y(s.$$.fragment,l),o=!1},d(l){l&&$(e),l&&$(n),A(s,l)}}}function Vo(r){let e;return{c(){e=ee("Cancel")},l(t){e=te(t,"Cancel")},m(t,n){O(t,e,n)},d(t){t&&$(e)}}}function Xo(r){let e;return{c(){e=ee("Update")},l(t){e=te(t,"Update")},m(t,n){O(t,e,n)},d(t){t&&$(e)}}}function Yo(r){let e,t,n,s;return e=new tn({props:{$$slots:{default:[Vo]},$$scope:{ctx:r}}}),e.$on("click",r[6]),n=new kr({props:{$$slots:{default:[Xo]},$$scope:{ctx:r}}}),n.$on("click",r[11]),{c(){T(e.$$.fragment),t=D(),T(n.$$.fragment)},l(o){k(e.$$.fragment,o),t=N(o),k(n.$$.fragment,o)},m(o,l){F(e,o,l),O(o,t,l),F(n,o,l),s=!0},p(o,l){const a={};l&16384&&(a.$$scope={dirty:l,ctx:o}),e.$set(a);const i={};l&16384&&(i.$$scope={dirty:l,ctx:o}),n.$set(i)},i(o){s||(b(e.$$.fragment,o),b(n.$$.fragment,o),s=!0)},o(o){y(e.$$.fragment,o),y(n.$$.fragment,o),s=!1},d(o){A(e,o),o&&$(t),A(n,o)}}}function Go(r){let e,t;return e=new Jr({props:{spacing:.5,slot:"footer",$$slots:{default:[Yo]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},l(n){k(e.$$.fragment,n)},m(n,s){F(e,n,s),t=!0},p(n,s){const o={};s&16392&&(o.$$scope={dirty:s,ctx:n}),e.$set(o)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){y(e.$$.fragment,n),t=!1},d(n){A(e,n)}}}function qo(r){var w;let e,t,n,s,o,l,a,i=((w=r[1])!=null?w:"")+"",c,u,h,f,m,p,g,_;h=new Do({props:{isOpen:r[2],onClose:r[6],$$slots:{footer:[Go],body:[Uo]},$$scope:{ctx:r}}});const v=r[10].default,S=Re(v,r,r[14],null);return{c(){e=P("div"),t=P("div"),n=P("p"),s=ee(r[0]),o=D(),l=P("p"),a=ee(r[3]),c=ee(i),u=D(),T(h.$$.fragment),f=D(),m=P("div"),S&&S.c(),this.h()},l(L){e=M(L,"DIV",{class:!0});var C=x(e);t=M(C,"DIV",{class:!0});var z=x(t);n=M(z,"P",{class:!0});var I=x(n);s=te(I,r[0]),I.forEach($),o=N(z),l=M(z,"P",{class:!0});var V=x(l);a=te(V,r[3]),c=te(V,i),V.forEach($),z.forEach($),u=N(C),k(h.$$.fragment,C),f=N(C),m=M(C,"DIV",{class:!0});var oe=x(m);S&&S.l(oe),oe.forEach($),C.forEach($),this.h()},h(){R(n,"class","label svelte-1tm4qf2"),R(l,"class","label svelte-1tm4qf2"),R(t,"class","textContainer svelte-1tm4qf2"),R(m,"class","content svelte-1tm4qf2"),R(e,"class","container svelte-1tm4qf2")},m(L,C){O(L,e,C),E(e,t),E(t,n),E(n,s),E(t,o),E(t,l),E(l,a),E(l,c),E(e,u),F(h,e,null),E(e,f),E(e,m),S&&S.m(m,null),p=!0,g||(_=J(l,"click",r[5]),g=!0)},p(L,[C]){var I;(!p||C&1)&&de(s,L[0]),(!p||C&8)&&de(a,L[3]),(!p||C&2)&&i!==(i=((I=L[1])!=null?I:"")+"")&&de(c,i);const z={};C&4&&(z.isOpen=L[2]),C&16393&&(z.$$scope={dirty:C,ctx:L}),h.$set(z),S&&S.p&&(!p||C&16384)&&Ee(S,v,L,L[14],p?Te(v,L[14],C,null):Se(L[14]),null)},i(L){p||(b(h.$$.fragment,L),b(S,L),p=!0)},o(L){y(h.$$.fragment,L),y(S,L),p=!1},d(L){L&&$(e),A(h),S&&S.d(L),g=!1,_()}}}function Ko(r,e,t){let n,{$$slots:s={},$$scope:o}=e,{label:l}=e,{valuePostfix:a=void 0}=e,{value:i=""}=e;const c=$e();let u=!1;const h=w=>{t(3,n=w)},f=()=>{t(2,u=!0)},m=()=>{t(2,u=!1)},p=w=>{w===null||(c("change",w),t(2,u=!1))},g=w=>{h(w),p(w)},_=()=>p(n),v=w=>h(w.detail),S=w=>g(w.detail);return r.$$set=w=>{"label"in w&&t(0,l=w.label),"valuePostfix"in w&&t(1,a=w.valuePostfix),"value"in w&&t(9,i=w.value),"$$scope"in w&&t(14,o=w.$$scope)},r.$$.update=()=>{r.$$.dirty&512&&t(3,n=i)},[l,a,u,n,h,f,m,p,g,i,s,_,v,S,o]}class K extends Y{constructor(e){super(),G(this,e,Ko,qo,q,{label:0,valuePostfix:1,value:9})}}function Jn(r,e,t){const n=r.slice();return n[12]=e[t],n}function er(r,e,t){const n=r.slice();return n[12]=e[t],n}function tr(r){let e,t,n,s,o=r[1](r[0].focus)+"",l,a,i,c,u,h=r[0].getLeft(),f=[];for(let g=0;g<h.length;g+=1)f[g]=nr(er(r,h,g));let m=r[0].getRight(),p=[];for(let g=0;g<m.length;g+=1)p[g]=rr(Jn(r,m,g));return{c(){e=P("div"),t=P("div");for(let g=0;g<f.length;g+=1)f[g].c();n=D(),s=P("div"),l=ee(o),a=D();for(let g=0;g<p.length;g+=1)p[g].c();this.h()},l(g){e=M(g,"DIV",{class:!0,style:!0});var _=x(e);t=M(_,"DIV",{class:!0});var v=x(t);for(let w=0;w<f.length;w+=1)f[w].l(v);n=N(v),s=M(v,"DIV",{class:!0});var S=x(s);l=te(S,o),S.forEach($),a=N(v);for(let w=0;w<p.length;w+=1)p[w].l(v);v.forEach($),_.forEach($),this.h()},h(){R(s,"class","optionSelected svelte-2j7vup"),R(t,"class","svelte-2j7vup"),R(e,"class","selectableOptions svelte-2j7vup"),R(e,"style",i=`margin-top: ${r[2]==null?"auto":`calc(-0.5rem - ${r[2].getBoundingClientRect().height}px)`};`)},m(g,_){O(g,e,_),E(e,t);for(let v=0;v<f.length;v+=1)f[v].m(t,null);E(t,n),E(t,s),E(s,l),E(t,a);for(let v=0;v<p.length;v+=1)p[v].m(t,null);c||(u=J(s,"click",r[5]),c=!0)},p(g,_){if(_&67){h=g[0].getLeft();let v;for(v=0;v<h.length;v+=1){const S=er(g,h,v);f[v]?f[v].p(S,_):(f[v]=nr(S),f[v].c(),f[v].m(t,n))}for(;v<f.length;v+=1)f[v].d(1);f.length=h.length}if(_&3&&o!==(o=g[1](g[0].focus)+"")&&de(l,o),_&67){m=g[0].getRight();let v;for(v=0;v<m.length;v+=1){const S=Jn(g,m,v);p[v]?p[v].p(S,_):(p[v]=rr(S),p[v].c(),p[v].m(t,null))}for(;v<p.length;v+=1)p[v].d(1);p.length=m.length}_&4&&i!==(i=`margin-top: ${g[2]==null?"auto":`calc(-0.5rem - ${g[2].getBoundingClientRect().height}px)`};`)&&R(e,"style",i)},d(g){g&&$(e),en(f,g),en(p,g),c=!1,u()}}}function nr(r){let e,t=r[1](r[12])+"",n,s,o;function l(){return r[7](r[12])}return{c(){e=P("div"),n=ee(t),this.h()},l(a){e=M(a,"DIV",{class:!0});var i=x(e);n=te(i,t),i.forEach($),this.h()},h(){R(e,"class","optionDefault svelte-2j7vup")},m(a,i){O(a,e,i),E(e,n),s||(o=J(e,"click",l),s=!0)},p(a,i){r=a,i&3&&t!==(t=r[1](r[12])+"")&&de(n,t)},d(a){a&&$(e),s=!1,o()}}}function rr(r){let e,t=r[1](r[12])+"",n,s,o,l;function a(){return r[8](r[12])}return{c(){e=P("div"),n=ee(t),s=D(),this.h()},l(i){e=M(i,"DIV",{class:!0});var c=x(e);n=te(c,t),s=N(c),c.forEach($),this.h()},h(){R(e,"class","optionDefault svelte-2j7vup")},m(i,c){O(i,e,c),E(e,n),E(e,s),o||(l=J(e,"click",a),o=!0)},p(i,c){r=i,c&3&&t!==(t=r[1](r[12])+"")&&de(n,t)},d(i){i&&$(e),o=!1,l()}}}function Wo(r){let e,t,n=r[1](r[0].focus)+"",s,o,l,a,i,c=r[3]&&tr(r);return{c(){e=P("div"),t=P("div"),s=ee(n),l=D(),c&&c.c(),this.h()},l(u){e=M(u,"DIV",{class:!0});var h=x(e);t=M(h,"DIV",{class:!0});var f=x(t);s=te(f,n),f.forEach($),l=N(h),c&&c.l(h),h.forEach($),this.h()},h(){R(t,"class",o=_e(r[3]?"selectedDisplayExpanded":"selectedDisplay")+" svelte-2j7vup"),R(e,"class","container svelte-2j7vup")},m(u,h){O(u,e,h),E(e,t),E(t,s),E(e,l),c&&c.m(e,null),r[9](e),a||(i=[J(t,"click",r[4]),J(e,"blur",r[5])],a=!0)},p(u,[h]){h&3&&n!==(n=u[1](u[0].focus)+"")&&de(s,n),h&8&&o!==(o=_e(u[3]?"selectedDisplayExpanded":"selectedDisplay")+" svelte-2j7vup")&&R(t,"class",o),u[3]?c?c.p(u,h):(c=tr(u),c.c(),c.m(e,null)):c&&(c.d(1),c=null)},i:W,o:W,d(u){u&&$(e),c&&c.d(),r[9](null),a=!1,Sr(i)}}}function Zo(r,e,t){let{choices:n}=e,{show:s}=e;const o=$e();let l=null,a=!1;const i=g=>{if(!a)return;let _=g.target;for(;_.parentElement!==null;){if(_===l)return;_=_.parentElement}u()},c=()=>{t(3,a=!0)},u=()=>{t(3,a=!1)},h=g=>{o("select",g),u()};Me(()=>(document.body.addEventListener("mousedown",i,{passive:!0}),()=>{document.body.removeEventListener("mousedown",i)}));const f=g=>h(g),m=g=>h(g);function p(g){He[g?"unshift":"push"](()=>{l=g,t(2,l)})}return r.$$set=g=>{"choices"in g&&t(0,n=g.choices),"show"in g&&t(1,s=g.show)},[n,s,l,a,c,u,h,f,m,p]}class jo extends Y{constructor(e){super(),G(this,e,Zo,Wo,q,{choices:0,show:1})}}function Qo(r){let e,t,n,s,o,l,a,i,c,u,h,f;return{c(){e=P("div"),t=P("div"),n=P("div"),l=D(),a=P("div"),c=D(),u=P("div"),this.h()},l(m){e=M(m,"DIV",{class:!0});var p=x(e);t=M(p,"DIV",{});var g=x(t);n=M(g,"DIV",{class:!0,style:!0}),x(n).forEach($),l=N(g),a=M(g,"DIV",{class:!0,style:!0}),x(a).forEach($),c=N(g),u=M(g,"DIV",{class:!0}),x(u).forEach($),g.forEach($),p.forEach($),this.h()},h(){var m,p;R(n,"class",s=_e(r[0]===0?"emptyButton":"button")+" svelte-1v7d1ps"),R(n,"style",o=`left: calc(${r[3]} * calc(100% - 0.75rem)); background-color: ${(m=r[1])==null?void 0:m.toStyle()}`),R(a,"class","filledLineClass svelte-1v7d1ps"),R(a,"style",i=`width: ${r[3]*100}%; background-color: ${(p=r[1])==null?void 0:p.toStyle()}`),R(u,"class","baseline svelte-1v7d1ps"),R(e,"class","container svelte-1v7d1ps")},m(m,p){O(m,e,p),E(e,t),E(t,n),E(t,l),E(t,a),E(t,c),E(t,u),r[5](e),h||(f=J(e,"mousedown",r[4]),h=!0)},p(m,[p]){var g,_;p&1&&s!==(s=_e(m[0]===0?"emptyButton":"button")+" svelte-1v7d1ps")&&R(n,"class",s),p&10&&o!==(o=`left: calc(${m[3]} * calc(100% - 0.75rem)); background-color: ${(g=m[1])==null?void 0:g.toStyle()}`)&&R(n,"style",o),p&10&&i!==(i=`width: ${m[3]*100}%; background-color: ${(_=m[1])==null?void 0:_.toStyle()}`)&&R(a,"style",i)},i:W,o:W,d(m){m&&$(e),r[5](null),h=!1,f()}}}function Jo(r,e,t){let n,{value:s}=e,{color:o=void 0}=e;const l=$e();let a=null,i=!1;const c=p=>{if(!a)return;const g=a.getBoundingClientRect(),v=16*.75,S=g.width-v,w=se(p.clientX-g.left-v/2,0,S);l("change",w/S)},u=p=>{c(p),i=!0},h=()=>{i=!1},f=p=>{i&&c(p)};Me(()=>(document.body.addEventListener("mouseup",h,{passive:!0}),document.body.addEventListener("mouseleave",h,{passive:!0}),document.body.addEventListener("mousemove",f,{passive:!0}),()=>{document.body.removeEventListener("mouseup",h),document.body.removeEventListener("mouseleave",h),document.body.removeEventListener("mousemove",f)}));function m(p){He[p?"unshift":"push"](()=>{a=p,t(2,a)})}return r.$$set=p=>{"value"in p&&t(0,s=p.value),"color"in p&&t(1,o=p.color)},r.$$.update=()=>{r.$$.dirty&1&&t(3,n=se(s,0,1))},[s,o,a,n,u,m]}class j extends Y{constructor(e){super(),G(this,e,Jo,Qo,q,{value:0,color:1})}}function el(r){let e,t;const n=r[1].default,s=Re(n,r,r[0],null);return{c(){e=P("div"),s&&s.c(),this.h()},l(o){e=M(o,"DIV",{class:!0});var l=x(e);s&&s.l(l),l.forEach($),this.h()},h(){R(e,"class","surface svelte-bbao3p")},m(o,l){O(o,e,l),s&&s.m(e,null),t=!0},p(o,[l]){s&&s.p&&(!t||l&1)&&Ee(s,n,o,o[0],t?Te(n,o[0],l,null):Se(o[0]),null)},i(o){t||(b(s,o),t=!0)},o(o){y(s,o),t=!1},d(o){o&&$(e),s&&s.d(o)}}}function tl(r,e,t){let{$$slots:n={},$$scope:s}=e;return r.$$set=o=>{"$$scope"in o&&t(0,s=o.$$scope)},[s,n]}class _t extends Y{constructor(e){super(),G(this,e,tl,el,q,{})}}function nl(r){let e,t,n,s,o,l,a,i,c;return{c(){e=P("span"),t=P("span"),n=P("span"),l=D(),a=P("span"),this.h()},l(u){e=M(u,"SPAN",{class:!0});var h=x(e);t=M(h,"SPAN",{class:!0,style:!0});var f=x(t);n=M(f,"SPAN",{class:!0}),x(n).forEach($),f.forEach($),l=N(h),a=M(h,"SPAN",{class:!0}),x(a).forEach($),h.forEach($),this.h()},h(){R(n,"class",s=_e(`switchButton ${r[0]?"bgColorPrimary":"bgColorSecondary"}`)+" svelte-lpbvur"),R(t,"class","switchButtonContainer svelte-lpbvur"),R(t,"style",o=r[0]?"transform: translate(0.75rem, -0.125rem)":"transform: translate(0, -0.125rem)"),R(a,"class","switchBar svelte-lpbvur"),R(e,"class","xswitch svelte-lpbvur")},m(u,h){O(u,e,h),E(e,t),E(t,n),E(e,l),E(e,a),i||(c=J(e,"click",r[1]),i=!0)},p(u,[h]){h&1&&s!==(s=_e(`switchButton ${u[0]?"bgColorPrimary":"bgColorSecondary"}`)+" svelte-lpbvur")&&R(n,"class",s),h&1&&o!==(o=u[0]?"transform: translate(0.75rem, -0.125rem)":"transform: translate(0, -0.125rem)")&&R(t,"style",o)},i:W,o:W,d(u){u&&$(e),i=!1,c()}}}function rl(r,e,t){let{checked:n}=e;const s=$e();function o(){s("change",!n)}return r.$$set=l=>{"checked"in l&&t(0,n=l.checked)},[n,o]}class vt extends Y{constructor(e){super(),G(this,e,rl,nl,q,{checked:0})}}function sl(r){let e,t;return e=new j({props:{value:r[1].h}}),e.$on("change",r[3]),{c(){T(e.$$.fragment)},l(n){k(e.$$.fragment,n)},m(n,s){F(e,n,s),t=!0},p(n,s){const o={};s&2&&(o.value=n[1].h),e.$set(o)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){y(e.$$.fragment,n),t=!1},d(n){A(e,n)}}}function ol(r){let e,t;return e=new j({props:{value:r[1].s}}),e.$on("change",r[5]),{c(){T(e.$$.fragment)},l(n){k(e.$$.fragment,n)},m(n,s){F(e,n,s),t=!0},p(n,s){const o={};s&2&&(o.value=n[1].s),e.$set(o)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){y(e.$$.fragment,n),t=!1},d(n){A(e,n)}}}function ll(r){let e,t;return e=new j({props:{value:r[1].l}}),e.$on("change",r[7]),{c(){T(e.$$.fragment)},l(n){k(e.$$.fragment,n)},m(n,s){F(e,n,s),t=!0},p(n,s){const o={};s&2&&(o.value=n[1].l),e.$set(o)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){y(e.$$.fragment,n),t=!1},d(n){A(e,n)}}}function al(r){let e,t,n,s,o,l;return e=new K({props:{label:"Hue",value:r[1].h.toFixed(2),$$slots:{default:[sl]},$$scope:{ctx:r}}}),e.$on("change",r[4]),n=new K({props:{label:"Saturation",value:r[1].s.toFixed(2),$$slots:{default:[ol]},$$scope:{ctx:r}}}),n.$on("change",r[6]),o=new K({props:{label:"Luminosity",value:r[1].l.toFixed(2),$$slots:{default:[ll]},$$scope:{ctx:r}}}),o.$on("change",r[8]),{c(){T(e.$$.fragment),t=D(),T(n.$$.fragment),s=D(),T(o.$$.fragment)},l(a){k(e.$$.fragment,a),t=N(a),k(n.$$.fragment,a),s=N(a),k(o.$$.fragment,a)},m(a,i){F(e,a,i),O(a,t,i),F(n,a,i),O(a,s,i),F(o,a,i),l=!0},p(a,[i]){const c={};i&2&&(c.value=a[1].h.toFixed(2)),i&515&&(c.$$scope={dirty:i,ctx:a}),e.$set(c);const u={};i&2&&(u.value=a[1].s.toFixed(2)),i&515&&(u.$$scope={dirty:i,ctx:a}),n.$set(u);const h={};i&2&&(h.value=a[1].l.toFixed(2)),i&515&&(h.$$scope={dirty:i,ctx:a}),o.$set(h)},i(a){l||(b(e.$$.fragment,a),b(n.$$.fragment,a),b(o.$$.fragment,a),l=!0)},o(a){y(e.$$.fragment,a),y(n.$$.fragment,a),y(o.$$.fragment,a),l=!1},d(a){A(e,a),a&&$(t),A(n,a),a&&$(s),A(o,a)}}}function il(r,e,t){let{sender:n}=e,{color:s}=e;const o=(f,m)=>{const p=ot(f.detail);p!=null&&m(p)},l=f=>n.setColor(s.with({h:f.detail})),a=f=>o(f,m=>n.setColor(s.with({h:m}))),i=f=>n.setColor(s.with({s:f.detail})),c=f=>o(f,m=>n.setColor(s.with({s:m}))),u=f=>n.setColor(s.with({l:f.detail})),h=f=>o(f,m=>n.setColor(s.with({l:m})));return r.$$set=f=>{"sender"in f&&t(0,n=f.sender),"color"in f&&t(1,s=f.color)},[n,s,o,l,a,i,c,u,h]}class cl extends Y{constructor(e){super(),G(this,e,il,al,q,{sender:0,color:1})}}function ul(r){let e,t;return e=new j({props:{value:r[1].h}}),e.$on("change",r[3]),{c(){T(e.$$.fragment)},l(n){k(e.$$.fragment,n)},m(n,s){F(e,n,s),t=!0},p(n,s){const o={};s&2&&(o.value=n[1].h),e.$set(o)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){y(e.$$.fragment,n),t=!1},d(n){A(e,n)}}}function fl(r){let e,t;return e=new j({props:{value:r[1].s}}),e.$on("change",r[5]),{c(){T(e.$$.fragment)},l(n){k(e.$$.fragment,n)},m(n,s){F(e,n,s),t=!0},p(n,s){const o={};s&2&&(o.value=n[1].s),e.$set(o)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){y(e.$$.fragment,n),t=!1},d(n){A(e,n)}}}function hl(r){let e,t;return e=new j({props:{value:r[1].v}}),e.$on("change",r[7]),{c(){T(e.$$.fragment)},l(n){k(e.$$.fragment,n)},m(n,s){F(e,n,s),t=!0},p(n,s){const o={};s&2&&(o.value=n[1].v),e.$set(o)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){y(e.$$.fragment,n),t=!1},d(n){A(e,n)}}}function dl(r){let e,t,n,s,o,l;return e=new K({props:{label:"Hue",value:r[1].h.toFixed(2),$$slots:{default:[ul]},$$scope:{ctx:r}}}),e.$on("change",r[4]),n=new K({props:{label:"Saturation",value:r[1].s.toFixed(2),$$slots:{default:[fl]},$$scope:{ctx:r}}}),n.$on("change",r[6]),o=new K({props:{label:"Value",value:r[1].v.toFixed(2),$$slots:{default:[hl]},$$scope:{ctx:r}}}),o.$on("change",r[8]),{c(){T(e.$$.fragment),t=D(),T(n.$$.fragment),s=D(),T(o.$$.fragment)},l(a){k(e.$$.fragment,a),t=N(a),k(n.$$.fragment,a),s=N(a),k(o.$$.fragment,a)},m(a,i){F(e,a,i),O(a,t,i),F(n,a,i),O(a,s,i),F(o,a,i),l=!0},p(a,[i]){const c={};i&2&&(c.value=a[1].h.toFixed(2)),i&515&&(c.$$scope={dirty:i,ctx:a}),e.$set(c);const u={};i&2&&(u.value=a[1].s.toFixed(2)),i&515&&(u.$$scope={dirty:i,ctx:a}),n.$set(u);const h={};i&2&&(h.value=a[1].v.toFixed(2)),i&515&&(h.$$scope={dirty:i,ctx:a}),o.$set(h)},i(a){l||(b(e.$$.fragment,a),b(n.$$.fragment,a),b(o.$$.fragment,a),l=!0)},o(a){y(e.$$.fragment,a),y(n.$$.fragment,a),y(o.$$.fragment,a),l=!1},d(a){A(e,a),a&&$(t),A(n,a),a&&$(s),A(o,a)}}}function ml(r,e,t){let{sender:n}=e,{color:s}=e;const o=(f,m)=>{const p=ot(f.detail);p!=null&&m(p)},l=f=>n.setColor(be(s.with({h:f.detail}).toRgb())),a=f=>o(f,m=>n.setColor(be(s.with({h:m}).toRgb()))),i=f=>n.setColor(be(s.with({s:f.detail}).toRgb())),c=f=>o(f,m=>n.setColor(be(s.with({s:m}).toRgb()))),u=f=>n.setColor(be(s.with({v:f.detail}).toRgb())),h=f=>o(f,m=>n.setColor(be(s.with({v:m}).toRgb())));return r.$$set=f=>{"sender"in f&&t(0,n=f.sender),"color"in f&&t(1,s=f.color)},[n,s,o,l,a,i,c,u,h]}class pl extends Y{constructor(e){super(),G(this,e,ml,dl,q,{sender:0,color:1})}}function gl(r){let e,t;return e=new j({props:{value:r[1].diameterPx/500}}),e.$on("change",r[8]),{c(){T(e.$$.fragment)},l(n){k(e.$$.fragment,n)},m(n,s){F(e,n,s),t=!0},p(n,s){const o={};s&2&&(o.value=n[1].diameterPx/500),e.$set(o)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){y(e.$$.fragment,n),t=!1},d(n){A(e,n)}}}function _l(r){let e,t;return e=new j({props:{value:r[1].softness}}),e.$on("change",r[10]),{c(){T(e.$$.fragment)},l(n){k(e.$$.fragment,n)},m(n,s){F(e,n,s),t=!0},p(n,s){const o={};s&2&&(o.value=n[1].softness),e.$set(o)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){y(e.$$.fragment,n),t=!1},d(n){A(e,n)}}}function vl(r){let e,t;return e=new j({props:{value:r[1].flowPct}}),e.$on("change",r[12]),{c(){T(e.$$.fragment)},l(n){k(e.$$.fragment,n)},m(n,s){F(e,n,s),t=!0},p(n,s){const o={};s&2&&(o.value=n[1].flowPct),e.$set(o)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){y(e.$$.fragment,n),t=!1},d(n){A(e,n)}}}function $l(r){let e,t;return e=new j({props:{value:r[1].spacingPct}}),e.$on("change",r[14]),{c(){T(e.$$.fragment)},l(n){k(e.$$.fragment,n)},m(n,s){F(e,n,s),t=!0},p(n,s){const o={};s&2&&(o.value=n[1].spacingPct),e.$set(o)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){y(e.$$.fragment,n),t=!1},d(n){A(e,n)}}}function bl(r){let e,t;return e=new pl({props:{sender:r[0],color:Oe(r[1].color.toRgb())}}),{c(){T(e.$$.fragment)},l(n){k(e.$$.fragment,n)},m(n,s){F(e,n,s),t=!0},p(n,s){const o={};s&1&&(o.sender=n[0]),s&2&&(o.color=Oe(n[1].color.toRgb())),e.$set(o)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){y(e.$$.fragment,n),t=!1},d(n){A(e,n)}}}function yl(r){let e,t;return e=new cl({props:{sender:r[0],color:r[1].color}}),{c(){T(e.$$.fragment)},l(n){k(e.$$.fragment,n)},m(n,s){F(e,n,s),t=!0},p(n,s){const o={};s&1&&(o.sender=n[0]),s&2&&(o.color=n[1].color),e.$set(o)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){y(e.$$.fragment,n),t=!1},d(n){A(e,n)}}}function wl(r){let e,t;return e=new vt({props:{checked:r[1].pressureAffectsOpacity}}),e.$on("change",r[16]),{c(){T(e.$$.fragment)},l(n){k(e.$$.fragment,n)},m(n,s){F(e,n,s),t=!0},p(n,s){const o={};s&2&&(o.checked=n[1].pressureAffectsOpacity),e.$set(o)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){y(e.$$.fragment,n),t=!1},d(n){A(e,n)}}}function Rl(r){let e,t;return e=new vt({props:{checked:r[1].pressureAffectsSize}}),e.$on("change",r[17]),{c(){T(e.$$.fragment)},l(n){k(e.$$.fragment,n)},m(n,s){F(e,n,s),t=!0},p(n,s){const o={};s&2&&(o.checked=n[1].pressureAffectsSize),e.$set(o)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){y(e.$$.fragment,n),t=!1},d(n){A(e,n)}}}function El(r){let e,t;return e=new j({props:{value:r[1].delay.duration/500}}),e.$on("change",r[18]),{c(){T(e.$$.fragment)},l(n){k(e.$$.fragment,n)},m(n,s){F(e,n,s),t=!0},p(n,s){const o={};s&2&&(o.value=n[1].delay.duration/500),e.$set(o)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){y(e.$$.fragment,n),t=!1},d(n){A(e,n)}}}function Sl(r){let e,t,n,s,o,l,a,i,c,u,h,f,m,p,g,_,v,S,w,L,C,z,I,V,oe,me,Ue,ae,ke;n=new jo({props:{choices:r[1].colorMode,show:ro}}),n.$on("select",r[5]),o=new Eo({props:{color:r[1].color,colorType:r[1].colorMode.focus}}),o.$on("colorChange",r[6]),i=new ks({props:{color:r[1].color,colorSecondary:r[1].colorSecondary}}),i.$on("click",function(){Tr(r[0].swapColorFrom)&&r[0].swapColorFrom.apply(this,arguments)}),h=new es({props:{initialValue:r[1].color.toStyle()}}),h.$on("enter",r[7]),m=new K({props:{label:"Size",valuePostfix:" px",value:r[1].diameterPx.toFixed(1),$$slots:{default:[gl]},$$scope:{ctx:r}}}),m.$on("change",r[9]),g=new K({props:{label:"Softness",value:r[1].softness.toFixed(2),$$slots:{default:[_l]},$$scope:{ctx:r}}}),g.$on("change",r[11]),v=new K({props:{label:"Flow",value:r[1].flowPct.toFixed(2),$$slots:{default:[vl]},$$scope:{ctx:r}}}),v.$on("change",r[13]),w=new K({props:{label:"Spacing",valuePostfix:"%",value:r[1].spacingPct.toFixed(2),$$slots:{default:[$l]},$$scope:{ctx:r}}}),w.$on("change",r[15]);const Dn=[yl,bl],Fe=[];function Nn(U,H){return U[2]===Z.Hsluv?0:U[2]===Z.Hsv?1:-1}return~(C=Nn(r))&&(z=Fe[C]=Dn[C](r)),V=new Wn({props:{label:"Pressure-Opacity",$$slots:{default:[wl]},$$scope:{ctx:r}}}),me=new Wn({props:{label:"Pressure-Size",$$slots:{default:[Rl]},$$scope:{ctx:r}}}),ae=new K({props:{label:"Delay",valuePostfix:"ms",value:r[1].delay.duration.toFixed(0),$$slots:{default:[El]},$$scope:{ctx:r}}}),ae.$on("change",r[19]),{c(){e=P("div"),t=P("div"),T(n.$$.fragment),s=D(),T(o.$$.fragment),l=D(),a=P("div"),T(i.$$.fragment),c=D(),u=P("div"),T(h.$$.fragment),f=D(),T(m.$$.fragment),p=D(),T(g.$$.fragment),_=D(),T(v.$$.fragment),S=D(),T(w.$$.fragment),L=D(),z&&z.c(),I=D(),T(V.$$.fragment),oe=D(),T(me.$$.fragment),Ue=D(),T(ae.$$.fragment),this.h()},l(U){e=M(U,"DIV",{class:!0});var H=x(e);t=M(H,"DIV",{style:!0});var ct=x(t);k(n.$$.fragment,ct),ct.forEach($),s=N(H),k(o.$$.fragment,H),l=N(H),a=M(H,"DIV",{style:!0});var Ve=x(a);k(i.$$.fragment,Ve),Ve.forEach($),c=N(H),u=M(H,"DIV",{style:!0});var Xe=x(u);k(h.$$.fragment,Xe),Xe.forEach($),f=N(H),k(m.$$.fragment,H),p=N(H),k(g.$$.fragment,H),_=N(H),k(v.$$.fragment,H),S=N(H),k(w.$$.fragment,H),L=N(H),z&&z.l(H),I=N(H),k(V.$$.fragment,H),oe=N(H),k(me.$$.fragment,H),Ue=N(H),k(ae.$$.fragment,H),H.forEach($),this.h()},h(){pe(t,"margin","0.5rem 0"),pe(a,"margin","0.5rem 0"),pe(u,"margin","0.5rem 0"),R(e,"class","detailsContainer svelte-15pr5om")},m(U,H){O(U,e,H),E(e,t),F(n,t,null),E(e,s),F(o,e,null),E(e,l),E(e,a),F(i,a,null),E(e,c),E(e,u),F(h,u,null),E(e,f),F(m,e,null),E(e,p),F(g,e,null),E(e,_),F(v,e,null),E(e,S),F(w,e,null),E(e,L),~C&&Fe[C].m(e,null),E(e,I),F(V,e,null),E(e,oe),F(me,e,null),E(e,Ue),F(ae,e,null),ke=!0},p(U,H){r=U;const ct={};H&2&&(ct.choices=r[1].colorMode),n.$set(ct);const Ve={};H&2&&(Ve.color=r[1].color),H&2&&(Ve.colorType=r[1].colorMode.focus),o.$set(Ve);const Xe={};H&2&&(Xe.color=r[1].color),H&2&&(Xe.colorSecondary=r[1].colorSecondary),i.$set(Xe);const Hn={};H&2&&(Hn.initialValue=r[1].color.toStyle()),h.$set(Hn);const Nt={};H&2&&(Nt.value=r[1].diameterPx.toFixed(1)),H&1048579&&(Nt.$$scope={dirty:H,ctx:r}),m.$set(Nt);const Ht={};H&2&&(Ht.value=r[1].softness.toFixed(2)),H&1048579&&(Ht.$$scope={dirty:H,ctx:r}),g.$set(Ht);const Ot={};H&2&&(Ot.value=r[1].flowPct.toFixed(2)),H&1048579&&(Ot.$$scope={dirty:H,ctx:r}),v.$set(Ot);const zt={};H&2&&(zt.value=r[1].spacingPct.toFixed(2)),H&1048579&&(zt.$$scope={dirty:H,ctx:r}),w.$set(zt);let Ut=C;C=Nn(r),C===Ut?~C&&Fe[C].p(r,H):(z&&(xe(),y(Fe[Ut],1,1,()=>{Fe[Ut]=null}),Pe()),~C?(z=Fe[C],z?z.p(r,H):(z=Fe[C]=Dn[C](r),z.c()),b(z,1),z.m(e,I)):z=null);const On={};H&1048579&&(On.$$scope={dirty:H,ctx:r}),V.$set(On);const zn={};H&1048579&&(zn.$$scope={dirty:H,ctx:r}),me.$set(zn);const Vt={};H&2&&(Vt.value=r[1].delay.duration.toFixed(0)),H&1048579&&(Vt.$$scope={dirty:H,ctx:r}),ae.$set(Vt)},i(U){ke||(b(n.$$.fragment,U),b(o.$$.fragment,U),b(i.$$.fragment,U),b(h.$$.fragment,U),b(m.$$.fragment,U),b(g.$$.fragment,U),b(v.$$.fragment,U),b(w.$$.fragment,U),b(z),b(V.$$.fragment,U),b(me.$$.fragment,U),b(ae.$$.fragment,U),ke=!0)},o(U){y(n.$$.fragment,U),y(o.$$.fragment,U),y(i.$$.fragment,U),y(h.$$.fragment,U),y(m.$$.fragment,U),y(g.$$.fragment,U),y(v.$$.fragment,U),y(w.$$.fragment,U),y(z),y(V.$$.fragment,U),y(me.$$.fragment,U),y(ae.$$.fragment,U),ke=!1},d(U){U&&$(e),A(n),A(o),A(i),A(h),A(m),A(g),A(v),A(w),~C&&Fe[C].d(),A(V),A(me),A(ae)}}}function Tl(r){let e,t;return e=new _t({props:{$$slots:{default:[Sl]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},l(n){k(e.$$.fragment,n)},m(n,s){F(e,n,s),t=!0},p(n,[s]){const o={};s&1048583&&(o.$$scope={dirty:s,ctx:n}),e.$set(o)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){y(e.$$.fragment,n),t=!1},d(n){A(e,n)}}}function kl(r,e,t){let n,{sender:s}=e,{brush:o}=e;const l=(I,V)=>{const oe=ot(I.detail);oe!=null&&V(oe)},a=I=>{const V=Ks.fromCss(I);V!==null&&s.setColor(be(V))},i=I=>s.setColorMode(I.detail),c=I=>s.setColor(I.detail),u=I=>a(I.detail),h=I=>s.setDiameter(I.detail*500),f=I=>l(I,s.setDiameter),m=I=>s.setSoftness(I.detail),p=I=>l(I,s.setSoftness),g=I=>s.setOpacity(I.detail),_=I=>l(I,s.setOpacity),v=I=>s.setSpacing(I.detail),S=I=>l(I,s.setSpacing),w=I=>s.setPressureAffectsOpacity(I.detail),L=I=>s.setPressureAffectsSize(I.detail),C=I=>s.setDelay(I.detail*500),z=I=>l(I,s.setDelay);return r.$$set=I=>{"sender"in I&&t(0,s=I.sender),"brush"in I&&t(1,o=I.brush)},r.$$.update=()=>{r.$$.dirty&2&&t(2,n=o.colorMode.focus)},[s,o,n,l,a,i,c,u,h,f,m,p,g,_,v,S,w,L,C,z]}class Fl extends Y{constructor(e){super(),G(this,e,kl,Tl,q,{sender:0,brush:1})}}function Al(r){let e,t;return e=new j({props:{value:r[1].diameterPx/500}}),e.$on("change",r[3]),{c(){T(e.$$.fragment)},l(n){k(e.$$.fragment,n)},m(n,s){F(e,n,s),t=!0},p(n,s){const o={};s&2&&(o.value=n[1].diameterPx/500),e.$set(o)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){y(e.$$.fragment,n),t=!1},d(n){A(e,n)}}}function Ll(r){let e,t;return e=new j({props:{value:r[1].softness}}),e.$on("change",r[5]),{c(){T(e.$$.fragment)},l(n){k(e.$$.fragment,n)},m(n,s){F(e,n,s),t=!0},p(n,s){const o={};s&2&&(o.value=n[1].softness),e.$set(o)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){y(e.$$.fragment,n),t=!1},d(n){A(e,n)}}}function xl(r){let e,t;return e=new j({props:{value:r[1].flowPct}}),e.$on("change",r[7]),{c(){T(e.$$.fragment)},l(n){k(e.$$.fragment,n)},m(n,s){F(e,n,s),t=!0},p(n,s){const o={};s&2&&(o.value=n[1].flowPct),e.$set(o)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){y(e.$$.fragment,n),t=!1},d(n){A(e,n)}}}function Pl(r){let e,t;return e=new j({props:{value:r[1].spacingPct}}),e.$on("change",r[9]),{c(){T(e.$$.fragment)},l(n){k(e.$$.fragment,n)},m(n,s){F(e,n,s),t=!0},p(n,s){const o={};s&2&&(o.value=n[1].spacingPct),e.$set(o)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){y(e.$$.fragment,n),t=!1},d(n){A(e,n)}}}function Ml(r){let e,t;return e=new vt({props:{checked:r[1].pressureAffectsOpacity}}),e.$on("change",r[11]),{c(){T(e.$$.fragment)},l(n){k(e.$$.fragment,n)},m(n,s){F(e,n,s),t=!0},p(n,s){const o={};s&2&&(o.checked=n[1].pressureAffectsOpacity),e.$set(o)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){y(e.$$.fragment,n),t=!1},d(n){A(e,n)}}}function Cl(r){let e,t;return e=new vt({props:{checked:r[1].pressureAffectsSize}}),e.$on("change",r[12]),{c(){T(e.$$.fragment)},l(n){k(e.$$.fragment,n)},m(n,s){F(e,n,s),t=!0},p(n,s){const o={};s&2&&(o.checked=n[1].pressureAffectsSize),e.$set(o)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){y(e.$$.fragment,n),t=!1},d(n){A(e,n)}}}function Bl(r){let e,t;return e=new j({props:{value:r[1].delay.duration/500}}),e.$on("change",r[13]),{c(){T(e.$$.fragment)},l(n){k(e.$$.fragment,n)},m(n,s){F(e,n,s),t=!0},p(n,s){const o={};s&2&&(o.value=n[1].delay.duration/500),e.$set(o)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){y(e.$$.fragment,n),t=!1},d(n){A(e,n)}}}function Il(r){let e,t,n,s,o,l,a,i,c,u,h,f,m,p,g;return t=new K({props:{label:"Size",valuePostfix:" px",value:r[1].diameterPx.toFixed(1),$$slots:{default:[Al]},$$scope:{ctx:r}}}),t.$on("change",r[4]),s=new K({props:{label:"Softness",value:r[1].softness.toFixed(2),$$slots:{default:[Ll]},$$scope:{ctx:r}}}),s.$on("change",r[6]),l=new K({props:{label:"Flow",value:r[1].flowPct.toFixed(2),$$slots:{default:[xl]},$$scope:{ctx:r}}}),l.$on("change",r[8]),i=new K({props:{label:"Spacing",valuePostfix:"%",value:r[1].spacingPct.toFixed(2),$$slots:{default:[Pl]},$$scope:{ctx:r}}}),i.$on("change",r[10]),u=new K({props:{label:"Pressure-Opacity",$$slots:{default:[Ml]},$$scope:{ctx:r}}}),f=new K({props:{label:"Pressure-Size",$$slots:{default:[Cl]},$$scope:{ctx:r}}}),p=new K({props:{label:"Delay",valuePostfix:"ms",value:r[1].delay.duration.toFixed(0),$$slots:{default:[Bl]},$$scope:{ctx:r}}}),p.$on("change",r[14]),{c(){e=P("div"),T(t.$$.fragment),n=D(),T(s.$$.fragment),o=D(),T(l.$$.fragment),a=D(),T(i.$$.fragment),c=D(),T(u.$$.fragment),h=D(),T(f.$$.fragment),m=D(),T(p.$$.fragment),this.h()},l(_){e=M(_,"DIV",{class:!0});var v=x(e);k(t.$$.fragment,v),n=N(v),k(s.$$.fragment,v),o=N(v),k(l.$$.fragment,v),a=N(v),k(i.$$.fragment,v),c=N(v),k(u.$$.fragment,v),h=N(v),k(f.$$.fragment,v),m=N(v),k(p.$$.fragment,v),v.forEach($),this.h()},h(){R(e,"class","detailsContainer svelte-15pr5om")},m(_,v){O(_,e,v),F(t,e,null),E(e,n),F(s,e,null),E(e,o),F(l,e,null),E(e,a),F(i,e,null),E(e,c),F(u,e,null),E(e,h),F(f,e,null),E(e,m),F(p,e,null),g=!0},p(_,v){const S={};v&2&&(S.value=_[1].diameterPx.toFixed(1)),v&32771&&(S.$$scope={dirty:v,ctx:_}),t.$set(S);const w={};v&2&&(w.value=_[1].softness.toFixed(2)),v&32771&&(w.$$scope={dirty:v,ctx:_}),s.$set(w);const L={};v&2&&(L.value=_[1].flowPct.toFixed(2)),v&32771&&(L.$$scope={dirty:v,ctx:_}),l.$set(L);const C={};v&2&&(C.value=_[1].spacingPct.toFixed(2)),v&32771&&(C.$$scope={dirty:v,ctx:_}),i.$set(C);const z={};v&32771&&(z.$$scope={dirty:v,ctx:_}),u.$set(z);const I={};v&32771&&(I.$$scope={dirty:v,ctx:_}),f.$set(I);const V={};v&2&&(V.value=_[1].delay.duration.toFixed(0)),v&32771&&(V.$$scope={dirty:v,ctx:_}),p.$set(V)},i(_){g||(b(t.$$.fragment,_),b(s.$$.fragment,_),b(l.$$.fragment,_),b(i.$$.fragment,_),b(u.$$.fragment,_),b(f.$$.fragment,_),b(p.$$.fragment,_),g=!0)},o(_){y(t.$$.fragment,_),y(s.$$.fragment,_),y(l.$$.fragment,_),y(i.$$.fragment,_),y(u.$$.fragment,_),y(f.$$.fragment,_),y(p.$$.fragment,_),g=!1},d(_){_&&$(e),A(t),A(s),A(l),A(i),A(u),A(f),A(p)}}}function Dl(r){let e,t;return e=new _t({props:{$$slots:{default:[Il]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},l(n){k(e.$$.fragment,n)},m(n,s){F(e,n,s),t=!0},p(n,[s]){const o={};s&32771&&(o.$$scope={dirty:s,ctx:n}),e.$set(o)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){y(e.$$.fragment,n),t=!1},d(n){A(e,n)}}}function Nl(r,e,t){let{sender:n}=e,{brush:s}=e;const o=(S,w)=>{const L=ot(S.detail);L!=null&&w(L)},l=S=>n.setDiameter(S.detail*500),a=S=>o(S,n.setDiameter),i=S=>n.setSoftness(S.detail),c=S=>o(S,n.setSoftness),u=S=>n.setOpacity(S.detail),h=S=>o(S,n.setOpacity),f=S=>n.setSpacing(S.detail),m=S=>o(S,n.setSpacing),p=S=>n.setPressureAffectsOpacity(S.detail),g=S=>n.setPressureAffectsSize(S.detail),_=S=>n.setDelay(S.detail*500),v=S=>o(S,n.setSpacing);return r.$$set=S=>{"sender"in S&&t(0,n=S.sender),"brush"in S&&t(1,s=S.brush)},[n,s,o,l,a,i,c,u,h,f,m,p,g,_,v]}class Hl extends Y{constructor(e){super(),G(this,e,Nl,Dl,q,{sender:0,brush:1})}}function Ol(r){let e,t;return e=new To({}),{c(){T(e.$$.fragment)},l(n){k(e.$$.fragment,n)},m(n,s){F(e,n,s),t=!0},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){y(e.$$.fragment,n),t=!1},d(n){A(e,n)}}}function zl(r){let e,t;return e=new Fo({}),{c(){T(e.$$.fragment)},l(n){k(e.$$.fragment,n)},m(n,s){F(e,n,s),t=!0},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){y(e.$$.fragment,n),t=!1},d(n){A(e,n)}}}function Ul(r){let e,t;return e=new Lo({}),{c(){T(e.$$.fragment)},l(n){k(e.$$.fragment,n)},m(n,s){F(e,n,s),t=!0},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){y(e.$$.fragment,n),t=!1},d(n){A(e,n)}}}function sr(r){let e,t,n,s;const o=[Xl,Vl],l=[];function a(i,c){return i[3]==="Brush"?0:i[3]==="Eraser"?1:-1}return~(e=a(r))&&(t=l[e]=o[e](r)),{c(){t&&t.c(),n=kt()},l(i){t&&t.l(i),n=kt()},m(i,c){~e&&l[e].m(i,c),O(i,n,c),s=!0},p(i,c){let u=e;e=a(i),e===u?~e&&l[e].p(i,c):(t&&(xe(),y(l[u],1,1,()=>{l[u]=null}),Pe()),~e?(t=l[e],t?t.p(i,c):(t=l[e]=o[e](i),t.c()),b(t,1),t.m(n.parentNode,n)):t=null)},i(i){s||(b(t),s=!0)},o(i){y(t),s=!1},d(i){~e&&l[e].d(i),i&&$(n)}}}function Vl(r){let e,t;return e=new Hl({props:{brush:r[1].eraser,sender:r[0].eraser}}),{c(){T(e.$$.fragment)},l(n){k(e.$$.fragment,n)},m(n,s){F(e,n,s),t=!0},p(n,s){const o={};s&2&&(o.brush=n[1].eraser),s&1&&(o.sender=n[0].eraser),e.$set(o)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){y(e.$$.fragment,n),t=!1},d(n){A(e,n)}}}function Xl(r){let e,t;return e=new Fl({props:{brush:r[1].brush,sender:r[0].brush}}),{c(){T(e.$$.fragment)},l(n){k(e.$$.fragment,n)},m(n,s){F(e,n,s),t=!0},p(n,s){const o={};s&2&&(o.brush=n[1].brush),s&1&&(o.sender=n[0].brush),e.$set(o)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){y(e.$$.fragment,n),t=!1},d(n){A(e,n)}}}function Yl(r){let e,t,n,s,o,l,a,i,c;n=new Yt({props:{isDown:r[3]==="Brush",$$slots:{default:[Ol]},$$scope:{ctx:r}}}),n.$on("click",r[4]),o=new Yt({props:{isDown:r[3]==="Eraser",$$slots:{default:[zl]},$$scope:{ctx:r}}}),o.$on("click",r[5]),a=new Yt({props:{isDown:r[3]==="Zoom",$$slots:{default:[Ul]},$$scope:{ctx:r}}}),a.$on("click",r[6]);let u=r[2].isDetailsExpanded&&sr(r);return{c(){e=P("div"),t=P("div"),T(n.$$.fragment),s=D(),T(o.$$.fragment),l=D(),T(a.$$.fragment),i=D(),u&&u.c(),this.h()},l(h){e=M(h,"DIV",{class:!0});var f=x(e);t=M(f,"DIV",{class:!0});var m=x(t);k(n.$$.fragment,m),s=N(m),k(o.$$.fragment,m),l=N(m),k(a.$$.fragment,m),m.forEach($),i=N(f),u&&u.l(f),f.forEach($),this.h()},h(){R(t,"class","surfaceLike leftBar svelte-11igebj"),R(e,"class","toolBarContainer svelte-11igebj")},m(h,f){O(h,e,f),E(e,t),F(n,t,null),E(t,s),F(o,t,null),E(t,l),F(a,t,null),E(e,i),u&&u.m(e,null),c=!0},p(h,[f]){const m={};f&8&&(m.isDown=h[3]==="Brush"),f&128&&(m.$$scope={dirty:f,ctx:h}),n.$set(m);const p={};f&8&&(p.isDown=h[3]==="Eraser"),f&128&&(p.$$scope={dirty:f,ctx:h}),o.$set(p);const g={};f&8&&(g.isDown=h[3]==="Zoom"),f&128&&(g.$$scope={dirty:f,ctx:h}),a.$set(g),h[2].isDetailsExpanded?u?(u.p(h,f),f&4&&b(u,1)):(u=sr(h),u.c(),b(u,1),u.m(e,null)):u&&(xe(),y(u,1,1,()=>{u=null}),Pe())},i(h){c||(b(n.$$.fragment,h),b(o.$$.fragment,h),b(a.$$.fragment,h),b(u),c=!0)},o(h){y(n.$$.fragment,h),y(o.$$.fragment,h),y(a.$$.fragment,h),y(u),c=!1},d(h){h&&$(e),A(n),A(o),A(a),u&&u.d()}}}function Gl(r,e,t){let n,{sender:s}=e,{tool:o}=e,{transientState:l}=e;const a=()=>s.setTool("Brush"),i=()=>s.setTool("Eraser"),c=()=>s.setTool("Zoom");return r.$$set=u=>{"sender"in u&&t(0,s=u.sender),"tool"in u&&t(1,o=u.tool),"transientState"in u&&t(2,l=u.transientState)},r.$$.update=()=>{r.$$.dirty&2&&t(3,n=o.current)},[s,o,l,n,a,i,c]}class ql extends Y{constructor(e){super(),G(this,e,Gl,Yl,q,{sender:0,tool:1,transientState:2})}}function Kl(r){let e,t,n,s,o,l=r[0].opacity.toFixed(2)+"",a;return{c(){e=P("span"),t=P("span"),n=ee("Opacity:"),s=D(),o=P("span"),a=ee(l)},l(i){e=M(i,"SPAN",{});var c=x(e);t=M(c,"SPAN",{});var u=x(t);n=te(u,"Opacity:"),u.forEach($),s=N(c),o=M(c,"SPAN",{});var h=x(o);a=te(h,l),h.forEach($),c.forEach($)},m(i,c){O(i,e,c),E(e,t),E(t,n),E(e,s),E(e,o),E(o,a)},p(i,c){c&1&&l!==(l=i[0].opacity.toFixed(2)+"")&&de(a,l)},d(i){i&&$(e)}}}function Wl(r){let e;return{c(){e=ee("Hidden")},l(t){e=te(t,"Hidden")},m(t,n){O(t,e,n)},p:W,d(t){t&&$(e)}}}function Zl(r){let e,t,n,s,o=(r[0].name||"Layer "+r[0].id)+"",l,a,i;function c(f,m){return f[0].isHidden?Wl:Kl}let u=c(r),h=u(r);return{c(){e=P("div"),t=D(),n=P("div"),s=P("div"),l=ee(o),a=D(),i=P("div"),h.c(),this.h()},l(f){e=M(f,"DIV",{class:!0}),x(e).forEach($),t=N(f),n=M(f,"DIV",{class:!0});var m=x(n);s=M(m,"DIV",{class:!0});var p=x(s);l=te(p,o),p.forEach($),a=N(m),i=M(m,"DIV",{class:!0});var g=x(i);h.l(g),g.forEach($),m.forEach($),this.h()},h(){R(e,"class","layerLeft svelte-1xkk8yf"),R(s,"class","layerName svelte-1xkk8yf"),R(i,"class","layerOpacity svelte-1xkk8yf"),R(n,"class","layerRight svelte-1xkk8yf")},m(f,m){O(f,e,m),O(f,t,m),O(f,n,m),E(n,s),E(s,l),E(n,a),E(n,i),h.m(i,null)},p(f,m){m&1&&o!==(o=(f[0].name||"Layer "+f[0].id)+"")&&de(l,o),u===(u=c(f))&&h?h.p(f,m):(h.d(1),h=u(f),h&&(h.c(),h.m(i,null)))},d(f){f&&$(e),f&&$(t),f&&$(n),h.d()}}}function jl(r){let e,t,n,s,o,l;return t=new _t({props:{$$slots:{default:[Zl]},$$scope:{ctx:r}}}),{c(){e=P("div"),T(t.$$.fragment),this.h()},l(a){e=M(a,"DIV",{class:!0});var i=x(e);k(t.$$.fragment,i),i.forEach($),this.h()},h(){R(e,"class",n=_e(r[2]?"selectedLayerWrapper":"unselectedLayerWrapper")+" svelte-1xkk8yf")},m(a,i){O(a,e,i),F(t,e,null),s=!0,o||(l=J(e,"click",r[4]),o=!0)},p(a,[i]){const c={};i&33&&(c.$$scope={dirty:i,ctx:a}),t.$set(c),(!s||i&4&&n!==(n=_e(a[2]?"selectedLayerWrapper":"unselectedLayerWrapper")+" svelte-1xkk8yf"))&&R(e,"class",n)},i(a){s||(b(t.$$.fragment,a),s=!0)},o(a){y(t.$$.fragment,a),s=!1},d(a){a&&$(e),A(t),o=!1,l()}}}function Ql(r,e,t){let n,{selectedId:s}=e,{layer:o}=e,{onClick:l}=e;const a=()=>l(o.id);return r.$$set=i=>{"selectedId"in i&&t(3,s=i.selectedId),"layer"in i&&t(0,o=i.layer),"onClick"in i&&t(1,l=i.onClick)},r.$$.update=()=>{r.$$.dirty&9&&t(2,n=s===o.id)},[o,l,n,s,a]}class Jl extends Y{constructor(e){super(),G(this,e,Ql,jl,q,{selectedId:3,layer:0,onClick:1})}}function or(r,e,t){const n=r.slice();return n[11]=e[t],n}function ea(r){let e;return{c(){e=ee("New")},l(t){e=te(t,"New")},m(t,n){O(t,e,n)},d(t){t&&$(e)}}}function ta(r){let e;return{c(){e=ee("Delete")},l(t){e=te(t,"Delete")},m(t,n){O(t,e,n)},d(t){t&&$(e)}}}function na(r){let e,t,n,s;return e=new tn({props:{title:"New layer",$$slots:{default:[ea]},$$scope:{ctx:r}}}),e.$on("click",r[5]),n=new tn({props:{title:"Delete layer",$$slots:{default:[ta]},$$scope:{ctx:r}}}),n.$on("click",r[6]),{c(){T(e.$$.fragment),t=D(),T(n.$$.fragment)},l(o){k(e.$$.fragment,o),t=N(o),k(n.$$.fragment,o)},m(o,l){F(e,o,l),O(o,t,l),F(n,o,l),s=!0},p(o,l){const a={};l&16384&&(a.$$scope={dirty:l,ctx:o}),e.$set(a);const i={};l&16384&&(i.$$scope={dirty:l,ctx:o}),n.$set(i)},i(o){s||(b(e.$$.fragment,o),b(n.$$.fragment,o),s=!0)},o(o){y(e.$$.fragment,o),y(n.$$.fragment,o),s=!1},d(o){A(e,o),o&&$(t),A(n,o)}}}function ra(r){let e,t;return e=new vt({props:{checked:r[1].isHidden}}),e.$on("change",r[7]),{c(){T(e.$$.fragment)},l(n){k(e.$$.fragment,n)},m(n,s){F(e,n,s),t=!0},p(n,s){const o={};s&2&&(o.checked=n[1].isHidden),e.$set(o)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){y(e.$$.fragment,n),t=!1},d(n){A(e,n)}}}function sa(r){let e,t;return e=new j({props:{value:r[1].opacity}}),e.$on("change",r[8]),{c(){T(e.$$.fragment)},l(n){k(e.$$.fragment,n)},m(n,s){F(e,n,s),t=!0},p(n,s){const o={};s&2&&(o.value=n[1].opacity),e.$set(o)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){y(e.$$.fragment,n),t=!1},d(n){A(e,n)}}}function oa(r){let e,t,n,s,o,l,a;return t=new Jr({props:{spacing:.25,$$slots:{default:[na]},$$scope:{ctx:r}}}),s=new K({props:{label:"Hidden",$$slots:{default:[ra]},$$scope:{ctx:r}}}),l=new K({props:{label:"Opacity",value:r[1].opacity.toFixed(2),$$slots:{default:[sa]},$$scope:{ctx:r}}}),l.$on("change",r[9]),{c(){e=P("div"),T(t.$$.fragment),n=D(),T(s.$$.fragment),o=D(),T(l.$$.fragment),this.h()},l(i){e=M(i,"DIV",{class:!0});var c=x(e);k(t.$$.fragment,c),n=N(c),k(s.$$.fragment,c),o=N(c),k(l.$$.fragment,c),c.forEach($),this.h()},h(){R(e,"class","layersControlsWrapper svelte-8rt2vb")},m(i,c){O(i,e,c),F(t,e,null),E(e,n),F(s,e,null),E(e,o),F(l,e,null),a=!0},p(i,c){const u={};c&16387&&(u.$$scope={dirty:c,ctx:i}),t.$set(u);const h={};c&16387&&(h.$$scope={dirty:c,ctx:i}),s.$set(h);const f={};c&2&&(f.value=i[1].opacity.toFixed(2)),c&16387&&(f.$$scope={dirty:c,ctx:i}),l.$set(f)},i(i){a||(b(t.$$.fragment,i),b(s.$$.fragment,i),b(l.$$.fragment,i),a=!0)},o(i){y(t.$$.fragment,i),y(s.$$.fragment,i),y(l.$$.fragment,i),a=!1},d(i){i&&$(e),A(t),A(s),A(l)}}}function lr(r){let e,t;return e=new Jl({props:{layer:r[11],selectedId:r[1].id,onClick:r[10]}}),{c(){T(e.$$.fragment)},l(n){k(e.$$.fragment,n)},m(n,s){F(e,n,s),t=!0},p(n,s){const o={};s&4&&(o.layer=n[11]),s&2&&(o.selectedId=n[1].id),s&1&&(o.onClick=n[10]),e.$set(o)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){y(e.$$.fragment,n),t=!1},d(n){A(e,n)}}}function la(r){let e,t,n,s,o;t=new _t({props:{$$slots:{default:[oa]},$$scope:{ctx:r}}});let l=r[2],a=[];for(let c=0;c<l.length;c+=1)a[c]=lr(or(r,l,c));const i=c=>y(a[c],1,1,()=>{a[c]=null});return{c(){e=P("div"),T(t.$$.fragment),n=D(),s=P("div");for(let c=0;c<a.length;c+=1)a[c].c();this.h()},l(c){e=M(c,"DIV",{class:!0});var u=x(e);k(t.$$.fragment,u),n=N(u),s=M(u,"DIV",{class:!0});var h=x(s);for(let f=0;f<a.length;f+=1)a[f].l(h);h.forEach($),u.forEach($),this.h()},h(){R(s,"class","layersListWrapper svelte-8rt2vb"),R(e,"class","layersWrapper svelte-8rt2vb")},m(c,u){O(c,e,u),F(t,e,null),E(e,n),E(e,s);for(let h=0;h<a.length;h+=1)a[h].m(s,null);o=!0},p(c,[u]){const h={};if(u&16387&&(h.$$scope={dirty:u,ctx:c}),t.$set(h),u&7){l=c[2];let f;for(f=0;f<l.length;f+=1){const m=or(c,l,f);a[f]?(a[f].p(m,u),b(a[f],1)):(a[f]=lr(m),a[f].c(),b(a[f],1),a[f].m(s,null))}for(xe(),f=l.length;f<a.length;f+=1)i(f);Pe()}},i(c){if(!o){b(t.$$.fragment,c);for(let u=0;u<l.length;u+=1)b(a[u]);o=!0}},o(c){y(t.$$.fragment,c),a=a.filter(Boolean);for(let u=0;u<a.length;u+=1)y(a[u]);o=!1},d(c){c&&$(e),A(t),en(a,c)}}}function aa(r,e,t){let n,s,{layers:o}=e,{sender:l}=e;const a=(p,g)=>{const _=ot(p.detail);_!=null&&g(_)},i=()=>l.newLayer(s.id),c=()=>l.removeLayer(s.id),u=p=>l.setHidden(s.id,p.detail),h=p=>l.setOpacity(s.id,p.detail),f=p=>a(p,g=>l.setOpacity(s.id,g)),m=p=>l.selectLayer(p);return r.$$set=p=>{"layers"in p&&t(4,o=p.layers),"sender"in p&&t(0,l=p.sender)},r.$$.update=()=>{r.$$.dirty&16&&t(2,n=o.layers.children),r.$$.dirty&16&&t(1,s=o.current())},[l,s,n,a,o,i,c,u,h,f,m]}class ia extends Y{constructor(e){super(),G(this,e,aa,la,q,{layers:4,sender:0})}}function ca(r){let e,t;return e=new j({props:{value:r[0].zoomPct/4}}),e.$on("change",r[5]),{c(){T(e.$$.fragment)},l(n){k(e.$$.fragment,n)},m(n,s){F(e,n,s),t=!0},p(n,s){const o={};s&1&&(o.value=n[0].zoomPct/4),e.$set(o)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){y(e.$$.fragment,n),t=!1},d(n){A(e,n)}}}function ua(r){let e,t;return e=new j({props:{value:r[0].rotateTurns}}),e.$on("change",r[7]),{c(){T(e.$$.fragment)},l(n){k(e.$$.fragment,n)},m(n,s){F(e,n,s),t=!0},p(n,s){const o={};s&1&&(o.value=n[0].rotateTurns),e.$set(o)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){y(e.$$.fragment,n),t=!1},d(n){A(e,n)}}}function fa(r){let e,t;return e=new j({props:{value:se((r[0].offsetX+2500)/5e3,-5e3,5e3)}}),e.$on("change",r[9]),{c(){T(e.$$.fragment)},l(n){k(e.$$.fragment,n)},m(n,s){F(e,n,s),t=!0},p(n,s){const o={};s&1&&(o.value=se((n[0].offsetX+2500)/5e3,-5e3,5e3)),e.$set(o)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){y(e.$$.fragment,n),t=!1},d(n){A(e,n)}}}function ha(r){let e,t;return e=new j({props:{value:se((r[0].offsetY+2500)/5e3,-5e3,5e3)}}),e.$on("change",r[11]),{c(){T(e.$$.fragment)},l(n){k(e.$$.fragment,n)},m(n,s){F(e,n,s),t=!0},p(n,s){const o={};s&1&&(o.value=se((n[0].offsetY+2500)/5e3,-5e3,5e3)),e.$set(o)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){y(e.$$.fragment,n),t=!1},d(n){A(e,n)}}}function da(r){let e,t,n,s,o,l,a,i,c;return t=new K({props:{label:"Zoom",valuePostfix:"%",value:r[2](r[0].zoomPct),$$slots:{default:[ca]},$$scope:{ctx:r}}}),t.$on("change",r[6]),s=new K({props:{label:"Rotate",valuePostfix:" deg",value:r[3](r[0].rotateTurns),$$slots:{default:[ua]},$$scope:{ctx:r}}}),s.$on("change",r[8]),l=new K({props:{label:"Offset X",valuePostfix:" px",value:r[0].offsetX.toFixed(0),$$slots:{default:[fa]},$$scope:{ctx:r}}}),l.$on("change",r[10]),i=new K({props:{label:"Offset Y",valuePostfix:" px",value:r[0].offsetY.toFixed(0),$$slots:{default:[ha]},$$scope:{ctx:r}}}),i.$on("change",r[12]),{c(){e=P("div"),T(t.$$.fragment),n=D(),T(s.$$.fragment),o=D(),T(l.$$.fragment),a=D(),T(i.$$.fragment),this.h()},l(u){e=M(u,"DIV",{class:!0});var h=x(e);k(t.$$.fragment,h),n=N(h),k(s.$$.fragment,h),o=N(h),k(l.$$.fragment,h),a=N(h),k(i.$$.fragment,h),h.forEach($),this.h()},h(){R(e,"class","container svelte-1o7mh2m")},m(u,h){O(u,e,h),F(t,e,null),E(e,n),F(s,e,null),E(e,o),F(l,e,null),E(e,a),F(i,e,null),c=!0},p(u,[h]){const f={};h&1&&(f.value=u[2](u[0].zoomPct)),h&8195&&(f.$$scope={dirty:h,ctx:u}),t.$set(f);const m={};h&1&&(m.value=u[3](u[0].rotateTurns)),h&8195&&(m.$$scope={dirty:h,ctx:u}),s.$set(m);const p={};h&1&&(p.value=u[0].offsetX.toFixed(0)),h&8195&&(p.$$scope={dirty:h,ctx:u}),l.$set(p);const g={};h&1&&(g.value=u[0].offsetY.toFixed(0)),h&8195&&(g.$$scope={dirty:h,ctx:u}),i.$set(g)},i(u){c||(b(t.$$.fragment,u),b(s.$$.fragment,u),b(l.$$.fragment,u),b(i.$$.fragment,u),c=!0)},o(u){y(t.$$.fragment,u),y(s.$$.fragment,u),y(l.$$.fragment,u),y(i.$$.fragment,u),c=!1},d(u){u&&$(e),A(t),A(s),A(l),A(i)}}}function ma(r,e,t){const n=_=>(_*100).toFixed(2),s=_=>(_*360).toFixed(1),o=(_,v)=>{const S=ot(_.detail);S!=null&&v(S)};let{camera:l}=e,{sender:a}=e;const i=_=>{a.setRotation(_.detail*4)},c=_=>{o(_,a.setZoom)},u=_=>{a.setRotation(_.detail)},h=_=>{o(_,a.setRotation)},f=_=>{a.setOffset(_.detail*5e3-2500,l.offsetY)},m=_=>{o(_,v=>a.setOffset(v,l.offsetY))},p=_=>{a.setOffset(l.offsetX,_.detail*5e3-2500)},g=_=>{o(_,v=>a.setOffset(l.offsetX,v))};return r.$$set=_=>{"camera"in _&&t(0,l=_.camera),"sender"in _&&t(1,a=_.sender)},[l,a,n,s,o,i,c,u,h,f,m,p,g]}class pa extends Y{constructor(e){super(),G(this,e,ma,da,q,{camera:0,sender:1})}}const Ct=class{constructor(e,t,n,s){d(this,"sample0");d(this,"sample1");d(this,"sample2");d(this,"sample3");this.sample0=e,this.sample1=t,this.sample2=n,this.sample3=s}update(e){return new Ct(e,this.sample0,this.sample1,this.sample2)}length(){return this.sample0.length+this.sample1.length+this.sample2.length+this.sample3.length}forEach(e){let t=this.sample0,n=0;for(let s=0;s<t.length;s++)e(t[s],s);n+=t.length,t=this.sample1;for(let s=0;s<t.length;s++)e(t[s],n+s);n+=t.length,t=this.sample2;for(let s=0;s<t.length;s++)e(t[s],n+s);n+=t.length,t=this.sample3;for(let s=0;s<t.length;s++)e(t[s],n+s)}};let St=Ct;d(St,"empty",new Ct([],[],[],[]));const ga=st(St.empty);class _a{isEmpty(){return!0}isNonEmpty(){return!1}cons(e){return new Ne(e,this)}foldl(e,t){return t}reverse(){return this}toArray(){return[]}toString(){return"()"}}class Ne{constructor(e,t){d(this,"head");d(this,"tail");this.head=e,this.tail=t}static of(e){return new Ne(e,we())}isEmpty(){return!1}isNonEmpty(){return!0}cons(e){return new Ne(e,this)}foldl(e,t){let n=this,s=t;for(;n.isNonEmpty();)s=e(s,n.head),n=n.tail;return s}reverse(){let e=this.tail,t=Ne.of(this.head);for(;e.isNonEmpty();)t=t.cons(e.head),e=e.tail;return t}toArray(){const e=[this.head];let t=this.tail;for(;t.isNonEmpty();)e.push(t.head),t=t.tail;return e}toString(){let e="("+this.head,t=this.tail;for(;t.isNonEmpty();)e=e+", "+t.head,t=t.tail;return e+")"}}function we(){return new _a}class gt{constructor(e,t,n,s){d(this,"id");d(this,"name");d(this,"opacity");d(this,"isHidden");this.id=e,this.name=t,this.opacity=n,this.isHidden=s}static init(e){return new gt(e,"",1,!1)}get isLeaf(){return!0}with(e){const t=je(e.name,this.name),n=je(e.opacity,this.opacity),s=je(e.isHidden,this.isHidden);return new gt(this.id,t,n,s)}}class ht{constructor(e,t,n,s,o){d(this,"id");d(this,"name");d(this,"opacity");d(this,"isHidden");d(this,"children");this.id=e,this.name=t,this.opacity=n,this.isHidden=s,this.children=o}static init(e){return new ht(e,"",1,!1,[])}get isLeaf(){return!1}with(e){return new ht(this.id,je(e.name,this.name),je(e.opacity,this.opacity),je(e.isHidden,this.isHidden),this.children)}withChildren(e){return new ht(this.id,this.name,this.opacity,this.isHidden,e)}get(e){const t=e.head,n=this.children[t];if(e.tail.isNonEmpty()){if(n.isLeaf)throw new Error("Invariant violation");return n.get(e.tail)}return n}getWithContext(e,t){const n=e.head,s=this.children[n];if(e.tail.isNonEmpty()){if(s.isLeaf)throw new Error("Invariant violation");return s.getWithContext(e.tail,this.isHidden?0:t*this.opacity)}return{id:s.id,name:s.name,opacity:s.isHidden?0:t*s.opacity}}findPath(e){const t=this.children;for(let n=0;n<this.children.length;n++){const s=t[n];if(s.isLeaf){if(s.id===e)return we().cons(n)}else{const o=s.findPath(e);if(o!==null)return o.cons(n)}}return null}insert(e,t){const n=e.head,s=this.children[n];if(e.tail.isNonEmpty()){if(s.isLeaf)throw new Error("Invariant violation");const o=s.insert(e.tail,t),l=$t(this.children,n,o);return this.withChildren(l)}else return this.withChildren(to(this.children,n,t))}remove(e){const t=e.head,n=this.children[t];if(e.tail.isNonEmpty()){if(n.isLeaf)throw new Error("Invariant violation");const[s,o]=n.remove(e.tail),l=$t(this.children,t,s);return[this.withChildren(l),o.cons(t)]}else{const s=this.withChildren(no(this.children,t));if(s.children.length===0)return[s,we()];const o=this.children.length===t+1?t-1:t,l=t===o?e:Ne.of(o);return[s,l]}}update(e,t){const n=e.head,s=this.children[n];if(e.tail.isNonEmpty()){if(s.isLeaf)throw new Error("Invariant violation");const o=s.update(e.tail,t),l=$t(this.children,n,o);return this.withChildren(l)}else{const o=t(s),l=$t(this.children,n,o);return this.withChildren(l)}}collectLeaves(e,t){const n=this.children;for(let s=0;s<n.length;s++){const o=n[s],l=o.isHidden?0:t*o.opacity;o.isLeaf?e.push({id:o.id,name:o.name,opacity:l}):o.collectLeaves(e,l)}}}var ie;(function(r){r[r.NewLayerMsg=0]="NewLayerMsg",r[r.RemoveMsg=1]="RemoveMsg",r[r.SelectMsg=2]="SelectMsg",r[r.SetOpacityMsg=3]="SetOpacityMsg",r[r.SetHiddenMsg=4]="SetHiddenMsg"})(ie||(ie={}));class va{constructor(e){d(this,"id");d(this,"type",ie.NewLayerMsg);this.id=e}}class $a{constructor(e){d(this,"id");d(this,"type",ie.RemoveMsg);this.id=e}}class ba{constructor(e){d(this,"id");d(this,"type",ie.SelectMsg);this.id=e}}class ya{constructor(e,t){d(this,"id");d(this,"opacity");d(this,"type",ie.SetOpacityMsg);this.id=e,this.opacity=t}}class wa{constructor(e,t){d(this,"id");d(this,"isHidden");d(this,"type",ie.SetHiddenMsg);this.id=e,this.isHidden=t}}class Ra{constructor(e){d(this,"sendMessage");d(this,"newLayer",e=>{this.sendMessage(new va(e))});d(this,"removeLayer",e=>{this.sendMessage(new $a(e))});d(this,"selectLayer",e=>{this.sendMessage(new ba(e))});d(this,"setOpacity",(e,t)=>{this.sendMessage(new ya(e,t))});d(this,"setHidden",(e,t)=>{this.sendMessage(new wa(e,t))});this.sendMessage=e}}class Le{constructor(e,t,n){d(this,"getNextLayerId");d(this,"layers");d(this,"selectedPath");d(this,"cachedSplitLayers",null);this.getNextLayerId=e,this.layers=t,this.selectedPath=n}static init(){const e=(()=>{let s=1;return()=>s++})(),t=gt.init(e()),n=ht.init(e()).withChildren([t]);return new Le(e,n,we().cons(0))}current(){return this.layers.get(this.selectedPath)}update(e){switch(e.type){case ie.NewLayerMsg:return this.current().id===e.id?this.newLayer():this;case ie.RemoveMsg:return this.current().id===e.id?this.removeCurrent():this;case ie.SelectMsg:return this.current().id===e.id?this:this.select(e.id);case ie.SetOpacityMsg:{const{id:t,opacity:n}=e;return this.current().id===t?this.updateCurrent(o=>o.with({opacity:n})):this}case ie.SetHiddenMsg:{const{id:t,isHidden:n}=e;return this.current().id===t?this.updateCurrent(o=>o.with({isHidden:n})):this}default:throw{"unexpected msg":e}}}split(){if(this.cachedSplitLayers===null){const e=this.layers.children,t=this.selectedPath.head,n=[],s=[],o=1;for(let a=0;a<t;a++){const i=e[a];i.isLeaf?n.push({id:i.id,name:i.name,opacity:o*i.opacity}):i.collectLeaves(n,o)}for(let a=this.selectedPath.head+1;a<e.length;a++){const i=e[a];i.isLeaf?s.push({id:i.id,name:i.name,opacity:o*i.opacity}):i.collectLeaves(s,o)}const l=this.layers.get(this.selectedPath);l.isLeaf?this.cachedSplitLayers={above:n,current:this.layers.getWithContext(this.selectedPath,o),below:s}:(l.collectLeaves(s,o),this.cachedSplitLayers={above:n,current:null,below:s})}return this.cachedSplitLayers}select(e){const t=this.layers.findPath(e);return t===null?this:new Le(this.getNextLayerId,this.layers,t)}newLayer(){const e=this.layers.insert(this.selectedPath,gt.init(this.getNextLayerId()));return new Le(this.getNextLayerId,e,this.selectedPath)}removeCurrent(){const[e,t]=this.layers.remove(this.selectedPath);if(t.isNonEmpty())return new Le(this.getNextLayerId,e,t);const n=this.selectedPath.head,s=e.children.length<=n?n:n-1;return new Le(this.getNextLayerId,e,Ne.of(s))}updateCurrent(e){return new Le(this.getNextLayerId,this.layers.update(this.selectedPath,e),this.selectedPath)}}function Ea(r){return{prevPoint:r}}function ts(r,e,t){if(r===null){const p={alpha:t.alpha,color:t.color,position:t.position,rotation:t.rotation,scaledDiameter:e.diameterPx*t.pressure};return[{prevPoint:t},[p]]}const n=r.prevPoint,s=e.spacingPct*e.diameterPx,o=Sa(s,n,t);if(o.length===0)return[r,[]];const l=n.pressure===t.pressure,a=n.alpha===t.alpha,i=n.color.is(t.color),c=n.rotation===t.rotation,u=o.length,h=new Array(u);for(let p=0;p<u;p++){const g=o[p],_=a?n.alpha:Ie(g,n.alpha,t.alpha),v=i?n.color:n.color.mix(g,t.color),S=ne.lerp(g,n.position,t.position),w=e.diameterPx*(l?n.pressure:Ie(g,n.pressure,t.pressure)),L=c?n.rotation:Ie(g,n.rotation,t.rotation);h[p]={alpha:_,color:v,position:S,scaledDiameter:w,rotation:L}}const f=h[o.length-1];return[{prevPoint:{alpha:f.alpha,color:f.color,position:f.position,pressure:Ie(o[o.length-1],n.pressure,t.pressure),rotation:f.rotation}},h]}function Sa(r,e,t){const n=[],s=t.position.x,o=t.position.y,l=t.pressure,a=Math.max(r*l,.05);let i=e.position.x,c=e.position.y,u=e.pressure;const h=Xn(i,c,s,o);let f=h,m=.5,p=i,g=c,_=u;for(;f>a&&m>0;)m=r*u/f,i+=m*(s-i),c+=m*(o-c),u+=m*(l-u),f=Xn(i,c,s,o),(i!==p||c!==g||u!==_)&&(n.push(1-f/h),p=i,g=c,_=u);return n}function ns(r){return r**.92}function rs(r){return console.assert(r>=0,"Delay can't be negative"),{duration:r}}class Sn{constructor(e,t,n){d(this,"x");d(this,"y");d(this,"pressure");this.x=e,this.y=t,this.pressure=n}lerp(e,t){return new Sn(Ie(e,this.x,t.x),Ie(e,this.y,t.y),Ie(e,this.pressure,t.pressure))}}function Ta(r,e){return{startTime:r,start:e,end:e}}function ka(r,e,t,n){if(r.duration===0)return[{startTime:t,start:n,end:n},n];const s=t-e.startTime,o=ns(Math.min(s/r.duration,1)),l=e.start.lerp(o,n);return[{startTime:t,start:l,end:n},l]}function Fa(r,e,t){const n=t-e.startTime;if(n>=r.duration)return[e,e.end];const s=ns(Math.min(n/r.duration,1)),o=e.start.lerp(s,e.end);return[e,o]}class Be{constructor(e,t,n){d(this,"__left");d(this,"focus");d(this,"__right");this.__left=e,this.focus=t,this.__right=n}static singleton(e){return new Be(we(),e,we())}static fromArray(e){return e.length===0?null:Be.unsafeFromArray(e)}static unsafeFromArray(e){let t=we();for(let n=e.length-1;n>0;n--)t=t.cons(e[n]);return new Be(we(),e[0],t)}getLeft(){return this.__left.reverse().toArray()}getRight(){return this.__right.toArray()}hasLeft(){return this.__left.isNonEmpty()}hasRight(){return this.__right.isNonEmpty()}focusLeft(){return this.__left.isNonEmpty()?new Be(this.__left.tail,this.__left.head,this.__right.cons(this.focus)):this}focusRight(){return this.__right.isNonEmpty()?new Be(this.__left.cons(this.focus),this.__right.head,this.__right.tail):this}focusf(e){if(e(this.focus))return this;let t=this;for(;t.hasLeft();)if(t=t.focusLeft(),e(t.focus))return t;for(t=this;t.hasRight();)if(t=t.focusRight(),e(t.focus))return t;return this}toArray(){const e=[];let t=this.__left.reverse();for(;t.isNonEmpty();)e.push(t.head),t=t.tail;for(e.push(this.focus),t=this.__right;t.isNonEmpty();)e.push(t.head),t=t.tail;return e}}class ar{constructor(e){d(this,"sendMessage");d(this,"setColor",e=>this.sendMessage(B("SetColor",e)));d(this,"setColorMode",e=>this.sendMessage(B("SetColorMode",e)));d(this,"setDelay",e=>this.sendMessage(B("SetDelay",{delayMs:e})));d(this,"setDiameter",e=>this.sendMessage(B("SetDiameter",{diameterPx:e})));d(this,"setOpacity",e=>this.sendMessage(B("SetOpacity",{opacityPct:e})));d(this,"setSoftness",e=>this.sendMessage(B("SetSoftness",{softnessPct:e})));d(this,"setSpacing",e=>this.sendMessage(B("SetSpacing",{spacingPct:e})));d(this,"setPressureAffectsOpacity",e=>this.sendMessage(B("SetPressureAffectsOpacity",e)));d(this,"setPressureAffectsSize",e=>this.sendMessage(B("SetPressureAffectsSize",e)));d(this,"swapColorFrom",()=>this.sendMessage(B("SwapColor")));this.sendMessage=e}}function dn(){return null}const ir={diameterPx:15,softness:.4,flowPct:.3,colorMode:Be.unsafeFromArray([Z.Hsluv,Z.Hsv]),color:new Lt(73,100,16),colorSecondary:new Lt(0,0,100),spacingPct:.05,pressureAffectsOpacity:!1,pressureAffectsSize:!0,delay:rs(5)};function cr(r,e){switch(e.tag){case"SetDiameter":return{...r,diameterPx:se(e.val.diameterPx,.1,500)};case"SetSoftness":return{...r,softness:se(e.val.softnessPct,0,1)};case"SetOpacity":return{...r,flowPct:se(e.val.opacityPct,.01,1)};case"SetColor":return{...r,color:e.val};case"SetColorMode":return{...r,colorMode:r.colorMode.focusf(t=>t===e.val)};case"SetSpacing":return{...r,spacingPct:se(e.val.spacingPct,.01,1)};case"SetPressureAffectsOpacity":return{...r,pressureAffectsOpacity:e.val};case"SetPressureAffectsSize":return{...r,pressureAffectsSize:e.val};case"SwapColor":return{...r,color:r.colorSecondary,colorSecondary:r.color};case"SetDelay":return{...r,delay:rs(se(e.val.delayMs,0,500))};default:throw{"unexpected msg":e}}}function mn(r,e,t){const n=ss(t),s=Ea(Tn(r,n)),o=Ta(t.time,n);return[{interpState:s,delayState:o},Aa(r,n)]}function ur(r,e,t,n){if(t===null){const a=mn(r,e,n[0]);return[a[0],[a[1]]]}let s=t.interpState,o=[],l=t.delayState;for(let a=0;a<n.length;a++){const i=n[a],c=ss(i),u=ka(r.delay,l,i.time,c),h=ts(s,r,Tn(r,u[1]));l=u[0],s=h[0],o=o.concat(h[1])}return[{delayState:l,interpState:s},o]}function fr(r,e,t){if(e===null)return[null,[]];const[n,s]=Fa(r.delay,e.delayState,t),[o,l]=ts(e.interpState,r,Tn(r,s));return[{delayState:n,interpState:o},l]}function hr(){return[null,[]]}function ss(r){return new Sn(r.x,r.y,r.pressure)}function Aa(r,e){const t=r.flowPct*e.pressure,n=t===1?r.color.toRgb().toLinear():r.color.toRgb().toLinear().mix(1-t,At.Black),s=new ne(e.x,e.y);return{alpha:t,color:n,position:s,rotation:0,scaledDiameter:r.diameterPx*e.pressure}}function Tn(r,e){const t=r.flowPct*e.pressure,n=t===1?r.color.toRgb().toLinear():r.color.toRgb().toLinear().mix(1-t,At.Black),s=new ne(e.x,e.y);return{alpha:t,color:n,position:s,pressure:e.pressure,rotation:0}}class La{constructor(e){d(this,"sendMessage");d(this,"setRotation",e=>this.sendMessage(B("SetRotation",{rotationTurns:e})));d(this,"setOffset",(e,t)=>this.sendMessage(B("SetOffset",{offsetX:e,offsetY:t})));d(this,"setZoom",e=>this.sendMessage(B("SetZoom",{zoomPct:e})));this.sendMessage=e}}const xa={offsetX:0,offsetY:0,zoomPct:1,rotateTurns:0};function Pa(r,e){switch(e.tag){case"SetZoom":return{...r,zoomPct:Math.max(.01,e.val.zoomPct)};case"SetOffset":return{...r,offsetX:e.val.offsetX,offsetY:e.val.offsetY};case"SetRotation":return{...r,rotateTurns:e.val.rotationTurns};default:throw{"unexpected msg":e}}}function kn(r,e,t){let s=(t.x-e.clickPoint.x)/500;s>=0?s=s**2:s=-((-s)**2);const o=e.originalScale+s;return{...r,zoomPct:Math.min(5e3,o)}}function Fn(r,e,t){throw new Error("todo: should be turns, not rad")}function An(r,e,t){const n=t.x-e.prevPoint.x,s=t.y-e.prevPoint.y;return{...r,offsetX:r.offsetX+n,offsetY:r.offsetY+s}}class Ma{constructor(e){d(this,"sendMessage");d(this,"brush");d(this,"eraser");d(this,"camera");d(this,"setTool",e=>this.sendMessage(B("SetToolMsg",e)));this.sendMessage=e,this.brush=new ar(t=>e(B("BrushMsg",t))),this.eraser=new ar(t=>e(B("EraserMsg",t))),this.camera=new La(t=>e(B("CameraMsg",t)))}}const Ca={brush:ir,eraser:ir,camera:xa,current:"Brush"};function Ba(r,e){switch(e.tag){case"SetToolMsg":switch(e.val){case"Brush":return{...r,current:"Brush"};case"Eraser":return{...r,current:"Eraser"};case"Move":return{...r,current:"Move"};case"Zoom":return{...r,current:"Zoom"};case"Rotate":return{...r,current:"Rotate"};default:throw{"unexpected tool type: ":e}}case"BrushMsg":return{...r,brush:cr(r.brush,e.val)};case"EraserMsg":return{...r,eraser:cr(r.eraser,e.val)};case"CameraMsg":return{...r,camera:Pa(r.camera,e.val)};default:throw{"unexpected msg":e}}}function Ia(r,e,t){const n=It(r,e);switch(n.tag){case"Brush":{const[s,o]=mn(r.brush,r.camera,t);return[r,B("Brush",s),[o]]}case"Eraser":{const[s,o]=mn(r.eraser,r.camera,t);return[r,B("Eraser",s),[o]]}case"Move":{if(n.val!==null)return[r,n,[]];const s={clickPoint:t,prevPoint:t,originalScale:r.camera.zoomPct},o=An(r.camera,s,t);return[{...r,camera:o},B("Move",s),[]]}case"Zoom":{if(n.val!==null)return[r,n,[]];const s={clickPoint:t,prevPoint:t,originalScale:r.camera.zoomPct},o=kn(r.camera,s,t);return[{...r,camera:o},B("Zoom",s),[]]}case"Rotate":{if(n.val!==null)return[r,n,[]];const s={clickPoint:t,prevPoint:t,originalScale:r.camera.zoomPct},o=Fn(r.camera);return[{...r,camera:o},B("Rotate",s),[]]}default:throw{"unxpected state":n}}}function Da(r,e,t){const n=It(r,e);switch(n.tag){case"Brush":{const[s,o]=ur(r.brush,r.camera,n.val,t);return[r,B("Brush",s),o]}case"Eraser":{const[s,o]=ur(r.eraser,r.camera,n.val,t);return[r,B("Eraser",s),o]}case"Move":{if(n.val===null)return[r,n,[]];const s=t[t.length-1],o=An(r.camera,n.val,s),l={clickPoint:n.val.clickPoint,prevPoint:s,originalScale:n.val.originalScale};return[{...r,camera:o},B("Move",l),[]]}case"Zoom":{if(n.val===null)return[r,n,[]];const s=t[t.length-1],o=kn(r.camera,n.val,s),l={clickPoint:n.val.clickPoint,prevPoint:s,originalScale:n.val.originalScale};return[{...r,camera:o},B("Zoom",l),[]]}case"Rotate":{if(n.val===null)return[r,n,[]];const s=t[t.length-1],o=Fn(r.camera,n.val),l={clickPoint:n.val.clickPoint,prevPoint:s,originalScale:n.val.originalScale};return[{...r,camera:o},B("Rotate",l),[]]}default:throw{"unxpected state":n}}}function Na(r,e,t){const n=It(r,e);switch(n.tag){case"Brush":{const[s,o]=hr();return[r,B("Brush",s),o]}case"Eraser":{const[s,o]=hr();return[r,B("Eraser",s),o]}case"Move":{if(n.val===null)return[r,n,[]];const s=An(r.camera,n.val,t);return[{...r,camera:s},B("Move",null),[]]}case"Zoom":{if(n.val===null)return[r,n,[]];const s=kn(r.camera,n.val,t);return[{...r,camera:s},B("Zoom",null),[]]}case"Rotate":{if(n.val===null)return[r,n,[]];const s=Fn(r.camera,n.val);return[{...r,camera:s},B("Rotate",null),[]]}default:throw{"unxpected state":n}}}function Ha(r,e,t){const n=It(r,e);switch(n.tag){case"Brush":{const[s,o]=fr(r.brush,n.val,t);return s===n.val&&o.length===0?[n,o]:[B("Brush",s),o]}case"Eraser":{const[s,o]=fr(r.eraser,n.val,t);return s===n.val&&o.length===0?[n,o]:[B("Eraser",s),o]}default:return[n,[]]}}var dr;(function(r){r[r.BrushState=0]="BrushState",r[r.EraserState=1]="EraserState",r[r.MoveState=2]="MoveState",r[r.ZoomState=3]="ZoomState",r[r.RotateState=4]="RotateState"})(dr||(dr={}));function Oa(){return B("Brush",dn())}function It(r,e){if(e.tag===r.current)return e;switch(r.current){case"Brush":return B("Brush",dn());case"Eraser":return B("Eraser",dn());case"Move":return B("Move",null);case"Rotate":return B("Rotate",null);case"Zoom":return B("Zoom",null);default:throw r.current,{"Unknown tool type: ":r.current}}}function za(r){switch(r.current){case"Brush":return De.Normal;case"Eraser":return De.Erase;default:return De.Normal}}function Ua(r){switch(r.current){case"Brush":return r.brush.softness;case"Eraser":return r.eraser.softness;default:return 0}}const bt={None:0,create(r,e,t){let n=0;return r&&(n+=1),e&&(n+=2),t&&(n+=4),n},hasModifiers(r,e){return(r&e)>0},hasShift(r){return(r&1)>0},hasAlt(r){return(r&2)>0},hasCtrl(r){return(r&4)>0},toString(r){return r.toString()},fromString(r){const e=parseInt(r,10);return isNaN(e)?null:e}},Dt={toString(r){return bt.toString(r.modifiers)+"|"+r.code},createKey(r){return Dt.toString({code:r.code,modifiers:bt.create(!!r.shift,!!r.alt,!!r.ctrl)})},fromString(r){const e=r.split("|");if(e.length!==2)return null;const t=e[1],n=bt.fromString(e[0]);return n===null?null:{code:t,modifiers:n}},fromKeyboardEvent(r){return console.log(r),{code:r.code,modifiers:bt.create(r.shiftKey,r.altKey,r.ctrlKey)}}};function Va(r,e){const t=Dt.toString(e),n=[];let s=r.layers;for(;s.isNonEmpty();){if(t in s.head){const o=s.head[t];if(n.push(o.msg),!o.passive)break}s=s.tail}return n}function Xa(r){function e(t){r.handle(Dt.fromKeyboardEvent(t))}return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}}class Ya{nextInt(){return[this.asInt(),this.step()]}nextFloat(){return[this.asInt()/4294967295,this.step()]}next2Floats(){const[e,t]=this.nextFloat(),[n,s]=t.nextFloat();return[e,n,s]}next3Floats(){const[e,t]=this.nextFloat(),[n,s]=t.nextFloat(),[o,l]=s.nextFloat();return[e,n,o,l]}}class Pt extends Ya{constructor(t,n,s,o,l){super();d(this,"a");d(this,"b");d(this,"c");d(this,"d");d(this,"value");this.a=t,this.b=n,this.c=s,this.d=o,this.value=l}static create(t){let n=new Pt(t,0,0,0,null);for(let s=0;s<32;s++)n=n.step();return n}asInt(){return this.force().asInt}step(){return this.force().next}display(){return`Xorshift 128 (${this.a}, ${this.b}, ${this.c}, ${this.d})`}force(){if(this.value===null){const t=this.a;let n=this.d;n^=n<<11,n^=n>>>8,n^=t,n^=t>>>19,this.value={asInt:n>>>0,next:new Pt(n,t,this.b,this.c,null)}}return this.value}}function Ln(r){return e=>[r,e]}function mr(r,e){return t=>Ga(r,e,t)}function Ga(r,e,t){const[n,s]=t.nextFloat(),o=e-r;return[n*o+r,s]}function os(r){return e=>qa(r,e)}function qa(r,e){const t={};for(const n in r){const[s,o]=r[n](e);t[n]=s,e=o}return[t,e]}function Ka(r,e,t,n){return s=>Wa(r,e,t,n,s)}function Wa(r,e,t,n,s){const[o,l]=r(s),[a,i]=e(l),[c,u]=t(i);return[n(o,a,c),u]}const Mt={"--color-primary":r=>r.color.primary.toStyle(),"--color-primaryLight":r=>r.color.primaryLight.toStyle(),"--color-primaryDark":r=>r.color.primaryDark.toStyle(),"--color-secondary":r=>r.color.secondary.toStyle(),"--color-secondaryLight":r=>r.color.secondaryLight.toStyle(),"--color-secondaryDark":r=>r.color.secondaryDark.toStyle(),"--color-onPrimary":r=>r.color.onPrimary.toStyle(),"--color-onSecondary":r=>r.color.onSecondary.toStyle(),"--color-onSurface":r=>r.color.onSurface.toStyle(),"--color-surface":r=>r.color.surface.toStyle(),"--color-background":r=>r.color.background.toStyle(),"--shadows-button":r=>r.shadows.button,"--shadows-menu":r=>r.shadows.menu,"--shadows-surface":r=>r.shadows.surface,"--fonts-monospace":r=>r.fonts.monospace,"--fonts-normal":r=>r.fonts.normal};function Za(r,e){for(const t in Mt){const n=Mt[t],s=n(r),o=n(e);s!==o&&document.body.style.setProperty(t,o)}}function ja(r){for(const e in Mt){const t=Mt[e];document.body.style.setProperty(e,t(r))}}const ue=(r,e)=>Ka(mr(0,360),mr(0,r),Ln(e),(t,n,s)=>new Lt(t,n,s)),Qa=os({primary:ue(100,80),primaryLight:ue(100,90),primaryDark:ue(100,70),secondary:ue(70,77),secondaryLight:ue(70,87),secondaryDark:ue(70,67),background:ue(20,46),surface:ue(35,38),onPrimary:ue(100,0),onSecondary:ue(100,0),onSurface:ue(100,100)}),Ja=Ln({button:"0 1px 5px 0 rgba(0, 0, 0, 0.2), 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 3px 1px -2px rgba(0, 0, 0, 0.12)",surface:"0 1px 5px 0 rgba(0, 0, 0, 0.2), 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 3px 1px -2px rgba(0, 0, 0, 0.12)",menu:"2px 2px 2px rgba(0, 0, 0, 0.45), 0 5px 8px 0 rgba(0, 0, 0, 0.3)"}),ei=Ln({normal:'"Helvetica", "Arial", sans-serif',monospace:'"Courier New", Courier, monospace'}),ls=os({color:Qa,shadows:Ja,fonts:ei}),ti=`
precision highp float;

attribute vec2 a_position;

uniform vec2 u_resolution;

varying vec2 v_tex_coords;

void main() {
    vec2 pos = a_position / u_resolution;
    pos.y = 1.0 - pos.y;
    v_tex_coords = pos;
    pos = pos * 2.0;
    pos = pos - 1.0;
    gl_Position = vec4(pos, 0.0, 1.0);
    
}
`,ni=`
precision highp float;

${lo}

varying vec2 v_tex_coords;

uniform sampler2D u_texture;

void main() {
    vec4 pixel = texture2D(u_texture, v_tex_coords);
    gl_FragColor = vec4(from_linear(pixel.rgb), pixel.a);
}
`,yt=r=>new it(r,[{name:"a_position",size:2,type:ce.Float}]),ri={u_resolution:Q.F2,u_texture:Q.I1};class xn{constructor(e,t,n){d(this,"program");d(this,"locations");d(this,"buffer");d(this,"array");d(this,"capacity",1024);this.program=t,this.locations=n,this.buffer=e.createBuffer(),this.array=new Float32Array(yt(e).size*6*this.capacity)}static create(e){const t=ve(e,ti,ni);if(t===null)return null;const n=lt(e,t,ri);return n===null?null:(yt(e).bindAttribLocations(e,t),new xn(e,t,n))}render(e,t){const{sfact:n,dfact:s}=ze(e);e.blendFunc(n,s),e.useProgram(this.program),e.bindFramebuffer(e.FRAMEBUFFER,null),this.capacity<t.blocks.length&&(this.capacity=t.blocks.length,this.array=new Float32Array(yt(e).size*6*this.capacity));const o=this.array;let l=0;for(let a=0;a<t.blocks.length;a++){const{x0:i,y0:c,x1:u,y1:h}=t.blocks[a];o[l++]=i,o[l++]=c,o[l++]=i,o[l++]=h,o[l++]=u,o[l++]=c,o[l++]=i,o[l++]=h,o[l++]=u,o[l++]=c,o[l++]=u,o[l++]=h}e.bindBuffer(e.ARRAY_BUFFER,this.buffer),e.bufferData(e.ARRAY_BUFFER,o,e.DYNAMIC_DRAW),at(e,this.locations,t.uniforms),yt(e).vertexAttrib(e),e.drawArrays(e.TRIANGLES,0,6*t.blocks.length)}dispose(e){e.deleteBuffer(this.buffer),e.deleteProgram(this.program)}}const si=`
precision highp float;

attribute vec2 a_position;

varying vec2 v_position;

void main() {
  gl_Position = vec4(a_position, 0.0, 1.0);
  
  v_position = a_position;
}
`,oi=`
precision highp float;

varying vec2 v_position;

uniform float u_softness;

void main() {
  float radius = 1.0 - u_softness;
  float dist = sqrt(dot(v_position, v_position));
  float a = 1.0 - smoothstep(radius, radius + u_softness, dist);

  gl_FragColor = vec4(vec3(0.0), (a));
}
`,pr=r=>new it(r,[{name:"a_position",size:2,type:ce.Float}]),li={u_softness:Q.F1};class Pn{constructor(e,t,n){d(this,"program");d(this,"locations");d(this,"buffer");d(this,"array");this.program=t,this.locations=n,this.buffer=e.createBuffer();const s=new Float32Array(12);s[0]=-1,s[1]=-1,s[2]=-1,s[3]=1,s[4]=1,s[5]=-1,s[6]=-1,s[7]=1,s[8]=1,s[9]=-1,s[10]=1,s[11]=1,this.array=s}static create(e){const t=ve(e,si,oi);if(t===null)return null;const n=lt(e,t,li);return n===null?null:(pr(e).bindAttribLocations(e,t),new Pn(e,t,n))}generateBrushTexture(e,t){const{sfact:n,dfact:s}=ze(e);e.blendFunc(n,s),e.useProgram(this.program),e.viewport(0,0,t.size.x,t.size.y),e.bindFramebuffer(e.FRAMEBUFFER,t.framebuffer),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT),at(e,this.locations,t.uniforms),e.bindBuffer(e.ARRAY_BUFFER,this.buffer),e.bufferData(e.ARRAY_BUFFER,this.array,e.STATIC_DRAW),pr(e).vertexAttrib(e),e.drawArrays(e.TRIANGLES,0,6)}dispose(e){e.deleteBuffer(this.buffer),e.deleteProgram(this.program)}}const ai=`
precision highp float;

attribute vec2 a_position;

uniform vec2 u_resolution;

varying vec2 v_tex_coords;

void main() {
    vec2 pos = a_position / u_resolution;
    pos.y = 1.0 - pos.y;
    pos = pos * 2.0;
    pos = pos - 1.0;
    gl_Position = vec4(pos, 0.0, 1.0);
    
    v_tex_coords = a_position / u_resolution;
}
`,ii=`
precision highp float;

varying vec2 v_tex_coords;

uniform sampler2D u_texture;
uniform float u_opacity;

void main() {
    vec4 pixel = texture2D(u_texture, v_tex_coords);
    gl_FragColor = pixel * u_opacity;
}
`,wt=r=>new it(r,[{name:"a_position",size:2,type:ce.Float}]),ci={u_texture:Q.I1,u_resolution:Q.F2,u_opacity:Q.F1};class Mn{constructor(e,t,n){d(this,"program");d(this,"locations");d(this,"buffer");d(this,"array");d(this,"capacity",1024);this.program=t,this.locations=n,this.buffer=e.createBuffer(),this.array=new Float32Array(wt(e).size*6*this.capacity)}static create(e){const t=ve(e,ai,ii);if(t===null)return null;const n=lt(e,t,ci);return n===null?null:(wt(e).bindAttribLocations(e,t),new Mn(e,t,n))}render(e,t){if(t.framebuffer==null)throw new Error("Framebuffer should be defined");const{sfact:n,dfact:s}=ze(e);e.blendFunc(n,s),e.useProgram(this.program),e.bindFramebuffer(e.FRAMEBUFFER,t.framebuffer),this.capacity<t.blocks.length&&(this.capacity=t.blocks.length,this.array=new Float32Array(wt(e).size*6*this.capacity));const o=this.array;let l=0;for(let a=0;a<t.blocks.length;a++){const{x0:i,y0:c,x1:u,y1:h}=t.blocks[a];o[l++]=i,o[l++]=c,o[l++]=i,o[l++]=h,o[l++]=u,o[l++]=c,o[l++]=i,o[l++]=h,o[l++]=u,o[l++]=c,o[l++]=u,o[l++]=h}e.bindBuffer(e.ARRAY_BUFFER,this.buffer),e.bufferData(e.ARRAY_BUFFER,o,e.DYNAMIC_DRAW),at(e,this.locations,t.uniforms),wt(e).vertexAttrib(e),e.drawArrays(e.TRIANGLES,0,6*t.blocks.length)}dispose(e){e.deleteBuffer(this.buffer),e.deleteProgram(this.program)}}const ui=`
precision highp float;

attribute vec2 a_position;

uniform vec2 u_resolution;

void main() {
    vec2 pos = a_position / u_resolution;
    pos.y = 1.0 - pos.y;
    pos = pos * 2.0;
    pos = pos - 1.0;
    gl_Position = vec4(pos, 0.0, 1.0);
}
`,fi=`
precision highp float;

uniform vec4 u_rgba;

void main() {
    gl_FragColor = u_rgba;
}
`,Rt=r=>new it(r,[{name:"a_position",size:2,type:ce.Float}]),hi={u_resolution:Q.F2,u_rgba:Q.F4};class Cn{constructor(e,t,n){d(this,"program");d(this,"locations");d(this,"buffer");d(this,"array");d(this,"capacity",1024);this.program=t,this.locations=n,this.buffer=e.createBuffer(),this.array=new Float32Array(Rt(e).size*6*this.capacity)}static create(e){const t=ve(e,ui,fi);if(t===null)return null;const n=lt(e,t,hi);return n===null?null:(Rt(e).bindAttribLocations(e,t),new Cn(e,t,n))}render(e,t){if(t.framebuffer==null)throw new Error("Framebuffer should be defined");const{sfact:n,dfact:s}=ze(e);e.blendFunc(n,s),e.useProgram(this.program),e.bindFramebuffer(e.FRAMEBUFFER,t.framebuffer),this.capacity<t.blocks.length&&(this.capacity=t.blocks.length,this.array=new Float32Array(Rt(e).size*6*this.capacity));const o=this.array;let l=0;for(let a=0;a<t.blocks.length;a++){const{x0:i,y0:c,x1:u,y1:h}=t.blocks[a];o[l++]=i,o[l++]=c,o[l++]=i,o[l++]=h,o[l++]=u,o[l++]=c,o[l++]=i,o[l++]=h,o[l++]=u,o[l++]=c,o[l++]=u,o[l++]=h}e.bindBuffer(e.ARRAY_BUFFER,this.buffer),e.bufferData(e.ARRAY_BUFFER,o,e.DYNAMIC_DRAW),at(e,this.locations,t.uniforms),Rt(e).vertexAttrib(e),e.drawArrays(e.TRIANGLES,0,6*t.blocks.length)}dispose(e){e.deleteBuffer(this.buffer),e.deleteProgram(this.program)}}const di=`
precision highp float;

attribute vec2 a_position;
attribute float a_opacity;

uniform vec2 u_resolution;

varying float v_opacity;

void main() {
    vec2 pos = a_position / u_resolution;
    pos.y = 1.0 - pos.y;
    pos = pos * 2.0;
    pos = pos - 1.0;
    gl_Position = vec4(pos, 0.0, 1.0);

    v_opacity = a_opacity;
}
`,mi=`
precision highp float;

varying float v_opacity;

uniform vec4 u_rgba;

void main() {
    gl_FragColor = u_rgba * v_opacity;
}
`,pi=r=>new it(r,[{name:"a_position",size:2,type:ce.Float},{name:"a_opacity",size:1,type:ce.Float}]),gi={u_resolution:Q.F2,u_rgba:Q.F4},Ke=class{constructor(e,t,n){d(this,"program");d(this,"locations");d(this,"buffer");d(this,"array");d(this,"capacity",1024);this.program=t,this.locations=n,this.buffer=e.createBuffer(),this.array=new Float32Array(Ke.attributesInfo.size*6*this.capacity)}static create(e){const t=ve(e,di,mi);if(t===null)return null;const n=lt(e,t,gi);return n===null?null:(this.attributesInfo=pi(e),this.attributesInfo.bindAttribLocations(e,t),new Ke(e,t,n))}render(e,t){if(t.framebuffer==null)throw new Error("Framebuffer should be defined");const{sfact:n,dfact:s}=ze(e);e.blendFunc(n,s),e.useProgram(this.program),e.bindFramebuffer(e.FRAMEBUFFER,t.framebuffer),this.capacity<t.blockHighlights.length&&(this.capacity=t.blockHighlights.length,this.array=new Float32Array(Ke.attributesInfo.size*6*this.capacity));const o=this.array;let l=0;for(let a=0;a<t.blockHighlights.length;a++){const{block:i,opacity:c}=t.blockHighlights[a],{x0:u,y0:h,x1:f,y1:m}=i;o[l++]=u,o[l++]=h,o[l++]=c,o[l++]=u,o[l++]=m,o[l++]=c,o[l++]=f,o[l++]=h,o[l++]=c,o[l++]=u,o[l++]=m,o[l++]=c,o[l++]=f,o[l++]=h,o[l++]=c,o[l++]=f,o[l++]=m,o[l++]=c}e.bindBuffer(e.ARRAY_BUFFER,this.buffer),e.bufferData(e.ARRAY_BUFFER,o,e.DYNAMIC_DRAW),at(e,this.locations,t.uniforms),Ke.attributesInfo.vertexAttrib(e),e.drawArrays(e.TRIANGLES,0,6*t.blockHighlights.length)}dispose(e){e.deleteBuffer(this.buffer),e.deleteProgram(this.program)}};let Tt=Ke;d(Tt,"attributesInfo");const _i=5e3,vi=`
precision highp float;

attribute vec4 a_color;
attribute vec2 a_tex_coords;
attribute vec2 a_position;

uniform vec2 u_resolution;

varying vec4 v_color;
varying vec2 v_tex_coords;

void main() {
    vec2 pos = (a_position / u_resolution) * vec2(2.0, -2.0) + vec2(-1.0, 1.0);
    gl_Position = vec4(pos, 0.0, 1.0);

    v_color = vec4(a_color.rgb * a_color.a, a_color.a);
    v_tex_coords = a_tex_coords;
}
`,$i=`
precision highp float;

varying vec4 v_color;
varying vec2 v_tex_coords;

uniform sampler2D u_texture;

void main() {
    float alpha = texture2D(u_texture, v_tex_coords).a;
    gl_FragColor = v_color * alpha;
}
`,Et=r=>new it(r,[{name:"a_color",size:4,type:ce.Float},{name:"a_tex_coords",size:2,type:ce.Float},{name:"a_position",size:2,type:ce.Float}]),bi={u_resolution:Q.F2,u_texture:Q.I1};function gr(){return{x0:Number.MAX_VALUE,y0:Number.MAX_VALUE,x1:Number.MIN_VALUE,y1:Number.MIN_VALUE}}class Bn{constructor(e,t,n){d(this,"gl");d(this,"program");d(this,"locations");d(this,"buffer");d(this,"array");d(this,"offset");d(this,"affectedArea");this.gl=e,this.program=t,this.locations=n;const s=Et(e).size*6*_i;this.buffer=e.createBuffer(),this.array=new Float32Array(s),this.offset=0,this.affectedArea=gr()}static create(e){const t=ve(e,vi,$i);if(t===null)return null;const n=lt(e,t,bi);return n===null?null:(Et(e).bindAttribLocations(e,t),new Bn(e,t,n))}get canFlush(){return this.offset>0}addPoints(e){const t=6*Et(this.gl).size*e.length+this.offset;for(;t>this.array.length;)this.array=yi(this.array);const n=this.array,s=e.length;let o=this.offset;for(let l=0;l<s;l++)o=wi(n,o,e[l],this.affectedArea);this.offset=o}getAffectedArea(){const{affectedArea:e}=this;return new rt(e.x0,e.y0,e.x1,e.y1)}flush(e,t){e.useProgram(this.program);const n=this.array.subarray(0,this.offset),{sfact:s,dfact:o}=io(e,t.blendMode);e.blendFunc(s,o),e.bindBuffer(e.ARRAY_BUFFER,this.buffer),e.bufferData(e.ARRAY_BUFFER,n,e.DYNAMIC_DRAW),at(e,this.locations,t.uniforms);const l=Et(e);l.vertexAttrib(e);const a=l.getDrawCount(this.offset);e.drawArrays(e.TRIANGLES,0,a),this.offset=0,this.affectedArea=gr()}dispose(e){e.deleteBuffer(this.buffer),e.deleteProgram(this.program)}}function yi(r){const e=new Float32Array(r.length*2);for(let t=0;t<r.length;t++)e[t]=r[t];return e}function wi(r,e,t,n){const s=t.position.x,o=t.position.y,l=t.scaledDiameter*.5,a=s-l,i=o-l,c=s+l,u=o+l;return e=Ge(r,e,t,0,0,a,i),e=Ge(r,e,t,1,0,c,i),e=Ge(r,e,t,0,1,a,u),e=Ge(r,e,t,1,1,c,u),e=Ge(r,e,t,0,1,a,u),e=Ge(r,e,t,1,0,c,i),a<n.x0&&(n.x0=a),i<n.y0&&(n.y0=i),c>n.x1&&(n.x1=c),u>n.y1&&(n.y1=u),e}function Ge(r,e,t,n,s,o,l){return r[e++]=t.color.r,r[e++]=t.color.g,r[e++]=t.color.b,r[e++]=t.alpha,r[e++]=n,r[e++]=s,r[e++]=o,r[e++]=l,e}const dt=32,mt=32;class _r{constructor(e,t){d(this,"x0");d(this,"y0");d(this,"x1");d(this,"y1");this.x0=e*dt,this.y0=t*mt,this.x1=(e+1)*dt,this.y1=(t+1)*mt}eq(e){return this.x0===e.x0&&this.y0===e.y0}getHashcode(){let e=0;return e=(e<<5)-e+this.x0,e=(e<<5)-e+this.y0,e}contains(e){return e.x>=this.x0&&e.x<=this.x1&&e.y>=this.y0&&e.y<=this.y1}}class Ri{constructor(e){d(this,"debugHighlightTimeMs");d(this,"_newBrushPoints",[]);d(this,"_strokeBlocks",[]);d(this,"_renderBlocks",[]);d(this,"_finalHighlights",[]);d(this,"_lastUpdateMs",0);this.debugHighlightTimeMs=e}getFrameBlocks(){const e=this._renderBlocks,t=this._finalHighlights,n=e.length+t.length,s=new Array(n);let o=0;for(let l=0;l<e.length;l++)s[o++]=e[l].block;for(let l=0;l<t.length;l++)s[o++]=t[l];return s}getStrokeBlocks(){return this._strokeBlocks}getHighlights(){if(this.debugHighlightTimeMs===0)return[];const e=this.debugHighlightTimeMs,t=this._renderBlocks,n=this._lastUpdateMs,s=new Array(t.length);for(let o=0;o<t.length;o++){const l=t[o],a=n-l.drawTimeMs;s[o]={opacity:se(1-a/e,0,1),block:l.block}}return s}addBrushPoints(e){for(let t=0;t<e.length;t++)this._newBrushPoints.push(e[t])}update(e){const t=this._newBrushPoints,n=this._renderBlocks,s=this._finalHighlights;s.length=0;for(let l=0;l<n.length;l++)e-n[l].drawTimeMs>this.debugHighlightTimeMs&&(s.push(n[l].block),n.splice(l,1),l-=1);for(let l=0;l<t.length;l++){const a=t[l],i=a.scaledDiameter/2,c=a.position.x-i,u=a.position.y-i,h=a.position.x+i,f=a.position.y+i,m=c/dt|0,p=u/mt|0,g=h/dt|0,_=f/mt|0;for(let v=p;v<=_;v++)for(let S=m;S<=g;S++){const w=new _r(S,v);let L=-1;for(let C=0;C<n.length;C++)if(n[C].block.eq(w)){n[C].drawTimeMs=e,L=C;break}L===-1&&n.push({drawTimeMs:e,block:w})}}t.length=0;const o=this._strokeBlocks;for(let l=0;l<n.length;l++){const{block:a}=n[l];let i=!1;for(let c=0;c<o.length;c++)if(a.eq(o[c])){i=!0;break}i||o.push(a)}this._lastUpdateMs=e}fillAll(e,t){const n=t.x/dt|0,s=t.y/mt|0,o=this._renderBlocks;let l=0;for(let a=0;a<s;a++)for(let i=0;i<n;i++){const c=new _r(i,a);o[l++]={drawTimeMs:e,block:c}}}strokeEnded(){this._strokeBlocks.length=0}}let Ei=1;class as{constructor(e,t){d(this,"id");d(this,"texture");d(this,"framebuffer");this.id=Ei++,this.texture=e,this.framebuffer=t}}function ye(r,e,t,n){const s=new as(r.createTexture(),r.createFramebuffer());e.push(s),Ae(r,t,s),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,n.x,n.y,0,r.RGBA,r.FLOAT,null),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.bindFramebuffer(r.FRAMEBUFFER,s.framebuffer),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,s.texture,0);const o=r.checkFramebufferStatus(r.FRAMEBUFFER);switch(o){case r.FRAMEBUFFER_COMPLETE:break;case r.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:console.warn("FRAMEBUFFER_INCOMPLETE_ATTACHMENT for texture:",s);break;case r.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:console.warn("FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT for texture:",s);break;case r.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:console.warn("FRAMEBUFFER_INCOMPLETE_DIMENSIONS for texture:",s);break;case r.FRAMEBUFFER_UNSUPPORTED:console.warn("FRAMEBUFFER_UNSUPPORTED for texture:",s);break;default:throw new Error("Unexpected status: "+o)}return s}function Ae(r,e,{texture:t,id:n}){for(let s=0;s<e.length;s++)if(e[s][0]===n)return r.activeTexture(r.TEXTURE0+s),s;for(let s=0;s<e.length;s++)if(e[s][0]===null)return r.activeTexture(r.TEXTURE0+s),r.bindTexture(r.TEXTURE_2D,t),e[s]=[n,performance.now()],s;{let s=Number.MAX_VALUE,o=0;for(let l=0;l<e.length;l++){const a=e[l][1];a<s&&(s=a,o=l)}return r.activeTexture(r.TEXTURE0+o),r.bindTexture(r.TEXTURE_2D,t),e[o]=[n,performance.now()],o}}class Si{constructor(e,t){d(this,"above");d(this,"below");d(this,"current");d(this,"anyChange");const n=t.above,s=t.below;let o=null,l=null;if(vr(e.above,n)){o=[];for(let a=0;a<n.length;a++){const i=n[a];i.opacity!==0&&o.push(i)}}if(vr(e.below,s)){l=[];for(let a=s.length-1;a>=0;a--){const i=s[a];i.opacity!==0&&l.push(i)}}this.above=o,this.below=l,this.current=t.current,this.anyChange=e.current!==t.current||o!==null||l!==null}}function vr(r,e){if(r.length!==e.length)return!0;for(let t=0;t<e.length;t++)if(r[t].id!==e[t].id)return!0;return!1}function Ti(r){const{gl:e,allTextures:t,resolution:n,layersToRender:s,textureShader:o,textureBindings:l,layerTextureMap:a}=r,i=s.above,c=s.below,u=s.current;if(e.clearColor(0,0,0,0),i!==null){e.bindFramebuffer(e.FRAMEBUFFER,r.textureAbove.framebuffer),e.clear(e.COLOR_BUFFER_BIT);for(let h=0;h<i.length;h++){const f=i[h];let m=a.get(f.id);m==null&&(m=ye(e,t,l,n),a.set(f.id,m)),o.render(e,{blocks:[{x0:0,y0:0,x1:n.x,y1:n.y}],framebuffer:r.textureAbove.framebuffer,uniforms:{u_opacity:f.opacity,u_resolution:n,u_texture:Qt(e,l,m)}})}}if(c!==null){e.bindFramebuffer(e.FRAMEBUFFER,r.textureBelow.framebuffer),e.clear(e.COLOR_BUFFER_BIT);for(let h=0;h<c.length;h++){const f=c[h];let m=a.get(f.id);m==null&&(m=ye(e,t,l,n),a.set(f.id,m)),o.render(e,{blocks:[{x0:0,y0:0,x1:n.x,y1:n.y}],framebuffer:r.textureBelow.framebuffer,uniforms:{u_opacity:f.opacity,u_resolution:n,u_texture:Qt(e,l,m)}})}}if(u!==null){let h=a.get(u.id);h==null&&(h=ye(e,t,l,n),a.set(u.id,h)),e.bindFramebuffer(e.FRAMEBUFFER,r.textureCurrent.framebuffer),e.clear(e.COLOR_BUFFER_BIT),o.render(e,{blocks:[{x0:0,y0:0,x1:n.x,y1:n.y}],framebuffer:r.textureCurrent.framebuffer,uniforms:{u_opacity:u.opacity,u_resolution:n,u_texture:Qt(e,l,h)}})}}function Qt(r,e,{texture:t,id:n}){for(let s=0;s<e.length;s++)if(e[s][0]===n)return r.activeTexture(r.TEXTURE0+s),s;for(let s=0;s<e.length;s++)if(e[s][0]===null)return r.activeTexture(r.TEXTURE0+s),r.bindTexture(r.TEXTURE_2D,t),e[s]=[n,performance.now()],s;{let s=Number.MAX_VALUE,o=0;for(let l=0;l<e.length;l++){const a=e[l][1];a<s&&(s=a,o=l)}return r.activeTexture(r.TEXTURE0+o),r.bindTexture(r.TEXTURE_2D,t),e[o]=[n,performance.now()],o}}function ki(r){const e={antialias:!1,depth:!1,alpha:!1,premultipliedAlpha:!1,stencil:!1,preserveDrawingBuffer:!0,desynchronized:!0},t=r.getContext("webgl",e);if(t===null)return console.error("Failed to initialize WebGL renderer for canvas: ",r),new fe("Failed to initialize WebGL");const n=t.getContextAttributes();n&&n.desynchronized||console.warn("Low latency canvas not supported. Boo!"),t.getExtension("OES_texture_float_linear")===null&&console.warn(`Couldn't enable "OES_texture_float_linear"`),t.getExtension("OES_texture_float")===null&&console.warn(`Couldn't enable "OES_texture_float"`),t.viewport(0,0,r.width,r.height),t.enable(t.BLEND),t.disable(t.DEPTH_TEST);const{sfact:l,dfact:a}=ze(t);t.blendFunc(l,a);const i=Bn.create(t);if(i===null){const g="Failed to initialize BrushShader";return console.error(g),new fe(g)}const c=Pn.create(t);if(c===null){const g="Failed to initialize BrushTextureGenerator";return console.error(g),new fe(g)}const u=Mn.create(t);if(u===null){const g="Failed to initialize TextureShader";return console.error(g),new fe(g)}const h=Cn.create(t);if(h===null){const g="Failed to initialize ClearBlocksShader";return console.error(g),new fe(g)}const f=xn.create(t);if(f===null){const g="Failed to initialize OutputShader";return console.error(g),new fe(g)}const m=Tt.create(t);if(m===null){const g="Failed to initialize BlockHighlightShader";return console.error(g),new fe(g)}t.viewport(0,0,r.width,r.height);const p=new Fi({gl:t,brushTextureGenerator:c,drawpointBatch:i,outputRenderer:f,textureRenderer:u,clearBlocksRenderer:h,blockHighlightShader:m,resolution:new ne(r.width,r.height)});return new xt([p,t])}class Fi{constructor(e){d(this,"gl");d(this,"brushTextureGenerator");d(this,"textureRenderer");d(this,"clearBlocksRenderer");d(this,"blockHighlightShader");d(this,"outputRenderer");d(this,"drawpointBatch");d(this,"allTextures");d(this,"textureBindings");d(this,"layerTextureMap");d(this,"internalCanvasSize");d(this,"stroke");d(this,"renderBlockSystem");d(this,"prevLayers");d(this,"brushTexture");d(this,"outputTexture");d(this,"combinedLayers");this.gl=e.gl,this.brushTextureGenerator=e.brushTextureGenerator,this.textureRenderer=e.textureRenderer,this.clearBlocksRenderer=e.clearBlocksRenderer,this.blockHighlightShader=e.blockHighlightShader,this.outputRenderer=e.outputRenderer,this.drawpointBatch=e.drawpointBatch,this.allTextures=[],this.textureBindings=new Array(32).fill([null,0]),this.layerTextureMap=new Map,this.internalCanvasSize=e.resolution,this.stroke=null,this.renderBlockSystem=new Ri(500),this.prevLayers={above:[],below:[],current:null};{const n=new ne(128,128);this.brushTexture=ye(this.gl,this.allTextures,this.textureBindings,n),this.brushTextureGenerator.generateBrushTexture(this.gl,{framebuffer:this.brushTexture.framebuffer,size:n,uniforms:{u_softness:0}})}this.outputTexture=ye(this.gl,this.allTextures,this.textureBindings,e.resolution);const t=this.outputTexture.framebuffer;this.combinedLayers={above:ye(this.gl,this.allTextures,this.textureBindings,e.resolution),below:ye(this.gl,this.allTextures,this.textureBindings,e.resolution),current:ye(this.gl,this.allTextures,this.textureBindings,e.resolution)},this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,t),this.gl.viewport(0,0,e.resolution.x,e.resolution.y),this.gl.clearColor(.6,.6,.6,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.outputRenderer.render(this.gl,{uniforms:{u_resolution:e.resolution,u_texture:Ae(this.gl,this.textureBindings,this.outputTexture)},blocks:[{x0:0,y0:0,x1:e.resolution.x,y1:e.resolution.y}]})}addBrushPoints(e){this.drawpointBatch.addPoints(e),this.renderBlockSystem.addBrushPoints(e)}endStroke(){const{gl:e,stroke:t,prevLayers:n,internalCanvasSize:s,textureRenderer:o,combinedLayers:l,renderBlockSystem:a,textureBindings:i}=this;t===null||n.current===null||(e.viewport(0,0,s.x,s.y),o.render(e,{framebuffer:l.current.framebuffer,uniforms:{u_opacity:1,u_resolution:s,u_texture:Ae(e,i,t)},blocks:a.getStrokeBlocks()}),e.bindFramebuffer(e.FRAMEBUFFER,t.framebuffer),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT),a.strokeEnded())}render(e){const{blendMode:t,nextLayers:n,resolution:s,brush:o}=e,{gl:l,renderBlockSystem:a,drawpointBatch:i,layerTextureMap:c,allTextures:u,textureBindings:h,internalCanvasSize:f,brushTexture:m,brushTextureGenerator:p,prevLayers:g,combinedLayers:_,outputTexture:v}=this,S=new Si(g,n);S.anyChange&&a.fillAll(e.currentTime,s),a.update(e.currentTime);const w=a.getFrameBlocks();if(w.length===0)return;if(i.canFlush)if(n.current===null)console.warn("Drawpoint batch has data to flush, but no layer is currently selected");else{let C=c.get(n.current.id);C==null&&(C=ye(l,u,h,f),c.set(n.current.id,C)),p.generateBrushTexture(l,{framebuffer:m.framebuffer,size:new ne(128,128),uniforms:{u_softness:Math.max(o.softness,1e-6)}}),l.viewport(0,0,s.x,s.y),l.bindFramebuffer(l.FRAMEBUFFER,C.framebuffer),i.flush(l,{blendMode:t,uniforms:{u_resolution:s,u_texture:Ae(l,h,m)}})}Ti({gl:l,resolution:s,allTextures:u,layerTextureMap:c,textureBindings:h,textureShader:this.textureRenderer,layersToRender:S,textureAbove:_.above,textureBelow:_.below,textureCurrent:_.current});const L=v.framebuffer;if(l.bindFramebuffer(l.FRAMEBUFFER,L),this.clearBlocksRenderer.render(l,{framebuffer:L,uniforms:{u_resolution:s,u_rgba:rt.fromRgba(new At(.6,.6,.6),1)},blocks:w}),this.textureRenderer.render(l,{framebuffer:L,uniforms:{u_opacity:1,u_resolution:s,u_texture:Ae(l,h,_.below)},blocks:w}),n.current!==null&&this.textureRenderer.render(l,{framebuffer:L,uniforms:{u_opacity:n.current.opacity,u_resolution:s,u_texture:Ae(l,h,_.current)},blocks:w}),this.textureRenderer.render(l,{framebuffer:L,uniforms:{u_opacity:1,u_resolution:s,u_texture:Ae(l,h,_.above)},blocks:w}),e.highlightRenderBlocks){const C=a.getHighlights();this.blockHighlightShader.render(l,{framebuffer:L,uniforms:{u_resolution:s,u_rgba:rt.fromRgba(new At(0,0,1),1)},blockHighlights:C})}this.outputRenderer.render(l,{uniforms:{u_resolution:s,u_texture:Ae(l,h,v)},blocks:w}),l.flush(),this.prevLayers=n}dispose(){const{gl:e}=this;this.brushTextureGenerator.dispose(e),this.textureRenderer.dispose(e),this.outputRenderer.dispose(e),this.drawpointBatch.dispose(e);for(const t of this.allTextures)e.deleteTexture(t.texture),t instanceof as&&e.deleteFramebuffer(t.framebuffer)}}const qe=B("NoOp");class is{constructor(e){d(this,"sendMessage");d(this,"tool");d(this,"layer");d(this,"onFrame",e=>this.sendMessage(B("OnFrame",e)));d(this,"onClick",e=>this.sendMessage(B("OnClick",e)));d(this,"onRelease",e=>this.sendMessage(B("OnRelease",e)));d(this,"onDrag",e=>{if(e.length===0){const t="Expected inputs be be 1 or greater";throw console.error(t,e),{[t]:e}}this.sendMessage(B("OnDrag",e))});d(this,"onKeyboard",e=>this.sendMessage(B("OnKeyboard",e)));d(this,"randomizeTheme",()=>this.sendMessage(B("RandomizeTheme")));d(this,"toggleHighlightRenderBlocks",()=>this.sendMessage(B("ToggleHighlightRenderBlocks")));this.sendMessage=e,this.tool=new Ma(t=>e(B("ToolMsg",t))),this.layer=new Ra(t=>e(B("LayersMsg",t)))}}function Ai(){const[r,e]=ls(Pt.create(145264772)),t=Dt.createKey,n={theme:r,tool:Ca,layers:Le.init(),highlightRenderBlocks:!1,keyboard:{layers:we().cons({[t({code:"KeyB"})]:{msg:B("ToolMsg",B("SetToolMsg","Brush")),passive:!1},[t({code:"KeyE"})]:{msg:B("ToolMsg",B("SetToolMsg","Eraser")),passive:!1},[t({code:"KeyZ"})]:{msg:B("ToolMsg",B("SetToolMsg","Zoom")),passive:!1},[t({code:"KeyM"})]:{msg:B("ToolMsg",B("SetToolMsg","Move")),passive:!1},[t({code:"KeyR"})]:{msg:B("ToolMsg",B("SetToolMsg","Rotate")),passive:!1},[t({code:"KeyP"})]:{msg:B("ToggleHighlightRenderBlocks"),passive:!1}})}},s={themeRng:e,tool:Oa(),hasPressedDown:!1};return[n,s]}function pn(r,e,t){const n=new ne(t.x,t.y).subtract(r.offset).subtractScalars(e.offsetX,e.offsetY).subtract(r.halfResoution).multiplyScalar(1/e.zoomPct),{x:s,y:o}=so(-e.rotateTurns,ne.zeroes,n).add(r.halfResoution);return{x:s,y:o,pressure:t.pressure,time:t.time,originalX:t.x,originalY:t.y}}function Li(r,e,t){const n=new Array(t.length);for(let s=0;s<t.length;s++)n[s]=pn(r,e,t[s]);return n}function cs(r,e,t,n){switch(n.tag){case"OnFrame":{const[s,o]=Ha(e.tool,t.tool,n.val),l=B("RenderFrame",{brushPoints:o,config:e});return[e,{...t,tool:s},l]}case"OnClick":{const[s,o,l]=Ia(e.tool,t.tool,pn(r,e.tool.camera,n.val)),a={...e,tool:s},i={...t,hasPressedDown:!0,tool:o},c=B("AddBrushPoints",l);return[a,i,c]}case"OnRelease":{const[s,o,l]=Na(e.tool,t.tool,pn(r,e.tool.camera,n.val)),a={...e,tool:s},i={...t,hasPressedDown:!1,tool:o},c=B("EndStroke",l);return[a,i,c]}case"OnDrag":{if(!t.hasPressedDown)return[e,t,qe];const[s,o,l]=Da(e.tool,t.tool,Li(r,e.tool.camera,n.val)),a={...e,tool:s},i={...t,tool:o},c=B("AddBrushPoints",l);return[a,i,c]}case"OnKeyboard":{const s=Va(e.keyboard,n.val),o=[];let l=qe,a=e,i=t;for(let c=0;c<s.length;c++)[a,i,l]=cs(r,a,i,s[c]),l.tag!=="NoOp"&&o.push(l);return o.length>0&&(l=B("Batch",o)),[a,i,l]}case"RandomizeTheme":{const[s,o]=ls(t.themeRng),l={...e,theme:s},a={...t,themeRng:o};return[l,a,qe]}case"ToggleHighlightRenderBlocks":return[{...e,highlightRenderBlocks:!e.highlightRenderBlocks},t,qe];case"ToolMsg":return[{...e,tool:Ba(e.tool,n.val)},t,qe];case"LayersMsg":return[{...e,layers:e.layers.update(n.val)},t,qe];default:throw{"unexpected msg":n}}}class In{constructor(e,t,n){d(this,"resolution");d(this,"hooks");d(this,"context");d(this,"perfTracker");this.resolution=e,this.hooks=t,this.context=n,this.perfTracker=new Js({maxSamples:50,onSamples:this.hooks.onStats})}static create(e,t){const n=ki(e);return n.isOk()?new In(new ne(e.width,e.height),t,n.value[0]):(console.error("Error in Context setup:",n.value),null)}handle(e){switch(e.tag){case"NoOp":return;case"Batch":{const t=e.val;for(let n=0;n<t.length;n++)this.handle(t[n]);return}case"RenderFrame":{const{brushPoints:t,config:n}=e.val;this.perfTracker.start(),this.context.addBrushPoints(t),this.context.render({blendMode:za(n.tool),nextLayers:n.layers.split(),resolution:this.resolution,brush:{softness:Ua(n.tool)},currentTime:performance.now(),highlightRenderBlocks:n.highlightRenderBlocks}),this.perfTracker.end();return}case"AddBrushPoints":{this.context.addBrushPoints(e.val);return}case"EndStroke":{this.context.addBrushPoints(e.val),this.context.endStroke();return}default:throw{"unexpected effect":e}}}dispose(){this.context.dispose()}}function xi(r){return window.PointerEvent!==void 0?Bi(r):Ii(r)}const gn={};function $r(r){r.pressure!==.5&&(gn[r.pointerId]||(gn[r.pointerId]=!0))}function Pi(r){return gn[r.pointerId]?r.pressure:r.pressure===.5?1:r.pressure}const Mi=()=>PointerEvent.prototype.getCoalescedEvents===void 0?r=>[r]:r=>r.getCoalescedEvents();function _n(r,e,t){return{x:e.x,y:e.y,pressure:Pi(t),shift:e.shiftKey,alt:e.altKey,ctrl:e.ctrlKey,time:r}}function Ci(r,e){const t=Mi()(e),n=new Array(t.length);for(let s=0;s<t.length;s++)n[s]=_n(r,t[s],e);return n}function Qe(r,e){return{subscribe(t){return r.addEventListener(e,t,{passive:!0}),()=>{r.removeEventListener(e,t)}}}}function Je(r,e){return{subscribe(t){return r.subscribe(n=>t(e(n)))}}}function us(r,e){return{subscribe(t){let n;const s=r.subscribe(o=>{n==null||n(),n=e(o).subscribe(t)});return()=>{n==null||n(),s()}}}}function fs(r,e){return{subscribe(t){const n=()=>{s(),o()},s=r.subscribe(t),o=e.subscribe(n);return n}}}function Bi(r){const e=Je(Qe(r,"pointerdown"),o=>($r(o),_n(performance.now(),o,o))),t=Je(Qe(document.body,"pointermove"),o=>($r(o),Ci(performance.now(),o))),n=Je(Qe(document.body,"pointerup"),o=>_n(performance.now(),o,o)),s=us(e,o=>fs(t,n));return{click:e,move:t,drag:s,release:n}}function Ii(r){const e=Je(Qe(r,"mousedown"),o=>Jt(performance.now(),o,!1)),t=Je(Qe(document.body,"mousemove"),o=>[Jt(performance.now(),o,!1)]),n=Je(Qe(document.body,"mouseup"),o=>Jt(performance.now(),o,!0)),s=us(e,o=>fs(t,n));return{click:e,move:t,drag:s,release:n}}function Jt(r,e,t){return{x:e.x,y:e.y,pressure:t?0:1,shift:e.shiftKey,alt:e.altKey,ctrl:e.ctrlKey,time:r}}const vn=new ne(800,800),[et,hs]=Ai(),$n=({canvasOffset:r,canvasResolution:e})=>({resolution:e,halfResoution:e.multiplyScalar(.5),offset:r}),Di=$n({canvasOffset:new ne(et.tool.camera.offsetX,et.tool.camera.offsetY),canvasResolution:vn}),Ni=new is(r=>{}),Hi=st(),ds=st(et),ms=st(Ni),ps=st(Di),Oi=st(hs),zi=ds,Ui=ms,Vi=ps,Xi=r=>{let e=$n({canvasOffset:new ne(et.tool.camera.offsetX,et.tool.camera.offsetY),canvasResolution:vn});Me(()=>{const t=r();if(!t)throw new Error("Canvas not found");const n=In.create(t,{onStats:i=>{ga.update(c=>c.update(i))},onWebglContextCreated:i=>{console.log("debuggingGl set"),Hi.set(i)}});if(n===null)throw new Error("Failed to initialize Canvas");const s=js({initialState:et,initialEphemeral:hs,effectsHandler:i=>n.handle(i),forceRender:(i,c)=>{ds.set(i),Oi.set(c),qi(i.theme)},update:(i,c,u)=>{const h=cs(e,i,c,u);return u.tag!=="OnFrame"&&console.log(`UPD [${u.tag}]`,h),h}}),o=new is(s.send);ms.set(o),console.log("Painter mounted");const l=[],a=xi(t);return l.push(a.click.subscribe(o.onClick)),l.push(a.release.subscribe(o.onRelease)),l.push(a.move.subscribe(()=>{})),l.push(a.drag.subscribe(o.onDrag)),l.push(Xa({handle:o.onKeyboard})),l.push(Qs.make(o.onFrame)),l.push(()=>n.dispose()),()=>{for(const i of l)typeof i!="function"?i.unsubscribe():i();console.log("Painter unmounted")}}),Ki(()=>{const t=r();!t||(e=$n({canvasOffset:Yi(t),canvasResolution:vn}),ps.set(e))})},Yi=r=>new ne(r.offsetLeft,r.offsetTop),Gi=()=>{let r=null;return e=>{r===null?ja(e):Za(r,e),r=e}},qi=Gi(),Ki=r=>{Er(()=>{r()}),Me(()=>(window.addEventListener("resize",r),()=>{window.removeEventListener("resize",r)}))};const Wi=()=>{Me(()=>{const r=e=>{e.preventDefault(),e.returnValue=""};return window.addEventListener("beforeunload",r),()=>{window.removeEventListener("beforeunload",r)}})},br=r=>{const e="translate("+r.offsetX+"px, "+r.offsetY+"px) ",t="rotate("+r.rotateTurns+"turn) ",n="scale("+r.zoomPct+", "+r.zoomPct+")";return e+t+n};function yr(r){let e,t;return e=new ql({props:{sender:r[1].tool,tool:r[2].tool,transientState:{isDetailsExpanded:!0}}}),{c(){T(e.$$.fragment)},l(n){k(e.$$.fragment,n)},m(n,s){F(e,n,s),t=!0},p(n,s){const o={};s&2&&(o.sender=n[1].tool),s&4&&(o.tool=n[2].tool),e.$set(o)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){y(e.$$.fragment,n),t=!1},d(n){A(e,n)}}}function wr(r){let e,t,n,s,o;return t=new _t({props:{$$slots:{default:[Zi]},$$scope:{ctx:r}}}),s=new ia({props:{layers:r[2].layers,sender:r[1].layer}}),{c(){e=P("div"),T(t.$$.fragment),n=D(),T(s.$$.fragment),this.h()},l(l){e=M(l,"DIV",{class:!0});var a=x(e);k(t.$$.fragment,a),n=N(a),k(s.$$.fragment,a),a.forEach($),this.h()},h(){R(e,"class","layersViewContainer svelte-5xuksa")},m(l,a){O(l,e,a),F(t,e,null),E(e,n),F(s,e,null),o=!0},p(l,a){const i={};a&134&&(i.$$scope={dirty:a,ctx:l}),t.$set(i);const c={};a&4&&(c.layers=l[2].layers),a&2&&(c.sender=l[1].layer),s.$set(c)},i(l){o||(b(t.$$.fragment,l),b(s.$$.fragment,l),o=!0)},o(l){y(t.$$.fragment,l),y(s.$$.fragment,l),o=!1},d(l){l&&$(e),A(t),A(s)}}}function Zi(r){let e,t;return e=new pa({props:{camera:r[2].tool.camera,sender:r[1].tool.camera}}),{c(){T(e.$$.fragment)},l(n){k(e.$$.fragment,n)},m(n,s){F(e,n,s),t=!0},p(n,s){const o={};s&4&&(o.camera=n[2].tool.camera),s&2&&(o.sender=n[1].tool.camera),e.$set(o)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){y(e.$$.fragment,n),t=!1},d(n){A(e,n)}}}function Rr(r){let e,t,n;return t=new kr({props:{$$slots:{default:[ji]},$$scope:{ctx:r}}}),t.$on("click",function(){Tr(r[1].randomizeTheme)&&r[1].randomizeTheme.apply(this,arguments)}),{c(){e=P("div"),T(t.$$.fragment),this.h()},l(s){e=M(s,"DIV",{class:!0});var o=x(e);k(t.$$.fragment,o),o.forEach($),this.h()},h(){R(e,"class","bottomLeft svelte-5xuksa")},m(s,o){O(s,e,o),F(t,e,null),n=!0},p(s,o){r=s;const l={};o&128&&(l.$$scope={dirty:o,ctx:r}),t.$set(l)},i(s){n||(b(t.$$.fragment,s),n=!0)},o(s){y(t.$$.fragment,s),n=!1},d(s){s&&$(e),A(t)}}}function ji(r){let e;return{c(){e=ee("Next theme")},l(t){e=te(t,"Next theme")},m(t,n){O(t,e,n)},d(t){t&&$(e)}}}function Qi(r){let e,t,n,s,o,l,a,i,c,u,h,f=r[1]&&r[2]&&yr(r),m=r[1]&&r[2]&&wr(r),p=r[1]&&r[2]&&Rr(r),g=!1;return{c(){e=P("div"),t=P("div"),f&&f.c(),n=D(),s=P("canvas"),i=D(),m&&m.c(),c=D(),p&&p.c(),u=D(),this.h()},l(_){e=M(_,"DIV",{class:!0});var v=x(e);t=M(v,"DIV",{class:!0});var S=x(t);f&&f.l(S),n=N(S),s=M(S,"CANVAS",{class:!0,width:!0,height:!0,style:!0}),x(s).forEach($),i=N(S),m&&m.l(S),S.forEach($),c=N(v),p&&p.l(v),u=N(v),v.forEach($),this.h()},h(){var _,v;R(s,"class","canvas svelte-5xuksa"),R(s,"width",o=(_=r[3].resolution.x)!=null?_:800),R(s,"height",l=(v=r[3].resolution.y)!=null?v:800),R(s,"style",a=r[2]?`transform: ${br(r[2].tool.camera)}`:void 0),R(t,"class","wrapper svelte-5xuksa"),R(e,"class","appContainer svelte-5xuksa")},m(_,v){O(_,e,v),E(e,t),f&&f.m(t,null),E(t,n),E(t,s),r[6](s),E(t,i),m&&m.m(t,null),E(e,c),p&&p.m(e,null),E(e,u),h=!0},p(_,[v]){var S,w;_[1]&&_[2]?f?(f.p(_,v),v&6&&b(f,1)):(f=yr(_),f.c(),b(f,1),f.m(t,n)):f&&(xe(),y(f,1,1,()=>{f=null}),Pe()),(!h||v&8&&o!==(o=(S=_[3].resolution.x)!=null?S:800))&&R(s,"width",o),(!h||v&8&&l!==(l=(w=_[3].resolution.y)!=null?w:800))&&R(s,"height",l),(!h||v&4&&a!==(a=_[2]?`transform: ${br(_[2].tool.camera)}`:void 0))&&R(s,"style",a),_[1]&&_[2]?m?(m.p(_,v),v&6&&b(m,1)):(m=wr(_),m.c(),b(m,1),m.m(t,null)):m&&(xe(),y(m,1,1,()=>{m=null}),Pe()),_[1]&&_[2]?p?(p.p(_,v),v&6&&b(p,1)):(p=Rr(_),p.c(),b(p,1),p.m(e,u)):p&&(xe(),y(p,1,1,()=>{p=null}),Pe())},i(_){h||(b(f),b(m),b(p),b(g),h=!0)},o(_){y(f),y(m),y(p),y(g),h=!1},d(_){_&&$(e),f&&f.d(),r[6](null),m&&m.d(),p&&p.d()}}}function Ji(r,e,t){let n,s,o,l,a;Xt(r,Ui,u=>t(4,o=u)),Xt(r,zi,u=>t(5,l=u)),Xt(r,Vi,u=>t(3,a=u));let i;Xi(()=>i),Wi();function c(u){He[u?"unshift":"push"](()=>{i=u,t(0,i)})}return r.$$.update=()=>{r.$$.dirty&32&&t(2,n=l),r.$$.dirty&16&&t(1,s=o)},[i,s,n,a,o,l,c]}class ec extends Y{constructor(e){super(),G(this,e,Ji,Qi,q,{})}}function tc(r){let e,t,n,s;return n=new ec({}),{c(){e=D(),t=P("main"),T(n.$$.fragment),this.h()},l(o){vs("svelte-w8bttj",document.head).forEach($),e=N(o),t=M(o,"MAIN",{style:!0});var a=x(t);k(n.$$.fragment,a),a.forEach($),this.h()},h(){document.title="Paint tool v2",pe(t,"background-color","var(--color-background, #555)")},m(o,l){O(o,e,l),O(o,t,l),F(n,t,null),s=!0},p:W,i(o){s||(b(n.$$.fragment,o),s=!0)},o(o){y(n.$$.fragment,o),s=!1},d(o){o&&$(e),o&&$(t),A(n)}}}class oc extends Y{constructor(e){super(),G(this,e,null,tc,q,{})}}export{oc as default};
