{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./node_modules/ivi/dist/module/vdom/factories.js","webpack:///./src/util/store.ts","webpack:///./src/util/decode.ts","webpack:///./src/util/maybe.ts","webpack:///./src/util/vec2.ts","webpack:///./src/util/result.ts","webpack:///./src/util/vec3.ts","webpack:///./src/util/vec4.ts","webpack:///./src/util/signals.ts","webpack:///./src/util/frameStream.ts","webpack:///./src/util/perfTracker.ts","webpack:///./src/util/index.ts","webpack:///./node_modules/ivi-html/dist/module/index.js","webpack:///./src/ui/views/buttons.ts","webpack:///./src/ui/views/colorDisplay.ts","webpack:///./src/ui/views/colorWheel.ts","webpack:///./src/ui/views/icons.ts","webpack:///./src/ui/views/inlineLabeled.ts","webpack:///./src/ui/views/labeled.ts","webpack:///./src/ui/views/menu.ts","webpack:///./src/ui/views/row.ts","webpack:///./src/ui/views/slider.ts","webpack:///./src/ui/views/surface.ts","webpack:///./src/ui/views/switch.ts","webpack:///./src/ui/views/index.ts","webpack:///./src/webgl/index.ts","webpack:///./src/webgl/glsl.ts","webpack:///./node_modules/color/dist/index.js","webpack:///./node_modules/ivi/dist/module/dom/shortcuts.js","webpack:///./node_modules/ivi/dist/module/core/shortcuts.js","webpack:///./node_modules/ivi/dist/module/vdom/context.js","webpack:///./node_modules/ivi/dist/module/core/error.js","webpack:///./node_modules/ivi/dist/module/core/array.js","webpack:///./node_modules/ivi/dist/module/core/repeatable_task_list.js","webpack:///./node_modules/ivi/dist/module/scheduler/index.js","webpack:///./node_modules/ivi/dist/module/vdom/operations.js","webpack:///./node_modules/ivi-svg/dist/module/index.js","webpack:///./node_modules/ivi/dist/module/core/token.js","webpack:///./node_modules/ivi/dist/module/ssr/render.js","webpack:///./src/ui/layers.scss?6c59","webpack:///./node_modules/ivi/dist/module/vdom/reconciler.js","webpack:///./node_modules/ivi/dist/module/ssr/escape.js","webpack:///./src/ui/views/menu.scss?d9d0","webpack:///./node_modules/process/browser.js","webpack:///./src/ui/views/icons.scss?9903","webpack:///./src/ui/views/switch.scss?fcbd","webpack:///./node_modules/ivi/dist/module/vdom/root.js","webpack:///./node_modules/ivi/dist/module/vdom/hooks.js","webpack:///./src/ui/index.scss?1b87","webpack:///./src/ui/views/labeled.scss?a05d","webpack:///./src/ui/views/slider.scss?880f","webpack:///./src/ui/debugging.scss?2f81","webpack:///./src/ui/views/buttons.scss?58c5","webpack:///./node_modules/ivi/dist/module/events/utils.js","webpack:///./node_modules/ivi/dist/module/dom/feature_detection.js","webpack:///./node_modules/ivi/dist/module/vdom/state.js","webpack:///./node_modules/ivi/dist/module/dom/namespaces.js","webpack:///./src/ui/views/colorDisplay.scss?3226","webpack:///./src/ui/views/colorWheel.scss?ca06","webpack:///./src/ui/views/row.scss?64f2","webpack:///./src/ui/brush.scss?150c","webpack:///./src/ui/views/inlineLabeled.scss?8d73","webpack:///./src/ui/views/surface.scss?972e","webpack:///./src/ui/toolbar.scss?2696","webpack:///./node_modules/ivi/dist/module/vdom/attribute_directive.js","webpack:///./node_modules/ivi/dist/module/events/dispatch.js","webpack:///./src/ui/eraser.scss?8488","webpack:///./src/ui/miniMap.scss?dce8","webpack:///./src/ui/debugging.ts","webpack:///./src/tools/interpolation.ts","webpack:///./src/tools/brushDelay.ts","webpack:///./src/collections/stack.ts","webpack:///./src/tools/brush.ts","webpack:///./src/tools/eraser.ts","webpack:///./src/tools/camera.ts","webpack:///./src/collections/zipperList.ts","webpack:///./src/tools/index.ts","webpack:///./src/ui/brush.ts","webpack:///./src/ui/eraser.ts","webpack:///./src/ui/toolbar.ts","webpack:///./src/rng/rng.ts","webpack:///./src/rng/generators.ts","webpack:///./src/ui/theme.ts","webpack:///./src/ui/layers.ts","webpack:///./src/canvas/input.ts","webpack:///./src/canvas/layers.ts","webpack:///./src/canvas/outputShader.ts","webpack:///./src/canvas/brushTextureGenerator.ts","webpack:///./src/canvas/textureShader.ts","webpack:///./src/canvas/clearBlocksShader.ts","webpack:///./src/canvas/brushShader.ts","webpack:///./src/canvas/blockRender.ts","webpack:///./src/canvas/texture.ts","webpack:///./src/canvas/render.ts","webpack:///./src/canvas/context.ts","webpack:///./src/canvas/index.ts","webpack:///./src/ui/miniMap.ts","webpack:///./src/ui/index.ts","webpack:///./node_modules/ivi/dist/module/events/native_events.js","webpack:///./node_modules/ivi/dist/module/core/box.js","webpack:///./node_modules/ivi/dist/module/core/noop.js","webpack:///./node_modules/ivi/dist/module/vdom/utils.js","webpack:///./node_modules/ivi/dist/module/vdom/ref.js","webpack:///./node_modules/ivi/dist/module/core/equal.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","__webpack_exports__","elementFactory","htmlElementFactory","svgElementFactory","component","statelessComponent","_operations__WEBPACK_IMPORTED_MODULE_0__","tag","flags","v","e","type","props","Store","Decode","Maybe","Vec2","[object Object]","x","y","this","other","eq","zeroes","lerp","pct","begin","end","distance","Math","sqrt","args","effectsHandler","initialState","initialEphemeral","forceRender","update","state","ephemeral","send","msg","nextState","nextEphemeral","effect","getState","ok","isOk","err","bool","val","int","Number","isInteger","number","string","nullable","decoder","nullable_","maybe","undefined","maybe_","array","decode","Array","isArray","arr","length","res","push","array_","decoders","resObj","propName","prop","object_","dictionary","val_","keys","dictionary_","tuple2","decoder1","decoder2","first","second","tuple2_","tuple3","decoder3","third","tuple3_","oneOf","oneOf_","map","transform","map_","filter","predicate","filter_","extend","baseRes","extend_","lazy","lazyDecoder","createJsonDecoder","json","JSON","parse","ex","decodeJson","decodeValue","of","withDefault","def","withDefaultf","f","map2","val1","val2","map3","val3","andThen","ResultBase","error","Ok","super","Err","Vec3","z","Vec4","w","initialValue","SignalWithPush","signal","SignalTransform","defaultValue","SignalFilter","fromRgba","rgb","alpha","g","b","handlers","currentValue","SignalWrapper","handler","dispose","idx","splice","removeHandler","baseSignal","subscribe","baseValue","FrameStream","make","fn","shouldStop","window","requestId","requestAnimationFrame","callback","performance","now","cancelAnimationFrame","PerfTracker","maxSamples","onSamples","samples","nextIdx","startTimeMs","endMs","startMs","SetOnce","orDefault","clamp","delay","arrUpdate","arrInsert","arrRemove","ColorMode","colorModeToString","turn","signals_namespaceObject","__value","x0","y0","x1","y1","start","min","max","ms","Promise","setTimeout","index","newArr","slice","Hsv","Hsluv","turns","center","point","radians","PI","cos","sin","process","VALUE","CONTENT","button","canvas","div","li","span","ul","textarea","input","ivi__WEBPACK_IMPORTED_MODULE_0__","ivi__WEBPACK_IMPORTED_MODULE_1__","ivi__WEBPACK_IMPORTED_MODULE_2__","ivi__WEBPACK_IMPORTED_MODULE_3__","VALUE_EMPTY","u","updateValue","renderToStringValue","renderToStringContent","element","prev","next","env","IVI_TARGET","PrimaryButton","onClick","title","content","operations","native_events","dist_module","buttons","DefaultButton","noOp","SinkableButton","className","isDown","onDownClick","children","ColorDisplay","factories","colorDisplay","style","background-color","colorSecondary","toStyle","color","equal","PointerState","MARGIN","colorWheel_noOp","ColorWheel","containerRef","box","canvasRef","glState","pointerState","Default","dist","colorMode","util","colorHandler","signalOuter","ev","bounds","utils","getBoundingClientRect","clientX","left","width","clientY","top","height","hue","atan2","hsv","toRgb","with","h","scheduler","signalInner","marginX","marginY","pctX","pctY","initializeCanvas","hooks","canvas ref not fonud","colorWheel_GlState","renderCanvas","render","a","is","listenToMouse","onUp","_ev","onMove","DownOnInner","DownOnOuter","document","body","addEventListener","passive","removeEventListener","onDown","isInclusive","colorType","onChange","canvasNode","thumbData","getThumbPositions","ref","colorWheel","shortcuts","circleThumbX","circleThumbY","border-color","angle","areaThumbX","areaThumbY","gl","getContext","blendFunc","WebGLRenderingContext","ONE","ONE_MINUS_SRC_ALPHA","enable","BLEND","disable","DEPTH_TEST","ringRenderer","colorWheel_RingRenderer","satValRenderer","colorWheel_SatValRenderer","clearColor","clear","COLOR_BUFFER_BIT","canvasRect","xPct","yPct","radius","cx","cy","theta","offset","RING_VERT_SRC","makeRingFragSrc","DEFINE_toRgb","webgl","RING_FRAG_SRC_HSV","RING_FRAG_SRC_HSLUV","program","colorLocation","prevColorType","buffer","createBuffer","bindBuffer","ARRAY_BUFFER","bufferData","Float32Array","STATIC_DRAW","deleteProgram","bindAttribLocation","getUniformLocation","useProgram","vertexAttribPointer","FLOAT","enableVertexAttribArray","uniform3f","drawArrays","TRIANGLE_STRIP","deleteBuffer","WI","SATVAL_VERT_SRC","toFixed","makeSatValFragSrc","SATVAL_FRAG_SRC_HSV","SATVAL_FRAG_SRC_HSLUV","prevColorMode","unexpected color mode","TRIANGLES","attr24px","viewBox","xmlns","namespaces","attr48px","brush24px","ivi_svg_dist_module","icons_default","icon","brush48px","edit24px","edit48px","search24px","search48px","InlineLabeled","label","inlineLabeled","Labeled","labeled","menu_noOp","Menu","isExpanded","selectHandler","onGlobalClick","containerNode","target","parentElement","closeMenu","openMenu","closeAndCallback","onSelect","menu","show","choices","focus","margin-top","getLeft","getRight","Row","spacing","spacedChildren","row","margin-left","slider_noOp","Slider","preventDefault","Rem","localX","dotWidth","percentage","slider","surfaceLook","surface","Surface","Switch","onCheck","checked","views_switch","views_icons_namespaceObject","createProgram","vSrc","fSrc","vShader","compileShader","VERTEX_SHADER","fShader","FRAGMENT_SHADER","attachShader","linkedProgram","linkProgram","getProgramParameter","LINK_STATUS","deleteShader","src","shaderType","shader","createShader","shaderSource","getShaderParameter","COMPILE_STATUS","lines","split","lineNumberLength","toString","line","text","fillChar","padCount","pad","join","padStart","withNumberedLines","UniformType","AttribType","Blend","updateUniforms","AttributesInfo","Uniform","location","uniforms","result","notFound","textureLoc","uniform","I1","arg","uniform1i","F1","uniform1f","F2","uniform2f","F3","F4","uniform4f","unexpected type","AttribInternal","attrib","size","Float","glType","bytes","Unexpected type on attribute","attributes","attributes_","totalSize","stride","sizeOffset","Mode","factorsNormal","sfact","dfact","factorsErase","ZERO","getFactors","Normal","Erase","Rgb","css","replace","startsWith","vals","parseFloat","validateRgb","parseRgbCss","substr","parseHexCss","floatToByte","RgbLinear","toLinear","mix","White","Black","fromLinear","pow","isNaN","isFinite","parseHex","parseHexPair","hex","toLowerCase","NaN","from","to","__cachedRgb","hsvToRgb","q","Luv","hsluvToRgb","Hpluv","hpluvToRgb","Lch","Xyz","mInv","refY","refU","refV","kappa","epsilon","lengthOfRayUntilIntersect","vec","getBounds","sub1","sub2","m1","m2","m3","top1","top2","bottom","maxSafeChromaForL","MAX_VALUE","vec1","vec2","maxChromaForLH","hrad","luvToLch","lchToLuv","mat3map","mat","rgbToXyz","lrgb","xyz","xyzToRgb","fromLinear$1","lchToHsluv","mx","hsluvToLch","lchToHpluv","hpluvToLch","rgbToLch","xyzToLuv","lchToRgb","lch","luvToXyz","hsluv","hpluv","initU","initV","rgbToHsv","maxValue","minValue","luvToRgb","luv","rgbToHsluv","rgbToHpluv","toGray","gray","doc","objectHasOwnProperty","nodeInsertBefore","nodeRemoveChild","nodeCloneNode","elementSetAttribute","elementSetAttributeNS","elementRemoveAttribute","nodeSetTextContent","elementSetClassName","htmlElementGetStyle","svgElementGetStyle","getDescriptor","getOwnPropertyDescriptor","nodeProto","Node","elementProto","Element","insertBefore","removeChild","replaceChild","cloneNode","setAttribute","setAttributeNS","removeAttribute","set","HTMLElement","SVGElement","_","resetContext","pushContext","setContext","ERROR_HANDLERS","unorderedArrayDeleteByIndex","last","pop","runRepeatableTasks","tasks","run","token","withSchedulerTick","clock","scheduleMicrotask","scheduleMutationEffect","scheduleLayoutEffect","invalidate","_flags","_frameStartTime","_clock","_resolvedPromise","resolve","_microtasks","_mutationEffects","_layoutEffects","_beforeMutations","_afterMutations","inner","apply","arguments","forEach","runMicrotasks","noop","task","then","_handleNextFrame","time","vdom_root","withNextFrame","_handleNextFrameSync","requestNextFrame","requestDirtyCheck","container","root","createOpType","createValueOp","createContainerOp","createDOMElementOp","Events","EVENTS","path","svg","ivi__WEBPACK_IMPORTED_MODULE_4__","TASK_TOKEN","SELECT_TOKEN","UNMOUNT_TOKEN","EMPTY_OBJECT","emitAttribute","emitChildren","_attributes","_children","attr","layersWrapper","layersListWrapper","layersControlsWrapper","unselectedLayerWrapper","selectedLayerWrapper","layerLeft","layerRight","layerName","layerOpacity","_resetState","visitNodes","getDOMNode","_dirtyCheck","_update","_core__WEBPACK_IMPORTED_MODULE_0__","_dom_shortcuts__WEBPACK_IMPORTED_MODULE_1__","_dom_namespaces__WEBPACK_IMPORTED_MODULE_2__","_state__WEBPACK_IMPORTED_MODULE_3__","_context__WEBPACK_IMPORTED_MODULE_4__","_nextNode","_deepStateFlags","opState","visitor","moveNode","singleChild","_moveNodes","_unmount","_unmountRemove","_unmountWalk","_createElement","node","op","tagName","createElementNS","createElement","_updateClassName","_updateAttrs","_mount","childrenOps","newChildren","_mountFragment","opType","prevState","_mountObject","createTextNode","_mountText","nextOp","nodeValue","opStateChildren","prevData","nextData","nextValue","deepState","j","aEnd","bEnd","outer","k","pos","updated","aLength","bLength","sources","keyIndex","Map","seq","lis","_updateChildrenTrackByKeys","_updateAttr","matchCount","bValue","setProperty","removeProperty","_updateStyle","escapeText","indexOf","escape","charCodeAt","escapeAttributeValue","selectedDisplay","selectedDisplayExpanded","selectableOptions","optionDefault","optionSelected","cachedSetTimeout","cachedClearTimeout","defaultSetTimout","Error","defaultClearTimeout","runTimeout","fun","clearTimeout","currentQueue","queue","draining","queueIndex","cleanUpNextTick","concat","drainQueue","timeout","len","marker","runClearTimeout","Item","nextTick","browser","argv","version","versions","on","addListener","once","off","removeListener","removeAllListeners","emit","prependListener","prependOnceListener","listeners","binding","cwd","chdir","dir","umask","xswitch","switchButtonContainer","switchButton","bgColorPrimary","bgColorSecondary","switchBar","ROOTS","findRoot","dirtyCheck","_reconciler__WEBPACK_IMPORTED_MODULE_0__","find","useSelect","useUnmount","useEffect","useMutationEffect","useLayoutEffect","_scheduler__WEBPACK_IMPORTED_MODULE_1__","selector","areEqual","nextProps","lastChecked","prevSelector","hook","addHook","withEffect","scheduleTask","reset","wrapper","bottomLeft","bottomRight","appContainer","layersViewContainer","textContainer","baseLine","filledLineClass","emptyButton","contentContainer","monospaced","codeInput","primary","ddefault","sinkableUnsunk","sinkableSunk","EVENT_CAPTURE_ACTIVE_OPTIONS","_dom_feature_detection__WEBPACK_IMPORTED_MODULE_0__","capture","PASSIVE_EVENTS","createStateNode","SVG_NAMESPACE","XLINK_NAMESPACE","XML_NAMESPACE","secondary","cicleThumb","areaThumb","column","textInput","detailsContainer","toolBarContainer","leftBar","IGNORE_RENDER_TO_STRING","dispatchEvent","_vdom_root__WEBPACK_IMPORTED_MODULE_0__","collectDispatchTargets","match","targets","contains","visitUp","stateNode","parentNode","visitDown","collectDispatchTargetsFromEventsOpState","source","event","currentTarget","descriptor","ivi__WEBPACK_IMPORTED_MODULE_5__","ivi__WEBPACK_IMPORTED_MODULE_6__","ivi__WEBPACK_IMPORTED_MODULE_7__","ivi__WEBPACK_IMPORTED_MODULE_8__","ivi_html__WEBPACK_IMPORTED_MODULE_9__","_debugging_scss__WEBPACK_IMPORTED_MODULE_10__","_debugging_scss__WEBPACK_IMPORTED_MODULE_10___default","_views__WEBPACK_IMPORTED_MODULE_11__","Performance","SamplesOverTime","empty","samplesSignal","nextSamples","samplecount","MIN_VALUE","sum","sample","sample0","sample1","sample2","sample3","Scripting","textareaRef","code","onInput","onKeyboard","textareaNode","shiftKey","altKey","listenToKeyboard","DebugWindow","isOpen","open","close","rng","display","perfSamplesSignal","init","prevPoint","interpolate","brush","position","rotation","scaledDiameter","diameterPx","pressure","pcts","spacingPx","endX","endY","endPressure","endSpacing","totalDist","prevX","prevY","prevPressure","interpolateWithPressureScaling","spacingPct","pressureIsEq","alphaIsEq","colorIsEq","rotationIsEq","pctsLen","brushPoints","lastBrushPoint","easing","duration","inputLerp","brushDelay_init","currentTime","startTime","updateWithInput","config","deltaTime","output","Stack","MsgType","eraser_MsgType","camera_MsgType","Empty","NonEmpty","initial","head","tail","stack","isNonEmpty","nonReversed","reversed","cons","str","fromArray","zipperList_ZipperList","__left","__right","unsafeFromArray","right","reverse","toArray","attempt","hasLeft","focusLeft","hasRight","focusRight","SetDiameterMsg","SetSoftnessMsg","softnessPct","SetOpacityMsg","opacityPct","SetColorMsg","SetColorModeMsg","SetSpacingMsg","SetPressureAffectsOpacityMsg","pressureAffectsOpacity","SetPressureAffectsSizeMsg","pressureAffectsSize","SwapColorMsg","SetDelayMsg","delayMs","brush_MsgSender","sendMessage","setColor","setColorMode","setDelay","setDiameter","px","setOpacity","opacity","setSoftness","softness","setSpacing","setPressureAffectsOpacity","setPressureAffectsSize","swapColorFrom","brush_update","assign","flowPct","focusf","unexpected msg","camera","brushInput","pointerToBrushInput","interpState","createInputPoint","delayState","createBrushPoint","_camera","color_dist","eraser_SetDiameterMsg","eraser_SetSoftnessMsg","eraser_SetOpacityMsg","eraser_SetSpacingMsg","eraser_SetPressureAffectsOpacityMsg","eraser_SetPressureAffectsSizeMsg","eraser_SetDelayMsg","eraser_MsgSender","eraser_pointerToBrushInput","eraser_update","unexpected message","eraser_onClick","eraser_createInputPoint","eraser_createBrushPoint","SetZoomMsg","zoomPct","SetOffsetMsg","offsetX","offsetY","SetRotationMsg","rotationTurns","camera_MsgSender","setRotation","setOffset","setZoom","camera_State","rotateTurns","dragState","addedPct","clickPoint","originalScale","xd","yd","ToolMsgType","ToolType","EphemeralStateType","SetToolMsg","subType","BrushMsg","EraserMsg","CameraMsg","tools_MsgSender","setTool","eraser","BrushState","Brush","EraserState","Eraser","MoveState","Move","ZoomState","Zoom","RotateState","Rotate","brushToolInit","tools_update","tool","current","unexpected tool type: ","syncEphemeral","Unknown tool type: ","tools_onDrag","ephemeral_","pointers","tempState","inputs","brushDelayInput","updateResult","interpReslt","onDrag","eraser_onDrag","pointer","moveUpdate","zoomUpdate","rotateUpdate","unxpected state","tools_onFrame","newBrushInput","onFrame","eraser_onFrame","getBlendMode","getSoftness","Details","sender","messageSender","onColorText","fromCss","views","ui_brush","margin","ColorSliders","HsluvSliders","HsvSliders","unexpected color type","eraser_Details","Toolbar","currentToolType","msgSender","toolbar","z-index","transientState","isDetailsExpanded","Seed","asInt","step","state2","nextFloat","state3","state4","XorshiftSeed","seed","force","Generators","always","nextSeed","int_","float","float_","t2","genA","genB","rng0","valA","rng1","valB","rng2","t2_","t3","genC","valC","rng3","t3_","gen","nextRng","gens","obj","map2_","map3_","map4","genD","valD","rng4","map4_","andThen_","createGen","cachedGen","styleMap","--color-primary","theme","--color-primaryLight","primaryLight","--color-primaryDark","primaryDark","--color-secondary","--color-secondaryLight","secondaryLight","--color-secondaryDark","secondaryDark","--color-onPrimary","onPrimary","--color-onSecondary","onSecondary","--color-onSurface","onSurface","--color-surface","--color-background","background","--shadows-button","shadows","--shadows-menu","--shadows-surface","--fonts-monospace","fonts","monospace","--fonts-normal","normal","hsluvGen","maxSat","luminance","colorsGen","shadowsGen","fontsGen","random","LayersView","layers","topLayers","layers_default","newLayer","id","removeLayer","isHidden","setHidden","layer","selectedId","LayerView","selectLayer","listen","PointerEvent","pointerDown","click","localizePointer","pointerUp","release","pointerMove","move","uncoalesceAndLocalize","drag","checkPressureSupport","listenForPointers","mouseDown","localizeMouse","mouseUp","mouseMove","listenForMouse","pointerSupportsPressure","pointerId","uncoalesce","getCoalescedEvents","originalEvent","shift","alt","ctrl","ctrlKey","events","isRelease","layers_LeafLayer","isLeaf","layers_GroupLayer","selectedPath","selected","getWithContext","child","findPath","leaf","newSelected","insert","withChildren","newSelectedPath","remove","newIndex","updateFn","nextOpacity","collectLeaves","layers_MsgType","NewLayerMsg","RemoveMsg","SelectMsg","layers_SetOpacityMsg","SetHiddenMsg","layers_MsgSender","layers_State","getNextLayerId","layerId","group","removeCurrent","select","updateCurrent","selectedIdx","above","below","newLayers","oldIndex","VERT_SRC","FRAG_SRC","Uniforms","u_resolution","u_texture","outputShader_Shader","locations","capacity","bindAttribLocations","bindFramebuffer","FRAMEBUFFER","blocks","DYNAMIC_DRAW","vertexAttrib","brushTextureGenerator_VERT_SRC","brushTextureGenerator_FRAG_SRC","brushTextureGenerator_AttributesInfo","brushTextureGenerator_Uniforms","u_softness","brushTextureGenerator_Generator","viewport","framebuffer","textureShader_VERT_SRC","textureShader_FRAG_SRC","textureShader_AttributesInfo","textureShader_Uniforms","u_opacity","textureShader_Shader","clearBlocksShader_VERT_SRC","clearBlocksShader_FRAG_SRC","clearBlocksShader_AttributesInfo","clearBlocksShader_Uniforms","u_rgba","clearBlocksShader_Shader","INITIAL_VARRAY_SIZE","brushShader_VERT_SRC","brushShader_FRAG_SRC","brushShader_AttributesInfo","brushShader_Uniforms","initAffectedArea","brushShader_Shader","arrayLength","affectedArea","canFlush","points","nextOffset","doubleSize","ptsLen","addPoint","arrayView","subarray","blendMode","drawCount","getDrawCount","addCorner","tx","ty","PX_PER_BLOCK_X","PX_PER_BLOCK_Y","Block","BlockTracker","_frameBlocks","_strokeBlocks","frameBlocks","xMin","yMin","xMax","yMax","xBlockMin","xBlockMax","yBlockMax","block","exists","strokeBlocks","nextTextureId","Texture","texture","createTextureWithFramebuffer","allTextures","textureBindings","createTexture","createFramebuffer","ensureTextureIsBound","texImage2D","TEXTURE_2D","RGBA","texParameteri","TEXTURE_MAG_FILTER","LINEAR","TEXTURE_MIN_FILTER","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","framebufferTexture2D","COLOR_ATTACHMENT0","frameBufferStatus","checkFramebufferStatus","FRAMEBUFFER_COMPLETE","FRAMEBUFFER_INCOMPLETE_ATTACHMENT","FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT","FRAMEBUFFER_INCOMPLETE_DIMENSIONS","FRAMEBUFFER_UNSUPPORTED","activeTexture","TEXTURE0","bindTexture","minTime","minTimeIdx","layersAreDifferent","render_ensureTextureIsBound","context_InternalContext","brushTextureGenerator","textureRenderer","clearBlocksRenderer","outputRenderer","drawpointBatch","fill","layerTextureMap","internalCanvasSize","resolution","stroke","renderBlocks","prevLayers","brushTexture","generateBrushTexture","outputTexture","outFramebuffer","combinedLayers","addPoints","context","getStrokeBlocks","strokeEnded","endStroke","nextLayers","getFrameBlocks","currentLayerTex","flush","layersToCombine","nextAbove","nextBelow","getLayersToCombine","layersToRender","textureShader","layersAbove","layersBelow","layersCurrent","textureAbove","textureBelow","textureCurrent","combineLayers","bgColor","afterFrame","deleteTexture","deleteFramebuffer","CanvasMsgType","EffectType","OnFrame","OnClick","OnRelease","OnDrag","RandomizeTheme","ToolMsg","LayersMsg","NoOpEffect","FrameEffect","BrushPointsEffect","ReleaseEffect","canvas_MsgSender","timeMs","onRelease","randomizeTheme","canvas_pointerToBrushInput","canvasInfo","subtract","subtractScalars","halfResoution","multiplyScalar","add","originalX","originalY","canvas_update","nextToolEphemeral","nextTool","brushPoint","tools_onClick","hasPressedDown","tools_onRelease","pointersToBrushInputs","canvas_Canvas","canvasElement","perfTracker","onStats","splitLayers","antialias","depth","premultipliedAlpha","stencil","preserveDrawingBuffer","desynchronized","attrs","getContextAttributes","getExtension","newState","eff","addBrushPoints","unexpected effect","MiniMapDetails","miniMap","getDocumentResolution","documentElement","clientWidth","clientHeight","getCanvasOffset","offsetLeft","offsetTop","getCanvasInfo","canvasOffset","canvasResolution","App","initState","removeInputListeners","cancelFrameStream","canvasModel","debuggingGl","perfTrackerData","documentResolution","store","ef","handle","ephState","onResize","vdom_hooks","prevTheme","updateTheme","nextTheme","updateAll","prevValue","updateDiff","setupCanvas","htmlCanvas","stats","onWebglContextCreated","getCanvasTransform","cam","ui","rootElement","getElementById","onBlur","onMouseDown","onPaste","_dom_shortcuts__WEBPACK_IMPORTED_MODULE_0__","_dispatch__WEBPACK_IMPORTED_MODULE_2__","_utils__WEBPACK_IMPORTED_MODULE_3__","dispatchNativeEvent","createNativeEventSource","options","ABORT_EVENT","ACTIVATE_EVENT","ARIA_REQUEST_EVENT","BEFORE_ACTIVATE_EVENT","BEFORE_COPY_EVENT","BEFORE_CUT_EVENT","BEFORE_DEACTIVATE_EVENT","BEFORE_PASTE_EVENT","BLUR_EVENT","CAN_PLAY_EVENT","CAN_PLAYTHROUGH_EVENT","CHANGE_EVENT","CLICK_EVENT","CONTEXT_MENU_EVENT","COPY_EVENT","CUE_CHANGE_EVENT","CUT_EVENT","DOUBLE_CLICK_EVENT","DEACTIVATE_EVENT","DRAG_EVENT","DRAG_END_EVENT","DRAG_ENTER_EVENT","DRAG_LEAVE_EVENT","DRAG_OVER_EVENT","DRAG_START_EVENT","DROP_EVENT","DURATION_CHANGE_EVENT","EMPTIED_EVENT","ENCRYPTED_EVENT","ENDED_EVENT","ERROR_EVENT","FOCUS_EVENT","GOT_POINTER_CAPTURE_EVENT","BEFORE_INPUT_EVENT","INPUT_EVENT","INVALID_EVENT","KEY_DOWN_EVENT","KEY_PRESS_EVENT","KEY_UP_EVENT","LOAD_EVENT","LOADED_DATA_EVENT","LOADED_METADATA_EVENT","LOAD_START_EVENT","LOST_POINTER_CAPTURE_EVENT","MOUSE_DOWN_EVENT","MOUSE_MOVE_EVENT","MOUSE_OUT_EVENT","MOUSE_OVER_EVENT","MOUSE_UP_EVENT","PASTE_EVENT","PAUSE_EVENT","PLAY_EVENT","PLAYING_EVENT","POINTER_CANCEL_EVENT","POINTER_DOWN_EVENT","POINTER_MOVE_EVENT","POINTER_OUT_EVENT","POINTER_OVER_EVENT","POINTER_UP_EVENT","PROGRESS_EVENT","RATE_CHANGE_EVENT","RESET_EVENT","SCROLL_EVENT","SEEKED_EVENT","SEEKING_EVENT","SELECT_EVENT","SELECT_START_EVENT","STALLED_EVENT","SUBMIT_EVENT","SUSPEND_EVENT","TIME_UPDATE_EVENT","TOUCH_CANCEL_EVENT","TOUCH_END_EVENT","TOUCH_MOVE_EVENT","TOUCH_START_EVENT","TRANSITION_CANCEL_EVENT","TRANSITION_END_EVENT","TRANSITION_RUN_EVENT","TRANSITION_START_EVENT","UNLOAD_EVENT","VOLUME_CHANGE_EVENT","WAITING_EVENT","WHEEL_EVENT","ACTIVE_TOUCH_END_EVENT","ACTIVE_TOUCH_MOVE_EVENT","ACTIVE_TOUCH_START_EVENT","ACTIVE_WHEEL_EVENT","nativeEventHandlerFactory","bubbleDescriptor","captureDescriptor","NOOP","findDOMNode","_reconciler__WEBPACK_IMPORTED_MODULE_1__","Ref","_factories__WEBPACK_IMPORTED_MODULE_1__","_hooks__WEBPACK_IMPORTED_MODULE_2__","_Ref","_ref","updateRef","shallowEqual","aKeys","bKeys"],"mappings":"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","file":"main-8767ece46c479374e2a5.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 46);\n","import { checkElement } from \"../debug/element\";\nimport { createOpType, createDOMElementOp, createValueOp } from \"./operations\";\n/**\n * elementFactory creates a factory for DOM elements.\n *\n * @param tag HTML element tag name.\n * @param flags Node flags.\n * @returns HTML element operation factory.\n */\nexport function elementFactory(tag, flags) {\n    const t = createOpType(flags, tag);\n    return process.env.NODE_ENV !== \"production\" ?\n        (n, v, c = null) => {\n            checkElement(tag, v, (flags & 512 /* Svg */) !== 0);\n            return createDOMElementOp(t, v, c, n);\n        } :\n        /* istanbul ignore next */ (n, v, c = null) => createDOMElementOp(t, v, c, n);\n}\n/**\n * htmlElementFactory creates a factory for HTML elements.\n *\n * @param tag HTML element tag name.\n * @returns HTML element operation factory.\n */\nexport const htmlElementFactory = (tag) => elementFactory(tag, 2 /* Element */);\n/**\n * svgElementFactory creates a factory for SVG elements.\n *\n * @param tag SVG element tag name.\n * @returns SVG element operation factory.\n */\nexport const svgElementFactory = (tag) => elementFactory(tag, 2 /* Element */ | 512 /* Svg */);\n/**\n * `elementProto()` creates a factory that produces elements with predefined attributes.\n *\n * @example\n *\n *     const DivWithIdAttribute = elementProto(div(_, { id: \"predefined-id\" }));\n *\n *     render(\n *       DivWithIdAttribute(\"class-name\", { title: \"Title\" }, \"Hello World\"),\n *       document.getElementById(\"app\")!,\n *     );\n *\n * @param p Element prototype.\n * @returns Factory that produces elements with predefined attributes.\n */\nexport function elementProto(p) {\n    /* istanbul ignore else */\n    if (process.env.NODE_ENV !== \"production\") {\n        if (p.c !== null) {\n            throw new Error(`Invalid OpNode, element prototypes can't have any children`);\n        }\n        checkElement(p.t.d, p.v, (p.t.f & 512 /* Svg */) !== 0);\n    }\n    const t = createOpType(p.t.f | 64 /* ElementProto */, { n: null, p });\n    return (n, v, c = null) => createDOMElementOp(t, v, c, n);\n}\n/**\n * component creates a factory that produces component nodes.\n *\n * @example\n *\n *     const A = component<string>(() => {\n *       let _text;\n *       const click = onClick(() => { console.log(_text); });\n *\n *       return (text) => (\n *         _text = text,\n *         Events(click,\n *           button(_, _, \"Click Me\"),\n *         )\n *       );\n *     });\n *\n * @param c Component function.\n * @param e `areEqual` function.\n * @returns Factory that produces component nodes.\n */\nexport function component(c, e) {\n    const type = createOpType(4 /* Component */ | 256 /* Stateful */ | 16384 /* DirtyCheck */, { c, e });\n    return (props) => createValueOp(type, props);\n}\n/**\n * statelessComponent creates an factory that produces stateless components nodes.\n *\n * @example\n *\n *     const A = statelessComponent<string>((text) => div(_, _, text));\n *\n * @param c Update function.\n * @param e `areEqual` function.\n * @returns Factory that produces stateless component nodes.\n */\nexport function statelessComponent(c, e) {\n    const type = createOpType(4 /* Component */, { c, e });\n    return (props) => createValueOp(type, props);\n}\n//# sourceMappingURL=factories.js.map","export interface Store<state, ephemeral, msg> {\r\n    send(msg: msg): void\r\n    getState(): state\r\n}\r\n\r\nexport namespace Store {\r\n    export interface Args<state, ephemeral, msg, effects> {\r\n        readonly initialState: state\r\n        readonly initialEphemeral: ephemeral\r\n        readonly update: (\r\n            state: state,\r\n            ephemeral: ephemeral,\r\n            msg: msg\r\n        ) => readonly [state, ephemeral, effects]\r\n        readonly effectsHandler: (eff: effects) => void\r\n        readonly forceRender: () => void\r\n    }\r\n\r\n    export function create<state, ephemeral, msg, effects>(\r\n        args: Args<state, ephemeral, msg, effects>\r\n    ): Store<state, ephemeral, msg> {\r\n        const { effectsHandler, initialState, initialEphemeral, forceRender, update } = args\r\n\r\n        let state = initialState\r\n        let ephemeral = initialEphemeral\r\n\r\n        function handleMsg(msg: msg): void {\r\n            const [nextState, nextEphemeral, effect] = update(state, ephemeral, msg)\r\n            if (state !== nextState) {\r\n                forceRender()\r\n                state = nextState\r\n            }\r\n            effectsHandler(effect)\r\n            ephemeral = nextEphemeral\r\n        }\r\n\r\n        return {\r\n            send: handleMsg,\r\n            getState: () => state,\r\n        }\r\n    }\r\n}\r\n","export namespace Decode {\r\n    export interface DecodeOk<a> {\r\n        readonly isOk: true\r\n        readonly value: a\r\n    }\r\n\r\n    export interface DecodeErr<a> {\r\n        readonly isOk: false\r\n        readonly value: null\r\n    }\r\n\r\n    export type DecodeResult<a> = DecodeOk<a> | DecodeErr<a>\r\n\r\n    export type DecoderBlock<a> = (val: unknown) => DecodeResult<a>\r\n\r\n    export function ok<a>(value: a): DecodeResult<a> {\r\n        return { isOk: true, value }\r\n    }\r\n\r\n    export function err<a extends never>(): DecodeResult<a> {\r\n        return { isOk: false, value: null }\r\n    }\r\n\r\n    export function bool(val: unknown): DecodeResult<boolean> {\r\n        return typeof val === \"boolean\" ? ok(val) : err()\r\n    }\r\n\r\n    export function int(val: unknown): DecodeResult<number> {\r\n        return typeof val === \"number\" && Number.isInteger(val) ? ok(val) : err()\r\n    }\r\n\r\n    export function number(val: unknown): DecodeResult<number> {\r\n        return typeof val === \"number\" ? ok(val) : err()\r\n    }\r\n\r\n    export function string(val: unknown): DecodeResult<string> {\r\n        return typeof val === \"string\" ? ok(val) : err()\r\n    }\r\n\r\n    export function nullable<a>(decoder: DecoderBlock<a>): DecoderBlock<a | null> {\r\n        return val => nullable_(decoder, val)\r\n    }\r\n\r\n    function nullable_<a>(decoder: DecoderBlock<a>, val: unknown): DecodeResult<a | null> {\r\n        return val === null ? ok(null) : decoder(val)\r\n    }\r\n\r\n    export function maybe<a>(decoder: DecoderBlock<a>): DecoderBlock<a | undefined> {\r\n        return val => maybe_(decoder, val)\r\n    }\r\n\r\n    function maybe_<a>(decoder: DecoderBlock<a>, val: unknown): DecodeResult<a | undefined> {\r\n        return val === undefined ? ok(undefined) : decoder(val)\r\n    }\r\n\r\n    export function array<a>(decode: DecoderBlock<a>): DecoderBlock<a[]> {\r\n        return val => array_(decode, val)\r\n    }\r\n\r\n    function array_<a>(decode: DecoderBlock<a>, val: unknown): DecodeResult<a[]> {\r\n        if (typeof val !== \"object\" || !Array.isArray(val)) return err()\r\n\r\n        const arr: a[] = []\r\n\r\n        for (let i = 0; i < val.length; i++) {\r\n            const res = decode(val[i])\r\n            if (!res.isOk) return err()\r\n            arr.push(res.value)\r\n        }\r\n\r\n        return ok(arr)\r\n    }\r\n\r\n    export type ObjectProps<a> = { readonly [propName in keyof a]: DecoderBlock<a[propName]> }\r\n\r\n    export function object<a>(decoders: ObjectProps<a>): DecoderBlock<a> {\r\n        return val => object_(decoders, val)\r\n    }\r\n\r\n    /* eslint-disable-next-line @typescript-eslint/no-explicit-any */\r\n    function object_<a>(decoders: ObjectProps<a>, val: any): DecodeResult<a> {\r\n        if (typeof val !== \"object\") return err()\r\n\r\n        /* eslint-disable-next-line @typescript-eslint/no-explicit-any */\r\n        const resObj: any = {}\r\n        for (const propName in decoders) {\r\n            if (!decoders.hasOwnProperty(propName)) continue\r\n\r\n            const prop = decoders[propName](val[propName])\r\n            if (!prop.isOk) return err()\r\n\r\n            resObj[propName] = prop.value\r\n        }\r\n\r\n        return ok(resObj)\r\n    }\r\n\r\n    export function dictionary<a>(decoder: DecoderBlock<a>): DecoderBlock<{ [key: string]: a }> {\r\n        return val => dictionary_(decoder, val)\r\n    }\r\n\r\n    function dictionary_<a>(\r\n        decoder: DecoderBlock<a>,\r\n        val_: unknown\r\n    ): DecodeResult<{ [key: string]: a }> {\r\n        if (typeof val_ !== \"object\") return err()\r\n\r\n        const val = val_ as { readonly [key: string]: unknown }\r\n\r\n        const keys = Object.keys(val as object)\r\n\r\n        const res: { [key: string]: a } = {}\r\n\r\n        for (let i = 0; i < keys.length; i++) {\r\n            const key = keys[i]\r\n            const value = decoder(val[key])\r\n            if (!value.isOk) return err()\r\n\r\n            res[key] = value.value\r\n        }\r\n\r\n        return ok(res)\r\n    }\r\n\r\n    export function tuple2<a, b>(\r\n        decoder1: DecoderBlock<a>,\r\n        decoder2: DecoderBlock<b>\r\n    ): DecoderBlock<[a, b]> {\r\n        return val => tuple2_(decoder1, decoder2, val)\r\n    }\r\n\r\n    function tuple2_<a, b>(\r\n        decoder1: DecoderBlock<a>,\r\n        decoder2: DecoderBlock<b>,\r\n        val: unknown\r\n    ): DecodeResult<[a, b]> {\r\n        if (typeof val !== \"object\" || !Array.isArray(val) || val.length < 2) return err()\r\n\r\n        const first = decoder1(val[0])\r\n        if (!first.isOk) return err()\r\n\r\n        const second = decoder2(val[1])\r\n        if (!second.isOk) return err()\r\n\r\n        const tup: [a, b] = [first.value, second.value]\r\n        return ok(tup)\r\n    }\r\n\r\n    function tuple3_<a, b, c>(\r\n        decoder1: DecoderBlock<a>,\r\n        decoder2: DecoderBlock<b>,\r\n        decoder3: DecoderBlock<c>,\r\n        val: unknown\r\n    ): DecodeResult<[a, b, c]> {\r\n        if (typeof val !== \"object\" || !Array.isArray(val) || val.length < 3) return err()\r\n\r\n        const first = decoder1(val[0])\r\n        if (!first.isOk) return err()\r\n\r\n        const second = decoder2(val[1])\r\n        if (!second.isOk) return err()\r\n\r\n        const third = decoder3(val[2])\r\n        if (!third.isOk) return err()\r\n\r\n        const tup: [a, b, c] = [first.value, second.value, third.value]\r\n        return ok(tup)\r\n    }\r\n\r\n    export function tuple3<a, b, c>(\r\n        decoder1: DecoderBlock<a>,\r\n        decoder2: DecoderBlock<b>,\r\n        decoder3: DecoderBlock<c>\r\n    ): DecoderBlock<[a, b, c]> {\r\n        return val => tuple3_(decoder1, decoder2, decoder3, val)\r\n    }\r\n\r\n    export function oneOf<a>(decoders: readonly DecoderBlock<a>[]): DecoderBlock<a> {\r\n        return val => oneOf_(decoders, val)\r\n    }\r\n\r\n    function oneOf_<a>(decoders: readonly DecoderBlock<a>[], val: unknown): DecodeResult<a> {\r\n        for (let i = 0; i < decoders.length; i++) {\r\n            const res = decoders[i](val)\r\n            if (res.isOk) return res\r\n        }\r\n        return err()\r\n    }\r\n\r\n    export function map<a, b>(decoder: DecoderBlock<a>, transform: (val: a) => b): DecoderBlock<b> {\r\n        return val => map_(decoder, transform, val)\r\n    }\r\n\r\n    function map_<a, b>(\r\n        decoder: DecoderBlock<a>,\r\n        transform: (val: a) => b,\r\n        val: unknown\r\n    ): DecodeResult<b> {\r\n        const res = decoder(val)\r\n        return res.isOk ? ok(transform(res.value)) : err()\r\n    }\r\n\r\n    export function filter<a>(\r\n        decoder: DecoderBlock<a>,\r\n        predicate: (val: a) => boolean\r\n    ): DecoderBlock<a> {\r\n        return val => filter_(decoder, predicate, val)\r\n    }\r\n\r\n    function filter_<a>(\r\n        decoder: DecoderBlock<a>,\r\n        predicate: (val: a) => boolean,\r\n        val: unknown\r\n    ): DecodeResult<a> {\r\n        const res = decoder(val)\r\n        if (!res.isOk) return res\r\n\r\n        if (predicate(res.value)) return res\r\n\r\n        return err()\r\n    }\r\n\r\n    export function extend<a, b>(\r\n        decoder: DecoderBlock<a>,\r\n        transform: (val: a) => DecodeResult<b>\r\n    ): DecoderBlock<b> {\r\n        return val => extend_(decoder, transform, val)\r\n    }\r\n\r\n    function extend_<a, b>(\r\n        decoder: DecoderBlock<a>,\r\n        transform: (val: a) => DecodeResult<b>,\r\n        val: unknown\r\n    ): DecodeResult<b> {\r\n        const baseRes = decoder(val)\r\n        return baseRes.isOk ? transform(baseRes.value) : err()\r\n    }\r\n\r\n    // Laziness is required for circularly defined data\r\n    export function lazy<a>(lazyDecoder: () => DecoderBlock<a>): DecoderBlock<a> {\r\n        return val => lazyDecoder()(val)\r\n    }\r\n\r\n    export function createJsonDecoder<a>(\r\n        decoder: DecoderBlock<a>\r\n    ): (json: string) => DecodeResult<a> {\r\n        return json => decodeJson(decoder, json)\r\n    }\r\n\r\n    function decodeJson<a>(decoder: DecoderBlock<a>, json: string): DecodeResult<a> {\r\n        try {\r\n            return decoder(JSON.parse(json))\r\n        } catch (ex) {\r\n            console.error(ex)\r\n            return err()\r\n        }\r\n    }\r\n\r\n    export function decodeValue<a>(decoder: DecoderBlock<a>, value: unknown): DecodeResult<a> {\r\n        return decoder(value)\r\n    }\r\n}\r\n","export type Maybe<a> = (readonly []) | (readonly [a])\r\n\r\nexport namespace Maybe {\r\n    export function of<a>(val: a | null | undefined): Maybe<a> {\r\n        if (val == null) return []\r\n        return [val]\r\n    }\r\n\r\n    export function withDefault<a>(val: Maybe<a>, def: a): a {\r\n        if (val.length === 0) return def\r\n        return val[0]\r\n    }\r\n\r\n    export function withDefaultf<a>(val: Maybe<a>, def: () => a): a {\r\n        if (val.length === 0) return def()\r\n        return val[0]\r\n    }\r\n\r\n    export function map<a, b>(val: Maybe<a>, f: (val: a) => b): Maybe<b> {\r\n        if (val.length === 0) return []\r\n        return [f(val[0])]\r\n    }\r\n\r\n    export function map2<a, b, c>(\r\n        val1: Maybe<a>,\r\n        val2: Maybe<b>,\r\n        f: (val1: a, val2: b) => c\r\n    ): Maybe<c> {\r\n        if (val1.length === 0 || val2.length === 0) return []\r\n        return [f(val1[0], val2[0])]\r\n    }\r\n\r\n    export function map3<a, b, c, d>(\r\n        val1: Maybe<a>,\r\n        val2: Maybe<b>,\r\n        val3: Maybe<c>,\r\n        f: (val1: a, val2: b, val3: c) => d\r\n    ): Maybe<d> {\r\n        if (val1.length === 0 || val2.length === 0 || val3.length === 0) return []\r\n        return [f(val1[0], val2[0], val3[0])]\r\n    }\r\n\r\n    export function andThen<a, b>(val: Maybe<a>, f: (val: a) => Maybe<b>): Maybe<b> {\r\n        if (val.length === 0) return []\r\n        return f(val[0])\r\n    }\r\n}\r\n","export class Vec2 {\r\n    static zeroes: Vec2 = new Vec2(0, 0)\r\n\r\n    constructor(readonly x: number, readonly y: number) {}\r\n\r\n    eq(other: Vec2): boolean {\r\n        return Vec2.eq(this, other)\r\n    }\r\n\r\n    add(other: Vec2): Vec2 {\r\n        return new Vec2(this.x + other.x, this.y + other.y)\r\n    }\r\n\r\n    addScalar(x: number): Vec2 {\r\n        return new Vec2(this.x + x, this.y + x)\r\n    }\r\n\r\n    addScalars(x: number, y: number): Vec2 {\r\n        return new Vec2(this.x + x, this.y + y)\r\n    }\r\n\r\n    subtract(other: Vec2): Vec2 {\r\n        return new Vec2(this.x - other.x, this.y - other.y)\r\n    }\r\n\r\n    subtractScalar(x: number): Vec2 {\r\n        return new Vec2(this.x - x, this.y - x)\r\n    }\r\n\r\n    subtractScalars(x: number, y: number): Vec2 {\r\n        return new Vec2(this.x - x, this.y - y)\r\n    }\r\n\r\n    multiply(other: Vec2): Vec2 {\r\n        return new Vec2(this.x * other.x, this.y * other.y)\r\n    }\r\n\r\n    multiplyScalar(x: number): Vec2 {\r\n        return new Vec2(this.x * x, this.y * x)\r\n    }\r\n\r\n    multiplyScalars(x: number, y: number): Vec2 {\r\n        return new Vec2(this.x * x, this.y * y)\r\n    }\r\n\r\n    divide(other: Vec2): Vec2 {\r\n        return new Vec2(this.x / other.x, this.y / other.y)\r\n    }\r\n\r\n    divideScalar(x: number): Vec2 {\r\n        return new Vec2(this.x / x, this.y / x)\r\n    }\r\n\r\n    toString(): string {\r\n        return \"Vec2(\" + this.x + \", \" + this.y + \")\"\r\n    }\r\n}\r\n\r\nexport namespace Vec2 {\r\n    export function eq(l: Vec2, r: Vec2): boolean {\r\n        return l.x === r.x && l.y === r.y\r\n    }\r\n\r\n    export function lerp(pct: number, begin: Vec2, end: Vec2): Vec2 {\r\n        return new Vec2(begin.x + (end.x - begin.x) * pct, begin.y + (end.y - begin.y) * pct)\r\n    }\r\n\r\n    export function distance(l: Vec2, r: Vec2): number {\r\n        const x = r.x - l.x\r\n        const y = r.y - l.y\r\n        return Math.sqrt(x * x + y * y)\r\n    }\r\n}\r\n","export type Result<a, error> = Ok<a, error> | Err<a, error>\r\n\r\nabstract class ResultBase<a, error> {\r\n    readonly value: a | null = null\r\n    readonly error: error | null = null\r\n\r\n    abstract isOk(): this is Ok<a, error>\r\n    abstract isErr(): this is Err<a, error>\r\n    abstract map<b>(f: (val: a) => b): Result<b, error>\r\n    abstract mapError<errorB>(f: (val: error) => errorB): Result<a, errorB>\r\n    abstract andThen<b>(f: (val: a) => Result<b, error>): Result<b, error>\r\n}\r\n\r\nexport class Ok<a, error> extends ResultBase<a, error> {\r\n    private nominal: void\r\n    readonly value: a\r\n    readonly error: null\r\n\r\n    constructor(value: a) {\r\n        super()\r\n        this.value = value\r\n    }\r\n\r\n    isOk(): this is Ok<a, error> {\r\n        return true\r\n    }\r\n\r\n    isErr(): this is Err<a, error> {\r\n        return false\r\n    }\r\n\r\n    map<b>(f: (val: a) => b): Ok<b, error> {\r\n        return new Ok(f(this.value))\r\n    }\r\n\r\n    mapError<errorB>(f: (val: error) => errorB): Ok<a, errorB> {\r\n        return new Ok(this.value)\r\n    }\r\n\r\n    andThen<b>(f: (val: a) => Result<b, error>): Result<b, error> {\r\n        return f(this.value)\r\n    }\r\n}\r\n\r\nexport class Err<a, error> extends ResultBase<a, error> {\r\n    private nominal: void\r\n    readonly value: null\r\n    readonly error: error\r\n\r\n    constructor(error: error) {\r\n        super()\r\n        this.error = error\r\n    }\r\n\r\n    isOk(): this is Ok<a, error> {\r\n        return false\r\n    }\r\n\r\n    isErr(): this is Err<a, error> {\r\n        return true\r\n    }\r\n\r\n    map<b>(f: (val: a) => b): Err<b, error> {\r\n        return new Err(this.error)\r\n    }\r\n\r\n    mapError<errorB>(f: (val: error) => errorB): Err<a, errorB> {\r\n        return new Err(f(this.error))\r\n    }\r\n\r\n    andThen<b>(f: (val: a) => Result<b, error>): Err<b, error> {\r\n        return new Err(this.error)\r\n    }\r\n}\r\n","export class Vec3 {\r\n    constructor(readonly x: number, readonly y: number, readonly z: number) {}\r\n\r\n    eq(other: Vec3): boolean {\r\n        return Vec3.eq(this, other)\r\n    }\r\n}\r\n\r\nexport namespace Vec3 {\r\n    export function eq(l: Vec3, r: Vec3): boolean {\r\n        return l.x === r.x && l.y === r.y && l.y === r.y\r\n    }\r\n\r\n    export function lerp(pct: number, begin: Vec3, end: Vec3): Vec3 {\r\n        return new Vec3(\r\n            begin.x + (end.x - begin.x) * pct,\r\n            begin.y + (end.y - begin.y) * pct,\r\n            begin.z + (end.z - begin.z) * pct\r\n        )\r\n    }\r\n}\r\n","import { RgbLinear } from \"color\"\r\n\r\nexport class Vec4 {\r\n    constructor(readonly x: number, readonly y: number, readonly z: number, readonly w: number) {}\r\n\r\n    eq(other: Vec4): boolean {\r\n        return Vec4.eq(this, other)\r\n    }\r\n}\r\n\r\nexport namespace Vec4 {\r\n    export function fromRgba(rgb: RgbLinear, alpha: number): Vec4 {\r\n        return new Vec4(rgb.r * alpha, rgb.g * alpha, rgb.b * alpha, alpha)\r\n    }\r\n\r\n    export function eq(l: Vec4, r: Vec4): boolean {\r\n        return l.x === r.x && l.y === r.y && l.z === r.z && l.w === r.w\r\n    }\r\n}\r\n","export interface CancelSubscribtion {\r\n    dispose(): void\r\n}\r\n\r\nexport interface ChangeHandler<a> {\r\n    (value: a): void\r\n}\r\n\r\nexport interface Signal<a> {\r\n    value(): a\r\n    subscribe(handler: ChangeHandler<a>): CancelSubscribtion\r\n}\r\n\r\nexport interface PushableSignal<a> extends Signal<a> {\r\n    readonly signal: Signal<a>\r\n\r\n    push(value: a): void\r\n}\r\n\r\nexport function create<a>(initialValue: a): PushableSignal<a> {\r\n    return new SignalWithPush(initialValue)\r\n}\r\n\r\nexport function map<a, b>(signal: Signal<a>, transform: (value: a) => b): Signal<b> {\r\n    return new SignalTransform(signal, transform)\r\n}\r\n\r\nexport function filter<a>(\r\n    signal: Signal<a>,\r\n    defaultValue: a,\r\n    filter: (value: a) => boolean\r\n): Signal<a> {\r\n    return new SignalFilter(signal, defaultValue, filter)\r\n}\r\n\r\nclass SignalWithPush<a> implements PushableSignal<a> {\r\n    private handlers: ChangeHandler<a>[] = []\r\n    private currentValue: a\r\n\r\n    /**\r\n     * Immutable wrapper for the pushable signal.\r\n     */\r\n    readonly signal: Signal<a>\r\n\r\n    constructor(initialValue: a) {\r\n        this.currentValue = initialValue\r\n        this.signal = new SignalWrapper(this)\r\n    }\r\n\r\n    push(value: a): void {\r\n        this.currentValue = value\r\n\r\n        const handlers = this.handlers\r\n        for (let i = 0; i < handlers.length; i++) {\r\n            handlers[i](value)\r\n        }\r\n    }\r\n\r\n    value(): a {\r\n        return this.currentValue\r\n    }\r\n\r\n    subscribe(handler: ChangeHandler<a>): CancelSubscribtion {\r\n        this.handlers.push(handler)\r\n        return {\r\n            dispose: () => {\r\n                removeHandler(this.handlers, handler)\r\n            },\r\n        }\r\n    }\r\n}\r\n\r\nfunction removeHandler<a>(handlers: ChangeHandler<a>[], handler: ChangeHandler<a>): void {\r\n    let idx = -1\r\n    for (let i = 0; i < handlers.length; i++) {\r\n        if (handlers[i] === handler) {\r\n            idx = i\r\n            break\r\n        }\r\n    }\r\n    if (idx !== -1) {\r\n        handlers.splice(idx, 1)\r\n    }\r\n}\r\n\r\nclass SignalWrapper<a> implements Signal<a> {\r\n    constructor(readonly baseSignal: Signal<a>) {}\r\n\r\n    value(): a {\r\n        return this.baseSignal.value()\r\n    }\r\n\r\n    subscribe(handler: ChangeHandler<a>) {\r\n        return this.baseSignal.subscribe(handler)\r\n    }\r\n}\r\n\r\nclass SignalTransform<a, b> implements Signal<b> {\r\n    constructor(readonly baseSignal: Signal<a>, readonly transform: (val: a) => b) {}\r\n\r\n    value(): b {\r\n        return this.transform(this.baseSignal.value())\r\n    }\r\n\r\n    subscribe(handler: ChangeHandler<b>) {\r\n        const transformedHandler = (val: a) => {\r\n            handler(this.transform(val))\r\n        }\r\n\r\n        return this.baseSignal.subscribe(transformedHandler)\r\n    }\r\n}\r\n\r\nclass SignalFilter<a> implements Signal<a> {\r\n    readonly baseSignal: Signal<a>\r\n    private currentValue: a\r\n    readonly filter: (val: a) => boolean\r\n    constructor(baseSignal: Signal<a>, defaultValue: a, filter: (val: a) => boolean) {\r\n        this.baseSignal = baseSignal\r\n        this.filter = filter\r\n        const baseValue = baseSignal.value()\r\n        this.currentValue = filter(baseValue) ? baseValue : defaultValue\r\n    }\r\n\r\n    value(): a {\r\n        return this.currentValue\r\n    }\r\n\r\n    subscribe(handler: ChangeHandler<a>) {\r\n        const filter = this.filter\r\n\r\n        const filteredHandler = (val: a) => {\r\n            if (filter(val)) {\r\n                this.currentValue = val\r\n                handler(val)\r\n            }\r\n        }\r\n\r\n        return this.baseSignal.subscribe(filteredHandler)\r\n    }\r\n}\r\n","export interface FrameStream {\r\n    (fn: (time: number) => void): CancelFrameStream\r\n}\r\n\r\nexport interface CancelFrameStream {\r\n    (): void\r\n}\r\n\r\nexport const FrameStream = {\r\n    make: (fn: (time: number) => void): CancelFrameStream => {\r\n        let shouldStop = false\r\n            /* eslint-disable-next-line @typescript-eslint/no-explicit-any */\r\n        ;(window as any)[\"painterStop\"] = () => (shouldStop = true)\r\n\r\n        let requestId = requestAnimationFrame(function callback() {\r\n            if (shouldStop) return\r\n            try {\r\n                fn(performance.now())\r\n            } catch (e) {\r\n                console.error(e)\r\n            }\r\n            requestId = requestAnimationFrame(callback)\r\n        })\r\n        return () => cancelAnimationFrame(requestId)\r\n    },\r\n}\r\n","export namespace PerfTracker {\r\n    export interface Sample {\r\n        readonly startMs: number\r\n        readonly endMs: number\r\n    }\r\n}\r\n\r\nexport class PerfTracker {\r\n    private readonly maxSamples: number\r\n    private readonly onSamples: (stats: readonly PerfTracker.Sample[]) => void\r\n    private samples: PerfTracker.Sample[]\r\n    private nextIdx: number\r\n    private startTimeMs: number | null\r\n\r\n    constructor(args: {\r\n        readonly maxSamples: number\r\n        readonly onSamples: (stats: readonly PerfTracker.Sample[]) => void\r\n    }) {\r\n        this.maxSamples = args.maxSamples\r\n        this.onSamples = args.onSamples\r\n        this.samples = new Array(args.maxSamples)\r\n        this.nextIdx = 0\r\n        this.startTimeMs = null\r\n    }\r\n\r\n    start() {\r\n        if (this.startTimeMs !== null) {\r\n            console.error(\"Performance tracker should not already be in use\")\r\n        }\r\n        this.startTimeMs = performance.now()\r\n    }\r\n\r\n    end() {\r\n        if (this.startTimeMs === null) {\r\n            console.error(\"Performance tracker should be started\")\r\n        }\r\n        const endMs = performance.now()\r\n        /* eslint-disable-next-line @typescript-eslint/no-non-null-assertion */\r\n        const startMs = this.startTimeMs!\r\n        this.startTimeMs = null\r\n\r\n        this.samples[this.nextIdx++] = { startMs, endMs }\r\n        if (this.nextIdx === this.maxSamples) {\r\n            this.onSamples(this.samples)\r\n            this.samples = new Array(this.maxSamples)\r\n            this.nextIdx = 0\r\n        }\r\n    }\r\n}\r\n","import { Vec2 } from \"./vec2\"\r\n\r\nexport { Store } from \"./store\"\r\nexport { Decode } from \"./decode\"\r\nexport * from \"./maybe\"\r\nexport * from \"./result\"\r\nexport * from \"./vec2\"\r\nexport * from \"./vec3\"\r\nexport * from \"./vec4\"\r\nimport * as Signals from \"./signals\"\r\nexport { Signals }\r\nexport * from \"./frameStream\"\r\nexport * from \"./perfTracker\"\r\n\r\nexport type Brand<a, brand> = a & { \"@..brand\": brand }\r\n\r\nexport class Lazy<a> {\r\n    private __value: a | null = null\r\n    constructor(private readonly __fn: () => a) {}\r\n\r\n    get value(): a {\r\n        if (this.__value === null) {\r\n            this.__value = this.__fn()\r\n        }\r\n        return this.__value\r\n    }\r\n}\r\n\r\nexport class SetOnce<a> {\r\n    private __value: a | null = null\r\n\r\n    set(value: a): void {\r\n        if (this.__value !== null) throw \"Attempted to re-set a SetOnce\"\r\n        this.__value = value\r\n    }\r\n\r\n    get value(): a {\r\n        if (this.__value === null) throw \"Attempted to get the value of a SetOnce before it was set\"\r\n        return this.__value\r\n    }\r\n}\r\n\r\nexport function orDefault<a>(value: a | undefined, def: a): a {\r\n    return value !== undefined ? value : def\r\n}\r\n\r\nexport function range(start: number, end: number): readonly number[] {\r\n    const length = end - start + 1\r\n    const arr = new Array<number>(length)\r\n    for (let i = 0; i < length; i++) {\r\n        arr[i] = start + i\r\n    }\r\n    return arr\r\n}\r\n\r\nexport function distance(x0: number, y0: number, x1: number, y1: number): number {\r\n    const x = x1 - x0\r\n    const y = y1 - y0\r\n    return Math.sqrt(x * x + y * y)\r\n}\r\n\r\nexport function lerp(pct: number, start: number, end: number): number {\r\n    return start + (end - start) * pct\r\n}\r\n\r\nexport function smoothstep(x: number): number {\r\n    return x * x * (3 - x + x)\r\n}\r\n\r\nexport function clamp(min: number, max: number, n: number): number {\r\n    return n < min ? min : n > max ? max : n\r\n}\r\n\r\nexport function delay(ms: number): Promise<void> {\r\n    return new Promise(res => {\r\n        setTimeout(res, ms)\r\n    })\r\n}\r\n\r\nexport interface PushOnlyArray<a> extends ReadonlyArray<a> {\r\n    push(item: a): unknown\r\n}\r\n\r\nexport function arrUpdate<a>(array: readonly a[], index: number, value: a): readonly a[] {\r\n    const newArr = array.slice()\r\n    newArr.splice(index, 1, value)\r\n    return newArr\r\n}\r\n\r\nexport function arrInsert<a>(array: readonly a[], index: number, value: a): readonly a[] {\r\n    const newArr = array.slice()\r\n    newArr.splice(index, 0, value)\r\n    return newArr\r\n}\r\n\r\nexport function arrRemove<a>(array: readonly a[], index: number): readonly a[] {\r\n    const newArr = array.slice()\r\n    newArr.splice(index, 1)\r\n    return newArr\r\n}\r\n\r\nexport const enum ColorMode {\r\n    Hsv,\r\n    Hsluv,\r\n}\r\n\r\nexport function colorModeToString(type: ColorMode): string {\r\n    switch (type) {\r\n        case ColorMode.Hsv:\r\n            return \"Hsv\"\r\n        case ColorMode.Hsluv:\r\n            return \"Hsluv\"\r\n    }\r\n}\r\n\r\nexport function turnsToDegrees(turns: number): number {\r\n    return turns * 360\r\n}\r\n\r\nexport function turnsFromDegrees(degrees: number): number {\r\n    return degrees / 360\r\n}\r\n\r\nexport function turn(turns: number, center: Vec2, point: Vec2): Vec2 {\r\n    const radians = turns * 360 * (Math.PI / 180)\r\n    const x =\r\n        Math.cos(radians) * (point.x - center.x) -\r\n        Math.sin(radians) * (point.y - center.y) +\r\n        center.x\r\n    const y =\r\n        Math.sin(radians) * (point.x - center.x) +\r\n        Math.cos(radians) * (point.y - center.y) +\r\n        center.y\r\n    return new Vec2(x, y)\r\n}\r\n","import { elementFactory, htmlElementFactory, emitAttribute, emitChildren, escapeAttributeValue, escapeText, IGNORE_RENDER_TO_STRING, } from \"ivi\";\n/**\n * {@link AttributeDirective} with `\"\"` value and {@link updateValue} sync function.\n */\nconst VALUE_EMPTY = { v: \"\", u: updateValue };\n/**\n * {@link AttributeDirective} with `false` value and {@link updateChecked} sync function.\n */\nconst CHECKED_FALSE = { v: false, u: updateChecked };\n/**\n * {@link AttributeDirective} with `true` value and {@link updateChecked} sync function.\n */\nconst CHECKED_TRUE = { v: true, u: updateChecked };\n/**\n * {@link AttributeDirective} with `true` value that emits `checked` attribute.\n */\nconst CHECKED_TRUE_RENDER_TO_STRING = { v: true, s: () => { emitAttribute(\"checked\"); } };\n/**\n * Render to string function for an {@link AttributeDirective} created with {@link VALUE} function.\n *\n * @param key Attribute key.\n * @param value Value.\n */\nfunction renderToStringValue(key, value) {\n    emitAttribute(`value=\"${escapeAttributeValue(value)}\"`);\n}\n/**\n * Render to string function for an {@link AttributeDirective} created with {@link CONTENT} function.\n *\n * @param key Attribute key.\n * @param value Value.\n */\nfunction renderToStringContent(key, value) {\n    emitChildren(escapeText(value));\n}\n/**\n * Synchronization function for {@link AttributeDirective} created with {@link VALUE} function.\n *\n * @param element Target element.\n * @param key Attribute key.\n * @param prev Previous value.\n * @param next Next value.\n */\nfunction updateValue(element, key, prev, next) {\n    if (prev === void 0) {\n        if (next !== \"\") {\n            element.value = next;\n        }\n    }\n    else if (next !== void 0 && (element.value !== next)) {\n        element.value = next;\n    }\n}\n/**\n * Synchronization function for {@link AttributeDirective} created with {@link CHECKED} function.\n *\n * @param element Target element.\n * @param key Attribute key.\n * @param prev Previous value.\n * @param next Next value.\n */\nfunction updateChecked(element, key, prev, next) {\n    if (prev === void 0) {\n        if (next) {\n            element.checked = next;\n        }\n    }\n    else if (next !== void 0) {\n        if (element.checked !== next) {\n            element.checked = next;\n        }\n    }\n}\n/**\n * VALUE function creates a {@link AttributeDirective} that assigns a `value` property to an HTMLInputElement.\n *\n * @example\n *\n *   const e = input(\"\", { value: VALUE(\"value\") });\n *\n * @param v Value.\n * @returns {@link AttributeDirective}\n */\nexport const VALUE = (v) => (process.env.IVI_TARGET === \"ssr\" ?\n    v === \"\" ? IGNORE_RENDER_TO_STRING : { v, s: renderToStringValue } :\n    v === \"\" ? VALUE_EMPTY : { v, u: updateValue });\n/**\n * CONTENT function creates a {@link AttributeDirective} that assigns a `value` property to an HTMLTextAreaElement.\n *\n * @example\n *\n *   const e = textarea(\"\", { content: CONTENT(\"content\") });\n *\n * @param v Value.\n * @returns {@link AttributeDirective}\n */\nexport const CONTENT = (process.env.IVI_TARGET === \"ssr\" ?\n    (v) => (v === \"\" ? IGNORE_RENDER_TO_STRING : ({ v, s: renderToStringContent })) :\n    VALUE);\n/**\n * CHECKED function creates a {@link AttributeDirective} that assigns a `checked` property to an HTMLInputElement.\n *\n * @example\n *\n *   const e = input(\"\", { checked: CHECKED(true) });\n *\n * @param v Checked value.\n * @returns {@link AttributeDirective}\n */\nexport const CHECKED = (v) => (process.env.IVI_TARGET === \"ssr\" ?\n    v ? CHECKED_TRUE_RENDER_TO_STRING : IGNORE_RENDER_TO_STRING :\n    v ? CHECKED_TRUE : CHECKED_FALSE);\n/* tslint:disable:max-line-length */\n/**\n * Creates OpNode HTML element <a>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/a}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <a>\n */\nexport const a = /*#__PURE__*/ htmlElementFactory(\"a\");\n/**\n * Creates OpNode HTML element <abbr>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/abbr}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <abbr>\n */\nexport const abbr = /*#__PURE__*/ htmlElementFactory(\"abbr\");\n/**\n * Creates OpNode HTML element <address>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/address}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <address>\n */\nexport const address = /*#__PURE__*/ htmlElementFactory(\"address\");\n/**\n * Creates OpNode HTML element <article>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/article}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <article>\n */\nexport const article = /*#__PURE__*/ htmlElementFactory(\"article\");\n/**\n * Creates OpNode HTML element <aside>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/aside}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <aside>\n */\nexport const aside = /*#__PURE__*/ htmlElementFactory(\"aside\");\n/**\n * Creates OpNode HTML element <b>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/b}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <b>\n */\nexport const b = /*#__PURE__*/ htmlElementFactory(\"b\");\n/**\n * Creates OpNode HTML element <base>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/base}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <base>\n */\nexport const base = /*#__PURE__*/ elementFactory(\"base\", 2 /* Element */ | 4096 /* VoidElement */);\n/**\n * Creates OpNode HTML element <bdo>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/bdo}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <bdo>\n */\nexport const bdo = /*#__PURE__*/ htmlElementFactory(\"bdo\");\n/**\n * Creates OpNode HTML element <blockquote>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/blockquote}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <blockquote>\n */\nexport const blockquote = /*#__PURE__*/ htmlElementFactory(\"blockquote\");\n/**\n * Creates OpNode HTML element <body>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/body}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <body>\n */\nexport const body = /*#__PURE__*/ htmlElementFactory(\"body\");\n/**\n * Creates OpNode HTML element <br>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/br}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <br>\n */\nexport const br = /*#__PURE__*/ elementFactory(\"br\", 2 /* Element */ | 4096 /* VoidElement */);\n/**\n * Creates OpNode HTML element <button>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/button}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <button>\n */\nexport const button = /*#__PURE__*/ htmlElementFactory(\"button\");\n/**\n * Creates OpNode HTML element <canvas>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/canvas}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <canvas>\n */\nexport const canvas = /*#__PURE__*/ htmlElementFactory(\"canvas\");\n/**\n * Creates OpNode HTML element <caption>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/caption}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <caption>\n */\nexport const caption = /*#__PURE__*/ htmlElementFactory(\"caption\");\n/**\n * Creates OpNode HTML element <cite>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/cite}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <cite>\n */\nexport const cite = /*#__PURE__*/ htmlElementFactory(\"cite\");\n/**\n * Creates OpNode HTML element <code>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/code}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <code>\n */\nexport const code = /*#__PURE__*/ htmlElementFactory(\"code\");\n/**\n * Creates OpNode HTML element <col>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/col}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <col>\n */\nexport const col = /*#__PURE__*/ elementFactory(\"col\", 2 /* Element */ | 4096 /* VoidElement */);\n/**\n * Creates OpNode HTML element <colgroup>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/colgroup}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <colgroup>\n */\nexport const colgroup = /*#__PURE__*/ htmlElementFactory(\"colgroup\");\n/**\n * Creates OpNode HTML element <del>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/del}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <del>\n */\nexport const del = /*#__PURE__*/ htmlElementFactory(\"del\");\n/**\n * Creates OpNode HTML element <dfn>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/dfn}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <dfn>\n */\nexport const dfn = /*#__PURE__*/ htmlElementFactory(\"dfn\");\n/**\n * Creates OpNode HTML element <div>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/div}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <div>\n */\nexport const div = /*#__PURE__*/ htmlElementFactory(\"div\");\n/**\n * Creates OpNode HTML element <dd>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/dd}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <dd>\n */\nexport const dd = /*#__PURE__*/ htmlElementFactory(\"dd\");\n/**\n * Creates OpNode HTML element <dl>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/dl}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <dl>\n */\nexport const dl = /*#__PURE__*/ htmlElementFactory(\"dl\");\n/**\n * Creates OpNode HTML element <dt>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/dt}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <dt>\n */\nexport const dt = /*#__PURE__*/ htmlElementFactory(\"dt\");\n/**\n * Creates OpNode HTML element <em>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/em}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <em>\n */\nexport const em = /*#__PURE__*/ htmlElementFactory(\"em\");\n/**\n * Creates OpNode HTML element <fieldset>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/fieldset}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <fieldset>\n */\nexport const fieldset = /*#__PURE__*/ htmlElementFactory(\"fieldset\");\n/**\n * Creates OpNode HTML element <figcaption>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/figcaption}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <figcaption>\n */\nexport const figcaption = /*#__PURE__*/ htmlElementFactory(\"figcaption\");\n/**\n * Creates OpNode HTML element <figure>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/figure}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <figure>\n */\nexport const figure = /*#__PURE__*/ htmlElementFactory(\"figure\");\n/**\n * Creates OpNode HTML element <footer>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/footer}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <footer>\n */\nexport const footer = /*#__PURE__*/ htmlElementFactory(\"footer\");\n/**\n * Creates OpNode HTML element <form>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/form}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <form>\n */\nexport const form = /*#__PURE__*/ htmlElementFactory(\"form\");\n/**\n * Creates OpNode HTML element <h1>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/h1}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <h1>\n */\nexport const h1 = /*#__PURE__*/ htmlElementFactory(\"h1\");\n/**\n * Creates OpNode HTML element <h2>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/h2}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <h2>\n */\nexport const h2 = /*#__PURE__*/ htmlElementFactory(\"h2\");\n/**\n * Creates OpNode HTML element <h3>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/h3}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <h3>\n */\nexport const h3 = /*#__PURE__*/ htmlElementFactory(\"h3\");\n/**\n * Creates OpNode HTML element <h4>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/h4}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <h4>\n */\nexport const h4 = /*#__PURE__*/ htmlElementFactory(\"h4\");\n/**\n * Creates OpNode HTML element <h5>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/h5}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <h5>\n */\nexport const h5 = /*#__PURE__*/ htmlElementFactory(\"h5\");\n/**\n * Creates OpNode HTML element <h6>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/h6}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <h6>\n */\nexport const h6 = /*#__PURE__*/ htmlElementFactory(\"h6\");\n/**\n * Creates OpNode HTML element <head>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/head}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <head>\n */\nexport const head = /*#__PURE__*/ htmlElementFactory(\"head\");\n/**\n * Creates OpNode HTML element <header>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/header}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <header>\n */\nexport const header = /*#__PURE__*/ htmlElementFactory(\"header\");\n/**\n * Creates OpNode HTML element <hgroup>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/hgroup}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <hgroup>\n */\nexport const hgroup = /*#__PURE__*/ htmlElementFactory(\"hgroup\");\n/**\n * Creates OpNode HTML element <hr>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/hr}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <hr>\n */\nexport const hr = /*#__PURE__*/ elementFactory(\"hr\", 2 /* Element */ | 4096 /* VoidElement */);\n/**\n * Creates OpNode HTML element <html>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/html}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <html>\n */\nexport const html = /*#__PURE__*/ htmlElementFactory(\"html\");\n/**\n * Creates OpNode HTML element <i>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/i}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <i>\n */\nexport const i = /*#__PURE__*/ htmlElementFactory(\"i\");\n/**\n * Creates OpNode HTML element <iframe>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/iframe}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <iframe>\n */\nexport const iframe = /*#__PURE__*/ htmlElementFactory(\"iframe\");\n/**\n * Creates OpNode HTML element <img>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/img}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <img>\n */\nexport const img = /*#__PURE__*/ elementFactory(\"img\", 2 /* Element */ | 4096 /* VoidElement */);\n/**\n * Creates OpNode HTML element <area>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/area}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <area>\n */\nexport const area = /*#__PURE__*/ elementFactory(\"area\", 2 /* Element */ | 4096 /* VoidElement */);\n/**\n * Creates OpNode HTML element <map>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/map}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <map>\n */\nexport const map = /*#__PURE__*/ htmlElementFactory(\"map\");\n/**\n * Creates OpNode HTML element <ins>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/ins}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <ins>\n */\nexport const ins = /*#__PURE__*/ htmlElementFactory(\"ins\");\n/**\n * Creates OpNode HTML element <kbd>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/kbd}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <kbd>\n */\nexport const kbd = /*#__PURE__*/ htmlElementFactory(\"kbd\");\n/**\n * Creates OpNode HTML element <label>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/label}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <label>\n */\nexport const label = /*#__PURE__*/ htmlElementFactory(\"label\");\n/**\n * Creates OpNode HTML element <legend>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/legend}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <legend>\n */\nexport const legend = /*#__PURE__*/ htmlElementFactory(\"legend\");\n/**\n * Creates OpNode HTML element <li>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/li}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <li>\n */\nexport const li = /*#__PURE__*/ htmlElementFactory(\"li\");\n/**\n * Creates OpNode HTML element <link>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/link}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <link>\n */\nexport const link = /*#__PURE__*/ elementFactory(\"link\", 2 /* Element */ | 4096 /* VoidElement */);\n/**\n * Creates OpNode HTML element <main>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/main}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <main>\n */\nexport const main = /*#__PURE__*/ htmlElementFactory(\"main\");\n/**\n * Creates OpNode HTML element <mark>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/mark}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <mark>\n */\nexport const mark = /*#__PURE__*/ htmlElementFactory(\"mark\");\n/**\n * Creates OpNode HTML element <menu>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/menu}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <menu>\n */\nexport const menu = /*#__PURE__*/ htmlElementFactory(\"menu\");\n/**\n * Creates OpNode HTML element <meta>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/meta}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <meta>\n */\nexport const meta = /*#__PURE__*/ elementFactory(\"meta\", 2 /* Element */ | 4096 /* VoidElement */);\n/**\n * Creates OpNode HTML element <meter>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/meter}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <meter>\n */\nexport const meter = /*#__PURE__*/ htmlElementFactory(\"meter\");\n/**\n * Creates OpNode HTML element <nav>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/nav}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <nav>\n */\nexport const nav = /*#__PURE__*/ htmlElementFactory(\"nav\");\n/**\n * Creates OpNode HTML element <noscript>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/noscript}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <noscript>\n */\nexport const noscript = /*#__PURE__*/ htmlElementFactory(\"noscript\");\n/**\n * Creates OpNode HTML element <ol>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/ol}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <ol>\n */\nexport const ol = /*#__PURE__*/ htmlElementFactory(\"ol\");\n/**\n * Creates OpNode HTML element <optgroup>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/optgroup}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <optgroup>\n */\nexport const optgroup = /*#__PURE__*/ htmlElementFactory(\"optgroup\");\n/**\n * Creates OpNode HTML element <option>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/option}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <option>\n */\nexport const option = /*#__PURE__*/ htmlElementFactory(\"option\");\n/**\n * Creates OpNode HTML element <p>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/p}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <p>\n */\nexport const p = /*#__PURE__*/ htmlElementFactory(\"p\");\n/**\n * Creates OpNode HTML element <picture>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/picture}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <picture>\n */\nexport const picture = /*#__PURE__*/ htmlElementFactory(\"picture\");\n/**\n * Creates OpNode HTML element <pre>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/pre}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <pre>\n */\nexport const pre = /*#__PURE__*/ elementFactory(\"pre\", 2 /* Element */ | 2048 /* NewlineEatingElement */);\n/**\n * Creates OpNode HTML element <progress>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/progress}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <progress>\n */\nexport const progress = /*#__PURE__*/ htmlElementFactory(\"progress\");\n/**\n * Creates OpNode HTML element <q>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/q}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <q>\n */\nexport const q = /*#__PURE__*/ htmlElementFactory(\"q\");\n/**\n * Creates OpNode HTML element <rt>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/rt}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <rt>\n */\nexport const rt = /*#__PURE__*/ htmlElementFactory(\"rt\");\n/**\n * Creates OpNode HTML element <ruby>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/ruby}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <ruby>\n */\nexport const ruby = /*#__PURE__*/ htmlElementFactory(\"ruby\");\n/**\n * Creates OpNode HTML element <s>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/s}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <s>\n */\nexport const s = /*#__PURE__*/ htmlElementFactory(\"s\");\n/**\n * Creates OpNode HTML element <samp>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/samp}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <samp>\n */\nexport const samp = /*#__PURE__*/ htmlElementFactory(\"samp\");\n/**\n * Creates OpNode HTML element <script>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/script}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <script>\n */\nexport const script = /*#__PURE__*/ htmlElementFactory(\"script\");\n/**\n * Creates OpNode HTML element <section>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/section}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <section>\n */\nexport const section = /*#__PURE__*/ htmlElementFactory(\"section\");\n/**\n * Creates OpNode HTML element <select>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/select}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <select>\n */\nexport const select = /*#__PURE__*/ htmlElementFactory(\"select\");\n/**\n * Creates OpNode HTML element <source>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/source}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <source>\n */\nexport const source = /*#__PURE__*/ elementFactory(\"source\", 2 /* Element */ | 4096 /* VoidElement */);\n/**\n * Creates OpNode HTML element <span>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/span}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <span>\n */\nexport const span = /*#__PURE__*/ htmlElementFactory(\"span\");\n/**\n * Creates OpNode HTML element <strong>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/strong}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <strong>\n */\nexport const strong = /*#__PURE__*/ htmlElementFactory(\"strong\");\n/**\n * Creates OpNode HTML element <style>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/style}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <style>\n */\nexport const style = /*#__PURE__*/ htmlElementFactory(\"style\");\n/**\n * Creates OpNode HTML element <sub>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/sub}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <sub>\n */\nexport const sub = /*#__PURE__*/ htmlElementFactory(\"sub\");\n/**\n * Creates OpNode HTML element <sup>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/sup}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <sup>\n */\nexport const sup = /*#__PURE__*/ htmlElementFactory(\"sup\");\n/**\n * Creates OpNode HTML element <table>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/table}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <table>\n */\nexport const table = /*#__PURE__*/ htmlElementFactory(\"table\");\n/**\n * Creates OpNode HTML element <tbody>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/tbody}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <tbody>\n */\nexport const tbody = /*#__PURE__*/ htmlElementFactory(\"tbody\");\n/**\n * Creates OpNode HTML element <td>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/td}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <td>\n */\nexport const td = /*#__PURE__*/ htmlElementFactory(\"td\");\n/**\n * Creates OpNode HTML element <template>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/template}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <template>\n */\nexport const template = /*#__PURE__*/ htmlElementFactory(\"template\");\n/**\n * Creates OpNode HTML element <tfoot>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/tfoot}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <tfoot>\n */\nexport const tfoot = /*#__PURE__*/ htmlElementFactory(\"tfoot\");\n/**\n * Creates OpNode HTML element <th>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/th}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <th>\n */\nexport const th = /*#__PURE__*/ htmlElementFactory(\"th\");\n/**\n * Creates OpNode HTML element <thead>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/thead}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <thead>\n */\nexport const thead = /*#__PURE__*/ htmlElementFactory(\"thead\");\n/**\n * Creates OpNode HTML element <time>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/time}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <time>\n */\nexport const time = /*#__PURE__*/ htmlElementFactory(\"time\");\n/**\n * Creates OpNode HTML element <title>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/title}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <title>\n */\nexport const title = /*#__PURE__*/ htmlElementFactory(\"title\");\n/**\n * Creates OpNode HTML element <tr>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/tr}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <tr>\n */\nexport const tr = /*#__PURE__*/ htmlElementFactory(\"tr\");\n/**\n * Creates OpNode HTML element <track>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/track}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <track>\n */\nexport const track = /*#__PURE__*/ elementFactory(\"track\", 2 /* Element */ | 4096 /* VoidElement */);\n/**\n * Creates OpNode HTML element <u>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/u}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <u>\n */\nexport const u = /*#__PURE__*/ htmlElementFactory(\"u\");\n/**\n * Creates OpNode HTML element <ul>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/ul}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <ul>\n */\nexport const ul = /*#__PURE__*/ htmlElementFactory(\"ul\");\n/**\n * Creates OpNode HTML element <wbr>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/wbr}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <wbr>\n */\nexport const wbr = /*#__PURE__*/ elementFactory(\"wbr\", 2 /* Element */ | 4096 /* VoidElement */);\n/**\n * Creates OpNode HTML element <textarea>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/textarea}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <textarea>\n */\nexport const textarea = /*#__PURE__*/ elementFactory(\"textarea\", 2 /* Element */ | 2048 /* NewlineEatingElement */);\n/**\n * Creates OpNode HTML element <input>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <input>\n */\nexport const input = /*#__PURE__*/ elementFactory(\"input\", 2 /* Element */ | 4096 /* VoidElement */);\n/**\n * Creates OpNode HTML element <audio>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/audio}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <audio>\n */\nexport const audio = /*#__PURE__*/ htmlElementFactory(\"audio\");\n/**\n * Creates OpNode HTML element <video>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/video}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode HTML element <video>\n */\nexport const video = /*#__PURE__*/ htmlElementFactory(\"video\");\n//# sourceMappingURL=index.js.map","import { Op, Events, onClick } from \"ivi\"\r\nimport { button } from \"ivi-html\"\r\nimport * as styles from \"./buttons.scss\"\r\n\r\nexport interface ButtonProps {\r\n    readonly onClick: () => void\r\n    readonly title?: string\r\n    readonly content: Op\r\n}\r\n\r\nexport function PrimaryButton({ onClick: handler, title, content }: ButtonProps): Op {\r\n    return Events(onClick(handler), button(styles.primary, { title }, content))\r\n}\r\n\r\nexport function DefaultButton({ onClick: handler, title, content }: ButtonProps): Op {\r\n    return Events(onClick(handler), button(styles.ddefault, { title }, content))\r\n}\r\n\r\nfunction noOp() {}\r\n\r\nexport function SinkableButton(props: {\r\n    readonly onClick: () => void\r\n    readonly onDownClick?: () => void\r\n    readonly isDown: boolean\r\n    readonly children: Op\r\n    readonly title?: string\r\n}): Op {\r\n    const className = props.isDown ? styles.sinkableSunk : styles.sinkableUnsunk\r\n    const handler = props.isDown ? props.onDownClick || noOp : props.onClick\r\n\r\n    return Events(onClick(handler), button(className, { title: props.title }, props.children))\r\n}\r\n","import { Events, onClick, statelessComponent, shallowEqual } from \"ivi\"\r\nimport { div, span } from \"ivi-html\"\r\nimport * as styles from \"./colorDisplay.scss\"\r\nimport { Hsluv } from \"color\"\r\n\r\nexport interface ColorDisplay {\r\n    readonly color: Hsluv\r\n    readonly colorSecondary: Hsluv\r\n    readonly onClick: () => void\r\n}\r\n\r\nexport const ColorDisplay = statelessComponent((props: ColorDisplay) => {\r\n    return Events(\r\n        onClick(props.onClick),\r\n        div(styles.container, undefined, [\r\n            span(styles.secondary, {\r\n                style: { \"background-color\": props.colorSecondary.toStyle() },\r\n            }),\r\n            span(styles.primary, { style: { \"background-color\": props.color.toStyle() } }),\r\n        ])\r\n    )\r\n}, shallowEqual)\r\n","import {\r\n    component,\r\n    Events,\r\n    onMouseDown,\r\n    useEffect,\r\n    Ref,\r\n    box,\r\n    invalidate,\r\n    OpState,\r\n    findDOMNode,\r\n    _,\r\n    useMutationEffect,\r\n    scheduleMicrotask,\r\n    UpdateFlags,\r\n} from \"ivi\"\r\nimport { div, canvas } from \"ivi-html\"\r\nimport * as styles from \"./colorWheel.scss\"\r\nimport * as Color from \"color\"\r\nimport { DEFINE_TAU, createProgram, DEFINE_hsluv_etc, DEFINE_hsvToRgb } from \"../../webgl\"\r\nimport { ColorMode, clamp } from \"../../util\"\r\n\r\nexport interface ColorWheelProps {\r\n    readonly color: Color.Hsluv\r\n    readonly colorType: ColorMode\r\n    readonly onChange: (color: Color.Hsluv) => void\r\n}\r\n\r\nconst enum PointerState {\r\n    Default,\r\n    DownOnInner,\r\n    DownOnOuter,\r\n}\r\n\r\nconst MARGIN = (1 - 0.55) / 2\r\ntype WithClientXY = Readonly<{\r\n    clientX: number\r\n    clientY: number\r\n}>\r\n\r\nfunction noOp() {}\r\n\r\nexport const ColorWheel = component<ColorWheelProps>(c => {\r\n    const containerRef = box<OpState<HTMLDivElement> | null>(null)\r\n    const canvasRef = box<OpState<HTMLCanvasElement> | null>(null)\r\n    let glState: GlState | null = null\r\n    let pointerState = PointerState.Default\r\n    let color = new Color.Hsluv(0, 0, 0)\r\n    let colorMode = ColorMode.Hsluv\r\n    let colorHandler: (color: Color.Hsluv) => void = noOp\r\n\r\n    function signalOuter(ev: WithClientXY) {\r\n        // get xy delta from the center of the ring\r\n        const bounds = findDOMNode<HTMLDivElement>(containerRef)!.getBoundingClientRect()\r\n        const x = ev.clientX - bounds.left - bounds.width * 0.5\r\n        const y = ev.clientY - bounds.top - bounds.height * 0.5\r\n\r\n        // calculate radians of the delta\r\n        const rad = Math.atan2(y, x)\r\n\r\n        // get hue from radians (keep in mind the ring is turned 50%)\r\n        const hue = rad / (Math.PI * 2) + 0.5\r\n\r\n        switch (colorMode) {\r\n            case ColorMode.Hsv: {\r\n                const hsv = Color.rgbToHsv(color.toRgb())\r\n                colorHandler(Color.rgbToHsluv(hsv.with({ h: hue }).toRgb()))\r\n                break\r\n            }\r\n            case ColorMode.Hsluv: {\r\n                colorHandler(color.with({ h: hue * 360 }))\r\n                break\r\n            }\r\n        }\r\n        invalidate(c)\r\n    }\r\n\r\n    function signalInner(ev: WithClientXY) {\r\n        const bounds = findDOMNode<HTMLDivElement>(containerRef)!.getBoundingClientRect()\r\n        const marginX = bounds.width * MARGIN\r\n        const marginY = bounds.height * MARGIN\r\n\r\n        const width = bounds.width - marginX * 2\r\n        const height = bounds.height - marginY * 2\r\n\r\n        const x = clamp(0, width, ev.clientX - bounds.left - marginX)\r\n        const y = clamp(0, height, ev.clientY - bounds.top - marginY)\r\n\r\n        const pctX = x / width\r\n        const pctY = 1 - y / height\r\n\r\n        switch (colorMode) {\r\n            case ColorMode.Hsv: {\r\n                const hue = Color.rgbToHsv(color.toRgb()).h\r\n                colorHandler(Color.rgbToHsluv(Color.hsvToRgb(new Color.Hsv(hue, pctX, pctY))))\r\n                break\r\n            }\r\n            case ColorMode.Hsluv: {\r\n                const hue = color.h\r\n                colorHandler(new Color.Hsluv(hue, pctX * 100, pctY * 100))\r\n                break\r\n            }\r\n        }\r\n        invalidate(c)\r\n    }\r\n\r\n    const initializeCanvas = useMutationEffect(c, () => {\r\n        const canvas = findDOMNode<HTMLCanvasElement>(canvasRef)\r\n        if (canvas == null) {\r\n            throw { \"canvas ref not fonud\": canvasRef }\r\n        }\r\n\r\n        glState = new GlState(canvas)\r\n\r\n        scheduleMicrotask(() => invalidate(c, 1 as UpdateFlags.RequestSyncUpdate))\r\n        return () => {\r\n            if (glState) {\r\n                glState.dispose()\r\n            }\r\n        }\r\n    })\r\n\r\n    const renderCanvas = useMutationEffect<{ colorMode: ColorMode; color: Color.Hsluv }>(\r\n        c,\r\n        args => {\r\n            if (!glState) {\r\n                return\r\n            }\r\n            glState.render(args.colorMode, args.color)\r\n        },\r\n        (a, b) => a.color.is(b.color) && a.colorMode === b.colorMode\r\n    )\r\n\r\n    const listenToMouse = useEffect(c, () => {\r\n        function onUp(_ev: WithClientXY) {\r\n            pointerState = PointerState.Default\r\n        }\r\n\r\n        function onMove(ev: WithClientXY) {\r\n            switch (pointerState) {\r\n                case PointerState.Default:\r\n                    break\r\n                case PointerState.DownOnInner:\r\n                    signalInner(ev)\r\n                    break\r\n                case PointerState.DownOnOuter:\r\n                    signalOuter(ev)\r\n                    break\r\n            }\r\n        }\r\n\r\n        document.body.addEventListener(\"mouseup\", onUp)\r\n        document.body.addEventListener(\"mousemove\", onMove, { passive: true })\r\n        return () => {\r\n            document.body.removeEventListener(\"mouseup\", onUp)\r\n            document.body.removeEventListener(\"mousemove\", onMove)\r\n        }\r\n    })\r\n\r\n    function onDown(ev: WithClientXY) {\r\n        const bounds = findDOMNode<HTMLDivElement>(containerRef)!.getBoundingClientRect()\r\n        const x = clamp(0, bounds.width, ev.clientX - bounds.left)\r\n        const y = clamp(0, bounds.height, ev.clientY - bounds.top)\r\n\r\n        const marginX = bounds.width * MARGIN\r\n        const marginY = bounds.height * MARGIN\r\n\r\n        const isInner =\r\n            isInclusive(x, marginX, bounds.width - marginX) &&\r\n            isInclusive(y, marginY, bounds.height - marginY)\r\n\r\n        if (isInner) {\r\n            pointerState = PointerState.DownOnInner\r\n            signalInner(ev)\r\n        } else {\r\n            pointerState = PointerState.DownOnOuter\r\n            signalOuter(ev)\r\n        }\r\n    }\r\n\r\n    return props => {\r\n        listenToMouse()\r\n        initializeCanvas()\r\n        renderCanvas({ colorMode: props.colorType, color: props.color })\r\n\r\n        color = props.color\r\n        colorMode = props.colorType\r\n        colorHandler = props.onChange\r\n\r\n        const canvasNode = findDOMNode<HTMLCanvasElement>(canvasRef)\r\n        const thumbData =\r\n            glState === null\r\n                ? null\r\n                : canvasNode === null\r\n                ? null\r\n                : glState.getThumbPositions(\r\n                      props.colorType,\r\n                      props.color,\r\n                      canvasNode.getBoundingClientRect()\r\n                  )\r\n\r\n        return Events(\r\n            onMouseDown(onDown),\r\n            Ref(\r\n                containerRef,\r\n                div(\r\n                    styles.container,\r\n                    _,\r\n                    div(_, _, [\r\n                        Ref(canvasRef, canvas(_, { width: 160, height: 160 })),\r\n                        div(\r\n                            styles.cicleThumb,\r\n                            thumbData === null\r\n                                ? _\r\n                                : {\r\n                                      style: {\r\n                                          left: thumbData.circleThumbX + \"px\",\r\n                                          top: thumbData.circleThumbY + \"px\",\r\n                                          \"background-color\": props.color.toStyle(),\r\n                                          \"border-color\": props.color.l > 50 ? \"black\" : \"white\",\r\n                                          transform: \"rotate(\" + thumbData.angle + \"deg)\",\r\n                                      },\r\n                                  }\r\n                        ),\r\n                        div(\r\n                            styles.areaThumb,\r\n                            thumbData === null\r\n                                ? _\r\n                                : {\r\n                                      style: {\r\n                                          left: thumbData.areaThumbX + \"px\",\r\n                                          top: thumbData.areaThumbY + \"px\",\r\n                                          \"background-color\": props.color.toStyle(),\r\n                                          \"border-color\": props.color.l > 50 ? \"black\" : \"white\",\r\n                                      },\r\n                                  }\r\n                        ),\r\n                    ])\r\n                )\r\n            )\r\n        )\r\n    }\r\n})\r\n\r\nfunction isInclusive(n: number, min: number, max: number): boolean {\r\n    return n >= min && n <= max\r\n}\r\n\r\nclass GlState {\r\n    private readonly gl: WebGLRenderingContext\r\n    private readonly ringRenderer: RingRenderer\r\n    private readonly satValRenderer: SatValRenderer\r\n\r\n    constructor(canvas: HTMLCanvasElement) {\r\n        const gl = canvas.getContext(\"webgl\")\r\n        if (gl === null) {\r\n            throw \"Failed to init webgl\"\r\n        }\r\n\r\n        gl.blendFunc(WebGLRenderingContext.ONE, WebGLRenderingContext.ONE_MINUS_SRC_ALPHA)\r\n        gl.enable(WebGLRenderingContext.BLEND)\r\n        gl.disable(WebGLRenderingContext.DEPTH_TEST)\r\n\r\n        this.gl = gl\r\n        this.ringRenderer = new RingRenderer(gl)\r\n        this.satValRenderer = new SatValRenderer(gl)\r\n    }\r\n\r\n    render(colorMode: ColorMode, color: Color.Hsluv) {\r\n        this.gl.clearColor(0, 0, 0, 0)\r\n        this.gl.clear(WebGLRenderingContext.COLOR_BUFFER_BIT)\r\n        this.ringRenderer.render(colorMode, color)\r\n        this.satValRenderer.render(colorMode, color)\r\n    }\r\n\r\n    getThumbPositions(colorType: ColorMode, color: Color.Hsluv, canvasRect: ClientRect | DOMRect) {\r\n        let angle: number\r\n        let xPct: number\r\n        let yPct: number\r\n        if (colorType === ColorMode.Hsluv) {\r\n            angle = (color.h + 180) % 360\r\n            xPct = color.s / 100\r\n            yPct = color.l / 100\r\n        } else {\r\n            const hsv = Color.rgbToHsv(color.toRgb())\r\n            angle = (hsv.h * 360 + 180) % 360\r\n            xPct = hsv.s\r\n            yPct = hsv.v\r\n        }\r\n\r\n        let circleThumbX = 0\r\n        let circleThumbY = 0\r\n        if (canvasRect !== null) {\r\n            const radius = 80\r\n            const cx = canvasRect.left + radius\r\n            const cy = canvasRect.top + radius\r\n\r\n            const theta = (angle * Math.PI) / 180\r\n            const dx = (radius - 8) * Math.cos(theta)\r\n            const dy = (radius - 8) * Math.sin(theta)\r\n\r\n            circleThumbX = cx + dx\r\n            circleThumbY = cy + dy\r\n        }\r\n\r\n        let areaThumbX = 0\r\n        let areaThumbY = 0\r\n        if (canvasRect !== null) {\r\n            const offset = canvasRect.width * 0.225\r\n            const width = canvasRect.width * 0.55\r\n\r\n            areaThumbX = canvasRect.left + offset + width * xPct\r\n            areaThumbY = canvasRect.top + offset + width * (1 - yPct)\r\n        }\r\n\r\n        return {\r\n            angle,\r\n            circleThumbX,\r\n            circleThumbY,\r\n            areaThumbX,\r\n            areaThumbY,\r\n        }\r\n    }\r\n\r\n    dispose() {\r\n        this.ringRenderer.dispose()\r\n        this.satValRenderer.dispose()\r\n    }\r\n}\r\n\r\nconst RING_VERT_SRC = `\r\nprecision highp float;\r\n\r\nattribute vec2 a_position;\r\n\r\nvarying vec2 v_position;\r\n\r\nvoid main() {\r\n    gl_Position = vec4(a_position, 0.0, 1.0);\r\n\r\n    v_position = a_position;\r\n}\r\n`\r\n\r\nfunction makeRingFragSrc(DEFINE_toRgb: string) {\r\n    return `\r\n    precision highp float;\r\n    \r\n    ${DEFINE_TAU}\r\n\r\n    ${DEFINE_toRgb}\r\n    \r\n    #define INNER_RAD1 0.83\r\n    #define INNER_RAD2 0.85\r\n    #define OUTER_RAD1 0.98\r\n    #define OUTER_RAD2 1.00\r\n    \r\n    varying vec2 v_position;\r\n    \r\n    uniform vec3 u_color;\r\n    \r\n    void main() {\r\n        vec2 pos = v_position * vec2(1.0, -1.0);\r\n        float dist = sqrt(dot(pos, pos));\r\n    \r\n        float a = smoothstep(INNER_RAD1, INNER_RAD2, dist) - smoothstep(OUTER_RAD1, OUTER_RAD2, dist);\r\n    \r\n        float radians = atan(pos.y, pos.x);\r\n        float hue = (radians / TAU) + 0.5;\r\n    \r\n        vec3 hsluv = vec3(hue, 1.0, a);\r\n    \r\n        gl_FragColor = vec4(toRgb(u_color, hsluv) * a, a);\r\n    }\r\n    `\r\n}\r\n\r\nconst RING_FRAG_SRC_HSV = makeRingFragSrc(`\r\n${DEFINE_hsvToRgb}\r\n\r\nvec3 toRgb(vec3 color, vec3 xyz) {\r\n    return hsvToRgb(xyz * vec3(1.0, color.y, color.z));\r\n}\r\n`)\r\n\r\nconst RING_FRAG_SRC_HSLUV = makeRingFragSrc(`\r\n${DEFINE_hsluv_etc}\r\n\r\nvec3 toRgb(vec3 color, vec3 xyz) {\r\n    return hsluvToRgb(xyz * vec3(360.0, color.y, color.z));\r\n}\r\n`)\r\n\r\nclass RingRenderer {\r\n    private readonly buffer: WebGLBuffer\r\n    private program: WebGLProgram | null = null\r\n    private colorLocation: WebGLUniformLocation | null = null\r\n    private prevColorType: ColorMode | null = null\r\n\r\n    constructor(private readonly gl: WebGLRenderingContext) {\r\n        this.buffer = gl.createBuffer() as WebGLBuffer\r\n        gl.bindBuffer(WebGLRenderingContext.ARRAY_BUFFER, this.buffer)\r\n        gl.bufferData(\r\n            WebGLRenderingContext.ARRAY_BUFFER,\r\n            new Float32Array([1.0, 1.0, -1.0, 1.0, 1.0, -1.0, -1.0, -1.0]),\r\n            WebGLRenderingContext.STATIC_DRAW\r\n        )\r\n    }\r\n\r\n    render(colorType: ColorMode, color: Color.Hsluv): void {\r\n        if (!this.program || this.prevColorType !== colorType) {\r\n            if (this.program) {\r\n                this.gl.deleteProgram(this.program)\r\n            }\r\n\r\n            switch (colorType) {\r\n                case ColorMode.Hsv:\r\n                    this.program = createProgram(\r\n                        this.gl,\r\n                        RING_VERT_SRC,\r\n                        RING_FRAG_SRC_HSV\r\n                    ) as WebGLProgram\r\n                    break\r\n                case ColorMode.Hsluv:\r\n                    this.program = createProgram(\r\n                        this.gl,\r\n                        RING_VERT_SRC,\r\n                        RING_FRAG_SRC_HSLUV\r\n                    ) as WebGLProgram\r\n                    break\r\n            }\r\n            this.gl.bindAttribLocation(this.program as WebGLProgram, 0, \"a_position\")\r\n            this.colorLocation = this.gl.getUniformLocation(\r\n                this.program as WebGLProgram,\r\n                \"u_color\"\r\n            ) as WebGLUniformLocation\r\n            this.prevColorType = colorType\r\n        }\r\n\r\n        this.gl.useProgram(this.program)\r\n        this.gl.bindBuffer(WebGLRenderingContext.ARRAY_BUFFER, this.buffer)\r\n\r\n        this.gl.vertexAttribPointer(0, 2, WebGLRenderingContext.FLOAT, false, 0, 0)\r\n        this.gl.enableVertexAttribArray(0)\r\n\r\n        switch (colorType) {\r\n            case ColorMode.Hsv: {\r\n                const hsv = Color.rgbToHsv(Color.hsluvToRgb(color))\r\n                this.gl.uniform3f(this.colorLocation, hsv.h, hsv.s, hsv.v)\r\n                break\r\n            }\r\n            case ColorMode.Hsluv: {\r\n                this.gl.uniform3f(this.colorLocation, color.h, color.s, color.l)\r\n                break\r\n            }\r\n        }\r\n\r\n        this.gl.drawArrays(WebGLRenderingContext.TRIANGLE_STRIP, 0, 4)\r\n    }\r\n\r\n    dispose(): void {\r\n        this.gl.deleteBuffer(this.buffer)\r\n        this.gl.deleteProgram(this.program)\r\n    }\r\n}\r\n\r\nconst WI = 0.55\r\n\r\nconst SATVAL_VERT_SRC = `\r\nprecision highp float;\r\n\r\nattribute vec2 a_position;\r\n\r\nvarying vec2 v_tex_position;\r\n\r\nvoid main() {\r\n    gl_Position = vec4(a_position, 0.0, 1.0);\r\n\r\n    v_tex_position = ((a_position / ${WI.toFixed(2)}) + 1.0) / 2.0;\r\n}\r\n`\r\n\r\nfunction makeSatValFragSrc(DEFINE_toRgb: string): string {\r\n    return `\r\n    precision highp float;\r\n\r\n    ${DEFINE_toRgb}\r\n    \r\n    varying vec2 v_tex_position;\r\n    \r\n    uniform vec3 u_color;\r\n    \r\n    void main() {\r\n        // mix saturation from left to right [0, 1]\r\n        // mix value from bottom to top: [0, 1]\r\n        float x = v_tex_position.x;\r\n        float y = v_tex_position.y;\r\n    \r\n        gl_FragColor = vec4(\r\n            toRgb(u_color.x, x, y),\r\n            1.0\r\n        );\r\n    }\r\n    `\r\n}\r\n\r\nconst SATVAL_FRAG_SRC_HSV = makeSatValFragSrc(`\r\n${DEFINE_hsvToRgb}\r\n\r\nvec3 toRgb(float hue, float x, float y) {\r\n    return hsvToRgb(vec3(hue, x, y));\r\n}\r\n`)\r\n\r\nconst SATVAL_FRAG_SRC_HSLUV = makeSatValFragSrc(`\r\n${DEFINE_hsluv_etc}\r\n\r\nvec3 toRgb(float hue, float x, float y) {\r\n    return hsluvToRgb(vec3(hue, x * 100.0, y * 100.0));\r\n}\r\n`)\r\n\r\nclass SatValRenderer {\r\n    private readonly buffer: WebGLBuffer\r\n    private colorLocation: WebGLUniformLocation | null = null\r\n    private program: WebGLProgram | null = null\r\n    private prevColorMode: ColorMode | null = null\r\n\r\n    constructor(private readonly gl: WebGLRenderingContext) {\r\n        this.buffer = gl.createBuffer() as WebGLBuffer\r\n        gl.bindBuffer(WebGLRenderingContext.ARRAY_BUFFER, this.buffer)\r\n        gl.bufferData(\r\n            WebGLRenderingContext.ARRAY_BUFFER,\r\n            new Float32Array([\r\n                // 1\r\n                WI,\r\n                WI,\r\n                // 2\r\n                -WI,\r\n                WI,\r\n                // 3\r\n                WI,\r\n                -WI,\r\n                // 4\r\n                -WI,\r\n                WI,\r\n                // 5\r\n                WI,\r\n                -WI,\r\n                // 6\r\n                -WI,\r\n                -WI,\r\n            ]),\r\n            WebGLRenderingContext.STATIC_DRAW\r\n        )\r\n    }\r\n\r\n    render(colorMode: ColorMode, color: Color.Hsluv): void {\r\n        const gl = this.gl\r\n\r\n        if (!this.program || this.prevColorMode !== colorMode) {\r\n            if (this.program) {\r\n                gl.deleteProgram(this.program)\r\n            }\r\n\r\n            switch (colorMode) {\r\n                case ColorMode.Hsv:\r\n                    this.program = createProgram(gl, SATVAL_VERT_SRC, SATVAL_FRAG_SRC_HSV)\r\n                    break\r\n                case ColorMode.Hsluv:\r\n                    this.program = createProgram(gl, SATVAL_VERT_SRC, SATVAL_FRAG_SRC_HSLUV)\r\n                    break\r\n                default:\r\n                    const never: never = colorMode\r\n                    throw { \"unexpected color mode\": colorMode }\r\n            }\r\n\r\n            gl.bindAttribLocation(this.program as WebGLProgram, 0, \"a_position\")\r\n            this.colorLocation = gl.getUniformLocation(\r\n                this.program as WebGLProgram,\r\n                \"u_color\"\r\n            ) as WebGLUniformLocation\r\n        }\r\n        gl.useProgram(this.program)\r\n        gl.bindBuffer(WebGLRenderingContext.ARRAY_BUFFER, this.buffer)\r\n\r\n        gl.vertexAttribPointer(0, 2, WebGLRenderingContext.FLOAT, false, 0, 0)\r\n        gl.enableVertexAttribArray(0)\r\n\r\n        switch (colorMode) {\r\n            case ColorMode.Hsv: {\r\n                const hsv = Color.rgbToHsv(Color.hsluvToRgb(color))\r\n                this.gl.uniform3f(this.colorLocation, hsv.h, hsv.s, hsv.v)\r\n                break\r\n            }\r\n            case ColorMode.Hsluv: {\r\n                this.gl.uniform3f(this.colorLocation, color.h, color.s, color.l)\r\n                break\r\n            }\r\n        }\r\n\r\n        gl.drawArrays(WebGLRenderingContext.TRIANGLES, 0, 6)\r\n\r\n        this.prevColorMode = colorMode\r\n    }\r\n\r\n    dispose(): void {\r\n        const gl = this.gl\r\n        gl.deleteBuffer(this.buffer)\r\n        gl.deleteProgram(this.program)\r\n    }\r\n}\r\n","import { SVG_NAMESPACE, _ } from \"ivi\"\r\nimport { svg, path } from \"ivi-svg\"\r\nimport Styles from \"./icons.scss\"\r\n\r\n// icons copied from https://github.com/google/material-design-icons\r\n\r\nconst attr24px = {\r\n    width: \"24\",\r\n    height: \"24\",\r\n    viewBox: \"0 0 24 24\",\r\n    xmlns: SVG_NAMESPACE,\r\n} as const\r\n\r\nconst attr48px = {\r\n    width: \"48\",\r\n    height: \"48\",\r\n    viewBox: \"0 0 48 48\",\r\n    xmlns: SVG_NAMESPACE,\r\n} as const\r\n\r\nexport const brush24px = svg(\r\n    Styles.icon,\r\n    attr24px,\r\n    path(_, {\r\n        d:\r\n            \"M7 14c-1.66 0-3 1.34-3 3 0 1.31-1.16 2-2 2 .92 1.22 2.49 2 4 2 2.21 0 4-1.79 4-4 0-1.66-1.34-3-3-3zm13.71-9.37l-1.34-1.34c-.39-.39-1.02-.39-1.41 0L9 12.25 11.75 15l8.96-8.96c.39-.39.39-1.02 0-1.41z\",\r\n    })\r\n)\r\n\r\nexport const brush48px = svg(\r\n    Styles.icon,\r\n    attr48px,\r\n    path(_, {\r\n        d:\r\n            \"M14 28c-3.31 0-6 2.69-6 6 0 2.62-2.31 4-4 4 1.84 2.44 4.99 4 8 4 4.42 0 8-3.58 8-8 0-3.31-2.69-6-6-6zM41.41 9.26l-2.67-2.67c-.78-.78-2.05-.78-2.83 0L18 24.5l5.5 5.5 17.91-17.91c.79-.79.79-2.05 0-2.83z\",\r\n    })\r\n)\r\n\r\nexport const edit24px = svg(\r\n    Styles.icon,\r\n    attr24px,\r\n    path(_, {\r\n        d:\r\n            \"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z\",\r\n    })\r\n)\r\n\r\nexport const edit48px = svg(\r\n    Styles.icon,\r\n    attr24px,\r\n    path(_, {\r\n        d:\r\n            \"M6 34.5V42h7.5l22.13-22.13-7.5-7.5L6 34.5zm35.41-20.41c.78-.78.78-2.05 0-2.83l-4.67-4.67c-.78-.78-2.05-.78-2.83 0l-3.66 3.66 7.5 7.5 3.66-3.66z\",\r\n    })\r\n)\r\n\r\nexport const search24px = svg(\r\n    Styles.icon,\r\n    attr24px,\r\n    path(_, {\r\n        d:\r\n            \"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z\",\r\n    })\r\n)\r\n\r\nexport const search48px = svg(\r\n    Styles.icon,\r\n    attr24px,\r\n    path(_, {\r\n        d:\r\n            \"M31 28h-1.59l-.55-.55C30.82 25.18 32 22.23 32 19c0-7.18-5.82-13-13-13S6 11.82 6 19s5.82 13 13 13c3.23 0 6.18-1.18 8.45-3.13l.55.55V31l10 9.98L40.98 38 31 28zm-12 0c-4.97 0-9-4.03-9-9s4.03-9 9-9 9 4.03 9 9-4.03 9-9 9z\",\r\n    })\r\n)\r\n","import { Op, _ } from \"ivi\"\r\nimport { div } from \"ivi-html\"\r\nimport * as styles from \"./inlineLabeled.scss\"\r\n\r\nexport interface InlineLabeledProps {\r\n    readonly label: string\r\n    readonly children: Op\r\n}\r\n\r\nexport function InlineLabeled({ label, children }: InlineLabeledProps): Op {\r\n    return div(styles.container, _, [div(styles.label, _, label), children])\r\n}\r\n","import { Op, _ } from \"ivi\"\r\nimport { div, p } from \"ivi-html\"\r\nimport * as styles from \"./labeled.scss\"\r\n\r\nexport interface LabledProps {\r\n    readonly label: string\r\n    readonly value: string\r\n    readonly children: Op\r\n}\r\n\r\nexport function Labeled({ label, value, children }: LabledProps): Op {\r\n    return div(styles.container, _, [\r\n        div(styles.textContainer, _, [p(styles.label, _, label), p(styles.label, _, value || \"\")]),\r\n        div(styles.content, _, children),\r\n    ])\r\n}\r\n","import {\r\n    DOMElementOp,\r\n    component,\r\n    Events,\r\n    onClick,\r\n    useEffect,\r\n    onBlur,\r\n    Ref,\r\n    OpState,\r\n    box,\r\n    invalidate,\r\n    onMouseDown,\r\n    findDOMNode,\r\n    _,\r\n    shallowEqual,\r\n} from \"ivi\"\r\nimport { div } from \"ivi-html\"\r\nimport * as styles from \"./menu.scss\"\r\nimport { ZipperList } from \"../../collections/zipperList\"\r\n\r\nexport interface MenuProps<a> {\r\n    readonly choices: ZipperList<a>\r\n    readonly show: (val: a) => string\r\n    readonly onSelect: (val: a) => void\r\n}\r\n\r\nfunction noOp() {}\r\n\r\nfunction Menu_<a>(c: OpState) {\r\n    const containerRef = box<OpState<HTMLDivElement> | null>(null)\r\n    let isExpanded = false\r\n    let selectHandler: (val: any) => void = noOp\r\n\r\n    function onGlobalClick(ev: MouseEvent) {\r\n        const containerNode = findDOMNode(containerRef)\r\n        let target = ev.target as HTMLElement\r\n        while (target.parentElement !== null) {\r\n            if (target === containerNode) {\r\n                return\r\n            }\r\n\r\n            target = target.parentElement\r\n        }\r\n        closeMenu()\r\n    }\r\n\r\n    function openMenu() {\r\n        isExpanded = true\r\n        invalidate(c)\r\n    }\r\n\r\n    function closeMenu() {\r\n        isExpanded = false\r\n        invalidate(c)\r\n    }\r\n\r\n    function closeAndCallback(val: a) {\r\n        selectHandler(val)\r\n        closeMenu()\r\n    }\r\n\r\n    const listenToMouse = useEffect<boolean>(c, isExpanded => {\r\n        if (!isExpanded) {\r\n            return\r\n        }\r\n        document.body.addEventListener(\"mousedown\", onGlobalClick, {\r\n            passive: true,\r\n        })\r\n        return () => {\r\n            document.body.removeEventListener(\"mousedown\", onGlobalClick)\r\n        }\r\n    })\r\n\r\n    return (props: MenuProps<a>) => {\r\n        listenToMouse(isExpanded)\r\n\r\n        selectHandler = props.onSelect\r\n        const containerNode = findDOMNode<HTMLDivElement>(containerRef)\r\n\r\n        return Events(\r\n            onBlur(closeMenu),\r\n            Ref(\r\n                containerRef,\r\n                div(styles.container, _, [\r\n                    Events(\r\n                        onMouseDown(isExpanded ? closeMenu : openMenu),\r\n                        div(\r\n                            isExpanded ? styles.selectedDisplayExpanded : styles.selectedDisplay,\r\n                            _,\r\n                            props.show(props.choices.focus)\r\n                        )\r\n                    ),\r\n                    !isExpanded\r\n                        ? null\r\n                        : div(\r\n                              styles.selectableOptions,\r\n                              {\r\n                                  style: {\r\n                                      \"margin-top\":\r\n                                          containerNode === null\r\n                                              ? _\r\n                                              : \"calc(-0.5rem - \" +\r\n                                                containerNode.getBoundingClientRect().height +\r\n                                                \"px)\",\r\n                                  },\r\n                              },\r\n                              // nesting fragments inside fragments seems to cause trouble\r\n                              [\r\n                                  div(\r\n                                      _,\r\n                                      _,\r\n                                      props.choices\r\n                                          .getLeft()\r\n                                          .map(val =>\r\n                                              Events(\r\n                                                  onClick(() => closeAndCallback(val)),\r\n                                                  div(styles.optionDefault, _, props.show(val))\r\n                                              )\r\n                                          )\r\n                                  ),\r\n                                  Events(\r\n                                      onClick(closeMenu),\r\n                                      div(styles.optionSelected, _, props.show(props.choices.focus))\r\n                                  ),\r\n                                  div(\r\n                                      _,\r\n                                      _,\r\n                                      props.choices\r\n                                          .getRight()\r\n                                          .map(val =>\r\n                                              Events(\r\n                                                  onClick(() => closeAndCallback(val)),\r\n                                                  div(styles.optionDefault, _, props.show(val))\r\n                                              )\r\n                                          )\r\n                                  ),\r\n                              ]\r\n                          ),\r\n                ])\r\n            )\r\n        )\r\n    }\r\n}\r\n\r\nexport const Menu = component(Menu_, shallowEqual) as <a>(\r\n    props: MenuProps<a>\r\n) => DOMElementOp<MenuProps<a>>\r\n","import { Op, _, statelessComponent, shallowEqual } from \"ivi\"\r\nimport { div } from \"ivi-html\"\r\nimport * as styles from \"./row.scss\"\r\n\r\nexport interface RowProps {\r\n    readonly spacing?: string\r\n    readonly children: readonly Op[]\r\n}\r\n\r\nexport const Row = statelessComponent<RowProps>(({ spacing, children }) => {\r\n    spacing = spacing || \"0\"\r\n    const spacedChildren = new Array<Op>(children.length)\r\n\r\n    if (children.length > 0) {\r\n        spacedChildren[0] = div(styles.column, _, children[0])\r\n        for (let i = 1; i < children.length; i++) {\r\n            spacedChildren[i] = div(\r\n                styles.column,\r\n                { style: { \"margin-left\": spacing } },\r\n                children[i]\r\n            )\r\n        }\r\n    }\r\n\r\n    return div(styles.row, _, spacedChildren)\r\n}, shallowEqual)\r\n","import {\r\n    Op,\r\n    box,\r\n    OpState,\r\n    component,\r\n    Ref,\r\n    onMouseDown,\r\n    Events,\r\n    invalidate,\r\n    useEffect,\r\n    findDOMNode,\r\n    _,\r\n} from \"ivi\"\r\nimport { div } from \"ivi-html\"\r\nimport { Hsv } from \"color\"\r\nimport * as styles from \"./slider.scss\"\r\nimport { clamp } from \"../../util\"\r\n\r\n// Generic slider\r\n\r\nexport interface SliderProps {\r\n    readonly percentage: number\r\n    readonly onChange: (pct: number) => void\r\n    readonly color?: Hsv\r\n}\r\n\r\nfunction noOp() {}\r\n\r\nexport const Slider = component<SliderProps>(c => {\r\n    const containerRef = box<OpState<HTMLDivElement> | null>(null)\r\n    let isDown = false\r\n    let handler: (pct: number) => void = noOp\r\n\r\n    function signal(ev: MouseEvent): void {\r\n        ev.preventDefault()\r\n        const bounds = findDOMNode<HTMLDivElement>(containerRef)!.getBoundingClientRect()\r\n        const Rem = 16\r\n        const dotWidth = Rem * 0.75\r\n        const width = bounds.width - dotWidth\r\n\r\n        const localX = clamp(0, width, ev.clientX - bounds.left - dotWidth / 2)\r\n\r\n        handler(localX / width)\r\n    }\r\n\r\n    function onDown(ev: MouseEvent) {\r\n        signal(ev)\r\n        isDown = true\r\n        invalidate(c)\r\n    }\r\n\r\n    function onUp() {\r\n        isDown = false\r\n        invalidate(c)\r\n    }\r\n\r\n    function onMove(ev: MouseEvent) {\r\n        if (isDown) {\r\n            signal(ev)\r\n        }\r\n    }\r\n\r\n    const listenToMouse = useEffect(c, () => {\r\n        document.body.addEventListener(\"mouseup\", onUp, { passive: true })\r\n        document.body.addEventListener(\"mousemove\", onMove, {\r\n            passive: true,\r\n        })\r\n        return () => {\r\n            document.body.removeEventListener(\"mouseup\", onUp)\r\n            document.body.removeEventListener(\"mousemove\", onMove)\r\n        }\r\n    })\r\n\r\n    return props => {\r\n        handler = props.onChange\r\n        listenToMouse()\r\n        const color = props.color !== undefined ? props.color.toStyle() : undefined\r\n        const percentage = Math.max(0, Math.min(1, props.percentage))\r\n\r\n        return Events(\r\n            onMouseDown(ev => onDown(ev), true),\r\n            Ref(\r\n                containerRef,\r\n                div(styles.container, _, [\r\n                    div(_, _, [\r\n                        div(percentage === 0 ? styles.emptyButton : styles.button, {\r\n                            style: {\r\n                                left: \"calc(\" + percentage + \" * calc(100% - 0.75rem))\",\r\n                                \"background-color\": color,\r\n                            },\r\n                        }),\r\n                        div(styles.filledLineClass, {\r\n                            style: {\r\n                                width: percentage * 100 + \"%\",\r\n                                \"background-color\": color,\r\n                            },\r\n                        }),\r\n                        div(styles.baseLine),\r\n                    ]),\r\n                ])\r\n            )\r\n        )\r\n    }\r\n})\r\n","import { Op, _ } from \"ivi\"\r\nimport { div } from \"ivi-html\"\r\nimport * as styles from \"./surface.scss\"\r\n\r\nexport const surfaceLook = styles.surfaceLook\r\n\r\nexport function Surface(children: Op) {\r\n    return div(styles.surface, _, children)\r\n}\r\n","import { Op, Events, onClick, shallowEqual, statelessComponent } from \"ivi\"\r\nimport { span } from \"ivi-html\"\r\nimport * as styles from \"./switch.scss\"\r\n\r\nexport interface SwitchProps {\r\n    readonly checked: boolean\r\n    readonly onCheck: (checked: boolean) => void\r\n}\r\n\r\nexport const Switch = statelessComponent<SwitchProps>(props => {\r\n    function handler() {\r\n        props.onCheck(!props.checked)\r\n    }\r\n\r\n    return Events(\r\n        onClick(handler),\r\n        span(styles.xswitch, undefined, [\r\n            span(\r\n                styles.switchButtonContainer,\r\n                {\r\n                    style: {\r\n                        transform: props.checked\r\n                            ? \"translate(0.75rem, -0.125rem)\"\r\n                            : \"translate(0, -0.125rem)\",\r\n                    },\r\n                },\r\n                span(\r\n                    styles.switchButton +\r\n                        \" \" +\r\n                        (props.checked ? styles.bgColorPrimary : styles.bgColorSecondary)\r\n                )\r\n            ),\r\n            span(styles.switchBar),\r\n        ])\r\n    )\r\n}, shallowEqual)\r\n","export * from \"./buttons\"\r\nexport * from \"./colorDisplay\"\r\nexport * from \"./colorWheel\"\r\nexport * from \"./icons\"\r\nexport * from \"./inlineLabeled\"\r\nexport * from \"./labeled\"\r\nexport * from \"./menu\"\r\nexport * from \"./row\"\r\nexport * from \"./slider\"\r\nexport * from \"./surface\"\r\nexport * from \"./switch\"\r\nimport * as Icons from \"./icons\"\r\nexport { Icons }\r\n","import { Vec2, Vec3, Vec4 } from \"../util\"\r\n\r\nexport * from \"./glsl\"\r\n\r\nexport function createProgram(\r\n    gl: WebGLRenderingContext,\r\n    vSrc: string,\r\n    fSrc: string\r\n): WebGLProgram | null {\r\n    const vShader = compileShader(gl, vSrc, WebGLRenderingContext.VERTEX_SHADER)\r\n    const fShader = compileShader(gl, fSrc, WebGLRenderingContext.FRAGMENT_SHADER)\r\n\r\n    if (vShader === null || fShader === null) {\r\n        return null\r\n    }\r\n\r\n    const program = gl.createProgram()\r\n\r\n    if (program === null) {\r\n        console.error(\"Failed to create program\")\r\n        return null\r\n    }\r\n\r\n    gl.attachShader(program, vShader)\r\n    gl.attachShader(program, fShader)\r\n\r\n    const linkedProgram = linkProgram(gl, program)\r\n\r\n    gl.deleteShader(vShader)\r\n    gl.deleteShader(fShader)\r\n\r\n    return linkedProgram\r\n}\r\n\r\nfunction compileShader(gl: WebGLRenderingContext, src: string, shaderType: number) {\r\n    const shader = gl.createShader(shaderType)\r\n    if (shader === null) {\r\n        console.error(\"Failed to create shader.\")\r\n        return null\r\n    }\r\n    gl.shaderSource(shader, src)\r\n    gl.compileShader(shader)\r\n\r\n    if (gl.getShaderParameter(shader, WebGLRenderingContext.COMPILE_STATUS)) return shader\r\n\r\n    console.group(\"Failed to compile shader\")\r\n    console.error(\"shader info log: \", gl.getShaderInfoLog(shader))\r\n    const prettySrc = withNumberedLines(src)\r\n    console.log(prettySrc)\r\n    console.groupEnd()\r\n    gl.deleteShader(shader)\r\n    return null\r\n}\r\n\r\nfunction linkProgram(gl: WebGLRenderingContext, program: WebGLProgram): WebGLProgram | null {\r\n    gl.linkProgram(program)\r\n    if (program !== null || gl.getProgramParameter(program, WebGLRenderingContext.LINK_STATUS))\r\n        return program\r\n\r\n    console.group(\"Failed to link program\")\r\n    console.error(\"error: \", gl.getError())\r\n    console.log(\r\n        \"validate status: \",\r\n        gl.getProgramParameter(program, WebGLRenderingContext.VALIDATE_STATUS)\r\n    )\r\n    console.log(\"program info log: \", gl.getProgramInfoLog(program))\r\n    console.groupEnd()\r\n\r\n    gl.deleteProgram(program)\r\n    return null\r\n}\r\n\r\nfunction withNumberedLines(src: string): string {\r\n    const lines = src.split(\"\\n\")\r\n\r\n    const lineNumberLength = lines.length.toString().length\r\n\r\n    return lines\r\n        .map((line, index) => padStart(index.toString(10), lineNumberLength, \"0\") + \"| \" + line)\r\n        .join(\"\\n\")\r\n}\r\n\r\nfunction padStart(text: string, length: number, fillChar: string): string {\r\n    const padCount = length - text.length\r\n    if (padCount <= 0) return text\r\n\r\n    const pad = []\r\n    for (let i = 0; i < padCount; i++) pad.push(fillChar)\r\n    pad.push(text)\r\n    return pad.join(\"\")\r\n}\r\n\r\nexport const enum UniformType {\r\n    I1,\r\n    F1,\r\n    F2,\r\n    F3,\r\n    F4,\r\n}\r\n\r\nexport type UniformNames<a> = { readonly [key in keyof a]: UniformType }\r\n\r\nexport type UniformsInfo<a extends UniformNames<a>> = { readonly [key in keyof a]: Uniform }\r\n\r\nexport class Uniform {\r\n    private nominal: void\r\n    constructor(readonly location: WebGLUniformLocation, readonly type: UniformType) {}\r\n}\r\n\r\nexport interface UniformArgMap {\r\n    readonly [UniformType.I1]: number\r\n    readonly [UniformType.F1]: number\r\n    readonly [UniformType.F2]: Vec2\r\n    readonly [UniformType.F3]: Vec3\r\n    readonly [UniformType.F4]: Vec4\r\n}\r\n\r\nexport type UniformArgs<a extends UniformNames<a>> = {\r\n    readonly [key in keyof a]: UniformArgMap[a[key]]\r\n}\r\n\r\nexport function getUniformLocation<a extends UniformNames<a>>(\r\n    gl: WebGLRenderingContext,\r\n    program: WebGLProgram,\r\n    uniforms: UniformNames<a>\r\n): UniformsInfo<a> | null {\r\n    const result: any = {}\r\n    const notFound: string[] = []\r\n    for (const propName in uniforms) {\r\n        if (!uniforms.hasOwnProperty(propName)) {\r\n            continue\r\n        }\r\n        const textureLoc = gl.getUniformLocation(program, propName)\r\n        if (textureLoc === null) {\r\n            notFound.push(propName)\r\n        } else {\r\n            result[propName] = new Uniform(textureLoc, uniforms[propName])\r\n        }\r\n    }\r\n\r\n    if (notFound.length === 0) {\r\n        return result as UniformsInfo<a>\r\n    }\r\n\r\n    let msg = \"Failed to find location for uniforms\"\r\n\r\n    for (let i = 0; i < notFound.length; i++) {\r\n        msg += \"\\n - \" + notFound[i]\r\n    }\r\n\r\n    console.error(msg)\r\n    return null\r\n}\r\n\r\nexport function updateUniforms<a extends UniformNames<a>>(\r\n    gl: WebGLRenderingContext,\r\n    uniforms: UniformsInfo<a>,\r\n    args: UniformArgs<a>\r\n) {\r\n    for (const propName in uniforms) {\r\n        if (!args.hasOwnProperty(propName)) {\r\n            continue\r\n        }\r\n        const uniform = uniforms[propName]\r\n        switch (uniform.type) {\r\n            case UniformType.I1: {\r\n                const arg = args[propName] as number\r\n                gl.uniform1i(uniform.location, arg)\r\n                break\r\n            }\r\n            case UniformType.F1: {\r\n                const arg = args[propName] as number\r\n                gl.uniform1f(uniform.location, arg)\r\n                break\r\n            }\r\n            case UniformType.F2: {\r\n                const arg = args[propName] as Vec2\r\n                gl.uniform2f(uniform.location, arg.x, arg.y)\r\n                break\r\n            }\r\n            case UniformType.F3: {\r\n                const arg = args[propName] as Vec3\r\n                gl.uniform3f(uniform.location, arg.x, arg.y, arg.z)\r\n                break\r\n            }\r\n            case UniformType.F4: {\r\n                const arg = args[propName] as Vec4\r\n                gl.uniform4f(uniform.location, arg.x, arg.y, arg.z, arg.w)\r\n                break\r\n            }\r\n\r\n            default:\r\n                const never: never = uniform.type\r\n                throw { \"unexpected type\": uniform }\r\n        }\r\n    }\r\n}\r\n\r\n// Not using anything but float current, but this will allow us to easily add other types later\r\nexport enum AttribType {\r\n    Float,\r\n}\r\n\r\nexport interface Attrib {\r\n    readonly name: string\r\n    readonly size: number\r\n    readonly type: AttribType\r\n}\r\n\r\nclass AttribInternal {\r\n    readonly name: string\r\n    readonly size: number\r\n    readonly glType: number\r\n    readonly bytes: number\r\n\r\n    constructor(attrib: Attrib) {\r\n        this.name = attrib.name\r\n        this.size = attrib.size\r\n        switch (attrib.type) {\r\n            case AttribType.Float:\r\n                this.glType = WebGLRenderingContext.FLOAT\r\n                this.bytes = attrib.size * 4\r\n                break\r\n            default:\r\n                const never: never = attrib.type\r\n                throw { \"Unexpected type on attribute\": attrib }\r\n        }\r\n    }\r\n}\r\n\r\nexport class AttributesInfo {\r\n    readonly size: number\r\n    readonly stride: number\r\n    readonly attributes: readonly AttribInternal[]\r\n\r\n    constructor(attributes: readonly Attrib[]) {\r\n        {\r\n            let attributes_ = new Array<AttribInternal>(attributes.length)\r\n            for (let i = 0; i < attributes.length; i++) {\r\n                const attrib = attributes[i]\r\n                attributes_[i] = new AttribInternal(attrib)\r\n            }\r\n            this.attributes = attributes_\r\n        }\r\n        {\r\n            let totalSize = 0\r\n            for (let i = 0; i < this.attributes.length; i++) {\r\n                totalSize += this.attributes[i].size\r\n            }\r\n            this.size = totalSize\r\n            this.stride = totalSize * 4\r\n        }\r\n    }\r\n\r\n    bindAttribLocations(gl: WebGLRenderingContext, program: WebGLProgram): void {\r\n        const { attributes } = this\r\n        for (let i = 0; i < attributes.length; i++) {\r\n            gl.bindAttribLocation(program, i, attributes[i].name)\r\n        }\r\n    }\r\n\r\n    vertexAttrib(gl: WebGLRenderingContext): void {\r\n        const { attributes } = this\r\n\r\n        let sizeOffset = 0\r\n        for (let i = 0; i < attributes.length; i++) {\r\n            const attrib = attributes[i]\r\n            gl.vertexAttribPointer(i, attrib.size, attrib.glType, false, this.stride, sizeOffset)\r\n            sizeOffset += attrib.bytes\r\n        }\r\n\r\n        for (let i = 0; i < attributes.length; i++) {\r\n            gl.enableVertexAttribArray(i)\r\n        }\r\n    }\r\n\r\n    getDrawCount(offset: number): number {\r\n        return offset / this.size\r\n    }\r\n}\r\n\r\nexport namespace Blend {\r\n    export const enum Mode {\r\n        Normal,\r\n        Erase,\r\n    }\r\n\r\n    export interface Factors {\r\n        readonly sfact: number\r\n        readonly dfact: number\r\n    }\r\n\r\n    export const factorsNormal = {\r\n        sfact: WebGLRenderingContext.ONE,\r\n        dfact: WebGLRenderingContext.ONE_MINUS_SRC_ALPHA,\r\n    }\r\n\r\n    export const factorsErase = {\r\n        sfact: WebGLRenderingContext.ZERO,\r\n        dfact: WebGLRenderingContext.ONE_MINUS_SRC_ALPHA,\r\n    }\r\n\r\n    export function getFactors(mode: Mode): Factors {\r\n        switch (mode) {\r\n            case Mode.Normal:\r\n                return factorsNormal\r\n            case Mode.Erase:\r\n                return factorsErase\r\n        }\r\n    }\r\n}\r\n","export const DEFINE_TAU = `#ifndef TAU\r\n    #define TAU 6.283185307179586\r\n#endif`\r\n\r\nexport const DEFINE_from_linear = `\r\nfloat from_linear(float c) {\r\n    return c <= 0.0031308 \r\n        ? c * 12.92\r\n        : pow(c * 1.055, 1.0 / 2.4) - 0.055;\r\n}\r\n\r\nvec3 from_linear(vec3 color) {\r\n    return vec3(from_linear(color.x), from_linear(color.y), from_linear(color.z));\r\n}\r\n`\r\nexport const DEFINE_to_linear = `\r\nfloat to_linear(float c) {\r\n    return c > 0.04045\r\n        ? pow((c + 0.055) / (1.0 + 0.055), 2.4)\r\n        : c / 12.92;\r\n}\r\n\r\nvec3 to_linear(vec3 color) {\r\n    return vec3(to_linear(color.x), to_linear(color.y), to_linear(color.z));\r\n}\r\n`\r\n\r\n// credit: http://lolengine.net/blog/2013/07/27/rgb-to-hsv-in-glsl - Sam Hocevar\r\nexport const DEFINE_hsvToRgb = `\r\nvec3 hsvToRgb(in vec3 c) {\r\n    vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\r\n    vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\r\n    return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\r\n}`\r\n\r\n// credit: https://www.shadertoy.com/view/MsS3Wc - Iñigo Quiles\r\n// export const DEFINE_hsv2rgb = `vec3 hsv2rgb(in vec3 c) {\r\n//     vec3 rgb = clamp(abs(mod(c.x * 6.0 + vec3(0.0, 4.0, 2.0), 6.0) - 3.0) - 1.0, 0.0, 1.0);\r\n//     rgb = rgb * rgb * (3.0 - 2.0 * rgb);\r\n//     return c.z * mix(vec3(1.0), rgb, c.y);\r\n// }`\r\n\r\n/*\r\n    credit: https://github.com/williammalo/hsluv-glsl\r\n*/\r\nexport const DEFINE_hsluv_etc = `\r\nvec3 hsluv_intersectLineLine(vec3 line1x, vec3 line1y, vec3 line2x, vec3 line2y) {\r\n    return (line1y - line2y) / (line2x - line1x);\r\n}\r\n\r\nvec3 hsluv_distanceFromPole(vec3 pointx,vec3 pointy) {\r\n    return sqrt(pointx*pointx + pointy*pointy);\r\n}\r\n\r\nvec3 hsluv_lengthOfRayUntilIntersect(float theta, vec3 x, vec3 y) {\r\n    vec3 len = y / (sin(theta) - x * cos(theta));\r\n    if (len.r < 0.0) {len.r=1000.0;}\r\n    if (len.g < 0.0) {len.g=1000.0;}\r\n    if (len.b < 0.0) {len.b=1000.0;}\r\n    return len;\r\n}\r\n\r\nfloat hsluv_maxSafeChromaForL(float L){\r\n    mat3 m2 = mat3(\r\n         3.2409699419045214  ,-0.96924363628087983 , 0.055630079696993609,\r\n        -1.5373831775700935  , 1.8759675015077207  ,-0.20397695888897657 ,\r\n        -0.49861076029300328 , 0.041555057407175613, 1.0569715142428786  \r\n    );\r\n    float sub0 = L + 16.0;\r\n    float sub1 = sub0 * sub0 * sub0 * .000000641;\r\n    float sub2 = sub1 > 0.0088564516790356308 ? sub1 : L / 903.2962962962963;\r\n\r\n    vec3 top1   = (284517.0 * m2[0] - 94839.0  * m2[2]) * sub2;\r\n    vec3 bottom = (632260.0 * m2[2] - 126452.0 * m2[1]) * sub2;\r\n    vec3 top2   = (838422.0 * m2[2] + 769860.0 * m2[1] + 731718.0 * m2[0]) * L * sub2;\r\n\r\n    vec3 bounds0x = top1 / bottom;\r\n    vec3 bounds0y = top2 / bottom;\r\n\r\n    vec3 bounds1x =              top1 / (bottom+126452.0);\r\n    vec3 bounds1y = (top2-769860.0*L) / (bottom+126452.0);\r\n\r\n    vec3 xs0 = hsluv_intersectLineLine(bounds0x, bounds0y, -1.0/bounds0x, vec3(0.0) );\r\n    vec3 xs1 = hsluv_intersectLineLine(bounds1x, bounds1y, -1.0/bounds1x, vec3(0.0) );\r\n\r\n    vec3 lengths0 = hsluv_distanceFromPole( xs0, bounds0y + xs0 * bounds0x );\r\n    vec3 lengths1 = hsluv_distanceFromPole( xs1, bounds1y + xs1 * bounds1x );\r\n\r\n    return  min(lengths0.r,\r\n            min(lengths1.r,\r\n            min(lengths0.g,\r\n            min(lengths1.g,\r\n            min(lengths0.b,\r\n                lengths1.b)))));\r\n}\r\n\r\nfloat hsluv_maxChromaForLH(float L, float H) {\r\n\r\n    float hrad = radians(H);\r\n\r\n    mat3 m2 = mat3(\r\n         3.2409699419045214  ,-0.96924363628087983 , 0.055630079696993609,\r\n        -1.5373831775700935  , 1.8759675015077207  ,-0.20397695888897657 ,\r\n        -0.49861076029300328 , 0.041555057407175613, 1.0569715142428786  \r\n    );\r\n    float sub1 = pow(L + 16.0, 3.0) / 1560896.0;\r\n    float sub2 = sub1 > 0.0088564516790356308 ? sub1 : L / 903.2962962962963;\r\n\r\n    vec3 top1   = (284517.0 * m2[0] - 94839.0  * m2[2]) * sub2;\r\n    vec3 bottom = (632260.0 * m2[2] - 126452.0 * m2[1]) * sub2;\r\n    vec3 top2   = (838422.0 * m2[2] + 769860.0 * m2[1] + 731718.0 * m2[0]) * L * sub2;\r\n\r\n    vec3 bound0x = top1 / bottom;\r\n    vec3 bound0y = top2 / bottom;\r\n\r\n    vec3 bound1x =              top1 / (bottom+126452.0);\r\n    vec3 bound1y = (top2-769860.0*L) / (bottom+126452.0);\r\n\r\n    vec3 lengths0 = hsluv_lengthOfRayUntilIntersect(hrad, bound0x, bound0y );\r\n    vec3 lengths1 = hsluv_lengthOfRayUntilIntersect(hrad, bound1x, bound1y );\r\n\r\n    return  min(lengths0.r,\r\n            min(lengths1.r,\r\n            min(lengths0.g,\r\n            min(lengths1.g,\r\n            min(lengths0.b,\r\n                lengths1.b)))));\r\n}\r\n\r\nfloat hsluv_fromLinear(float c) {\r\n    return c <= 0.0031308 ? 12.92 * c : 1.055 * pow(c, 1.0 / 2.4) - 0.055;\r\n}\r\nvec3 hsluv_fromLinear(vec3 c) {\r\n    return vec3( hsluv_fromLinear(c.r), hsluv_fromLinear(c.g), hsluv_fromLinear(c.b) );\r\n}\r\n\r\nfloat hsluv_toLinear(float c) {\r\n    return c > 0.04045 ? pow((c + 0.055) / (1.0 + 0.055), 2.4) : c / 12.92;\r\n}\r\n\r\nvec3 hsluv_toLinear(vec3 c) {\r\n    return vec3( hsluv_toLinear(c.r), hsluv_toLinear(c.g), hsluv_toLinear(c.b) );\r\n}\r\n\r\nfloat hsluv_yToL(float Y){\r\n    return Y <= 0.0088564516790356308 ? Y * 903.2962962962963 : 116.0 * pow(Y, 1.0 / 3.0) - 16.0;\r\n}\r\n\r\nfloat hsluv_lToY(float L) {\r\n    return L <= 8.0 ? L / 903.2962962962963 : pow((L + 16.0) / 116.0, 3.0);\r\n}\r\n\r\nvec3 xyzToRgb(vec3 tuple) {\r\n    const mat3 m = mat3( \r\n        3.2409699419045214  ,-1.5373831775700935 ,-0.49861076029300328 ,\r\n       -0.96924363628087983 , 1.8759675015077207 , 0.041555057407175613,\r\n        0.055630079696993609,-0.20397695888897657, 1.0569715142428786  );\r\n    \r\n    return hsluv_fromLinear(tuple*m);\r\n}\r\n\r\nvec3 rgbToXyz(vec3 tuple) {\r\n    const mat3 m = mat3(\r\n        0.41239079926595948 , 0.35758433938387796, 0.18048078840183429 ,\r\n        0.21263900587151036 , 0.71516867876775593, 0.072192315360733715,\r\n        0.019330818715591851, 0.11919477979462599, 0.95053215224966058 \r\n    );\r\n    return hsluv_toLinear(tuple) * m;\r\n}\r\n\r\nvec3 xyzToLuv(vec3 tuple){\r\n    float X = tuple.x;\r\n    float Y = tuple.y;\r\n    float Z = tuple.z;\r\n\r\n    float L = hsluv_yToL(Y);\r\n    \r\n    float div = 1./dot(tuple,vec3(1,15,3)); \r\n\r\n    return vec3(\r\n        1.,\r\n        (52. * (X*div) - 2.57179),\r\n        (117.* (Y*div) - 6.08816)\r\n    ) * L;\r\n}\r\n\r\n\r\nvec3 luvToXyz(vec3 tuple) {\r\n    float L = tuple.x;\r\n\r\n    float U = tuple.y / (13.0 * L) + 0.19783000664283681;\r\n    float V = tuple.z / (13.0 * L) + 0.468319994938791;\r\n\r\n    float Y = hsluv_lToY(L);\r\n    float X = 2.25 * U * Y / V;\r\n    float Z = (3./V - 5.)*Y - (X/3.);\r\n\r\n    return vec3(X, Y, Z);\r\n}\r\n\r\nvec3 luvToLch(vec3 tuple) {\r\n    float L = tuple.x;\r\n    float U = tuple.y;\r\n    float V = tuple.z;\r\n\r\n    float C = length(tuple.yz);\r\n    float H = degrees(atan(V,U));\r\n    if (H < 0.0) {\r\n        H = 360.0 + H;\r\n    }\r\n    \r\n    return vec3(L, C, H);\r\n}\r\n\r\nvec3 lchToLuv(vec3 tuple) {\r\n    float hrad = radians(tuple.b);\r\n    return vec3(\r\n        tuple.r,\r\n        cos(hrad) * tuple.g,\r\n        sin(hrad) * tuple.g\r\n    );\r\n}\r\n\r\nvec3 hsluvToLch(vec3 tuple) {\r\n    tuple.g *= hsluv_maxChromaForLH(tuple.b, tuple.r) * .01;\r\n    return tuple.bgr;\r\n}\r\n\r\nvec3 lchToHsluv(vec3 tuple) {\r\n    tuple.g /= hsluv_maxChromaForLH(tuple.r, tuple.b) * .01;\r\n    return tuple.bgr;\r\n}\r\n\r\nvec3 hpluvToLch(vec3 tuple) {\r\n    tuple.g *= hsluv_maxSafeChromaForL(tuple.b) * .01;\r\n    return tuple.bgr;\r\n}\r\n\r\nvec3 lchToHpluv(vec3 tuple) {\r\n    tuple.g /= hsluv_maxSafeChromaForL(tuple.r) * .01;\r\n    return tuple.bgr;\r\n}\r\n\r\nvec3 lchToRgb(vec3 tuple) {\r\n    return xyzToRgb(luvToXyz(lchToLuv(tuple)));\r\n}\r\n\r\nvec3 rgbToLch(vec3 tuple) {\r\n    return luvToLch(xyzToLuv(rgbToXyz(tuple)));\r\n}\r\n\r\nvec3 hsluvToRgb(vec3 tuple) {\r\n    return lchToRgb(hsluvToLch(tuple));\r\n}\r\n\r\nvec3 rgbToHsluv(vec3 tuple) {\r\n    return lchToHsluv(rgbToLch(tuple));\r\n}\r\n\r\nvec3 hpluvToRgb(vec3 tuple) {\r\n    return lchToRgb(hpluvToLch(tuple));\r\n}\r\n\r\nvec3 rgbToHpluv(vec3 tuple) {\r\n    return lchToHpluv(rgbToLch(tuple));\r\n}\r\n\r\nvec3 luvToRgb(vec3 tuple){\r\n    return xyzToRgb(luvToXyz(tuple));\r\n}\r\n`\r\n","'use strict';\r\n\r\nObject.defineProperty(exports, '__esModule', { value: true });\r\n\r\nclass Rgb {\r\n    constructor(r, g, b) {\r\n        this.r = r;\r\n        this.g = g;\r\n        this.b = b;\r\n    }\r\n    static fromCss(css) {\r\n        css = css.replace(/[ \\t]/, \"\");\r\n        if (css.startsWith(\"rgb(\"))\r\n            return parseRgbCss(css.substr(4, css.length - 5));\r\n        if (css.startsWith(\"#\")) {\r\n            return parseHexCss(css.substr(1));\r\n        }\r\n        return parseHexCss(css);\r\n    }\r\n    is(other) {\r\n        return this.r === other.r && this.g === other.g && this.b === other.b;\r\n    }\r\n    toRgb() {\r\n        return this;\r\n    }\r\n    with({ r, g, b }) {\r\n        return new Rgb(r !== undefined ? r : this.r, g !== undefined ? g : this.g, b !== undefined ? b : this.b);\r\n    }\r\n    toStyle() {\r\n        return `rgb(${floatToByte(this.r)},${floatToByte(this.g)},${floatToByte(this.b)})`;\r\n    }\r\n    toLinear() {\r\n        return new RgbLinear(toLinear(this.r), toLinear(this.g), toLinear(this.b));\r\n    }\r\n    toString() {\r\n        return \"Rgb(\" + this.r + \", \" + this.g + \", \" + this.b + \")\";\r\n    }\r\n}\r\nclass RgbLinear {\r\n    constructor(r, g, b) {\r\n        this.r = r;\r\n        this.g = g;\r\n        this.b = b;\r\n    }\r\n    is(other) {\r\n        return this.r === other.r && this.g === other.g && this.b === other.b;\r\n    }\r\n    with({ r, g, b, }) {\r\n        return new RgbLinear(r !== undefined ? r : this.r, g !== undefined ? g : this.g, b !== undefined ? b : this.b);\r\n    }\r\n    mix(pct, other) {\r\n        return new RgbLinear(lerp(pct, this.r, other.r), lerp(pct, this.g, other.g), lerp(pct, this.b, other.b));\r\n    }\r\n    lighten(pct) {\r\n        return this.mix(pct, RgbLinear.White);\r\n    }\r\n    darken(pct) {\r\n        return this.mix(pct, RgbLinear.Black);\r\n    }\r\n    fromLinear() {\r\n        return new Rgb(fromLinear(this.r), fromLinear(this.g), fromLinear(this.b));\r\n    }\r\n    toString() {\r\n        return \"LinearRgb(\" + this.r + \", \" + this.g + \", \" + this.b + \")\";\r\n    }\r\n}\r\nRgbLinear.White = new RgbLinear(1, 1, 1);\r\nRgbLinear.Black = new RgbLinear(0, 0, 0);\r\nfunction toLinear(c) {\r\n    return c > 0.04045 ? Math.pow(((c + 0.055) / 1.055), 2.4) : c / 12.92;\r\n}\r\nfunction fromLinear(c) {\r\n    return c <= 0.0031308 ? c * 12.92 : Math.pow(c * 1.055, 1.0 / 2.4) - 0.055;\r\n}\r\nfunction floatToByte(x) {\r\n    return (x * 255.9999999) | 0;\r\n}\r\nfunction validateRgb(r, g, b) {\r\n    if (isNaN(r) || !isFinite(r))\r\n        return null;\r\n    if (isNaN(g) || !isFinite(g))\r\n        return null;\r\n    if (isNaN(b) || !isFinite(b))\r\n        return null;\r\n    return new Rgb(r, g, b);\r\n}\r\nfunction parseRgbCss(css) {\r\n    const vals = css.split(\",\");\r\n    if (vals.length !== 3)\r\n        return null;\r\n    const r = Number.parseFloat(vals[0]) / 255;\r\n    const g = Number.parseFloat(vals[1]) / 255;\r\n    const b = Number.parseFloat(vals[2]) / 255;\r\n    return validateRgb(r, g, b);\r\n}\r\nfunction parseHexCss(css) {\r\n    if (css.length === 3) {\r\n        const r = parseHex(css[0]) / 15;\r\n        const g = parseHex(css[1]) / 15;\r\n        const b = parseHex(css[2]) / 15;\r\n        return validateRgb(r, g, b);\r\n    }\r\n    if (css.length === 6) {\r\n        const r = parseHexPair(css[0], css[1]);\r\n        const g = parseHexPair(css[2], css[3]);\r\n        const b = parseHexPair(css[4], css[5]);\r\n        return validateRgb(r, g, b);\r\n    }\r\n    return null;\r\n}\r\nfunction parseHexPair(l, r) {\r\n    return (parseHex(l) * 16 + parseHex(r)) / 255;\r\n}\r\nfunction parseHex(hex) {\r\n    const lcHex = hex.toLowerCase();\r\n    switch (lcHex) {\r\n        case \"0\":\r\n            return 0;\r\n        case \"1\":\r\n            return 1;\r\n        case \"2\":\r\n            return 2;\r\n        case \"3\":\r\n            return 3;\r\n        case \"4\":\r\n            return 4;\r\n        case \"5\":\r\n            return 5;\r\n        case \"6\":\r\n            return 6;\r\n        case \"7\":\r\n            return 7;\r\n        case \"8\":\r\n            return 8;\r\n        case \"9\":\r\n            return 9;\r\n        case \"a\":\r\n            return 10;\r\n        case \"b\":\r\n            return 11;\r\n        case \"c\":\r\n            return 12;\r\n        case \"d\":\r\n            return 13;\r\n        case \"e\":\r\n            return 14;\r\n        case \"f\":\r\n            return 15;\r\n        default:\r\n            return NaN;\r\n    }\r\n}\r\nfunction lerp(pct, from, to) {\r\n    return from + pct * to;\r\n}\r\n\r\nclass Hsv {\r\n    constructor(h, s, v) {\r\n        this.h = h;\r\n        this.s = s;\r\n        this.v = v;\r\n        this.__cachedRgb = null;\r\n    }\r\n    is(other) {\r\n        return this.h === other.h && this.s === other.s && this.v === other.v;\r\n    }\r\n    toRgb() {\r\n        if (this.__cachedRgb === null) {\r\n            this.__cachedRgb = hsvToRgb(this);\r\n        }\r\n        return this.__cachedRgb;\r\n    }\r\n    toStyle() {\r\n        return this.toRgb().toStyle();\r\n    }\r\n    with({ h, s, v }) {\r\n        return new Hsv(h !== undefined ? h : this.h, s !== undefined ? s : this.s, v !== undefined ? v : this.v);\r\n    }\r\n    toString() {\r\n        return \"Hsv(\" + this.h + \", \" + this.s + \", \" + this.v + \")\";\r\n    }\r\n}\r\nfunction rgbToHsv({ r, g, b }) {\r\n    const maxValue = Math.max(r, g, b);\r\n    const minValue = Math.min(r, g, b);\r\n    const d = maxValue - minValue;\r\n    const s = maxValue === 0 ? 0 : d / maxValue;\r\n    let h;\r\n    switch (maxValue) {\r\n        case minValue:\r\n            h = 0;\r\n            break;\r\n        case r:\r\n            h = (g - b) / d + (g < b ? 6.0 : 0.0);\r\n            break;\r\n        case g:\r\n            h = (b - r) / d + 2.0;\r\n            break;\r\n        default:\r\n            h = (r - g) / d + 4.0;\r\n            break;\r\n    }\r\n    return new Hsv(h / 6, s, maxValue);\r\n}\r\nfunction hsvToRgb({ h, s, v }) {\r\n    const i = (h * 6) | 0;\r\n    const f = h * 6 - i;\r\n    const p = v * (1 - s);\r\n    const q = v * (1 - f * s);\r\n    const t = v * (1 - (1 - f) * s);\r\n    let r;\r\n    let g;\r\n    let b;\r\n    switch (i % 6) {\r\n        case 0:\r\n            r = v;\r\n            g = t;\r\n            b = p;\r\n            break;\r\n        case 1:\r\n            r = q;\r\n            g = v;\r\n            b = p;\r\n            break;\r\n        case 2:\r\n            r = p;\r\n            g = v;\r\n            b = t;\r\n            break;\r\n        case 3:\r\n            r = p;\r\n            g = q;\r\n            b = v;\r\n            break;\r\n        case 4:\r\n            r = t;\r\n            g = p;\r\n            b = v;\r\n            break;\r\n        default:\r\n            r = v;\r\n            g = p;\r\n            b = q;\r\n            break;\r\n    }\r\n    return new Rgb(r, g, b);\r\n}\r\n\r\n/* Hsluv vs Hsl:\r\n    http://www.hsluv.org/comparison/\r\n\r\n    Implementation based on:\r\n   https://github.com/dvdplm/rust-hsluv/blob/master/src/lib.rs\r\n   https://github.com/hsluv/hsluv-csharp/blob/master/Hsluv/Hsluv.cs\r\n\r\n   TODO: Consider having all the transformation functions taking a mutable vector as input and modifying it, rather than creating a new one.\r\n\r\n   the pure transformation functions can be implemented on top of these efficient impure functions\r\n\r\n   it would be a loss in performance for one-step transformations like rgb -> rgbLinear\r\n   but it would be a performance gain for multi-step transformations such as rgb -> hsluv\r\n*/\r\nclass Vec2 {\r\n    constructor(x, y) {\r\n        this.x = x;\r\n        this.y = y;\r\n    }\r\n}\r\nclass Vec3 {\r\n    constructor(x, y, z) {\r\n        this.x = x;\r\n        this.y = y;\r\n        this.z = z;\r\n    }\r\n}\r\nclass Luv {\r\n    constructor(l, u, v) {\r\n        this.l = l;\r\n        this.u = u;\r\n        this.v = v;\r\n    }\r\n}\r\nclass Hsluv {\r\n    constructor(h, s, l) {\r\n        this.h = h;\r\n        this.s = s;\r\n        this.l = l;\r\n        this.__cachedRgb = null;\r\n    }\r\n    is(other) {\r\n        return this.h === other.h && this.s === other.s && this.l === other.l;\r\n    }\r\n    with({ h, s, l }) {\r\n        return new Hsluv(h !== undefined ? h : this.h, s !== undefined ? s : this.s, l !== undefined ? l : this.l);\r\n    }\r\n    toRgb() {\r\n        if (this.__cachedRgb === null) {\r\n            this.__cachedRgb = hsluvToRgb(this);\r\n        }\r\n        return this.__cachedRgb;\r\n    }\r\n    toStyle() {\r\n        const style = this.toRgb().toStyle();\r\n        return style;\r\n    }\r\n    toString() {\r\n        return \"Hsluv(\" + this.h + \", \" + this.s + \", \" + this.l + \")\";\r\n    }\r\n}\r\nclass Hpluv {\r\n    constructor(h, p, l) {\r\n        this.h = h;\r\n        this.p = p;\r\n        this.l = l;\r\n        this.__cachedRgb = null;\r\n    }\r\n    is(other) {\r\n        return this.h === other.h && this.p === other.p && this.l === other.l;\r\n    }\r\n    with({ h, p, l }) {\r\n        return new Hpluv(h !== undefined ? h : this.h, p !== undefined ? p : this.p, l !== undefined ? l : this.l);\r\n    }\r\n    toRgb() {\r\n        if (this.__cachedRgb === null) {\r\n            this.__cachedRgb = hpluvToRgb(this);\r\n        }\r\n        return this.__cachedRgb;\r\n    }\r\n    toStyle() {\r\n        return this.toRgb().toStyle();\r\n    }\r\n    toString() {\r\n        return \"Hsv(\" + this.h + \", \" + this.p + \", \" + this.l + \")\";\r\n    }\r\n}\r\nclass Lch {\r\n    constructor(l, c, h) {\r\n        this.l = l;\r\n        this.c = c;\r\n        this.h = h;\r\n    }\r\n}\r\nclass Xyz {\r\n    constructor(x, y, z) {\r\n        this.x = x;\r\n        this.y = y;\r\n        this.z = z;\r\n    }\r\n}\r\n/*\r\n    m =\r\n        [ 3.240969941904521, -1.537383177570093, -0.498610760293\r\n        , -0.96924363628087, 1.87596750150772, 0.041555057407175\r\n        , 0.055630079696993, -0.20397695888897, 1.056971514242878\r\n        ]\r\n\r\n    mInv =\r\n        [ 0.41239079926595, 0.35758433938387, 0.18048078840183\r\n        , 0.21263900587151, 0.71516867876775, 0.072192315360733\r\n        , 0.019330818715591, 0.11919477979462, 0.95053215224966\r\n        ]\r\n*/\r\nconst m = [\r\n    new Vec3(3.240969941904521, -1.537383177570093, -0.498610760293),\r\n    new Vec3(-0.96924363628087, 1.87596750150772, 0.041555057407175),\r\n    new Vec3(0.055630079696993, -0.20397695888897, 1.056971514242878),\r\n];\r\nconst mInv = [\r\n    new Vec3(0.41239079926595, 0.35758433938387, 0.18048078840183),\r\n    new Vec3(0.21263900587151, 0.71516867876775, 0.072192315360733),\r\n    new Vec3(0.019330818715591, 0.11919477979462, 0.95053215224966),\r\n];\r\nconst refY = 1.0;\r\nconst refU = 0.19783000664283;\r\nconst refV = 0.46831999493879;\r\nconst kappa = 903.2962962;\r\nconst epsilon = 0.0088564516;\r\nfunction degreesToRadians(deg) {\r\n    return (deg * Math.PI) / 180.0;\r\n}\r\nfunction radiansToDegrees(rad) {\r\n    return (rad * 180.0) / Math.PI;\r\n}\r\nfunction lengthOfRayUntilIntersect(theta, vec) {\r\n    const length = vec.y / (Math.sin(theta) - vec.x * Math.cos(theta));\r\n    if (length < 0.0) {\r\n        return -0.0001;\r\n    }\r\n    else {\r\n        return length;\r\n    }\r\n}\r\nfunction getBounds(l) {\r\n    const sub1 = Math.pow((l + 16), 3) / 1560896;\r\n    const sub2 = sub1 > epsilon ? sub1 : l / kappa;\r\n    const bounds = new Array(3 * 2);\r\n    // TODO: unwrap loop\r\n    // can I also inline the matrix's values?\r\n    for (let c = 0; c < 3; c++) {\r\n        const m1 = m[c].x;\r\n        const m2 = m[c].y;\r\n        const m3 = m[c].z;\r\n        for (let t = 0; t < 2; t++) {\r\n            const top1 = (284517 * m1 - 94839 * m3) * sub2;\r\n            const top2 = (838422 * m3 + 769860 * m2 + 731718 * m1) * l * sub2 - 769860 * t * l;\r\n            const bottom = (632260 * m3 - 126452 * m2) * sub2 + 126452 * t;\r\n            bounds[c * 2 + t] = new Vec2(top1 / bottom, top2 / bottom);\r\n        }\r\n    }\r\n    return bounds;\r\n}\r\nfunction distance(x, y) {\r\n    return Math.sqrt(x * x + y * y);\r\n}\r\nfunction intersectLineLine(vec1, vec2) {\r\n    return (vec1.y - vec2.y) / (vec2.x - vec1.x);\r\n}\r\nfunction maxSafeChromaForL(l) {\r\n    const bounds = getBounds(l);\r\n    let min = Number.MAX_VALUE;\r\n    for (let i = 0; i < 2; ++i) {\r\n        const line = bounds[i];\r\n        // TODO: inline\r\n        const x = intersectLineLine(line, new Vec2(-1 / line.x, 0));\r\n        const length = distance(x, line.y + x * line.x);\r\n        if (length < min)\r\n            min = length;\r\n    }\r\n    return min;\r\n}\r\nfunction maxChromaForLH(l, h) {\r\n    const hrad = (h / 360.0) * Math.PI * 2.0;\r\n    const bounds = getBounds(l);\r\n    let min = Number.MAX_VALUE;\r\n    for (let i = 0; i < bounds.length; i++) {\r\n        // TODO: inline\r\n        const length = lengthOfRayUntilIntersect(hrad, bounds[i]);\r\n        if (length >= 0 && length < min)\r\n            min = length;\r\n    }\r\n    return min;\r\n}\r\nfunction funF(t) {\r\n    if (t > epsilon) {\r\n        return 116 * Math.pow((t / refY), (1 / 3)) - 16;\r\n    }\r\n    else {\r\n        return (t / refY) * kappa;\r\n    }\r\n}\r\nfunction funFInv(t) {\r\n    if (t > 8.0) {\r\n        return Math.pow((refY * ((t + 16.0) / 116.0)), 3.0);\r\n    }\r\n    else {\r\n        return (refY * t) / kappa;\r\n    }\r\n}\r\nfunction fromLinear$1(c) {\r\n    if (c <= 0.0031308) {\r\n        return 12.92 * c;\r\n    }\r\n    else {\r\n        return 1.055 * Math.pow(c, (1.0 / 2.4)) - 0.055;\r\n    }\r\n}\r\nfunction luvToLch({ l, u, v }) {\r\n    const c = distance(u, v);\r\n    if (c < 0.00000001) {\r\n        return new Lch(l, c, 0);\r\n    }\r\n    const h = radiansToDegrees(Math.atan2(v, u));\r\n    if (h < 0.0) {\r\n        return new Lch(l, c, h + 360);\r\n    }\r\n    else {\r\n        return new Lch(l, c, h);\r\n    }\r\n}\r\nfunction lchToLuv({ l, c, h }) {\r\n    const hrad = degreesToRadians(h);\r\n    const u = Math.cos(hrad) * c;\r\n    const v = Math.sin(hrad) * c;\r\n    return new Luv(l, u, v);\r\n}\r\nfunction mat3map(fn, mat) {\r\n    return [fn(mat[0]), fn(mat[1]), fn(mat[2])];\r\n}\r\nfunction rgbToXyz(rgb) {\r\n    const lrgb = rgb.toLinear();\r\n    // todo: unwrap map\r\n    const xyz = mat3map(vec => lrgb.r * vec.x + lrgb.g * vec.y + lrgb.b * vec.z, mInv);\r\n    return new Xyz(xyz[0], xyz[1], xyz[2]);\r\n}\r\nfunction xyzToRgb(xyz) {\r\n    // todo: unwrap map\r\n    const rgb = mat3map(vec => fromLinear$1(xyz.x * vec.x + xyz.y * vec.y + xyz.z * vec.z), m);\r\n    return new Rgb(rgb[0], rgb[1], rgb[2]);\r\n}\r\nfunction lchToHsluv({ l, c, h }) {\r\n    if (l > 99.9999999) {\r\n        return new Hsluv(h, 0, 100);\r\n    }\r\n    if (l < 0.00000001) {\r\n        return new Hsluv(h, 0, 0);\r\n    }\r\n    const mx = maxChromaForLH(l, h);\r\n    const s = (c / mx) * 100;\r\n    return new Hsluv(h, s, l);\r\n}\r\nfunction hsluvToLch({ h, s, l }) {\r\n    if (l > 99.9999999) {\r\n        return new Lch(100, 0.0, h);\r\n    }\r\n    if (l < 0.00000001) {\r\n        return new Lch(0, 0, h);\r\n    }\r\n    const mx = maxChromaForLH(l, h);\r\n    const c = (mx / 100) * s;\r\n    return new Lch(l, c, h);\r\n}\r\nfunction lchToHpluv({ l, c, h }) {\r\n    if (l > 99.9999999) {\r\n        return new Hpluv(h, 0, 100);\r\n    }\r\n    if (l < 0.00000001) {\r\n        return new Hpluv(h, 0, 0);\r\n    }\r\n    const mx = maxSafeChromaForL(l);\r\n    const p = (c / mx) * 100;\r\n    return new Hpluv(h, p, l);\r\n}\r\nfunction hpluvToLch({ h, p, l }) {\r\n    if (l > 99.9999999) {\r\n        return new Lch(100, 0, h);\r\n    }\r\n    if (l < 0.00000001) {\r\n        return new Lch(0, 0, h);\r\n    }\r\n    const mx = maxSafeChromaForL(l);\r\n    const c = (mx / 100) * p;\r\n    return new Lch(l, c, h);\r\n}\r\nfunction luvToRgb(luv) {\r\n    return xyzToRgb(luvToXyz(luv));\r\n}\r\nfunction rgbToLch(rgb) {\r\n    return luvToLch(xyzToLuv(rgbToXyz(rgb)));\r\n}\r\nfunction lchToRgb(lch) {\r\n    return xyzToRgb(luvToXyz(lchToLuv(lch)));\r\n}\r\nfunction rgbToHsluv(rgb) {\r\n    return lchToHsluv(rgbToLch(rgb));\r\n}\r\nfunction hsluvToRgb(hsluv) {\r\n    return lchToRgb(hsluvToLch(hsluv));\r\n}\r\nfunction rgbToHpluv(rgb) {\r\n    return lchToHpluv(rgbToLch(rgb));\r\n}\r\nfunction hpluvToRgb(hpluv) {\r\n    return lchToRgb(hpluvToLch(hpluv));\r\n}\r\nfunction xyzToLuv({ x, y, z }) {\r\n    if (x === 0 && y === 0 && z === 0) {\r\n        return new Luv(0, 0, 0);\r\n    }\r\n    const l = funF(y);\r\n    if (l === 0) {\r\n        return new Luv(0, 0, 0);\r\n    }\r\n    const u = 13 * l * ((4 * x) / (x + 15 * y + 3 * z) - refU);\r\n    const v = 13 * l * ((9 * y) / (x + 15 * y + 3 * z) - refV);\r\n    return new Luv(l, u, v);\r\n}\r\nfunction luvToXyz({ l, u, v }) {\r\n    if (l === 0) {\r\n        return new Xyz(0, 0, 0);\r\n    }\r\n    const initU = u / (13 * l) + refU;\r\n    const initV = v / (13 * l) + refV;\r\n    const y = funFInv(l) * refY;\r\n    const x = 0 - (9 * y * initU) / ((initU - 4) * initV - initU * initV);\r\n    const z = (9 * y - 15 * initV * y - initV * x) / (3 * initV);\r\n    return new Xyz(x, y, z);\r\n}\r\nfunction toGray({ r, g, b }) {\r\n    const gray = Math.sqrt(0.299 * r * r + 0.587 * g * g + 0.114 * b * b);\r\n    return new Rgb(gray, gray, gray);\r\n}\r\n\r\nexports.Rgb = Rgb;\r\nexports.RgbLinear = RgbLinear;\r\nexports.Hsv = Hsv;\r\nexports.rgbToHsv = rgbToHsv;\r\nexports.hsvToRgb = hsvToRgb;\r\nexports.Luv = Luv;\r\nexports.Hsluv = Hsluv;\r\nexports.Hpluv = Hpluv;\r\nexports.Lch = Lch;\r\nexports.Xyz = Xyz;\r\nexports.luvToLch = luvToLch;\r\nexports.lchToLuv = lchToLuv;\r\nexports.rgbToXyz = rgbToXyz;\r\nexports.xyzToRgb = xyzToRgb;\r\nexports.lchToHsluv = lchToHsluv;\r\nexports.hsluvToLch = hsluvToLch;\r\nexports.lchToHpluv = lchToHpluv;\r\nexports.hpluvToLch = hpluvToLch;\r\nexports.luvToRgb = luvToRgb;\r\nexports.rgbToLch = rgbToLch;\r\nexports.lchToRgb = lchToRgb;\r\nexports.rgbToHsluv = rgbToHsluv;\r\nexports.hsluvToRgb = hsluvToRgb;\r\nexports.rgbToHpluv = rgbToHpluv;\r\nexports.hpluvToRgb = hpluvToRgb;\r\nexports.xyzToLuv = xyzToLuv;\r\nexports.luvToXyz = luvToXyz;\r\nexports.toGray = toGray;\r\n//# sourceMappingURL=index.js.map\r\n","/**\n * Shortcuts for DOM methods and properties are used to reduce megamorphic callsites in the codebase.\n *\n * In many synthetic microbenchmarks it is most likely will be slower, unless synthetic benchmark is implemented with\n * many different html/svg elements. But it is definitely should make it faster in complex real applications.\n *\n * Since Chrome 74, issue with native accessors is finally fixed: https://bugs.chromium.org/p/v8/issues/detail?id=8820\n */\n/**\n * `Object.getOwnPropertyDescriptor(o, p)`\n *\n * @param o Object.\n * @param p Property name.\n * @returns Property Descriptor.\n */\nconst getDescriptor = (o, p) => Object.getOwnPropertyDescriptor(o, p);\nconst nodeProto = process.env.IVI_TARGET === \"ssr\" ? void 0 : Node.prototype;\nconst elementProto = process.env.IVI_TARGET === \"ssr\" ? void 0 : Element.prototype;\n/**\n * Shortcut for a `Document`.\n */\nexport const doc = (process.env.IVI_TARGET === \"ssr\" ? void 0 : document);\n/**\n * Shortcut for an `Object.prototype.hasOwnProperty`.\n */\nexport const objectHasOwnProperty = Object.prototype.hasOwnProperty;\n/**\n * Shortcut for a `Node.prototype.insertBefore`.\n */\nexport const nodeInsertBefore = process.env.IVI_TARGET === \"ssr\" ? void 0 : nodeProto.insertBefore;\n/**\n * Shortcut for a `Node.prototype.removeChild`.\n */\nexport const nodeRemoveChild = process.env.IVI_TARGET === \"ssr\" ? void 0 : nodeProto.removeChild;\n/**\n * Shortcut for a `Node.prototype.replaceChild`.\n */\nexport const nodeReplaceChild = process.env.IVI_TARGET === \"ssr\" ? void 0 : nodeProto.replaceChild;\n/**\n * Shortcut for a `Node.prototype.cloneNode`.\n */\nexport const nodeCloneNode = process.env.IVI_TARGET === \"ssr\" ? void 0 : nodeProto.cloneNode;\n/**\n * Shortcut for an `Element.prototype.setAttribute`.\n */\nexport const elementSetAttribute = process.env.IVI_TARGET === \"ssr\" ? void 0 : elementProto.setAttribute;\n/**\n * Shortcut for an `Element.prototype.setAttributeNS`.\n */\nexport const elementSetAttributeNS = process.env.IVI_TARGET === \"ssr\" ? void 0 : elementProto.setAttributeNS;\n/**\n * Shortcut for an `Element.prototype.removeAttribute`.\n */\nexport const elementRemoveAttribute = process.env.IVI_TARGET === \"ssr\" ? void 0 : elementProto.removeAttribute;\n/**\n * Shortcut for a `Node.textContent = value`.\n */\nexport const nodeSetTextContent = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    getDescriptor(nodeProto, \"textContent\").set);\n/**\n * Shortcut for an `Element.className = value`.\n */\nexport const elementSetClassName = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    getDescriptor(elementProto, \"className\").set);\n/**\n * Shortcut for a `HTMLElement.style`.\n */\nexport const htmlElementGetStyle = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    getDescriptor(HTMLElement.prototype, \"style\").get);\n/**\n * Shortcut for a `SVGElement.style`.\n */\nexport const svgElementGetStyle = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    getDescriptor(SVGElement.prototype, \"style\").get);\n//# sourceMappingURL=shortcuts.js.map","/**\n * Shortcut for an `undefined` value.\n */\nexport const _ = void 0;\n//# sourceMappingURL=shortcuts.js.map","import { createOpType, createContainerOp } from \"./operations\";\n/**\n * Current context.\n */\nlet n = null;\n/**\n * Used for detecting invalid `ContextDescriptor()` invocations in DEBUG mode.\n */\nlet contextEnabled = false;\n/**\n * Enable checking for invalid `context()` invocations in DEBUG mode.\n */\nexport function enableContext() {\n    contextEnabled = true;\n}\n/**\n * Disable checking for invalid `context()` invocations in DEBUG mode.\n */\nexport function disableContext() {\n    contextEnabled = false;\n}\n/**\n * Reset current context.\n */\nexport function resetContext() {\n    n = null;\n}\n/**\n * pushContext creates a new context state and pushes it to the context stack.\n *\n * @param d Context descriptor.\n * @param v Context value.\n * @returns New {@link ContextState}.\n */\nexport function pushContext(d, v) {\n    return n = { n, d, v };\n}\n/**\n * getContext retrieves current context.\n *\n * @returns current context.\n */\nexport function getContext() {\n    return n;\n}\n/**\n * setContext assigns current context.\n *\n * Should be executed before going deeper into context node.\n *\n * @param c Current context.\n */\nexport function setContext(c) {\n    return n = c;\n}\n/**\n * contextValue creates a context descriptor.\n *\n * @example\n *\n *     const { set: StoreContext, get: getStore } = contextValue<Store>();\n *     const Component = component((c) => {\n *       const getValue = useSelect(c, () => getStore().value);\n *       return () => getValue();\n *     });\n *     render(\n *       StoreContext(store,\n *         Component(),\n *       ),\n *       container,\n *     );\n *\n * @returns {@link ContextDescriptor}\n */\nexport function contextValue() {\n    let type;\n    const d = {\n        get: () => {\n            /* istanbul ignore else */\n            if (process.env.NODE_ENV !== \"production\") {\n                if (!contextEnabled) {\n                    throw Error(\"Invalid context invocation\");\n                }\n            }\n            let next = n;\n            while (next !== null) {\n                if (next.d === d) {\n                    return next.v;\n                }\n                next = next.n;\n            }\n            /* istanbul ignore else */\n            if (process.env.NODE_ENV !== \"production\") {\n                throw Error(\"Unable to find context value\");\n            }\n        },\n        set: (v, c) => createContainerOp(type, v, c),\n    };\n    type = createOpType(32 /* Context */, d);\n    return d;\n}\n//# sourceMappingURL=context.js.map","const ERROR_HANDLERS = [];\nlet error = false;\n/**\n * addErrorHandler adds an error handler for errors catched by functions decorated with `catchError()`.\n *\n * @param handler error handler.\n */\nexport function addErrorHandler(handler) {\n    ERROR_HANDLERS.push(handler);\n}\nexport function catchError(fn) {\n    return function () {\n        if (!error) {\n            try {\n                return fn.apply(void 0, arguments);\n            }\n            catch (e) {\n                error = true;\n                ERROR_HANDLERS.forEach((h) => { h(e); });\n                throw e;\n            }\n        }\n    };\n}\n//# sourceMappingURL=error.js.map","/**\n * append pushes item to an array and automatically creates a new array when it doesn't exist.\n *\n * @typeparam T Item type.\n * @param array Array.\n * @param item Item to append.\n * @returns Array.\n */\nexport const append = (array, item) => array === null ? [item] : (array.push(item), array);\n/**\n * unorderedArrayDeleteByIndex deletes item from an array with O(1) complexity.\n *\n * It swaps item at `index` position with the last item and removes the last one.\n *\n * @typeparam T Item type.\n * @param array Array.\n * @param index Index of an item to delete.\n */\nexport function unorderedArrayDeleteByIndex(array, index) {\n    const length = array.length - 1;\n    const last = array.pop();\n    if (index !== length) {\n        array[index] = last;\n    }\n}\n/**\n * unorderedArrayDelete deletes item from an array with O(1) complexity.\n *\n * It swaps item at `index` position with the last item and deletes the last one.\n *\n * @typeparam T Item type.\n * @param array Array.\n * @param item Item to delete.\n */\nexport function unorderedArrayDelete(array, item) {\n    const index = array.indexOf(item);\n    /* istanbul ignore else */\n    if (process.env.NODE_ENV !== \"production\") {\n        if (index === -1) {\n            throw new Error(`Failed to delete an item from an array, item doesn't exist in the array`);\n        }\n    }\n    unorderedArrayDeleteByIndex(array, index);\n}\n//# sourceMappingURL=array.js.map","import { unorderedArrayDeleteByIndex } from \"./array\";\n/**\n * runRepeatableTasks runs repeatable tasks.\n *\n * @param tasks Repeatable tasks.\n */\nexport function runRepeatableTasks(tasks) {\n    for (let i = 0; i < tasks.length; ++i) {\n        if (tasks[i]() === true) {\n            unorderedArrayDeleteByIndex(tasks, i--);\n        }\n    }\n}\n//# sourceMappingURL=repeatable_task_list.js.map","import { NOOP, catchError, runRepeatableTasks, box, TASK_TOKEN } from \"../core\";\nimport { printWarn } from \"../debug/print\";\nimport { doc } from \"../dom/shortcuts\";\nimport { ROOTS, findRoot, dirtyCheck } from \"../vdom/root\";\n/**\n * Execute tasks from the `TaskList`.\n *\n * @param t - Task list\n */\nfunction run(t) {\n    while (t.v.length > 0) {\n        const tasks = t.v;\n        t.v = [];\n        for (let i = 0; i < tasks.length; ++i) {\n            tasks[i](TASK_TOKEN);\n        }\n    }\n}\nlet _flags = 0;\nlet _debugFlags = 0;\nlet _frameStartTime = 0;\nlet _clock = 1;\nconst _resolvedPromise = Promise.resolve();\nconst _microtasks = box([]);\nconst _mutationEffects = box([]);\nconst _layoutEffects = box([]);\nconst _beforeMutations = [];\nconst _afterMutations = [];\n/**\n * withSchedulerTick wraps `inner` function into a scheduler context execution.\n *\n * @typeparam T Arguments.\n * @param inner Inner function.\n * @returns function that will be executed in a scheduler context.\n */\nexport const withSchedulerTick = (inner) => (catchError(function () {\n    _flags |= 1 /* Running */;\n    inner.apply(void 0, arguments);\n    run(_microtasks);\n    _flags &= ~(1 /* Running */ | 2 /* TickPending */);\n    ++_clock;\n}));\nconst runMicrotasks = withSchedulerTick(NOOP);\n/**\n * clock returns monotonically increasing clock value.\n *\n * @returns current clock value.\n */\nexport const clock = () => _clock;\n/**\n * scheduleMicrotask adds task to the microtask queue.\n *\n * @param task Microtask.\n */\nexport function scheduleMicrotask(task) {\n    _microtasks.v.push(task);\n    if ((_flags & (1 /* Running */ | 2 /* TickPending */)) === 0) {\n        _flags |= 2 /* TickPending */;\n        _resolvedPromise.then(runMicrotasks);\n    }\n}\n/**\n * beforeMutations adds a hook that will be executed before DOM mutations.\n *\n * @param fn Hook function.\n */\nexport function beforeMutations(fn) {\n    _beforeMutations.push(fn);\n}\n/**\n * afterMutations adds a hook that will be executed after DOM mutations.\n *\n * @param fn Hook function.\n */\nexport function afterMutations(fn) {\n    _afterMutations.push(fn);\n}\n/**\n * frameStartTime returns current frame start time.\n *\n * @returns current frame start time.\n */\nexport const frameStartTime = () => _frameStartTime;\n/**\n * withNextFrame wraps `inner` function into a scheduler frame update context.\n *\n * @param inner Inner function.\n * @returns function that will be executed in a frame update context.\n */\nexport const withNextFrame = (inner) => (withSchedulerTick((time) => {\n    _flags |= 16 /* UpdatingFrame */;\n    inner(time);\n    if ((_flags & 4 /* NextFramePending */) !== 0) {\n        if (time !== void 0) {\n            _frameStartTime = time;\n        }\n        runRepeatableTasks(_beforeMutations);\n        if ((_flags & 32 /* DirtyCheckPending */) !== 0) {\n            dirtyCheck();\n        }\n        /* istanbul ignore else */\n        if (process.env.NODE_ENV !== \"production\") {\n            _debugFlags |= 1 /* DirtyCheckingFinished */;\n        }\n        run(_mutationEffects);\n        /* istanbul ignore else */\n        if (process.env.NODE_ENV !== \"production\") {\n            _debugFlags |= 2 /* MutationsFinished */;\n        }\n        runRepeatableTasks(_afterMutations);\n        run(_layoutEffects);\n        /* istanbul ignore else */\n        if (process.env.NODE_ENV !== \"production\") {\n            _debugFlags |= 4 /* LayoutFinished */;\n        }\n    }\n    _flags &= ~(16 /* UpdatingFrame */ |\n        4 /* NextFramePending */ |\n        8 /* NextSyncFramePending */ |\n        32 /* DirtyCheckPending */);\n    /* istanbul ignore else */\n    if (process.env.NODE_ENV !== \"production\") {\n        _debugFlags &= ~(1 /* DirtyCheckingFinished */ |\n            2 /* MutationsFinished */ |\n            4 /* LayoutFinished */);\n    }\n}));\n/**\n * Frame tasks scheduler event handler.\n *\n * @param t Current time.\n */\nconst _handleNextFrame = withNextFrame(NOOP);\nconst _handleNextFrameSync = () => { _handleNextFrame(); };\n/**\n * requestNextFrame requests an update for next frame.\n *\n * @param flags See {@link UpdateFlags} for details.\n */\nexport function requestNextFrame(flags) {\n    if ((flags !== void 0) &&\n        ((flags & 1 /* RequestSyncUpdate */) !== 0) &&\n        ((_flags & 8 /* NextSyncFramePending */) === 0)) {\n        _flags |= 4 /* NextFramePending */ | 8 /* NextSyncFramePending */;\n        if ((_flags & 16 /* UpdatingFrame */) === 0) {\n            scheduleMicrotask(_handleNextFrameSync);\n        }\n    }\n    else if ((_flags & 4 /* NextFramePending */) === 0) {\n        _flags |= 4 /* NextFramePending */;\n        if ((_flags & 16 /* UpdatingFrame */) === 0) {\n            requestAnimationFrame(_handleNextFrame);\n        }\n    }\n}\n/**\n * Adds a write DOM task to the queue.\n *\n * @param fn Write DOM task.\n * @param flags See {@link UpdateFlags} for details.\n */\nexport function scheduleMutationEffect(fn, flags) {\n    /* istanbul ignore else */\n    if (process.env.NODE_ENV !== \"production\") {\n        if (_flags & 16 /* UpdatingFrame */) {\n            if (_debugFlags & 2 /* MutationsFinished */) {\n                printWarn(\"Mutation effect is scheduled after mutations were finished\");\n            }\n        }\n    }\n    _mutationEffects.v.push(fn);\n    requestNextFrame(flags);\n}\n/**\n * Adds a DOM layout task to the queue.\n *\n * @param fn Read DOM task\n * @param flags See {@link UpdateFlags} for details.\n */\nexport function scheduleLayoutEffect(fn, flags) {\n    /* istanbul ignore else */\n    if (process.env.NODE_ENV !== \"production\") {\n        if (_flags & 16 /* UpdatingFrame */) {\n            if (_debugFlags & 2 /* MutationsFinished */) {\n                printWarn(\"Layout effect is scheduled after layout were finished\");\n            }\n        }\n    }\n    _layoutEffects.v.push(fn);\n    requestNextFrame(flags);\n}\n/**\n * Request dirty checking.\n *\n * @param flags See {@link UpdateFlags} for details.\n */\nexport function requestDirtyCheck(flags) {\n    /* istanbul ignore else */\n    if (process.env.NODE_ENV !== \"production\") {\n        if (_flags & 16 /* UpdatingFrame */) {\n            if (_debugFlags & 2 /* MutationsFinished */) {\n                printWarn(\"Dirty checking is scheduled after dirty checking were finished\");\n            }\n        }\n    }\n    _flags |= 32 /* DirtyCheckPending */;\n    requestNextFrame(flags);\n}\n/**\n * Invalidate component.\n *\n * @param c Component instance.\n * @param flags See {@link UpdateFlags} for details.\n */\nexport function invalidate(c, flags) {\n    c.f |= 1024 /* Dirty */;\n    requestDirtyCheck(flags);\n}\n/**\n * dirty requests a dirty checking and returns current monotonic clock value.\n *\n * @param flags See {@link UpdateFlags} for details.\n * @returns current monotonic clock value.\n */\nexport const dirty = (flags) => (requestDirtyCheck(flags), _clock);\n/**\n * Render operation into the container.\n *\n * @param next Operation to render.\n * @param container DOM Node that will contain rendered operation.\n * @param flags See {@link UpdateFlags} for details.\n */\nexport function render(next, container, flags) {\n    /* istanbul ignore else */\n    if (process.env.NODE_ENV !== \"production\") {\n        /**\n         * Rendering into the <body> element is disabled to make it possible to fix iOS quirk with click events.\n         */\n        if (container === doc.body) {\n            throw new Error(\"Rendering into the <body> element aren't allowed\");\n        }\n        if (!doc.body.contains(container)) {\n            throw new Error(\"Container element should be attached to the document\");\n        }\n    }\n    const root = findRoot((v) => v.container === container);\n    if (root) {\n        root.next = next;\n    }\n    else {\n        ROOTS.push({ container, state: null, next });\n    }\n    requestDirtyCheck(flags);\n}\n//# sourceMappingURL=index.js.map","/**\n * createOpType creates {@link OpType} instances.\n *\n * @param f See {@link NodeFlags} for details.\n * @param d Operation type descriptor.\n * @returns {@link OpType} instance.\n */\nexport const createOpType = (f, d) => ({ f, d });\n/**\n * OpType for Events nodes.\n */\nexport const EVENTS = createOpType(16 /* Events */, null);\n/**\n * OpType for Context state nodes.\n */\nexport const SET_CONTEXT_STATE = createOpType(32 /* Context */ | 8192 /* SetContextState */, null);\n/**\n * OpType for TrackByKey nodes.\n */\nexport const TRACK_BY_KEY = createOpType(8 /* TrackByKey */, null);\n/**\n * createValueOp creates a {@link ValueOp} instance.\n *\n * @typeparam T Operation data type.\n * @param t Operation type.\n * @param v Operation value.\n * @returns {@link ValueOp} instance.\n */\nexport const createValueOp = (t, v) => ({ t, v });\n/**\n * createContainerOp creates a {@link ContainerOp} instance.\n *\n * @typeparam T Operation data type.\n * @param t Operation type.\n * @param v Operation value.\n * @param c Operation children.\n * @returns {@link ContainerOp} instance.\n */\nexport const createContainerOp = (t, v, c) => ({ t, v, c });\n/**\n * createDOMElementOp creates a {@link DOMElementOp} instance.\n *\n * @typeparam T Operation data type.\n * @param t Operation type.\n * @param v Operation value.\n * @param c Operation children.\n * @param n Class name.\n * @returns {@link DOMElementOp} instance.\n */\nexport const createDOMElementOp = (t, v, c, n) => ({ t, v, c, n });\n/**\n * Operation factory for event handlers.\n *\n * @example\n *\n *     render(\n *       Events(onClick(() => { console.log(\"clicked\"); }),\n *         ChildComponent(),\n *       ),\n *       DOMContainer,\n *     );\n *\n * @param v Event handlers.\n * @param c Children operation nodes.\n * @returns Events handler operation.\n */\nexport const Events = (v, c) => createContainerOp(EVENTS, v, c);\n/**\n * Operation factory for set context state operation.\n *\n * @param v Context state.\n * @param c Children operation nodes.\n * @returns Set context state operation.\n */\nexport const SetContextState = (v, c) => createContainerOp(SET_CONTEXT_STATE, v, c);\n/**\n * key creates a {@link Key} instance.\n *\n * @typeparam K Key type.\n * @typeparam V Value type.\n * @param k Key.\n * @param v Value.\n * @returns {@link Key} instance.\n */\nexport const key = (k, v) => ({ k, v });\n/**\n * Operation factory for track by key nodes.\n *\n * @example\n *\n *     const items = [1, 2, 3];\n *     render(\n *       TrackByKey(items.map((item) => key(item, div(_, _, item))),\n *       DOMContainer,\n *     );\n *\n * @typeparam K Key type.\n * @param items Keyed operations.\n * @returns Track by key operation.\n */\nexport const TrackByKey = process.env.NODE_ENV !== \"production\" ?\n    (items) => {\n        const keys = new Set();\n        for (let i = 0; i < items.length; i++) {\n            const { k } = items[i];\n            if (keys.has(k)) {\n                throw new Error(`Invalid key, found duplicated key: ${k}`);\n            }\n            keys.add(k);\n        }\n        return createValueOp(TRACK_BY_KEY, items);\n    } :\n    /* istanbul ignore next */ (items) => createValueOp(TRACK_BY_KEY, items);\n//# sourceMappingURL=operations.js.map","import { elementSetAttributeNS, XML_NAMESPACE, XLINK_NAMESPACE, svgElementFactory, elementRemoveAttribute, emitAttribute, escapeAttributeValue, } from \"ivi\";\nconst ATTRIBUTE_DIRECTIVE_SET_XML_ATTR_EMPTY = {\n    v: \"\",\n    u: updateXMLAttr,\n};\nconst ATTRIBUTE_DIRECTIVE_SET_XML_ATTR_EMPTY_RENDER_TO_STRING = {\n    v: \"\",\n    s: (key, value) => { emitAttribute(`xml:${key}`); },\n};\nconst ATTRIBUTE_DIRECTIVE_SET_XLINK_ATTR_EMPTY = {\n    v: \"\",\n    u: updateXLinkAttr,\n};\nconst ATTRIBUTE_DIRECTIVE_SET_XLINK_ATTR_EMPTY_RENDER_TO_STRING = {\n    v: \"\",\n    s: (key, value) => { emitAttribute(`xlink:${key}`); },\n};\nfunction renderToStringXMLAttr(key, value) {\n    emitAttribute(`xml:${key}=\"${escapeAttributeValue(value)}\"`);\n}\nfunction renderToStringXLinkAttr(key, value) {\n    emitAttribute(`xlink:${key}=\"${escapeAttributeValue(value)}\"`);\n}\nfunction updateNSAttr(element, ns, key, prev, next) {\n    if (prev !== next) {\n        if (next === void 0) {\n            elementRemoveAttribute.call(element, key);\n        }\n        else {\n            elementSetAttributeNS.call(element, ns, key, next);\n        }\n    }\n}\n/**\n * Update function for an {@link AttributeDirective} created with {@link XML_ATTR} function.\n *\n * @param element - Target element\n * @param key - Attribute key\n * @param prev - Previous value\n * @param next - Next value\n */\nfunction updateXMLAttr(element, key, prev, next) {\n    updateNSAttr(element, XML_NAMESPACE, key, prev, next);\n}\n/**\n * Update function for an {@link AttributeDirective} created with {@link XLINK_ATTR} function.\n *\n * @param element - Target element\n * @param key - Attribute key\n * @param prev - Previous value\n * @param next - Next value\n */\nfunction updateXLinkAttr(element, key, prev, next) {\n    updateNSAttr(element, XLINK_NAMESPACE, key, prev, next);\n}\n/**\n * XML_ATTR function creates an {@link AttributeDirective} that assigns an attribute from XML namespace, attribute name\n * is derived from the `key`.\n *\n * @example\n *\n *   const e = circle(\"\", { \"xml:text\": XML_ATTR(\"abc\") });\n *\n * @param v Value.\n * @returns {@link AttributeDirective}\n */\nexport const XML_ATTR = (v) => (process.env.IVI_TARGET === \"ssr\" ?\n    v === \"\" ? ATTRIBUTE_DIRECTIVE_SET_XML_ATTR_EMPTY_RENDER_TO_STRING : { v, s: renderToStringXMLAttr } :\n    v === \"\" ? ATTRIBUTE_DIRECTIVE_SET_XML_ATTR_EMPTY : { v, u: updateXMLAttr });\n/**\n * XLINK_ATTR function creates an {@link AttributeDirective} that assigns an attribute from XLINK namespace, attribute\n * name is derived from the `key`.\n *\n * @example\n *\n *   const e = circle(\"\", { \"xlink:text\": XLINK_ATTR(\"abc\") });\n *\n * @param v Value.\n * @returns {@link AttributeDirective}\n */\nexport const XLINK_ATTR = (v) => (process.env.IVI_TARGET === \"ssr\" ?\n    v === \"\" ? ATTRIBUTE_DIRECTIVE_SET_XLINK_ATTR_EMPTY_RENDER_TO_STRING : { v, s: renderToStringXLinkAttr } :\n    v === \"\" ? ATTRIBUTE_DIRECTIVE_SET_XLINK_ATTR_EMPTY : { v, u: updateXLinkAttr });\n/* tslint:disable:max-line-length */\n/**\n * Creates OpNode SVG element <a>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/SVG/Element/a}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode SVG element <a>\n */\nexport const a = /*#__PURE__*/ svgElementFactory(\"a\");\n/**\n * Creates OpNode SVG element <animate>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/SVG/Element/animate}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode SVG element <animate>\n */\nexport const animate = /*#__PURE__*/ svgElementFactory(\"animate\");\n/**\n * Creates OpNode SVG element <animateColor>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/SVG/Element/animateColor}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode SVG element <animateColor>\n */\nexport const animateColor = /*#__PURE__*/ svgElementFactory(\"animateColor\");\n/**\n * Creates OpNode SVG element <animateMotion>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/SVG/Element/animateMotion}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode SVG element <animateMotion>\n */\nexport const animateMotion = /*#__PURE__*/ svgElementFactory(\"animateMotion\");\n/**\n * Creates OpNode SVG element <animateTransform>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/SVG/Element/animateTransform}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode SVG element <animateTransform>\n */\nexport const animateTransform = /*#__PURE__*/ svgElementFactory(\"animateTransform\");\n/**\n * Creates OpNode SVG element <circle>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/SVG/Element/circle}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode SVG element <circle>\n */\nexport const circle = /*#__PURE__*/ svgElementFactory(\"circle\");\n/**\n * Creates OpNode SVG element <clipPath>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/SVG/Element/clipPath}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode SVG element <clipPath>\n */\nexport const clipPath = /*#__PURE__*/ svgElementFactory(\"clipPath\");\n/**\n * Creates OpNode SVG element <defs>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/SVG/Element/defs}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode SVG element <defs>\n */\nexport const defs = /*#__PURE__*/ svgElementFactory(\"defs\");\n/**\n * Creates OpNode SVG element <desc>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/SVG/Element/desc}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode SVG element <desc>\n */\nexport const desc = /*#__PURE__*/ svgElementFactory(\"desc\");\n/**\n * Creates OpNode SVG element <discard>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/SVG/Element/discard}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode SVG element <discard>\n */\nexport const discard = /*#__PURE__*/ svgElementFactory(\"discard\");\n/**\n * Creates OpNode SVG element <ellipse>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/SVG/Element/ellipse}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode SVG element <ellipse>\n */\nexport const ellipse = /*#__PURE__*/ svgElementFactory(\"ellipse\");\n/**\n * Creates OpNode SVG element <feBlend>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/SVG/Element/feBlend}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode SVG element <feBlend>\n */\nexport const feBlend = /*#__PURE__*/ svgElementFactory(\"feBlend\");\n/**\n * Creates OpNode SVG element <feColorMatrix>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/SVG/Element/feColorMatrix}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode SVG element <feColorMatrix>\n */\nexport const feColorMatrix = /*#__PURE__*/ svgElementFactory(\"feColorMatrix\");\n/**\n * Creates OpNode SVG element <feComponentTransfer>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/SVG/Element/feComponentTransfer}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode SVG element <feComponentTransfer>\n */\nexport const feComponentTransfer = /*#__PURE__*/ svgElementFactory(\"feComponentTransfer\");\n/**\n * Creates OpNode SVG element <feComposite>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/SVG/Element/feComposite}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode SVG element <feComposite>\n */\nexport const feComposite = /*#__PURE__*/ svgElementFactory(\"feComposite\");\n/**\n * Creates OpNode SVG element <feConvolveMatrix>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/SVG/Element/feConvolveMatrix}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode SVG element <feConvolveMatrix>\n */\nexport const feConvolveMatrix = /*#__PURE__*/ svgElementFactory(\"feConvolveMatrix\");\n/**\n * Creates OpNode SVG element <feDiffuseLighting>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/SVG/Element/feDiffuseLighting}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode SVG element <feDiffuseLighting>\n */\nexport const feDiffuseLighting = /*#__PURE__*/ svgElementFactory(\"feDiffuseLighting\");\n/**\n * Creates OpNode SVG element <feDisplacementMap>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/SVG/Element/feDisplacementMap}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode SVG element <feDisplacementMap>\n */\nexport const feDisplacementMap = /*#__PURE__*/ svgElementFactory(\"feDisplacementMap\");\n/**\n * Creates OpNode SVG element <feDistantLight>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/SVG/Element/feDistantLight}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode SVG element <feDistantLight>\n */\nexport const feDistantLight = /*#__PURE__*/ svgElementFactory(\"feDistantLight\");\n/**\n * Creates OpNode SVG element <feDropShadow>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/SVG/Element/feDropShadow}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode SVG element <feDropShadow>\n */\nexport const feDropShadow = /*#__PURE__*/ svgElementFactory(\"feDropShadow\");\n/**\n * Creates OpNode SVG element <feFlood>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/SVG/Element/feFlood}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode SVG element <feFlood>\n */\nexport const feFlood = /*#__PURE__*/ svgElementFactory(\"feFlood\");\n/**\n * Creates OpNode SVG element <feFuncA>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/SVG/Element/feFuncA}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode SVG element <feFuncA>\n */\nexport const feFuncA = /*#__PURE__*/ svgElementFactory(\"feFuncA\");\n/**\n * Creates OpNode SVG element <feFuncB>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/SVG/Element/feFuncB}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode SVG element <feFuncB>\n */\nexport const feFuncB = /*#__PURE__*/ svgElementFactory(\"feFuncB\");\n/**\n * Creates OpNode SVG element <feFuncG>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/SVG/Element/feFuncG}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode SVG element <feFuncG>\n */\nexport const feFuncG = /*#__PURE__*/ svgElementFactory(\"feFuncG\");\n/**\n * Creates OpNode SVG element <feFuncR>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/SVG/Element/feFuncR}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode SVG element <feFuncR>\n */\nexport const feFuncR = /*#__PURE__*/ svgElementFactory(\"feFuncR\");\n/**\n * Creates OpNode SVG element <feGaussianBlur>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/SVG/Element/feGaussianBlur}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode SVG element <feGaussianBlur>\n */\nexport const feGaussianBlur = /*#__PURE__*/ svgElementFactory(\"feGaussianBlur\");\n/**\n * Creates OpNode SVG element <feImage>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/SVG/Element/feImage}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode SVG element <feImage>\n */\nexport const feImage = /*#__PURE__*/ svgElementFactory(\"feImage\");\n/**\n * Creates OpNode SVG element <feMerge>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/SVG/Element/feMerge}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode SVG element <feMerge>\n */\nexport const feMerge = /*#__PURE__*/ svgElementFactory(\"feMerge\");\n/**\n * Creates OpNode SVG element <feMergeNode>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/SVG/Element/feMergeNode}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode SVG element <feMergeNode>\n */\nexport const feMergeNode = /*#__PURE__*/ svgElementFactory(\"feMergeNode\");\n/**\n * Creates OpNode SVG element <feMorphology>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/SVG/Element/feMorphology}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode SVG element <feMorphology>\n */\nexport const feMorphology = /*#__PURE__*/ svgElementFactory(\"feMorphology\");\n/**\n * Creates OpNode SVG element <feOffset>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/SVG/Element/feOffset}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode SVG element <feOffset>\n */\nexport const feOffset = /*#__PURE__*/ svgElementFactory(\"feOffset\");\n/**\n * Creates OpNode SVG element <fePointLight>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/SVG/Element/fePointLight}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode SVG element <fePointLight>\n */\nexport const fePointLight = /*#__PURE__*/ svgElementFactory(\"fePointLight\");\n/**\n * Creates OpNode SVG element <feSpecularLighting>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/SVG/Element/feSpecularLighting}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode SVG element <feSpecularLighting>\n */\nexport const feSpecularLighting = /*#__PURE__*/ svgElementFactory(\"feSpecularLighting\");\n/**\n * Creates OpNode SVG element <feSpotLight>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/SVG/Element/feSpotLight}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode SVG element <feSpotLight>\n */\nexport const feSpotLight = /*#__PURE__*/ svgElementFactory(\"feSpotLight\");\n/**\n * Creates OpNode SVG element <feTile>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/SVG/Element/feTile}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode SVG element <feTile>\n */\nexport const feTile = /*#__PURE__*/ svgElementFactory(\"feTile\");\n/**\n * Creates OpNode SVG element <feTurbulence>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/SVG/Element/feTurbulence}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode SVG element <feTurbulence>\n */\nexport const feTurbulence = /*#__PURE__*/ svgElementFactory(\"feTurbulence\");\n/**\n * Creates OpNode SVG element <filter>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/SVG/Element/filter}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode SVG element <filter>\n */\nexport const filter = /*#__PURE__*/ svgElementFactory(\"filter\");\n/**\n * Creates OpNode SVG element <foreignObject>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/SVG/Element/foreignObject}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode SVG element <foreignObject>\n */\nexport const foreignObject = /*#__PURE__*/ svgElementFactory(\"foreignObject\");\n/**\n * Creates OpNode SVG element <g>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/SVG/Element/g}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode SVG element <g>\n */\nexport const g = /*#__PURE__*/ svgElementFactory(\"g\");\n/**\n * Creates OpNode SVG element <hatch>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/SVG/Element/hatch}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode SVG element <hatch>\n */\nexport const hatch = /*#__PURE__*/ svgElementFactory(\"hatch\");\n/**\n * Creates OpNode SVG element <hatchpath>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/SVG/Element/hatchpath}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode SVG element <hatchpath>\n */\nexport const hatchpath = /*#__PURE__*/ svgElementFactory(\"hatchpath\");\n/**\n * Creates OpNode SVG element <image>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/SVG/Element/image}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode SVG element <image>\n */\nexport const image = /*#__PURE__*/ svgElementFactory(\"image\");\n/**\n * Creates OpNode SVG element <line>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/SVG/Element/line}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode SVG element <line>\n */\nexport const line = /*#__PURE__*/ svgElementFactory(\"line\");\n/**\n * Creates OpNode SVG element <linearGradient>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/SVG/Element/linearGradient}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode SVG element <linearGradient>\n */\nexport const linearGradient = /*#__PURE__*/ svgElementFactory(\"linearGradient\");\n/**\n * Creates OpNode SVG element <marker>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/SVG/Element/marker}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode SVG element <marker>\n */\nexport const marker = /*#__PURE__*/ svgElementFactory(\"marker\");\n/**\n * Creates OpNode SVG element <mask>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/SVG/Element/mask}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode SVG element <mask>\n */\nexport const mask = /*#__PURE__*/ svgElementFactory(\"mask\");\n/**\n * Creates OpNode SVG element <mesh>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/SVG/Element/mesh}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode SVG element <mesh>\n */\nexport const mesh = /*#__PURE__*/ svgElementFactory(\"mesh\");\n/**\n * Creates OpNode SVG element <meshgradient>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/SVG/Element/meshgradient}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode SVG element <meshgradient>\n */\nexport const meshgradient = /*#__PURE__*/ svgElementFactory(\"meshgradient\");\n/**\n * Creates OpNode SVG element <meshpatch>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/SVG/Element/meshpatch}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode SVG element <meshpatch>\n */\nexport const meshpatch = /*#__PURE__*/ svgElementFactory(\"meshpatch\");\n/**\n * Creates OpNode SVG element <meshrow>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/SVG/Element/meshrow}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode SVG element <meshrow>\n */\nexport const meshrow = /*#__PURE__*/ svgElementFactory(\"meshrow\");\n/**\n * Creates OpNode SVG element <metadata>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/SVG/Element/metadata}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode SVG element <metadata>\n */\nexport const metadata = /*#__PURE__*/ svgElementFactory(\"metadata\");\n/**\n * Creates OpNode SVG element <mpath>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/SVG/Element/mpath}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode SVG element <mpath>\n */\nexport const mpath = /*#__PURE__*/ svgElementFactory(\"mpath\");\n/**\n * Creates OpNode SVG element <path>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/SVG/Element/path}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode SVG element <path>\n */\nexport const path = /*#__PURE__*/ svgElementFactory(\"path\");\n/**\n * Creates OpNode SVG element <pattern>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/SVG/Element/pattern}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode SVG element <pattern>\n */\nexport const pattern = /*#__PURE__*/ svgElementFactory(\"pattern\");\n/**\n * Creates OpNode SVG element <polygon>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/SVG/Element/polygon}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode SVG element <polygon>\n */\nexport const polygon = /*#__PURE__*/ svgElementFactory(\"polygon\");\n/**\n * Creates OpNode SVG element <polyline>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/SVG/Element/polyline}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode SVG element <polyline>\n */\nexport const polyline = /*#__PURE__*/ svgElementFactory(\"polyline\");\n/**\n * Creates OpNode SVG element <radialGradient>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/SVG/Element/radialGradient}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode SVG element <radialGradient>\n */\nexport const radialGradient = /*#__PURE__*/ svgElementFactory(\"radialGradient\");\n/**\n * Creates OpNode SVG element <rect>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/SVG/Element/rect}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode SVG element <rect>\n */\nexport const rect = /*#__PURE__*/ svgElementFactory(\"rect\");\n/**\n * Creates OpNode SVG element <set>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/SVG/Element/set}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode SVG element <set>\n */\nexport const set = /*#__PURE__*/ svgElementFactory(\"set\");\n/**\n * Creates OpNode SVG element <solidcolor>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/SVG/Element/solidcolor}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode SVG element <solidcolor>\n */\nexport const solidcolor = /*#__PURE__*/ svgElementFactory(\"solidcolor\");\n/**\n * Creates OpNode SVG element <stop>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/SVG/Element/stop}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode SVG element <stop>\n */\nexport const stop = /*#__PURE__*/ svgElementFactory(\"stop\");\n/**\n * Creates OpNode SVG element <svg>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/SVG/Element/svg}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode SVG element <svg>\n */\nexport const svg = /*#__PURE__*/ svgElementFactory(\"svg\");\n/**\n * Creates OpNode SVG element <symbol>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/SVG/Element/symbol}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode SVG element <symbol>\n */\nexport const symbol = /*#__PURE__*/ svgElementFactory(\"symbol\");\n/**\n * Creates OpNode SVG element <text>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/SVG/Element/text}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode SVG element <text>\n */\nexport const text = /*#__PURE__*/ svgElementFactory(\"text\");\n/**\n * Creates OpNode SVG element <textPath>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/SVG/Element/textPath}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode SVG element <textPath>\n */\nexport const textPath = /*#__PURE__*/ svgElementFactory(\"textPath\");\n/**\n * Creates OpNode SVG element <title>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/SVG/Element/title}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode SVG element <title>\n */\nexport const title = /*#__PURE__*/ svgElementFactory(\"title\");\n/**\n * Creates OpNode SVG element <tspan>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/SVG/Element/tspan}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode SVG element <tspan>\n */\nexport const tspan = /*#__PURE__*/ svgElementFactory(\"tspan\");\n/**\n * Creates OpNode SVG element <use>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/SVG/Element/use}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode SVG element <use>\n */\nexport const use = /*#__PURE__*/ svgElementFactory(\"use\");\n/**\n * Creates OpNode SVG element <view>.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/SVG/Element/view}\n *\n * @param className Class name.\n * @param attrs Attributes.\n * @param children Children nodes.\n * @returns OpNode SVG element <view>\n */\nexport const view = /*#__PURE__*/ svgElementFactory(\"view\");\n//# sourceMappingURL=index.js.map","/**\n * Task token.\n */\nexport const TASK_TOKEN = (process.env.NODE_ENV !== \"production\" ? Object.freeze({}) : /* istanbul ignore next */ {});\n/**\n * Select token.\n */\nexport const SELECT_TOKEN = (process.env.NODE_ENV !== \"production\" ? Object.freeze({}) : /* istanbul ignore next */ {});\n/**\n * Unmount token.\n */\nexport const UNMOUNT_TOKEN = (process.env.NODE_ENV !== \"production\" ? Object.freeze({}) : /* istanbul ignore next */ {});\n/**\n * Empty object.\n */\nexport const EMPTY_OBJECT = process.env.NODE_ENV !== \"production\" ? Object.freeze({}) : /* istanbul ignore next */ {};\n/**\n * Empty array.\n */\nexport const EMPTY_ARRAY = process.env.NODE_ENV !== \"production\" ? Object.freeze([]) : /* istanbul ignore next */ [];\n//# sourceMappingURL=token.js.map","import { createStateNode } from \"../vdom/state\";\nimport { pushContext, disableContext, enableContext, resetContext, getContext, setContext, } from \"../vdom/context\";\nimport { escapeAttributeValue, escapeText } from \"./escape\";\nlet _attributes = \"\";\nlet _styles = \"\";\nlet _children = \"\";\n/**\n * emitAttribute pushes attribute string.\n *\n * @example\n *\n *   emitAttribute(`id=\"abc\"`);\n *\n * @param attr Attribute string.\n */\nexport function emitAttribute(attr) {\n    _attributes += ` ${attr}`;\n}\n/**\n * emitStyle pushes style string.\n *\n * @example\n *\n *   emitStyle(`padding:0`);\n *\n * @param style Style string.\n */\nexport function emitStyle(style) {\n    if (_styles !== \"\") {\n        _styles += \";\";\n    }\n    _styles += style;\n}\n/**\n * emitChildrens pushes children string.\n *\n * @example\n *\n *   emitChildren(`<h1>Hello World</h1>`);\n *\n * @param children Children string.\n */\nexport function emitChildren(children) {\n    _children += children;\n}\n/**\n * Renders a {@link OpNode} to string.\n *\n * @param op {@link OpNode}\n * @param context Current context.\n * @returns Rendering results.\n */\nfunction _renderToString(op) {\n    if (op !== null) {\n        if (typeof op === \"object\") {\n            let result = \"\";\n            if (op instanceof Array) {\n                for (let i = 0; i < op.length; ++i) {\n                    result += renderToString(op[i]);\n                }\n                return result;\n            }\n            const opType = op.t;\n            const flags = opType.f;\n            if ((flags & 2 /* Element */) !== 0) {\n                let children = \"\";\n                let tagName;\n                let className = op.n;\n                let attrs = op.v;\n                if ((flags & 64 /* ElementProto */) !== 0) {\n                    const proto = opType.d.p;\n                    tagName = proto.t.d;\n                    if (className === void 0) {\n                        className = proto.n;\n                    }\n                    if (proto.v !== void 0) {\n                        attrs = attrs === void 0 ? proto.v : { ...proto.v, ...attrs };\n                    }\n                }\n                else {\n                    tagName = opType.d;\n                }\n                let openElement = `<${tagName}`;\n                if (className !== void 0 && className !== \"\") {\n                    openElement += ` class=\"${className}\"`;\n                }\n                if (attrs !== void 0) {\n                    for (const key in attrs) {\n                        const value = attrs[key];\n                        if (key === \"style\") {\n                            for (const skey in value) {\n                                emitStyle(`${skey}:${escapeAttributeValue(value[skey])}`);\n                            }\n                        }\n                        else {\n                            if (typeof value === \"object\") {\n                                value.s(key, value.v);\n                            }\n                            else if (typeof value !== \"boolean\") {\n                                emitAttribute(`${key}=\"${escapeAttributeValue(value)}\"`);\n                            }\n                            else if (value === true) {\n                                emitAttribute(key);\n                            }\n                        }\n                    }\n                    if (_styles !== \"\") {\n                        emitAttribute(`style=\"${_styles}\"`);\n                        _styles = \"\";\n                    }\n                    openElement += _attributes;\n                    children = _children;\n                    _attributes = \"\";\n                    _children = \"\";\n                }\n                if (children === \"\") {\n                    children = renderToString(op.c);\n                }\n                if ((flags & 2048 /* NewlineEatingElement */) !== 0) {\n                    if (children.length > 0 && children.charCodeAt(0) === 10) { // \"\\n\"\n                        children = `\\n${children}`;\n                    }\n                }\n                return ((flags & (4096 /* VoidElement */ | 512 /* Svg */)) !== 0 && children === \"\") ?\n                    `${openElement} />` :\n                    `${openElement}>${children}</${tagName}>`;\n            }\n            if ((flags & 4 /* Component */) !== 0) {\n                if ((flags & 256 /* Stateful */) !== 0) {\n                    const stateNode = createStateNode(op);\n                    stateNode.s = { r: null, s: null, u: null };\n                    return renderToString(op.t.d.c(stateNode)(op.v));\n                }\n                else {\n                    return renderToString(op.t.d.c(op.v));\n                }\n            }\n            if ((flags & (16 /* Events */ | 32 /* Context */)) !== 0) {\n                if ((flags & 32 /* Context */) !== 0) {\n                    const prevContext = getContext();\n                    pushContext(op.t.d, op.v);\n                    result = renderToString(op.c);\n                    setContext(prevContext);\n                    return result;\n                }\n                else {\n                    return renderToString(op.c);\n                }\n            }\n            // TrackByKey Node\n            const childrenNodes = op.v;\n            for (let i = 0; i < childrenNodes.length; ++i) {\n                result += renderToString(childrenNodes[i].v);\n            }\n            return result;\n        }\n        if (typeof op === \"string\") {\n            return escapeText(op);\n        }\n        // number\n        return op.toString();\n    }\n    return \"\";\n}\n/**\n * Renders a {@link OpNode} to string.\n *\n * @param op {@link OpNode}\n * @param context Current context.\n * @returns Rendering results.\n */\nexport function renderToString(op) {\n    try {\n        /* istanbul ignore else */\n        if (process.env.NODE_ENV !== \"production\") {\n            enableContext();\n        }\n        return _renderToString(op);\n    }\n    catch (e) {\n        resetContext();\n        _attributes = \"\";\n        _styles = \"\";\n        _children = \"\";\n        throw e;\n    }\n    finally {\n        /* istanbul ignore else */\n        if (process.env.NODE_ENV !== \"production\") {\n            disableContext();\n        }\n    }\n}\n//# sourceMappingURL=render.js.map","// extracted by mini-css-extract-plugin\nmodule.exports = {\"layersWrapper\":\"ui/layers__layersWrapper\",\"layersListWrapper\":\"ui/layers__layersListWrapper\",\"layersControlsWrapper\":\"ui/layers__layersControlsWrapper\",\"unselectedLayerWrapper\":\"ui/layers__unselectedLayerWrapper\",\"selectedLayerWrapper\":\"ui/layers__selectedLayerWrapper\",\"layerLeft\":\"ui/layers__layerLeft\",\"layerRight\":\"ui/layers__layerRight\",\"layerName\":\"ui/layers__layerName\",\"layerOpacity\":\"ui/layers__layerOpacity\"};","import { SELECT_TOKEN, UNMOUNT_TOKEN } from \"../core\";\nimport { doc, objectHasOwnProperty, nodeInsertBefore, nodeRemoveChild, elementSetAttribute, nodeCloneNode, nodeSetTextContent, elementRemoveAttribute, elementSetClassName, htmlElementGetStyle, svgElementGetStyle, } from \"../dom/shortcuts\";\nimport { SVG_NAMESPACE } from \"../dom/namespaces\";\nimport { createStateNode } from \"./state\";\nimport { setContext, pushContext } from \"./context\";\nlet _nextNode;\nlet _deepStateFlags;\nexport function _resetState() {\n    _nextNode = null;\n    _deepStateFlags = 0;\n}\nexport function visitNodes(opState, visitor) {\n    let i = visitor(opState);\n    if (i !== 0 /* Continue */) {\n        return (i & 1 /* StopImmediate */);\n    }\n    const { f, c } = opState;\n    if ((f & (128 /* Fragment */ | 8 /* TrackByKey */)) !== 0) {\n        for (i = 0; i < c.length; i++) {\n            if ((opState = c[i]) !== null &&\n                (visitNodes(opState, visitor) & 1 /* StopImmediate */) !== 0) {\n                return 1 /* StopImmediate */;\n            }\n        }\n    }\n    else if (c !== null) {\n        return visitNodes(c, visitor);\n    }\n    return 0 /* Continue */;\n}\nexport function getDOMNode(opState) {\n    let i = opState.f;\n    let c;\n    if ((i & (2 /* Element */ | 1 /* Text */)) === 0) {\n        opState = opState.c;\n        if ((i & (128 /* Fragment */ | 8 /* TrackByKey */)) !== 0) {\n            for (i = 0; i < opState.length; i++) {\n                if ((c = opState[i]) !== null) {\n                    return getDOMNode(c);\n                }\n            }\n            return null;\n        }\n        if (opState === null) {\n            return null;\n        }\n        return getDOMNode(opState);\n    }\n    return opState.s;\n}\nexport function _dirtyCheck(parentElement, opState, moveNode, singleChild) {\n    const flags = opState.f;\n    let state;\n    let c;\n    let i;\n    let f;\n    if ((flags & 256 /* Stateful */) !== 0) {\n        state = opState.s;\n        if (((flags & 1024 /* Dirty */) !== 0) ||\n            (state.s !== null && state.s(SELECT_TOKEN) === true)) {\n            opState.c = _update(parentElement, opState.c, state.r(opState.o.v), moveNode, singleChild);\n        }\n        else if ((flags & 65536 /* DeepStateDirtyCheck */) !== 0) {\n            _dirtyCheck(parentElement, opState.c, moveNode, singleChild);\n        }\n        else {\n            if (moveNode === true) {\n                _moveNodes(parentElement, opState);\n            }\n            else {\n                _nextNode = getDOMNode(opState);\n            }\n        }\n        opState.f = (opState.f & 64511 /* SelfFlags */) | _deepStateFlags;\n        _deepStateFlags |= (opState.f & 49152 /* DeepStateFlags */) << 2 /* DeepStateShift */;\n    }\n    else if ((flags & 65536 /* DeepStateDirtyCheck */) !== 0) {\n        // Checking for `children === null` is unnecessary, `DeepStateDirtyCheck` flag guarantees that element should\n        // have children nodes.\n        c = opState.c;\n        if ((flags & 2 /* Element */) !== 0) {\n            state = opState.s;\n            if (moveNode === true) {\n                nodeInsertBefore.call(parentElement, state, _nextNode);\n            }\n            _nextNode = null;\n            _dirtyCheck(state, c, false, true);\n            _nextNode = state;\n        }\n        else if ((flags & (128 /* Fragment */ | 8 /* TrackByKey */)) !== 0) {\n            f = 0;\n            i = c.length;\n            while (i > 0) {\n                if ((state = c[--i]) !== null) {\n                    _dirtyCheck(parentElement, state, moveNode, false);\n                    f |= _deepStateFlags;\n                    _deepStateFlags = 0;\n                }\n            }\n            _deepStateFlags = f;\n        }\n        else if ((flags & (16 /* Events */ | 4 /* Component */)) !== 0) {\n            _dirtyCheck(parentElement, c, moveNode, singleChild);\n        }\n        else { // ((f & NodeFlags.Context) !== 0)\n            state = setContext(opState.s);\n            _dirtyCheck(parentElement, c, moveNode, singleChild);\n            setContext(state);\n        }\n        opState.f = (flags & 64511 /* SelfFlags */) | _deepStateFlags;\n    }\n    else {\n        if (moveNode === true) {\n            _moveNodes(parentElement, opState);\n        }\n        else {\n            _nextNode = getDOMNode(opState);\n        }\n        _deepStateFlags = flags & (49152 /* DeepStateFlags */ << 2 /* DeepStateShift */);\n    }\n}\nfunction _moveNodes(parentElement, opState) {\n    const flags = opState.f;\n    let children;\n    let c;\n    let i;\n    if ((flags & (2 /* Element */ | 1 /* Text */)) !== 0) {\n        c = opState.s;\n        nodeInsertBefore.call(parentElement, c, _nextNode);\n        _nextNode = c;\n    }\n    else {\n        children = opState.c;\n        if ((flags & (128 /* Fragment */ | 8 /* TrackByKey */)) !== 0) {\n            i = children.length;\n            while (i > 0) {\n                if ((c = children[--i]) !== null) {\n                    _moveNodes(parentElement, c);\n                }\n            }\n        }\n        else if (children !== null) {\n            _moveNodes(parentElement, children);\n        }\n    }\n}\nfunction _unmountWalk(opState) {\n    const flags = opState.f;\n    let children;\n    let i;\n    let v;\n    if ((flags & 131072 /* DeepStateUnmount */) !== 0) {\n        if ((children = opState.c) !== null) {\n            if ((flags & (128 /* Fragment */ | 8 /* TrackByKey */)) !== 0) {\n                for (i = 0; i < children.length; i++) {\n                    if ((v = children[i]) !== null) {\n                        _unmountWalk(v);\n                    }\n                }\n            }\n            else {\n                _unmountWalk(children);\n            }\n        }\n    }\n    if ((flags & 32768 /* Unmount */) !== 0) {\n        if ((v = opState.s.u) !== null) {\n            if (typeof v === \"function\") {\n                v(UNMOUNT_TOKEN);\n            }\n            else {\n                for (i = 0; i < v.length; i++) {\n                    v[i](UNMOUNT_TOKEN);\n                }\n            }\n        }\n    }\n}\nfunction _unmountRemove(parentElement, opState, singleChild) {\n    let i = opState.f;\n    let c;\n    if ((i & (2 /* Element */ | 1 /* Text */)) !== 0) {\n        nodeRemoveChild.call(parentElement, opState.s);\n    }\n    else {\n        opState = opState.c;\n        if ((i & (8 /* TrackByKey */ | 128 /* Fragment */)) !== 0) {\n            if (singleChild === true) {\n                nodeSetTextContent.call(parentElement, \"\");\n            }\n            else {\n                for (i = 0; i < opState.length; ++i) {\n                    if ((c = opState[i]) !== null) {\n                        _unmountRemove(parentElement, c, false);\n                    }\n                }\n            }\n        }\n        else if (opState !== null) {\n            _unmountRemove(parentElement, opState, singleChild);\n        }\n    }\n}\nexport function _unmount(parentElement, opState, singleChild) {\n    _unmountRemove(parentElement, opState, singleChild);\n    _unmountWalk(opState);\n}\nfunction _mountText(parentElement, opState, op) {\n    const node = doc.createTextNode(op);\n    nodeInsertBefore.call(parentElement, node, _nextNode);\n    _nextNode = node;\n    opState.s = node;\n    opState.f = 1 /* Text */;\n}\nfunction _createElement(node, op) {\n    const { t, v, n } = op;\n    const svg = (t.f & 512 /* Svg */) !== 0;\n    if (node === void 0) {\n        const tagName = t.d;\n        node = svg ?\n            doc.createElementNS(SVG_NAMESPACE, tagName) :\n            doc.createElement(tagName);\n    }\n    if (n) {\n        _updateClassName(node, n, svg);\n    }\n    if (v !== void 0) {\n        _updateAttrs(node, void 0, v, svg);\n    }\n    return node;\n}\nfunction _mountObject(parentElement, opState, op) {\n    const opType = op.t; // polymorphic callsite\n    const flags = opType.f;\n    let prevState;\n    let value;\n    let node;\n    let i;\n    let f;\n    if ((flags & 4 /* Component */) !== 0) {\n        if ((flags & 256 /* Stateful */) !== 0) {\n            opState.s = prevState = { r: null, s: null, u: null };\n            // Reusing value variable.\n            prevState.r = value = opType.d.c(opState);\n        }\n        else {\n            value = opType.d.c;\n        }\n        opState.c = _mount(parentElement, value(op.v));\n        opState.f |= flags | _deepStateFlags;\n        _deepStateFlags |= (opState.f & 49152 /* DeepStateFlags */) << 2 /* DeepStateShift */;\n    }\n    else {\n        if ((flags & 2 /* Element */) !== 0) {\n            value = opType.d;\n            if ((flags & 64 /* ElementProto */) !== 0) {\n                node = value.n;\n                if (node === null) {\n                    value.n = node = _createElement(void 0, value.p);\n                }\n                node = nodeCloneNode.call(node, false);\n            }\n            opState.s = node = _createElement(node, op);\n            prevState = _nextNode;\n            if ((value = op.c) !== null) {\n                _nextNode = null;\n                opState.c = _mount(node, value);\n            }\n            _nextNode = node;\n            nodeInsertBefore.call(parentElement, node, prevState);\n        }\n        else if ((flags & (16 /* Events */ | 32 /* Context */)) !== 0) {\n            if ((flags & 32 /* Context */) !== 0) {\n                opState.s = prevState = ((flags & 8192 /* SetContextState */) !== 0) ?\n                    setContext(op.v) :\n                    pushContext(opType.d, op.v);\n                opState.c = _mount(parentElement, op.c);\n                setContext(prevState);\n            }\n            else {\n                opState.c = _mount(parentElement, op.c);\n            }\n        }\n        else { // ((opFlags & NodeFlags.TrackByKey) !== 0)\n            f = 0;\n            node = op.v;\n            i = node.length;\n            opState.c = value = Array(i);\n            while (i > 0) {\n                value[--i] = _mount(parentElement, node[i].v);\n                f |= _deepStateFlags;\n                _deepStateFlags = 0;\n            }\n            _deepStateFlags = f;\n        }\n        opState.f = flags | _deepStateFlags;\n    }\n}\nfunction _mountFragment(parentElement, opState, childrenOps) {\n    let i = childrenOps.length;\n    let f = 0;\n    const newChildren = Array(i);\n    while (i > 0) {\n        newChildren[--i] = _mount(parentElement, childrenOps[i]);\n        f |= _deepStateFlags;\n        _deepStateFlags = 0;\n    }\n    _deepStateFlags = f;\n    opState.c = newChildren;\n    opState.f = 128 /* Fragment */ | f;\n}\nexport function _mount(parentElement, op) {\n    if (op !== null) {\n        const opState = createStateNode(op);\n        if (typeof op === \"object\") {\n            if (op instanceof Array) {\n                _mountFragment(parentElement, opState, op);\n            }\n            else {\n                _mountObject(parentElement, opState, op);\n            }\n        }\n        else {\n            _mountText(parentElement, opState, op);\n        }\n        return opState;\n    }\n    return null;\n}\n/**\n * _update updates a stateNode with a next operation.\n *\n * @param parentElement Parent DOM Element.\n * @param opState Operation state.\n * @param nextOp Next operation.\n * @param moveNode DOM Element should be moved.\n * @param singleChild Parent DOM Element contains a single child.\n * @returns OpNode state.\n */\nexport function _update(parentElement, opState, nextOp, moveNode, singleChild) {\n    if (nextOp === null) {\n        if (opState !== null) {\n            _unmount(parentElement, opState, singleChild);\n        }\n        return null;\n    }\n    if (opState === null) {\n        return _mount(parentElement, nextOp);\n    }\n    const { f, o, s } = opState;\n    if ((f & 1 /* Text */) !== 0) {\n        if (typeof nextOp !== \"object\") {\n            // Reassign to reduce memory consumption even if nextOp is strictly equal to the prev op.\n            opState.o = nextOp;\n            if (o !== nextOp) {\n                s.nodeValue = nextOp;\n            }\n            if (moveNode === true) {\n                nodeInsertBefore.call(parentElement, s, _nextNode);\n            }\n            _nextNode = s;\n        }\n        else {\n            nodeRemoveChild.call(parentElement, s);\n            return _mount(parentElement, nextOp);\n        }\n    }\n    else {\n        // Here we don't need to reassign nextOp because op should always be an object, and strict equality will guarantee\n        // that this object is occupying the same memory region.\n        if (o === nextOp) {\n            _dirtyCheck(parentElement, opState, moveNode, singleChild);\n            return opState;\n        }\n        if (((f & 128 /* Fragment */) !== 0 ?\n            !(nextOp instanceof Array) :\n            (nextOp instanceof Array ||\n                o.t !== nextOp.t // polymorphic callsites\n            ))) {\n            _unmount(parentElement, opState, singleChild);\n            return _mount(parentElement, nextOp);\n        }\n        opState.o = nextOp;\n        const opStateChildren = opState.c;\n        let prevData;\n        let nextData;\n        let nextValue;\n        let i;\n        let deepState;\n        if ((f & 4 /* Component */) !== 0) {\n            prevData = o.v;\n            nextData = nextOp.v;\n            nextValue = nextOp.t.d;\n            if ((prevData !== nextData) &&\n                (nextValue.e === void 0 || nextValue.e(prevData, nextData) !== true)) {\n                opState.c = _update(parentElement, opStateChildren, ((f & 256 /* Stateful */) !== 0) ?\n                    s.r(nextData) :\n                    nextValue.c(nextData), moveNode, singleChild);\n                opState.f = (opState.f & 64511 /* SelfFlags */) | _deepStateFlags;\n                _deepStateFlags |= (opState.f & 49152 /* DeepStateFlags */) << 2 /* DeepStateShift */;\n            }\n            else {\n                _dirtyCheck(parentElement, opState, moveNode, singleChild);\n            }\n        }\n        else {\n            if ((f & 2 /* Element */) !== 0) {\n                i = (f & 512 /* Svg */) !== 0;\n                if (moveNode === true) {\n                    nodeInsertBefore.call(parentElement, s, _nextNode);\n                }\n                nextValue = nextOp.n;\n                if (o.n !== nextValue) {\n                    if (nextValue === void 0) {\n                        nextValue = \"\";\n                    }\n                    _updateClassName(s, nextValue, i);\n                }\n                nextValue = nextOp.v;\n                if (o.v !== nextValue) {\n                    _updateAttrs(s, o.v, nextValue, i);\n                }\n                _nextNode = null;\n                opState.c = _update(s, opStateChildren, nextOp.c, false, true);\n                _nextNode = s;\n            }\n            else if ((f & (128 /* Fragment */ | 8 /* TrackByKey */)) !== 0) {\n                if ((f & 128 /* Fragment */) !== 0) {\n                    i = nextOp.length;\n                    if (i === 0) {\n                        _unmount(parentElement, opState, singleChild);\n                    }\n                    else {\n                        deepState = 0;\n                        prevData = opStateChildren.length;\n                        if (i !== prevData) {\n                            opState.c = nextValue = Array(i);\n                            while (prevData > i) {\n                                nextData = opStateChildren[--prevData];\n                                if (nextData !== null) {\n                                    _unmount(parentElement, nextData, false);\n                                }\n                            }\n                            while (i > prevData) {\n                                nextValue[--i] = _mount(parentElement, nextOp[i]);\n                                deepState |= _deepStateFlags;\n                                _deepStateFlags = 0;\n                            }\n                        }\n                        else {\n                            nextValue = opStateChildren;\n                        }\n                        while (i > 0) {\n                            nextValue[--i] = _update(parentElement, opStateChildren[i], nextOp[i], moveNode, false);\n                            deepState |= _deepStateFlags;\n                            _deepStateFlags = 0;\n                        }\n                        _deepStateFlags = deepState;\n                    }\n                }\n                else {\n                    _updateChildrenTrackByKeys(parentElement, opState, o.v, nextOp.v, moveNode, singleChild);\n                }\n            }\n            else if ((f & 16 /* Events */) !== 0) {\n                opState.c = _update(parentElement, opStateChildren, nextOp.c, moveNode, singleChild);\n            }\n            else { // if ((flags & NodeFlags.Context) !== 0) {\n                nextData = nextOp.v;\n                if ((f & 8192 /* SetContextState */) !== 0) {\n                    opState.s = nextData;\n                }\n                else {\n                    s.v = nextData;\n                }\n                nextValue = setContext(opState.s);\n                opState.c = _update(parentElement, opStateChildren, nextOp.c, moveNode, singleChild);\n                setContext(nextValue);\n            }\n            opState.f = (f & 64511 /* SelfFlags */) | _deepStateFlags;\n        }\n    }\n    return opState;\n}\n/**\n * Update children list with track by key algorithm.\n *\n * High-level overview of the algorithm that is implemented in this function (slightly outdated, but the key ideas are\n * the same).\n *\n * This algorithm finds a minimum[1] number of DOM operations. It works in several steps:\n *\n * 1. Find common suffix and prefix.\n *\n * This optimization technique is searching for nodes with identical keys by simultaneously iterating over nodes in the\n * old children list `A` and new children list `B` from both sides:\n *\n *  A: -> [a b c d] <-\n *  B: -> [a b d] <-\n *\n * Here we can skip nodes \"a\" and \"b\" at the begininng, and node \"d\" at the end.\n *\n *  A: -> [c] <-\n *  B: -> [] <-\n *\n * Here it will check if the size of one of the list is equal to zero. When length of the old children list is zero,\n * it will insert all remaining nodes from the new list, and when length of the new children list is zero, it will\n * remove all remaining nodes from the old list.\n *\n * When algorithm can't find a solution with this simple optimization technique, it will go to the next step of the\n * algorithm. For example:\n *\n *  A: -> [a b c d e f g] <-\n *  B: -> [a c b h f e g] <-\n *\n * Nodes \"a\" and \"g\" at the edges are the same, skipping them.\n *\n *  A: -> [b c d e f] <-\n *  B: -> [c b h f e] <-\n *\n * Here we are stuck, so we need to switch to the next step.\n *\n * 2. Look for removed and inserted nodes, and simultaneously check if one of the nodes is moved.\n *\n * First we create an array `P` with the length of the new children list and assign to each position value `-1`, it has\n * a meaning of a new node that should be inserted. Later we will assign node positions in the old children list to this\n * array.\n *\n *  A: [b c d e f]\n *  B: [c b h f e]\n *  P: [. . . . .] // . == -1\n *\n * Then we need to build an index `I` that maps keys with node positions of the remaining nodes from the new children\n * list.\n *\n *  A: [b c d e f]\n *  B: [c b h f e]\n *  P: [. . . . .] // . == -1\n *  I: {\n *    c: 0,\n *    b: 1,\n *    h: 2,\n *    f: 3,\n *    e: 4,\n *  }\n *  last = 0\n *\n * With this index, we start to iterate over the remaining nodes from the old children list and check if we can find a\n * node with the same key in the index. If we can't find any node, it means that it should be removed, otherwise we\n * assign position of the node in the old children list to the positions array.\n *\n *  A: [b c d e f]\n *      ^\n *  B: [c b h f e]\n *  P: [. 0 . . .] // . == -1\n *  I: {\n *    c: 0,\n *    b: 1, <-\n *    h: 2,\n *    f: 3,\n *    e: 4,\n *  }\n *  last = 1\n *\n * When we assigning positions to the positions array, we also keep a position of the last seen node in the new children\n * list, if the last seen position is larger than current position of the node at the new list, then we are switching\n * `moved` flag to `true`.\n *\n *  A: [b c d e f]\n *        ^\n *  B: [c b h f e]\n *  P: [1 0 . . .] // . == -1\n *  I: {\n *    c: 0, <-\n *    b: 1,\n *    h: 2,\n *    f: 3,\n *    e: 4,\n *  }\n *  last = 1 // last > 0; moved = true\n *\n * The last position `1` is larger than current position of the node at the new list `0`, switching `moved` flag to\n * `true`.\n *\n *  A: [b c d e f]\n *          ^\n *  B: [c b h f e]\n *  P: [1 0 . . .] // . == -1\n *  I: {\n *    c: 0,\n *    b: 1,\n *    h: 2,\n *    f: 3,\n *    e: 4,\n *  }\n *  moved = true\n *\n * Node with key \"d\" doesn't exist in the index, removing node.\n *\n *  A: [b c d e f]\n *            ^\n *  B: [c b h f e]\n *  P: [1 0 . . 3] // . == -1\n *  I: {\n *    c: 0,\n *    b: 1,\n *    h: 2,\n *    f: 3,\n *    e: 4, <-\n *  }\n *  moved = true\n *\n * Assign position for `e`.\n *\n *  A: [b c d e f]\n *              ^\n *  B: [c b h f e]\n *  P: [1 0 . 4 3] // . == -1\n *  I: {\n *    c: 0,\n *    b: 1,\n *    h: 2,\n *    f: 3, <-\n *    e: 4,\n *  }\n *  moved = true\n *\n * Assign position for 'f'.\n *\n * At this point we are checking if `moved` flag is on, or if the length of the old children list minus the number of\n * removed nodes isn't equal to the length of the new children list. If any of this conditions is true, then we are\n * going to the next step.\n *\n * 3. Find minimum number of moves if `moved` flag is on, or insert new nodes if the length is changed.\n *\n * When `moved` flag is on, we need to find the\n * [longest increasing subsequence](http://en.wikipedia.org/wiki/Longest_increasing_subsequence) in the positions array,\n * and move all nodes that doesn't belong to this subsequence.\n *\n *  A: [b c d e f]\n *  B: [c b h f e]\n *  P: [1 0 . 4 3] // . == -1\n *  LIS:     [1 4]\n *  moved = true\n *\n * Now we just need to simultaneously iterate over the new children list and LIS from the end and check if the current\n * position is equal to a value from LIS.\n *\n *  A: [b c d e f]\n *  B: [c b h f e]\n *              ^  // new_pos == 4\n *  P: [1 0 . 4 3] // . == -1\n *  LIS:     [1 4]\n *              ^  // new_pos == 4\n *  moved = true\n *\n * Node \"e\" stays at the same place.\n *\n *  A: [b c d e f]\n *  B: [c b h f e]\n *            ^    // new_pos == 3\n *  P: [1 0 . 4 3] // . == -1\n *  LIS:     [1 4]\n *            ^    // new_pos != 1\n *  moved = true\n *\n * Node \"f\" is moved, move it before the next node \"e\".\n *\n *  A: [b c d e f]\n *  B: [c b h f e]\n *          ^      // new_pos == 2\n *  P: [1 0 . 4 3] // . == -1\n *          ^      // old_pos == -1\n *  LIS:     [1 4]\n *            ^\n *  moved = true\n *\n * Node \"h\" has a `-1` value in the positions array, insert new node \"h\".\n *\n *  A: [b c d e f]\n *  B: [c b h f e]\n *        ^        // new_pos == 1\n *  P: [1 0 . 4 3] // . == -1\n *  LIS:     [1 4]\n *            ^    // new_pos == 1\n *  moved = true\n *\n * Node \"b\" stays at the same place.\n *\n *  A: [b c d e f]\n *  B: [c b h f e]\n *      ^          // new_pos == 0\n *  P: [1 0 . 4 3] // . == -1\n *  LIS:     [1 4]\n *          ^      // new_pos != undefined\n *  moved = true\n *\n * Node \"c\" is moved, move it before the next node \"b\".\n *\n * When moved flag is off, we don't need to find LIS, and we just iterate over the new children list and check its\n * current position in the positions array, if it is `-1`, then we insert new node.\n *\n * [1] Actually it is almost minimum number of dom ops, when node is removed and another one is inserted at the same\n * place, instead of insert and remove dom ops, we can use one replace op. It will make everything even more\n * complicated, and other use cases will be slower, so I don't think that it is worth to use replace here.\n *\n * @param parentElement Parent DOM element.\n * @param opState OpNode state for a TrackByKey operation.\n * @param a Previous operations.\n * @param b Next operations.\n * @param moveNode Children DOM nodes should be moved.\n * @param singleChild Parent DOM element contains a single node.\n * @noinline\n */\nfunction _updateChildrenTrackByKeys(parentElement, opState, a, b, moveNode, singleChild) {\n    let i = b.length;\n    let j = a.length;\n    let deepState = 0;\n    const result = Array(i);\n    if (i === 0) { // New children list is empty.\n        if (j > 0) { // Unmount nodes from the old children list.\n            _unmount(parentElement, opState, singleChild);\n        }\n    }\n    else if (j === 0) { // Old children list is empty.\n        while (i > 0) { // Mount nodes from the new children list.\n            result[--i] = _mount(parentElement, b[i].v);\n            deepState |= _deepStateFlags;\n            _deepStateFlags = 0;\n        }\n    }\n    else {\n        const opStateChildren = opState.c;\n        let aEnd = j - 1; // a.length - 1\n        let bEnd = i - 1; // b.length - 1\n        let start = 0;\n        let node = b[bEnd];\n        // Step 1\n        outer: while (true) {\n            // Update nodes with the same key at the end.\n            while (a[aEnd].k === node.k) {\n                result[bEnd] = _update(parentElement, opStateChildren[aEnd--], node.v, moveNode, false);\n                deepState |= _deepStateFlags;\n                _deepStateFlags = 0;\n                if (start > --bEnd || start > aEnd) {\n                    break outer;\n                }\n                node = b[bEnd];\n            }\n            // Update nodes with the same key at the beginning.\n            while (a[start].k === b[start].k && ++start <= aEnd && start <= bEnd) {\n                // delayed update (all updates should be performed from right-to-left).\n            }\n            break;\n        }\n        if (start > aEnd) {\n            // All nodes from `a` are updated, insert the rest from `b`.\n            while (bEnd >= start) {\n                result[bEnd] = _mount(parentElement, b[bEnd--].v);\n                deepState |= _deepStateFlags;\n                _deepStateFlags = 0;\n            }\n        }\n        else if (start > bEnd) {\n            // All nodes from `b` are updated, remove the rest from `a`.\n            i = start;\n            do {\n                if ((node = opStateChildren[i++]) !== null) {\n                    _unmount(parentElement, node, false);\n                }\n            } while (i <= aEnd);\n        }\n        else { // Step 2\n            // When `pos === 99999999`, it means that one of the nodes is in the wrong position and we should rearrange nodes\n            // with lis-based algorithm.\n            let pos = 0;\n            // Number of updated nodes after prefix/suffix phase. It is used for an optimization that removes all child nodes\n            // with `textContent=\"\"` when there are no updated nodes.\n            let updated = 0;\n            const aLength = aEnd - start + 1;\n            const bLength = bEnd - start + 1;\n            const sources = Array(bLength); // Maps positions in the new children list to positions in the old children list.\n            const keyIndex = new Map(); // Maps keys to their positions in the new children list.\n            for (i = 0; i < bLength; ++i) {\n                j = i + start;\n                sources[i] = -1; // Special value `-1` indicates that node doesn't exist in the old children list.\n                keyIndex.set(b[j].k, j);\n            }\n            for (i = start; i <= aEnd && updated < bLength; ++i) {\n                j = keyIndex.get(a[i].k);\n                if (j !== void 0) {\n                    pos = (pos < j) ? j : 99999999;\n                    ++updated;\n                    sources[j - start] = i;\n                    result[j] = opStateChildren[i];\n                    // remove updated nodes from previous array, so that we could remove the rest from the document.\n                    opStateChildren[i] = null;\n                }\n            }\n            if (aLength === a.length && updated === 0) {\n                // Zero updated nodes in step 1 and 2, remove all nodes and insert new ones.\n                _unmount(parentElement, opState, singleChild);\n                while (bEnd >= 0) {\n                    result[bEnd] = _mount(parentElement, b[bEnd--].v);\n                    deepState |= _deepStateFlags;\n                    _deepStateFlags = 0;\n                }\n            }\n            else {\n                // Step 3\n                // Remove nodes that weren't updated in the old children list.\n                for (i = start; i <= aEnd; i++) {\n                    if ((node = opStateChildren[i]) !== null) {\n                        _unmount(parentElement, node, false);\n                    }\n                }\n                i = bLength;\n                if (moveNode === true || pos !== 99999999) {\n                    while (i > 0) {\n                        pos = --i + start;\n                        node = b[pos].v;\n                        result[pos] = (sources[i] === -1) ?\n                            _mount(parentElement, node) :\n                            _update(parentElement, result[pos], node, moveNode, false);\n                        deepState |= _deepStateFlags;\n                        _deepStateFlags = 0;\n                    }\n                }\n                else {\n                    const seq = lis(sources);\n                    j = seq.length - 1;\n                    while (i > 0) {\n                        pos = --i + start;\n                        node = b[pos].v;\n                        if (sources[i] === -1) {\n                            result[pos] = _mount(parentElement, node);\n                        }\n                        else {\n                            if (j < 0 || i !== seq[j]) {\n                                moveNode = true;\n                            }\n                            else {\n                                --j;\n                            }\n                            result[pos] = _update(parentElement, result[pos], node, moveNode, false);\n                            moveNode = false;\n                        }\n                        deepState |= _deepStateFlags;\n                        _deepStateFlags = 0;\n                    }\n                }\n            }\n        }\n        // update nodes from Step 1 (prefix only)\n        while (start > 0) {\n            result[--start] = _update(parentElement, opStateChildren[start], b[start].v, moveNode, false);\n            deepState |= _deepStateFlags;\n            _deepStateFlags = 0;\n        }\n    }\n    opState.c = result;\n    _deepStateFlags = deepState;\n}\n/**\n * Slightly modified Longest Increased Subsequence algorithm, it ignores items that have -1 value, they're representing\n * new items.\n *\n * {@link http://en.wikipedia.org/wiki/Longest_increasing_subsequence}\n *\n * It is possible to use typed arrays in this function, and it will make it faster in most javascript engines, but for\n * some reason instantiating small typed arrays is slower in synthetic microbenchmarks on V8\n * {@link https://gist.github.com/localvoid/88da772d987794605f7fa4a078bce4d6} (maybe there is something wrong in this\n * benchmarks, if someone want to spend more time on optimizations, I'd recommend to double check everything).\n *\n * To solve problem with instantiation, we could just reuse arrays, but in my opinion it isn't worth to overcomplicate\n * this algorithm since it is already extremely fast and it is highly unlikely that it will be even noticeable in the\n * profiler. Usually when there is an update in the real applications, it triggers reordering of one dynamic children\n * list, that is why I prefer to keep it simple.\n *\n * @param a - Array of numbers\n * @returns Longest increasing subsequence\n * @noinline\n */\nfunction lis(a) {\n    const p = a.slice();\n    // result is instantiated as an empty array to prevent instantiation with CoW backing store.\n    const result = [];\n    let n = 0;\n    let i = 0;\n    let u;\n    let v;\n    let j;\n    result[0] = 0;\n    for (; i < a.length; ++i) {\n        const k = a[i];\n        if (k > -1) {\n            j = result[n];\n            if (a[j] < k) {\n                p[i] = j;\n                result[++n] = i;\n            }\n            else {\n                u = 0;\n                v = n;\n                while (u < v) {\n                    j = (u + v) >> 1;\n                    if (a[result[j]] < k) {\n                        u = j + 1;\n                    }\n                    else {\n                        v = j;\n                    }\n                }\n                if (k < a[result[u]]) {\n                    if (u > 0) {\n                        p[i] = result[u - 1];\n                    }\n                    result[u] = i;\n                }\n            }\n        }\n    }\n    v = result[n];\n    while (n >= 0) {\n        result[n--] = v;\n        v = p[v];\n    }\n    return result;\n}\n/**\n * Update DOM classname.\n *\n * @param element DOM Element.\n * @param className Class name.\n * @param svg SVG Element.\n */\nfunction _updateClassName(element, className, svg) {\n    /**\n     * SVGElement.className returns `SVGAnimatedString`.\n     *\n     * #quirks\n     */\n    if (svg === true) {\n        elementSetAttribute.call(element, \"class\", className);\n    }\n    else {\n        elementSetClassName.call(element, className);\n    }\n}\n/**\n * Update DOM styles.\n *\n * @param element HTML or SVG Element.\n * @param a Prev styles.\n * @param b Next styles.\n */\nfunction _updateStyle(element, a, b, svg) {\n    const style = svg === true ? svgElementGetStyle.call(element) : htmlElementGetStyle.call(element);\n    let key;\n    let bValue;\n    if (a === void 0) {\n        // a is empty, insert all styles from b.\n        for (key in b) {\n            bValue = b[key];\n            if (bValue !== void 0) {\n                style.setProperty(key, bValue);\n            }\n        }\n    }\n    else if (b === void 0) {\n        // b is empty, remove all styles from a\n        for (key in a) {\n            if (a[key] !== void 0) {\n                style.removeProperty(key);\n            }\n        }\n    }\n    else {\n        let matchCount = 0;\n        let i = 0;\n        for (key in a) {\n            const aValue = a[key];\n            bValue = (objectHasOwnProperty.call(b, key) === true) ? (matchCount++, b[key]) : void 0;\n            if (aValue !== bValue) {\n                if (bValue !== void 0) {\n                    style.setProperty(key, bValue);\n                }\n                else {\n                    style.removeProperty(key);\n                }\n            }\n        }\n        const keys = Object.keys(b);\n        for (; matchCount < keys.length && i < keys.length; ++i) {\n            key = keys[i];\n            if (objectHasOwnProperty.call(a, key) === false) {\n                bValue = b[key];\n                ++matchCount;\n                if (bValue !== void 0) {\n                    style.setProperty(key, b[key]);\n                }\n            }\n        }\n    }\n}\n/**\n * Update DOM attributes.\n *\n * @param element DOM element.\n * @param a Prev DOM attributes.\n * @param b Next DOM attributes.\n */\nfunction _updateAttrs(element, a, b, svg) {\n    let key;\n    if (a === void 0) {\n        // a is empty, insert all attributes from b.\n        for (key in b) {\n            _updateAttr(element, key, void 0, b[key], svg);\n        }\n    }\n    else if (b === void 0) {\n        // b is empty, remove all attributes from a.\n        for (key in a) {\n            _updateAttr(element, key, a[key], void 0, svg);\n        }\n    }\n    else {\n        let matchCount = 0;\n        let i = 0;\n        for (key in a) {\n            _updateAttr(element, key, a[key], (objectHasOwnProperty.call(b, key) === true) ? (matchCount++, b[key]) : void 0, svg);\n        }\n        const keys = Object.keys(b);\n        for (; matchCount < keys.length && i < keys.length; ++i) {\n            key = keys[i];\n            if (objectHasOwnProperty.call(a, key) === false) {\n                _updateAttr(element, key, void 0, b[key], svg);\n                ++matchCount;\n            }\n        }\n    }\n}\n/**\n * Update DOM attribute.\n *\n * @param element DOM Element.\n * @param key Attribute name.\n * @param prev Previous value.\n * @param next Next value.\n */\nfunction _updateAttr(element, key, prev, next, svg) {\n    if (key !== \"style\") {\n        if (typeof next === \"object\") {\n            /* istanbul ignore else */\n            if (process.env.NODE_ENV !== \"production\") {\n                if (typeof prev !== \"object\" && prev !== void 0) {\n                    throw new Error(`Invalid DOM attribute, transitioning from basic values to attribute directives isn't allowed`);\n                }\n            }\n            next.u(element, key, prev === void 0 ? void 0 : prev.v, next.v);\n        }\n        else if (typeof prev === \"object\") {\n            /* istanbul ignore else */\n            if (process.env.NODE_ENV !== \"production\") {\n                if (typeof next !== \"object\" && next !== void 0) {\n                    throw new Error(`Invalid DOM attribute, transitioning from attribute directives to basic values isn't allowed`);\n                }\n            }\n            prev.u(element, key, prev.v, void 0);\n        }\n        else if (prev !== next) {\n            if (typeof next === \"boolean\") {\n                next = next ? \"\" : void 0;\n            }\n            if (next === void 0) {\n                if (prev !== void 0 && prev !== false) {\n                    elementRemoveAttribute.call(element, key);\n                }\n            }\n            else {\n                elementSetAttribute.call(element, key, next);\n            }\n        }\n    }\n    else if (prev !== next) {\n        _updateStyle(element, prev, next, svg);\n    }\n}\n//# sourceMappingURL=reconciler.js.map","/**\n * Escapes HTML text.\n *\n * {@link https://www.w3.org/TR/html5/syntax.html#data-state}\n * {@link https://www.w3.org/TR/html5/syntax.html#rcdata-state}\n *\n * @param text - Text\n * @returns Escaped text\n */\nexport function escapeText(text) {\n    if (typeof text === \"string\") {\n        if (text.indexOf(\"&\") === -1 && text.indexOf(\"<\") === -1) {\n            return text;\n        }\n        let result = text;\n        let start = 0;\n        let i = 0;\n        for (; i < text.length; ++i) {\n            let escape;\n            switch (text.charCodeAt(i)) {\n                case 38: // &\n                    escape = \"&amp;\";\n                    break;\n                case 60: // <\n                    escape = \"&lt;\";\n                    break;\n                default:\n                    continue;\n            }\n            if (i > start) {\n                escape = text.slice(start, i) + escape;\n            }\n            result = (start > 0) ? result + escape : escape;\n            start = i + 1;\n        }\n        if (i !== start) {\n            return result + text.slice(start, i);\n        }\n        return result;\n    }\n    return text.toString();\n}\n/**\n * Escapes HTML attribute values.\n *\n * {@link https://www.w3.org/TR/html5/syntax.html#attribute-value-(double-quoted)-state}\n *\n * @param text - Attribute value\n * @returns Escaped attribute value\n */\nexport function escapeAttributeValue(text) {\n    if (typeof text === \"string\") {\n        if (text.indexOf(\"\\\"\") === -1 && text.indexOf(\"&\") === -1) {\n            return text;\n        }\n        let result = text;\n        let start = 0;\n        let i = 0;\n        for (; i < text.length; ++i) {\n            let escape;\n            switch (text.charCodeAt(i)) {\n                case 34: // \"\n                    escape = \"&quot;\";\n                    break;\n                case 38: // &\n                    escape = \"&amp;\";\n                    break;\n                default:\n                    continue;\n            }\n            if (i > start) {\n                escape = text.slice(start, i) + escape;\n            }\n            result = (start > 0) ? result + escape : escape;\n            start = i + 1;\n        }\n        if (i !== start) {\n            return result + text.slice(start, i);\n        }\n        return result;\n    }\n    return text.toString();\n}\n/**\n * Escapes javascript code.\n *\n * @param text - Text.\n * @returns Escaped text.\n */\nexport function escapeJavascript(text) {\n    let result = text;\n    let escape;\n    let start = 0;\n    let i = 0;\n    for (; i < text.length; ++i) {\n        switch (text.charCodeAt(i)) {\n            case 47: // /\n                escape = \"\\\\u002F\";\n                break;\n            case 60: // <\n                escape = \"\\\\u003C\";\n                break;\n            case 62: // >\n                escape = \"\\\\u003E\";\n                break;\n            case 8232:\n                escape = \"\\\\u2028\";\n                break;\n            case 8233:\n                escape = \"\\\\u2029\";\n                break;\n            default:\n                continue;\n        }\n        if (i > start) {\n            escape = text.slice(start, i) + escape;\n        }\n        result = (start > 0) ? result + escape : escape;\n        start = i + 1;\n    }\n    if (start !== 0 && i !== start) {\n        return result + text.slice(start, i);\n    }\n    return result;\n}\n//# sourceMappingURL=escape.js.map","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"ui/views/menu__container\",\"selectedDisplay\":\"ui/views/menu__selectedDisplay\",\"selectedDisplayExpanded\":\"ui/views/menu__selectedDisplayExpanded\",\"selectableOptions\":\"ui/views/menu__selectableOptions\",\"optionDefault\":\"ui/views/menu__optionDefault\",\"optionSelected\":\"ui/views/menu__optionSelected\"};","// shim for using process in browser\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\nfunction defaultSetTimout() {\n    throw new Error('setTimeout has not been defined');\n}\nfunction defaultClearTimeout () {\n    throw new Error('clearTimeout has not been defined');\n}\n(function () {\n    try {\n        if (typeof setTimeout === 'function') {\n            cachedSetTimeout = setTimeout;\n        } else {\n            cachedSetTimeout = defaultSetTimout;\n        }\n    } catch (e) {\n        cachedSetTimeout = defaultSetTimout;\n    }\n    try {\n        if (typeof clearTimeout === 'function') {\n            cachedClearTimeout = clearTimeout;\n        } else {\n            cachedClearTimeout = defaultClearTimeout;\n        }\n    } catch (e) {\n        cachedClearTimeout = defaultClearTimeout;\n    }\n} ())\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    // if setTimeout wasn't available but was latter defined\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n        cachedSetTimeout = setTimeout;\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch(e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch(e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    // if clearTimeout wasn't available but was latter defined\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n        cachedClearTimeout = clearTimeout;\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\nprocess.prependListener = noop;\nprocess.prependOnceListener = noop;\n\nprocess.listeners = function (name) { return [] }\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"icon\":\"ui/views/icons__icon\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"xswitch\":\"ui/views/switch__xswitch\",\"switchButtonContainer\":\"ui/views/switch__switchButtonContainer\",\"switchButton\":\"ui/views/switch__switchButton\",\"bgColorPrimary\":\"ui/views/switch__bgColorPrimary\",\"bgColorSecondary\":\"ui/views/switch__bgColorSecondary\",\"switchBar\":\"ui/views/switch__switchBar\"};","import { _update, _dirtyCheck, _resetState } from \"./reconciler\";\nimport { enableContext, disableContext } from \"./context\";\n/**\n * Root nodes.\n */\nexport const ROOTS = [];\n/**\n * Find root node of a container.\n *\n * @param predicate - Find predicate.\n * @returns root node or undefined when root node doesn't exist.\n */\nexport const findRoot = (predicate) => ROOTS.find(predicate);\n/**\n * Performs a dirty checking.\n */\nexport function dirtyCheck() {\n    /* istanbul ignore else */\n    if (process.env.NODE_ENV !== \"production\") {\n        enableContext();\n    }\n    for (let i = 0; i < ROOTS.length; ++i) {\n        const root = ROOTS[i];\n        const { container, state, next } = root;\n        _resetState();\n        if (next !== void 0) {\n            root.next = void 0;\n            root.state = _update(container, state, next, false, true);\n        }\n        else if (state !== null) {\n            _dirtyCheck(container, state, false, true);\n        }\n    }\n    /* istanbul ignore else */\n    if (process.env.NODE_ENV !== \"production\") {\n        disableContext();\n    }\n}\n//# sourceMappingURL=root.js.map","import { EMPTY_OBJECT, TASK_TOKEN, SELECT_TOKEN, UNMOUNT_TOKEN } from \"../core\";\nimport { clock, scheduleMutationEffect, scheduleLayoutEffect } from \"../scheduler\";\nfunction addHook(hooks, hook) {\n    if (hooks === null) {\n        return hook;\n    }\n    if (typeof hooks === \"function\") {\n        return [hooks, hook];\n    }\n    hooks.push(hook);\n    return hooks;\n}\nexport function useSelect(component, selector, areEqual) {\n    /* istanbul ignore next */\n    if (process.env.IVI_TARGET === \"ssr\") {\n        return (nextProps) => selector(nextProps, void 0);\n    }\n    let lastChecked = 0;\n    let state;\n    let props;\n    const prevSelector = component.s.s;\n    const hook = (p) => {\n        if (p === SELECT_TOKEN) {\n            if (prevSelector !== null && prevSelector(SELECT_TOKEN) === true) {\n                return true;\n            }\n            if (state !== void 0) {\n                p = selector(props, state);\n                lastChecked = clock();\n                if (state !== p) {\n                    state = p;\n                    return true;\n                }\n            }\n            return false;\n        }\n        if ((state !== void 0) &&\n            ((props !== p) &&\n                (areEqual === void 0 || areEqual(props, p) !== true))) {\n            state = void 0;\n        }\n        if (state === void 0 || lastChecked < clock()) {\n            state = selector(p, state);\n        }\n        props = p;\n        return state;\n    };\n    component.s.s = hook;\n    return hook;\n}\n/**\n * useUnmount creates an unmount hook.\n *\n * @example\n *\n *     const C = component((c) => {\n *       useUnmount(c, () => {\n *         console.log(\"unmounted\");\n *       });\n *\n *       return () => div();\n *     });\n *\n * @param component Component instance.\n * @param hook Unmount hook.\n */\nexport function useUnmount(component, hook) {\n    /* istanbul ignore else */\n    if (process.env.IVI_TARGET !== \"ssr\") {\n        component.f |= 32768 /* Unmount */;\n        const hooks = component.s;\n        hooks.u = addHook(hooks.u, hook);\n    }\n}\nfunction withEffect(scheduleTask) {\n    return (component, hook, areEqual) => {\n        let reset;\n        let props = EMPTY_OBJECT;\n        const handler = (p) => {\n            if (p === TASK_TOKEN || p === UNMOUNT_TOKEN) {\n                if (reset !== void 0) {\n                    reset();\n                }\n                if (p !== UNMOUNT_TOKEN) {\n                    reset = hook(props);\n                    if (reset !== void 0 && component !== void 0) {\n                        useUnmount(component, handler);\n                        // remove component reference to indicate that unmount hook is registered.\n                        component = void 0;\n                    }\n                }\n            }\n            else if ((props === EMPTY_OBJECT) ||\n                ((props !== p) &&\n                    (areEqual === void 0 || areEqual(props, p) !== true))) {\n                props = p;\n                scheduleTask(handler);\n            }\n        };\n        return handler;\n    };\n}\n/**\n * useEffect creates a side effect hook.\n *\n * @example\n *\n *     const Counter = component<number>((c) => {\n *       let i = 0;\n *       const timer = useEffect<number>(c, (delay) => {\n *         const tid = setInterval(() => {\n *           i++;\n *           invalidate(c);\n *         }, delay);\n *         return () => { clearInterval(tid); };\n *       });\n *\n *       return (delay) => (\n *         timer(delay),\n *\n *         div(_, _, i),\n *       );\n *     });\n *\n * @typeparam T Hook props type.\n * @param component Component instance.\n * @param hook Side effect function.\n * @param areEqual `areEqual` function.\n * @returns Side effect hook.\n */\nexport const useEffect = process.env.IVI_TARGET === \"ssr\" ?\n    /* istanbul ignore next */ (props) => { } :\n    ( /*#__PURE__*/withEffect((task) => { task(TASK_TOKEN); }));\n/**\n * useMutationEffect creates a DOM mutation effect hook.\n *\n * @typeparam T Hook props type.\n * @param stateNode Component instance.\n * @param hook DOM mutation function.\n * @param areEqual `areEqual` function.\n * @returns Side effect hook.\n */\nexport const useMutationEffect = process.env.IVI_TARGET === \"ssr\" ?\n    /* istanbul ignore next */ (props) => { } :\n    ( /*#__PURE__*/withEffect(scheduleMutationEffect));\n/**\n * useLayoutEffect creates a DOM layout effect hook.\n *\n * @typeparam T Hook props type.\n * @param component Component instance.\n * @param hook DOM layout function.\n * @param areEqual `areEqual` function.\n * @returns Side effect hook.\n */\nexport const useLayoutEffect = process.env.IVI_TARGET === \"ssr\" ?\n    /* istanbul ignore next */ (props) => { } :\n    ( /*#__PURE__*/withEffect(scheduleLayoutEffect));\n//# sourceMappingURL=hooks.js.map","// extracted by mini-css-extract-plugin\nmodule.exports = {\"wrapper\":\"ui/index__wrapper\",\"bottomLeft\":\"ui/index__bottomLeft\",\"bottomRight\":\"ui/index__bottomRight\",\"appContainer\":\"ui/index__appContainer\",\"layersViewContainer\":\"ui/index__layersViewContainer\",\"canvas\":\"ui/index__canvas\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"ui/views/labeled__container\",\"label\":\"ui/views/labeled__label\",\"content\":\"ui/views/labeled__content\",\"textContainer\":\"ui/views/labeled__textContainer\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"ui/views/slider__container\",\"baseLine\":\"ui/views/slider__baseLine\",\"filledLineClass\":\"ui/views/slider__filledLineClass\",\"emptyButton\":\"ui/views/slider__emptyButton\",\"button\":\"ui/views/slider__button\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"ui/debugging__container\",\"contentContainer\":\"ui/debugging__contentContainer\",\"monospaced\":\"ui/debugging__monospaced\",\"codeInput\":\"ui/debugging__codeInput\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"primary\":\"ui/views/buttons__primary\",\"ddefault\":\"ui/views/buttons__ddefault\",\"sinkableUnsunk\":\"ui/views/buttons__sinkableUnsunk\",\"sinkableSunk\":\"ui/views/buttons__sinkableSunk\"};","import { PASSIVE_EVENTS } from \"../dom/feature_detection\";\n/* istanbul ignore next */\n/**\n * getEventTarget retrieves target element from an event.\n *\n * There are still some differences in modern browsers, so we need to use this function to retrieve event targets.\n *\n * #quirks\n *\n * @param ev Event.\n * @returns Target Element.\n */\nexport function getEventTarget(ev) {\n    let target = ev.target || window;\n    /**\n     * Some browsers are implementing it according to SVG 1.1 specs:\n     *\n     * https://developer.microsoft.com/en-us/microsoft-edge/platform/issues/7998724/\n     *\n     * \"If event attributes are assigned to referenced elements, then the actual target for the event will be the\n     * SVGElementInstance object within the 'instance tree' corresponding to the given referenced element.\"\n     *\n     * https://www.w3.org/TR/SVG/struct.html#UseElement\n     *\n     * SVG 2 redefined the use event handling model:\n     *\n     * - Removed the SVGElementInstance and SVGElementInstanceList interfaces, and the corresponding attributes on the\n     *   SVGUseElement interface.\n     * - Changed the ‘use’ element event flow to follow the Shadow DOM spec.\n     *\n     * https://www.w3.org/TR/SVG2/changes.html#structure\n     */\n    if (target.correspondingUseElement !== void 0) {\n        target = target.correspondingUseElement;\n    }\n    return target;\n}\n/* istanbul ignore next */\n/**\n * `{ capture: true, passive: true }` object that should be used as a 3rd parameter for `addEventListener` method.\n */\nexport const EVENT_CAPTURE_PASSIVE_OPTIONS = PASSIVE_EVENTS ? { \"capture\": true, \"passive\": true } : true;\n/* istanbul ignore next */\n/**\n * `{ capture: true, passive: false }` object that should be used as a 3rd parameter for `addEventListener` method.\n */\nexport const EVENT_CAPTURE_ACTIVE_OPTIONS = PASSIVE_EVENTS ? { \"capture\": true, \"passive\": false } : true;\n/* istanbul ignore next */\n/**\n * `{ passive: true }` object that should be used as a 3rd parameter for `addEventListener` method.\n */\nexport const EVENT_PASSIVE_OPTIONS = PASSIVE_EVENTS ? { \"passive\": true } : false;\n/* istanbul ignore next */\n/**\n * `{ passive: false }` object that should be used as a 3rd parameter for `addEventListener` method.\n */\nexport const EVENT_ACTIVE_OPTIONS = PASSIVE_EVENTS ? { \"passive\": false } : false;\n//# sourceMappingURL=utils.js.map","/**\n * Feature Detection is used to implement polyfills or just disable some features when browser doesn't support them.\n * For example, when browser doesn't support passive events, we can just ignore it and always use active events.\n */\n/* istanbul ignore next */\n/**\n * Passive event listeners are a new feature in the DOM spec that enable developers to opt-in to better scroll\n * performance by eliminating the need for scrolling to block on touch and wheel event listeners. Developers can\n * annotate touch and wheel listeners with {passive: true} to indicate that they will never invoke preventDefault.\n *\n * https://github.com/WICG/EventListenerOptions/blob/gh-pages/explainer.md\n */\nexport const PASSIVE_EVENTS = ((process.env.IVI_TARGET === \"ssr\") ? false :\n    (process.env.IVI_TARGET === \"electron\") ? true :\n        /*#__PURE__*/ (() => {\n            let v = false;\n            try {\n                // Test via a getter in the options object to see if the passive property is accessed\n                window.addEventListener(\"_\", null, {\n                    get passive() {\n                        return v = true;\n                    }\n                });\n            }\n            catch (e) {\n                // ignore\n            }\n            return v;\n        })());\n/* istanbul ignore next */\n/**\n * `key` property is available on KeyboardEvent instances.\n */\nexport const KEYBOARD_EVENT_KEY = ((process.env.IVI_TARGET !== \"ssr\") && ((process.env.IVI_TARGET === \"electron\") ||\n    (process.env.IVI_TARGET === \"evergreen\") ||\n    /*#__PURE__*/ KeyboardEvent.prototype.hasOwnProperty(\"key\")));\n/* istanbul ignore next */\n/**\n * `buttons` property is available on MouseEvent instances.\n */\nexport const MOUSE_EVENT_BUTTONS = ((process.env.IVI_TARGET !== \"ssr\") && ((process.env.IVI_TARGET === \"electron\") ||\n    (process.env.IVI_TARGET === \"evergreen\") ||\n    /*#__PURE__*/ MouseEvent.prototype.hasOwnProperty(\"buttons\")));\n/* istanbul ignore next */\n/**\n * Touch Events support.\n */\nexport const TOUCH_EVENTS = ((process.env.IVI_TARGET !== \"ssr\") &&\n    (\"ontouchstart\" in window));\n/* istanbul ignore next */\n/**\n * Pointer Events support.\n */\nexport const POINTER_EVENTS = ((process.env.IVI_TARGET !== \"ssr\") && ((process.env.IVI_TARGET === \"electron\") ||\n    (\"PointerEvent\" in window)));\n/* istanbul ignore next */\n/**\n * iOS proprietary GestureEvent.\n *\n * {@link https://developer.mozilla.org/en-US/docs/Web/API/GestureEvent}\n */\nexport const IOS_GESTURE_EVENT = ((process.env.IVI_TARGET === \"browser\") &&\n    (\"GestureEvent\" in window));\n/* istanbul ignore next */\n/**\n * InputDeviceCapabilities support.\n *\n * http://wicg.github.io/InputDeviceCapabilities/\n */\nexport const INPUT_DEVICE_CAPABILITIES = ((process.env.IVI_TARGET !== \"ssr\") && ((process.env.IVI_TARGET === \"electron\") ||\n    (\"InputDeviceCapabilities\" in window)));\n//# sourceMappingURL=feature_detection.js.map","/**\n * createStateNode creates a {@link StateNode} instance.\n *\n * @param op Operation.\n * @returns {@link StateNode} instance.\n */\nexport const createStateNode = (o) => ({ o, f: 0, c: null, s: null });\n//# sourceMappingURL=state.js.map","export const SVG_NAMESPACE = \"http://www.w3.org/2000/svg\";\nexport const XLINK_NAMESPACE = \"http://www.w3.org/1999/xlink\";\nexport const XML_NAMESPACE = \"http://www.w3.org/XML/1998/namespace\";\n//# sourceMappingURL=namespaces.js.map","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"ui/views/colorDisplay__container\",\"secondary\":\"ui/views/colorDisplay__secondary\",\"primary\":\"ui/views/colorDisplay__primary\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"ui/views/colorWheel__container\",\"cicleThumb\":\"ui/views/colorWheel__cicleThumb\",\"areaThumb\":\"ui/views/colorWheel__areaThumb\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"row\":\"ui/views/row__row\",\"column\":\"ui/views/row__column\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"textInput\":\"ui/brush__textInput\",\"detailsContainer\":\"ui/brush__detailsContainer\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"ui/views/inlineLabeled__container\",\"label\":\"ui/views/inlineLabeled__label\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"surfaceLook\":\"ui/views/surface__surfaceLook\",\"surface\":\"ui/views/surface__surface\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"toolBarContainer\":\"ui/toolbar__toolBarContainer\",\"leftBar\":\"ui/toolbar__leftBar\"};","import { NOOP } from \"../core\";\nimport { scheduleLayoutEffect } from \"../scheduler\";\nimport { emitChildren, emitAttribute } from \"../ssr/render\";\n/**\n * {@link AttributeDirective} that ignores rendering to string.\n */\nexport const IGNORE_RENDER_TO_STRING = ({ v: void 0, s: NOOP });\n/**\n * PROPERTY function creates an {@link AttributeDirective} that assigns a property to a property name derived from the\n * `key` of the attribute.\n *\n * When rendered to string, it will be ignored.\n *\n * @example\n *\n *   const e = div(\"\", { _customProperty: PROPERTY(\"value\") });\n *\n * @typeparam Property value type.\n * @param v Property value.\n * @returns {@link AttributeDirective}\n */\nexport const PROPERTY = (v) => (process.env.IVI_TARGET === \"ssr\" ? IGNORE_RENDER_TO_STRING : ({ v, u: updateProperty }));\n/**\n * Update function for an {@link AttributeDirective} created with a {@link PROPERTY} function.\n *\n * @param element Target element.\n * @param key Attribute key.\n * @param prev Previous value.\n * @param next Next value.\n */\nfunction updateProperty(element, key, prev, next) {\n    if (prev !== next && next !== void 0) {\n        element[key] = next;\n    }\n}\n/**\n * UNSAFE_HTML function creates a {@link AttributeDirective} that assigns an `innerHTML` property to an Element.\n *\n * When rendered to string, it will emit its value as inner HTML without any escaping.\n *\n * @example\n *\n *   const e = div(\"\", { unsafeHTML: UNSAFE_HTML(\"<span></span>\") });\n *\n * @param v innerHTML value.\n * @returns {@link AttributeDirective}\n */\nexport const UNSAFE_HTML = (v) => (process.env.IVI_TARGET === \"ssr\" ?\n    ({ v, s: renderToStringUnsafeHTML }) :\n    ({ v, u: updateUnsafeHTML }));\n/**\n * Render to string function for an {@link AttributeDirective} created with {@link UNSAFE_HTML} function.\n *\n * @param key Attribute key.\n * @param value Value.\n */\nfunction renderToStringUnsafeHTML(key, value) {\n    emitChildren(value);\n}\n/**\n * Update function for an {@link AttributeDirective} created with {@link UNSAFE_HTML} function.\n *\n * @param element Target element.\n * @param key Attribute key.\n * @param prev Previous value.\n * @param next Next value.\n */\nfunction updateUnsafeHTML(element, key, prev, next) {\n    if (prev !== next) {\n        if (next === void 0) {\n            element.innerHTML = \"\";\n        }\n        else if (prev !== void 0 || next !== \"\") {\n            element.innerHTML = next;\n        }\n    }\n}\n/**\n * EVENT function creates an {@link AttributeDirective} that assigns a native event handler derived from the `key`\n * attribute to an Element.\n *\n * When rendered to string, it will be ignored.\n *\n * @example\n *\n *   const e = div(\"\", { click: EVENT((ev) => { console.log(ev) }); });\n *\n * @param v Event handler.\n * @returns {@link AttributeDirective}\n */\nexport const EVENT = (v) => (process.env.IVI_TARGET === \"ssr\" ?\n    IGNORE_RENDER_TO_STRING :\n    ({ v, u: updateEvent }));\n/**\n * Update function for an {@link AttributeDirective} created with {@link EVENT} function.\n *\n * @param element Target element.\n * @param key Attribute key.\n * @param prev Previous value.\n * @param next Next value.\n */\nfunction updateEvent(element, key, prev, next) {\n    if (prev !== next) {\n        if (prev !== void 0) {\n            element.removeEventListener(key, prev);\n        }\n        if (next !== void 0) {\n            element.addEventListener(key, next);\n        }\n    }\n}\n/**\n * Synchronization function for {@link AttributeDirective} created with {@link AUTOFOCUS} function.\n *\n * @param element Target element.\n * @param key Attribute key.\n * @param prev Previous value.\n * @param next Next value.\n */\nfunction updateAutofocus(element, key, prev, next) {\n    if (prev === void 0 && next) {\n        scheduleLayoutEffect(() => { element.focus(); });\n    }\n}\n/**\n * {@link AttributeDirective} with `false` value and {@link updateAutofocus} sync function.\n */\nconst AUTOFOCUS_FALSE = { v: false, u: updateAutofocus };\n/**\n * {@link AttributeDirective} with `true` value and {@link updateAutofocus} sync function.\n */\nconst AUTOFOCUS_TRUE = { v: true, u: updateAutofocus };\n/**\n * {@link AttributeDirective} with `true` value that emits `autofocus` attribute.\n */\nconst AUTOFOCUS_TRUE_RENDER_TO_STRING = {\n    v: true,\n    s: () => { emitAttribute(\"autofocus\"); },\n};\n/**\n * AUTOFOCUS function creates a {@link AttributeDirective} that sets autofocus on an element.\n *\n * When rendered to string, it will emit `autofocus` attribute.\n *\n * @example\n *\n *   const e = input(\"\", { autofocus: AUTOFOCUS(true) });\n *\n * @param v Autofocus state.\n * @returns {@link AttributeDirective}\n */\nexport const AUTOFOCUS = (v) => (process.env.IVI_TARGET === \"ssr\" ?\n    v ? AUTOFOCUS_TRUE_RENDER_TO_STRING : IGNORE_RENDER_TO_STRING :\n    v ? AUTOFOCUS_TRUE : AUTOFOCUS_FALSE);\n//# sourceMappingURL=attribute_directive.js.map","import { findRoot } from \"../vdom/root\";\n/**\n * collectDispatchTargets traverses the DOM tree from the `target` Element to the root element, then goes down\n * through Virtual DOM tree and collects matching Event Handlers.\n *\n * @param result Accumulated Dispatch Targets.\n * @param target Target DOM Element.\n * @param match Matching event source.\n * @returns Dispatch targets.\n */\nfunction collectDispatchTargets(target, match) {\n    const targets = [];\n    const root = findRoot((r) => r.container.contains(target));\n    if (root) {\n        const container = root.container;\n        if (container !== target) {\n            visitUp(targets, match, target, container, root.state);\n        }\n    }\n    return targets;\n}\nfunction visitUp(result, match, element, root, stateNode) {\n    const parentElement = element.parentNode;\n    return (parentElement === root || (stateNode = visitUp(result, match, parentElement, root, stateNode)) !== null) ?\n        visitDown(result, match, element, stateNode) :\n        null;\n}\nfunction visitDown(result, match, element, stateNode) {\n    if (stateNode !== null) {\n        const { f, c } = stateNode;\n        let r;\n        if ((f & 2 /* Element */) !== 0) {\n            if (stateNode.s === element) {\n                return stateNode;\n            }\n            if (c !== null) {\n                return visitDown(result, match, element, c);\n            }\n        }\n        else if ((f & (16 /* Events */ | 4 /* Component */ | 32 /* Context */)) !== 0) {\n            if ((r = visitDown(result, match, element, stateNode.c)) !== null) {\n                if ((f & 16 /* Events */) !== 0) {\n                    collectDispatchTargetsFromEventsOpState(result, stateNode, stateNode.o.v, match);\n                }\n                return r;\n            }\n        }\n        else if ((f & (128 /* Fragment */ | 8 /* TrackByKey */)) !== 0) {\n            for (let i = 0; i < c.length; i++) {\n                if ((r = visitDown(result, match, element, c[i])) !== null) {\n                    return r;\n                }\n            }\n        }\n    }\n    return null;\n}\n/**\n * collectDispatchTargetsFromEventsOpState accumulates matching Event Handlers in `result` array from the `target`\n * operation state.\n *\n * @param result Accumulated Dispatch Targets.\n * @param t Target operation state.\n * @param h Event handler.\n * @param match Matching function.\n */\nfunction collectDispatchTargetsFromEventsOpState(result, t, h, match) {\n    if (h !== null) {\n        if (h instanceof Array) {\n            let i = h.length;\n            while (--i >= 0) {\n                collectDispatchTargetsFromEventsOpState(result, t, h[i], match);\n            }\n        }\n        else {\n            const source = h.d.s;\n            if ((typeof source === \"function\" && source(match) === true) ||\n                (source === match)) {\n                result.push({ t, h });\n            }\n        }\n    }\n}\n/**\n * dispatchEvent dispatches event to the list of dispatch targets.\n *\n * Simplified version of w3 Events flow algorithm. This algorithm doesn't include target phase, only capture and\n * bubbling phases. We don't care too much about w3 events compatibility, and there aren't any use cases that require\n * target phase.\n *\n * https://www.w3.org/TR/DOM-Level-3-Events/#event-flow\n *\n * @param src Event source.\n * @param targets Dispatch targets.\n * @param event Event to dispatch.\n * @param bubble Use bubbling phase.\n * @param dispatch Dispatch handler.\n */\nexport function dispatchEvent(src, target, event) {\n    const targets = collectDispatchTargets(target, src);\n    let i = targets.length;\n    let currentTarget;\n    let descriptor;\n    if (i > 0) {\n        // capture phase\n        while (--i >= 0) {\n            currentTarget = targets[i];\n            descriptor = currentTarget.h.d;\n            if ((descriptor.f & 1 /* Capture */) !== 0) {\n                if (descriptor.h(event, currentTarget, src) === true) {\n                    return;\n                }\n            }\n        }\n        // bubble phase\n        while (++i < targets.length) {\n            currentTarget = targets[i];\n            descriptor = currentTarget.h.d;\n            if ((descriptor.f & 1 /* Capture */) === 0) {\n                if (descriptor.h(event, currentTarget, src) === true) {\n                    return;\n                }\n            }\n        }\n    }\n}\n//# sourceMappingURL=dispatch.js.map","// extracted by mini-css-extract-plugin\nmodule.exports = {\"detailsContainer\":\"ui/eraser__detailsContainer\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"ui/miniMap__container\"};","import {\r\n    Op,\r\n    Events,\r\n    component,\r\n    _,\r\n    invalidate,\r\n    useEffect,\r\n    box,\r\n    OpState,\r\n    findDOMNode,\r\n    Ref,\r\n    onChange,\r\n} from \"ivi\"\r\nimport { div, ul, li, span, textarea, CONTENT } from \"ivi-html\"\r\nimport * as styles from \"./debugging.scss\"\r\nimport { SetOnce, PerfTracker, Signals } from \"../util\"\r\nimport { Surface, DefaultButton } from \"./views\"\r\nimport * as Canvas from \"../canvas\"\r\n\r\ninterface PerformanceProps {\r\n    readonly samplesSignal: Signals.Signal<readonly PerfTracker.Sample[]>\r\n}\r\n\r\nconst Performance = component<PerformanceProps>(c => {\r\n    let samples = SamplesOverTime.empty\r\n\r\n    const subscribe = useEffect<Signals.Signal<readonly PerfTracker.Sample[]>>(c, samplesSignal => {\r\n        const { dispose } = samplesSignal.subscribe(nextSamples => {\r\n            samples = samples.update(nextSamples)\r\n            invalidate(c)\r\n        })\r\n\r\n        return dispose\r\n    })\r\n\r\n    return (props): Op => {\r\n        subscribe(props.samplesSignal)\r\n\r\n        const samplecount = samples.length()\r\n        let max = Number.MIN_VALUE\r\n        let sum = 0\r\n\r\n        samples.forEach((sample, index) => {\r\n            const time = sample.endMs - sample.startMs\r\n            sum += time\r\n            if (time > max) {\r\n                max = time\r\n            }\r\n        })\r\n\r\n        return div(_, _, [\r\n            div(_, _, \"Max: \" + max.toFixed(3) + \" ms\"),\r\n            div(_, _, \"Avg: \" + (sum / samplecount).toFixed(3) + \" ms\"),\r\n        ])\r\n    }\r\n})\r\n\r\nclass SamplesOverTime {\r\n    static empty = new SamplesOverTime([], [], [], [])\r\n\r\n    private constructor(\r\n        readonly sample0: readonly PerfTracker.Sample[],\r\n        readonly sample1: readonly PerfTracker.Sample[],\r\n        readonly sample2: readonly PerfTracker.Sample[],\r\n        readonly sample3: readonly PerfTracker.Sample[]\r\n    ) {}\r\n\r\n    update(sample: readonly PerfTracker.Sample[]) {\r\n        return new SamplesOverTime(sample, this.sample0, this.sample1, this.sample2)\r\n    }\r\n\r\n    length() {\r\n        return this.sample0.length + this.sample1.length + this.sample2.length + this.sample3.length\r\n    }\r\n\r\n    forEach(f: (sample: PerfTracker.Sample, index: number) => void): void {\r\n        let samples = this.sample0\r\n        let length = 0\r\n        for (let i = 0; i < samples.length; i++) {\r\n            f(samples[i], i)\r\n        }\r\n        length += samples.length\r\n        samples = this.sample1\r\n        for (let i = 0; i < samples.length; i++) {\r\n            f(samples[i], length + i)\r\n        }\r\n        length += samples.length\r\n        samples = this.sample2\r\n        for (let i = 0; i < samples.length; i++) {\r\n            f(samples[i], length + i)\r\n        }\r\n        length += samples.length\r\n        samples = this.sample3\r\n        for (let i = 0; i < samples.length; i++) {\r\n            f(samples[i], length + i)\r\n        }\r\n    }\r\n}\r\n\r\ninterface ScriptingProps {\r\n    readonly gl: SetOnce<WebGLRenderingContext>\r\n}\r\n\r\nconst Scripting = component<ScriptingProps>(c => {\r\n    const textareaRef = box<OpState<HTMLTextAreaElement> | null>(null)\r\n    let code = \"\"\r\n\r\n    function onInput(ev: Event) {\r\n        code = (ev.target as any).value\r\n        invalidate(c)\r\n    }\r\n\r\n    function onKeyboard(ev: KeyboardEvent) {\r\n        const textareaNode = findDOMNode<HTMLTextAreaElement>(textareaRef)\r\n        if (textareaNode === null || textareaNode !== ev.target) {\r\n            return\r\n        }\r\n        if (ev.key === \"Enter\" && !ev.shiftKey && !ev.altKey) {\r\n            ev.preventDefault()\r\n            try {\r\n                /* eslint-disable-next-line no-eval */\r\n                console.log(eval(\"var gl = props.gl.value;\\n\" + code))\r\n            } catch {}\r\n            code = \"\"\r\n            invalidate(c)\r\n        }\r\n    }\r\n\r\n    const listenToKeyboard = useEffect(c, () => {\r\n        document.body.addEventListener(\"keydown\", onKeyboard)\r\n        return () => {\r\n            document.body.removeEventListener(\"keydown\", onKeyboard)\r\n        }\r\n    })\r\n\r\n    return (props): Op => {\r\n        listenToKeyboard()\r\n        return div(_, _, [\r\n            div(_, _, [\r\n                \"Variables\",\r\n                ul(_, _, li(_, _, [span(styles.monospaced, _, \"gl\"), \": WebGLRenderingContext\"])),\r\n            ]),\r\n            Ref(\r\n                textareaRef,\r\n                Events(\r\n                    onChange(onInput),\r\n                    textarea(styles.codeInput, {\r\n                        content: CONTENT(code),\r\n                    })\r\n                )\r\n            ),\r\n        ])\r\n    }\r\n})\r\n\r\ninterface DebugWindowProps {\r\n    readonly state: Canvas.State\r\n    readonly gl: SetOnce<WebGLRenderingContext>\r\n    readonly perfSamplesSignal: Signals.Signal<readonly PerfTracker.Sample[]>\r\n}\r\n\r\n// let's get the webgl context in here somehow!\r\n// there's a lot of stuff I could use that for... maybe even eval?\r\n\r\nexport const DebugWindow = component<DebugWindowProps>(c => {\r\n    let isOpen = false\r\n\r\n    function open() {\r\n        isOpen = true\r\n        invalidate(c)\r\n    }\r\n\r\n    function close() {\r\n        isOpen = false\r\n        invalidate(c)\r\n    }\r\n\r\n    return props => {\r\n        const { state } = props\r\n        return Surface(\r\n            !isOpen\r\n                ? DefaultButton({\r\n                      onClick: open,\r\n                      content: \"Debug\",\r\n                  })\r\n                : div(styles.container, _, [\r\n                      DefaultButton({\r\n                          content: \"Close\",\r\n                          onClick: close,\r\n                      }),\r\n                      div(styles.contentContainer, _, [\r\n                          \"RNG: \",\r\n                          div(styles.monospaced, _, state.rng.display()),\r\n                          Performance({\r\n                              samplesSignal: props.perfSamplesSignal,\r\n                          }),\r\n                          Scripting({\r\n                              gl: props.gl,\r\n                          }),\r\n                      ]),\r\n                  ])\r\n        )\r\n    }\r\n})\r\n","import * as BrushShader from \"../canvas/brushShader\"\r\nimport * as Color from \"color\"\r\nimport { lerp, distance, Vec2 } from \"../util\"\r\n\r\nexport interface Interpolatable {\r\n    readonly diameterPx: number\r\n    readonly spacingPct: number\r\n}\r\n\r\nexport interface InputPoint {\r\n    readonly alpha: number\r\n    readonly color: Color.RgbLinear\r\n    readonly position: Vec2\r\n    readonly pressure: number\r\n    readonly rotation: number\r\n}\r\n\r\nexport interface State {\r\n    readonly prevPoint: InputPoint\r\n}\r\n\r\nexport function init(prevPoint: InputPoint): State {\r\n    return { prevPoint }\r\n}\r\n\r\nexport function interpolate(\r\n    brush: Interpolatable,\r\n    state: State,\r\n    end: InputPoint\r\n): [State, readonly BrushShader.BrushPoint[]] {\r\n    if (state === null) {\r\n        const brushPoint = {\r\n            alpha: end.alpha,\r\n            color: end.color,\r\n            position: end.position,\r\n            rotation: end.rotation,\r\n            scaledDiameter: brush.diameterPx * end.pressure,\r\n        }\r\n        return [{ prevPoint: end }, [brushPoint]]\r\n    }\r\n\r\n    const start = state.prevPoint\r\n\r\n    const spacingPx = brush.spacingPct * brush.diameterPx\r\n    // const pcts =\r\n    //     brush.pressureAffectsSize && start.pressure !== end.pressure\r\n    //         ? interpolateWithPressureScaling(spacingPx, start, end)\r\n    //         : interpolateNormal(spacingPx, start, end)\r\n    const pcts = interpolateWithPressureScaling(spacingPx, start, end)\r\n\r\n    if (pcts.length === 0) {\r\n        return [state, []]\r\n    }\r\n\r\n    const pressureIsEq = start.pressure === end.pressure\r\n    const alphaIsEq = start.alpha === end.alpha\r\n    const colorIsEq = start.color.is(end.color)\r\n    const rotationIsEq = start.rotation === end.rotation\r\n\r\n    const pctsLen = pcts.length\r\n    const brushPoints = new Array<BrushShader.BrushPoint>(pctsLen)\r\n    for (let i = 0; i < pctsLen; i++) {\r\n        const pct = pcts[i]\r\n\r\n        const alpha = alphaIsEq ? start.alpha : lerp(pct, start.alpha, end.alpha)\r\n        const color = colorIsEq ? start.color : start.color.mix(pct, end.color)\r\n        const position = Vec2.lerp(pct, start.position, end.position)\r\n        const scaledDiameter =\r\n            brush.diameterPx *\r\n            (pressureIsEq ? start.pressure : lerp(pct, start.pressure, end.pressure))\r\n        const rotation = rotationIsEq ? start.rotation : lerp(pct, start.rotation, end.rotation)\r\n\r\n        brushPoints[i] = {\r\n            alpha,\r\n            color,\r\n            position,\r\n            scaledDiameter,\r\n            rotation,\r\n        }\r\n    }\r\n\r\n    const lastBrushPoint = brushPoints[pcts.length - 1]\r\n    const prevPoint: InputPoint = {\r\n        alpha: lastBrushPoint.alpha,\r\n        color: lastBrushPoint.color,\r\n        position: lastBrushPoint.position,\r\n        pressure: lerp(pcts[pcts.length - 1], start.pressure, end.pressure),\r\n        rotation: lastBrushPoint.rotation,\r\n    }\r\n\r\n    return [{ prevPoint }, brushPoints]\r\n}\r\n\r\n// TODO: fix this optimization\r\nfunction interpolateNormal(\r\n    spacingPx: number,\r\n    start: InputPoint,\r\n    end: InputPoint\r\n): readonly number[] {\r\n    const totalDist = Vec2.distance(start.position, end.position)\r\n\r\n    const count = Math.floor(totalDist / spacingPx)\r\n    const arr = new Array<number>(count)\r\n\r\n    for (let i = 0; i < count; i++) {\r\n        arr[i] = (i * spacingPx) / totalDist\r\n    }\r\n\r\n    return arr\r\n}\r\n\r\n// Potential optimization?: the if condition can probably be avoided\r\nfunction interpolateWithPressureScaling(\r\n    spacingPx: number,\r\n    start: InputPoint,\r\n    end: InputPoint\r\n): readonly number[] {\r\n    const arr: number[] = []\r\n    const endX = end.position.x\r\n    const endY = end.position.y\r\n    const endPressure = end.pressure\r\n    const endSpacing = Math.max(spacingPx * endPressure, 0.05)\r\n\r\n    let x = start.position.x\r\n    let y = start.position.y\r\n    let pressure = start.pressure\r\n\r\n    const totalDist = distance(x, y, endX, endY)\r\n\r\n    let dist = totalDist\r\n    let p = 0.5\r\n    let prevX = x\r\n    let prevY = y\r\n    let prevPressure = pressure\r\n\r\n    while (dist > endSpacing && p > 0) {\r\n        p = (spacingPx * pressure) / dist\r\n        x += p * (endX - x)\r\n        y += p * (endY - y)\r\n        pressure += p * (endPressure - pressure)\r\n\r\n        dist = distance(x, y, endX, endY)\r\n\r\n        if (x !== prevX || y !== prevY || pressure !== prevPressure) {\r\n            arr.push(1 - dist / totalDist)\r\n            prevX = x\r\n            prevY = y\r\n            prevPressure = pressure\r\n        }\r\n    }\r\n    return arr\r\n}\r\n","import { lerp } from \"../util\"\r\n\r\nexport interface Config {\r\n    readonly duration: number\r\n}\r\n\r\nexport const noDelay: Config = {\r\n    duration: 0,\r\n}\r\n\r\nfunction easing(x: number): number {\r\n    return x ** 0.92\r\n}\r\n\r\nexport function delay(duration: number): Config {\r\n    console.assert(duration >= 0, \"Delay can't be negative\")\r\n    return { duration }\r\n}\r\n\r\nexport interface Input {\r\n    readonly x: number\r\n    readonly y: number\r\n    readonly pressure: number\r\n}\r\n\r\nfunction inputLerp(pct: number, start: Input, end: Input): Input {\r\n    return {\r\n        pressure: lerp(pct, start.pressure, end.pressure),\r\n        x: lerp(pct, start.x, end.x),\r\n        y: lerp(pct, start.y, end.y),\r\n    }\r\n}\r\n\r\nexport interface State {\r\n    readonly startTime: number\r\n    readonly start: Input\r\n    readonly end: Input\r\n}\r\n\r\nexport function init(currentTime: number, start: Input): State {\r\n    return { startTime: currentTime, start, end: start }\r\n}\r\n\r\nexport function updateWithInput(\r\n    config: Config,\r\n    state: State,\r\n    currentTime: number,\r\n    end: Input\r\n): [State, Input] {\r\n    if (config.duration === 0) {\r\n        return [{ startTime: currentTime, start: end, end }, end]\r\n    }\r\n    const deltaTime = currentTime - state.startTime\r\n    const pct = easing(Math.min(deltaTime / config.duration, 1))\r\n    const output: Input = inputLerp(pct, state.start, end)\r\n    return [{ startTime: currentTime, start: output, end }, output]\r\n}\r\n\r\nexport function update(config: Config, state: State, currentTime: number): [State, Input] {\r\n    const deltaTime = currentTime - state.startTime\r\n    if (deltaTime >= config.duration) {\r\n        return [state, state.end]\r\n    }\r\n\r\n    const pct = easing(Math.min(deltaTime / config.duration, 1))\r\n    const output: Input = inputLerp(pct, state.start, state.end)\r\n    return [state, output]\r\n}\r\n","// Very basic and efficient immutable stack\r\n\r\nexport namespace Stack {\r\n    export interface Stack<a> {\r\n        isEmpty(): this is Empty<a>\r\n        isNonEmpty(): this is NonEmpty<a>\r\n        cons(value: a): NonEmpty<a>\r\n        foldl<b>(f: (val: b, next: a) => b, initial: b): b\r\n        reverse(): Stack<a>\r\n        toArray(): a[]\r\n        toString(): string\r\n    }\r\n\r\n    export class Empty<a> implements Stack<a> {\r\n        isEmpty(): true {\r\n            return true\r\n        }\r\n\r\n        isNonEmpty(): false {\r\n            return false\r\n        }\r\n\r\n        cons(value: a): NonEmpty<a> {\r\n            return new NonEmpty(value, this)\r\n        }\r\n\r\n        foldl<b>(_: (val: b, next: a) => b, initial: b): b {\r\n            return initial\r\n        }\r\n\r\n        reverse(): Empty<a> {\r\n            return this\r\n        }\r\n\r\n        toArray(): a[] {\r\n            return []\r\n        }\r\n\r\n        toString(): string {\r\n            return \"()\"\r\n        }\r\n    }\r\n\r\n    export class NonEmpty<a> implements Stack<a> {\r\n        static of<a>(value: a): NonEmpty<a> {\r\n            return new NonEmpty(value, empty())\r\n        }\r\n\r\n        constructor(readonly head: a, readonly tail: Stack<a>) {}\r\n\r\n        isEmpty(): false {\r\n            return false\r\n        }\r\n\r\n        isNonEmpty(): true {\r\n            return true\r\n        }\r\n\r\n        cons(value: a): NonEmpty<a> {\r\n            return new NonEmpty(value, this)\r\n        }\r\n\r\n        foldl<b>(f: (val: b, next: a) => b, initial: b): b {\r\n            let stack: Stack<a> = this\r\n            let state = initial\r\n            while (stack.isNonEmpty()) {\r\n                state = f(state, stack.head)\r\n                stack = stack.tail\r\n            }\r\n            return state\r\n        }\r\n\r\n        reverse(): NonEmpty<a> {\r\n            let nonReversed = this.tail\r\n            let reversed = NonEmpty.of(this.head)\r\n            while (nonReversed.isNonEmpty()) {\r\n                reversed = reversed.cons(nonReversed.head)\r\n                nonReversed = nonReversed.tail\r\n            }\r\n            return reversed\r\n        }\r\n\r\n        toArray(): a[] {\r\n            const arr: a[] = [this.head]\r\n            let stack = this.tail\r\n            while (stack.isNonEmpty()) {\r\n                arr.push(stack.head)\r\n                stack = stack.tail\r\n            }\r\n            return arr\r\n        }\r\n\r\n        toString(): string {\r\n            let str = \"(\" + this.head\r\n            let stack: Stack<a> = this.tail\r\n            while (stack.isNonEmpty()) {\r\n                str = str + \", \" + stack.head\r\n                stack = stack.tail\r\n            }\r\n\r\n            return str + \")\"\r\n        }\r\n    }\r\n\r\n    export function empty<a>(): Empty<a> {\r\n        return new Empty()\r\n    }\r\n\r\n    export function fromArray<a>(arr: readonly a[]): Stack<a> {\r\n        let stack: Stack<a> = empty()\r\n        let i = arr.length\r\n        while (i--) {\r\n            stack = stack.cons(arr[i])\r\n        }\r\n        return stack\r\n    }\r\n}\r\n","import * as Interp from \"./interpolation\"\r\nimport * as BrushDelay from \"./brushDelay\"\r\nimport * as BrushShader from \"../canvas/brushShader\"\r\nimport * as Camera from \"./camera\"\r\nimport * as Color from \"color\"\r\nimport { Vec2, ColorMode, clamp } from \"../util\"\r\nimport { ZipperList } from \"../collections/zipperList\"\r\nimport { TransformedPointerInput } from \"../canvas\"\r\n\r\nexport const enum MsgType {\r\n    SetDiameterMsg,\r\n    SetSoftnessMsg,\r\n    SetOpacityMsg,\r\n    SetColorMsg,\r\n    SetColorModeMsg,\r\n    SetSpacingMsg,\r\n    SetPressureAffectsOpacityMsg,\r\n    SetPressureAffectsSizeMsg,\r\n    SwapColorMsg,\r\n    SetDelayMsg,\r\n}\r\n\r\nexport type Msg =\r\n    | SetDiameterMsg\r\n    | SetSoftnessMsg\r\n    | SetOpacityMsg\r\n    | SetColorMsg\r\n    | SetColorModeMsg\r\n    | SetSpacingMsg\r\n    | SetPressureAffectsOpacityMsg\r\n    | SetPressureAffectsSizeMsg\r\n    | SwapColorMsg\r\n    | SetDelayMsg\r\n\r\nclass SetDiameterMsg {\r\n    readonly type: MsgType.SetDiameterMsg = MsgType.SetDiameterMsg\r\n    private nominal: void\r\n    constructor(readonly diameterPx: number) {}\r\n}\r\nclass SetSoftnessMsg {\r\n    readonly type: MsgType.SetSoftnessMsg = MsgType.SetSoftnessMsg\r\n    private nominal: void\r\n    constructor(readonly softnessPct: number) {}\r\n}\r\nclass SetOpacityMsg {\r\n    readonly type: MsgType.SetOpacityMsg = MsgType.SetOpacityMsg\r\n    private nominal: void\r\n    constructor(readonly opacityPct: number) {}\r\n}\r\nclass SetColorMsg {\r\n    readonly type: MsgType.SetColorMsg = MsgType.SetColorMsg\r\n    private nominal: void\r\n    constructor(readonly color: Color.Hsluv) {}\r\n}\r\nclass SetColorModeMsg {\r\n    readonly type: MsgType.SetColorModeMsg = MsgType.SetColorModeMsg\r\n    private nominal: void\r\n    constructor(readonly mode: ColorMode) {}\r\n}\r\nclass SetSpacingMsg {\r\n    readonly type: MsgType.SetSpacingMsg = MsgType.SetSpacingMsg\r\n    private nominal: void\r\n    constructor(readonly spacingPct: number) {}\r\n}\r\nclass SetPressureAffectsOpacityMsg {\r\n    readonly type: MsgType.SetPressureAffectsOpacityMsg = MsgType.SetPressureAffectsOpacityMsg\r\n    private nominal: void\r\n    constructor(readonly pressureAffectsOpacity: boolean) {}\r\n}\r\nclass SetPressureAffectsSizeMsg {\r\n    readonly type: MsgType.SetPressureAffectsSizeMsg = MsgType.SetPressureAffectsSizeMsg\r\n    private nominal: void\r\n    constructor(readonly pressureAffectsSize: boolean) {}\r\n}\r\nclass SwapColorMsg {\r\n    readonly type: MsgType.SwapColorMsg = MsgType.SwapColorMsg\r\n    private nominal: void\r\n    constructor() {}\r\n}\r\nclass SetDelayMsg {\r\n    readonly type: MsgType.SetDelayMsg = MsgType.SetDelayMsg\r\n    private nominal: void\r\n    constructor(readonly delayMs: number) {}\r\n}\r\n\r\nexport class MsgSender {\r\n    constructor(private sendMessage: (msg: Msg) => void) {}\r\n\r\n    readonly setColor = (color: Color.Hsluv): void => {\r\n        this.sendMessage(new SetColorMsg(color))\r\n    }\r\n    readonly setColorMode = (mode: ColorMode): void => {\r\n        this.sendMessage(new SetColorModeMsg(mode))\r\n    }\r\n    readonly setDelay = (ms: number): void => {\r\n        this.sendMessage(new SetDelayMsg(ms))\r\n    }\r\n    readonly setDiameter = (px: number): void => {\r\n        this.sendMessage(new SetDiameterMsg(px))\r\n    }\r\n    readonly setOpacity = (opacity: number): void => {\r\n        this.sendMessage(new SetOpacityMsg(opacity))\r\n    }\r\n    readonly setSoftness = (softness: number): void => {\r\n        this.sendMessage(new SetSoftnessMsg(softness))\r\n    }\r\n    readonly setSpacing = (px: number): void => {\r\n        this.sendMessage(new SetSpacingMsg(px))\r\n    }\r\n    readonly setPressureAffectsOpacity = (setPressureAffectsOpacity: boolean): void => {\r\n        this.sendMessage(new SetPressureAffectsOpacityMsg(setPressureAffectsOpacity))\r\n    }\r\n    readonly setPressureAffectsSize = (setPressureAffectsSize: boolean): void => {\r\n        this.sendMessage(new SetPressureAffectsSizeMsg(setPressureAffectsSize))\r\n    }\r\n    readonly swapColorFrom = (): void => {\r\n        this.sendMessage(new SwapColorMsg())\r\n    }\r\n}\r\n\r\nexport type EphemeralState = {\r\n    readonly interpState: Interp.State\r\n    readonly delayState: BrushDelay.State\r\n} | null\r\n\r\nexport function initTempState(): EphemeralState {\r\n    return null\r\n}\r\n\r\nexport interface State extends Interp.Interpolatable {\r\n    readonly diameterPx: number\r\n    readonly softness: number\r\n    readonly flowPct: number\r\n    readonly colorMode: ZipperList<ColorMode>\r\n    readonly color: Color.Hsluv\r\n    readonly colorSecondary: Color.Hsluv\r\n    readonly spacingPct: number\r\n    // TODO: I'll want more fine-grained control over _how_ pressure affects things\r\n    //       for that, I'll want some extra stuff: [min, max, interpFunc]\r\n    readonly pressureAffectsOpacity: boolean\r\n    readonly pressureAffectsSize: boolean\r\n    readonly delay: BrushDelay.Config\r\n}\r\n\r\nexport function init(): State {\r\n    return {\r\n        diameterPx: 15,\r\n        softness: 0.4,\r\n        flowPct: 0.3,\r\n        colorMode: ZipperList.unsafeFromArray([ColorMode.Hsluv, ColorMode.Hsv]),\r\n        color: new Color.Hsluv(73, 100, 16),\r\n        colorSecondary: new Color.Hsluv(0, 0, 100),\r\n        spacingPct: 0.05,\r\n        pressureAffectsOpacity: false,\r\n        pressureAffectsSize: true,\r\n        delay: BrushDelay.delay(5),\r\n    }\r\n}\r\n\r\nexport function update(state: State, msg: Msg): State {\r\n    switch (msg.type) {\r\n        case MsgType.SetDiameterMsg:\r\n            return { ...state, diameterPx: clamp(0.1, 500, msg.diameterPx) }\r\n        case MsgType.SetSoftnessMsg:\r\n            return { ...state, softness: clamp(0, 1, msg.softnessPct) }\r\n        case MsgType.SetOpacityMsg:\r\n            return { ...state, flowPct: clamp(0.01, 1, msg.opacityPct) }\r\n        case MsgType.SetColorMsg:\r\n            return { ...state, color: msg.color }\r\n        case MsgType.SetColorModeMsg:\r\n            return { ...state, colorMode: state.colorMode.focusf(x => x === msg.mode) }\r\n        case MsgType.SetSpacingMsg:\r\n            return { ...state, spacingPct: clamp(0.01, 1, msg.spacingPct) }\r\n        case MsgType.SetPressureAffectsOpacityMsg:\r\n            return { ...state, pressureAffectsOpacity: msg.pressureAffectsOpacity }\r\n        case MsgType.SetPressureAffectsSizeMsg:\r\n            return { ...state, pressureAffectsSize: msg.pressureAffectsSize }\r\n        case MsgType.SwapColorMsg:\r\n            return {\r\n                ...state,\r\n                color: state.colorSecondary,\r\n                colorSecondary: state.color,\r\n            }\r\n        case MsgType.SetDelayMsg:\r\n            return { ...state, delay: BrushDelay.delay(clamp(0, 500, msg.delayMs)) }\r\n        default:\r\n            const never: never = msg\r\n            throw { \"unexpected msg\": msg }\r\n    }\r\n}\r\n\r\nexport function onClick(\r\n    camera: Camera.State,\r\n    brush: State,\r\n    input: TransformedPointerInput\r\n): [EphemeralState, BrushShader.BrushPoint] {\r\n    const brushInput = pointerToBrushInput(camera, input)\r\n    const interpState = Interp.init(createInputPoint(brush, brushInput))\r\n    const delayState = BrushDelay.init(input.time, brushInput)\r\n    return [{ interpState, delayState }, createBrushPoint(brush, brushInput)]\r\n}\r\n\r\nexport function onDrag(\r\n    camera: Camera.State,\r\n    state: State,\r\n    tempState: EphemeralState,\r\n    inputs: readonly TransformedPointerInput[]\r\n): [EphemeralState, readonly BrushShader.BrushPoint[]] {\r\n    if (tempState === null) {\r\n        const res = onClick(camera, state, inputs[0])\r\n        return [res[0], [res[1]]]\r\n    } else {\r\n        let interpState: Interp.State = tempState.interpState\r\n        let brushPoints: readonly BrushShader.BrushPoint[] = []\r\n        let delayState = tempState.delayState\r\n        for (let i = 0; i < inputs.length; i++) {\r\n            const input = inputs[i]\r\n            const brushDelayInput = pointerToBrushInput(camera, input)\r\n\r\n            const updateResult = BrushDelay.updateWithInput(\r\n                state.delay,\r\n                delayState,\r\n                input.time,\r\n                brushDelayInput\r\n            )\r\n\r\n            const interpReslt = Interp.interpolate(\r\n                state,\r\n                interpState,\r\n                createInputPoint(state, updateResult[1])\r\n            )\r\n            delayState = updateResult[0]\r\n            interpState = interpReslt[0]\r\n            brushPoints = brushPoints.concat(interpReslt[1])\r\n        }\r\n\r\n        return [{ delayState, interpState }, brushPoints]\r\n    }\r\n}\r\n\r\nexport function onFrame(\r\n    brush: State,\r\n    state: EphemeralState,\r\n    currentTime: number\r\n): [EphemeralState, readonly BrushShader.BrushPoint[]] {\r\n    if (state === null) {\r\n        return [null, []]\r\n    }\r\n    // if (brush.delay.duration <= 0) return [null, []]\r\n\r\n    const [delayState, newBrushInput] = BrushDelay.update(\r\n        brush.delay,\r\n        state.delayState,\r\n        currentTime\r\n    )\r\n\r\n    const [interpState, brushPoints] = Interp.interpolate(\r\n        brush,\r\n        state.interpState,\r\n        createInputPoint(brush, newBrushInput)\r\n    )\r\n\r\n    return [{ delayState, interpState }, brushPoints]\r\n}\r\n\r\nexport function onRelease(\r\n    camera: Camera.State,\r\n    brush: State,\r\n    state: EphemeralState,\r\n    input: TransformedPointerInput\r\n): [EphemeralState, readonly BrushShader.BrushPoint[]] {\r\n    if (state === null) {\r\n        return [null, []]\r\n    }\r\n\r\n    return [null, []]\r\n}\r\n\r\nfunction pointerToBrushInput(\r\n    _camera: Camera.State,\r\n    input: TransformedPointerInput\r\n): BrushDelay.Input {\r\n    // TODO: offset, zoom, and stuff\r\n    return { x: input.x, y: input.y, pressure: input.pressure }\r\n}\r\n\r\nfunction createBrushPoint(brush: State, input: BrushDelay.Input): BrushShader.BrushPoint {\r\n    const alpha = brush.flowPct * input.pressure\r\n    const color =\r\n        alpha === 1\r\n            ? brush.color.toRgb().toLinear()\r\n            : brush.color\r\n                  .toRgb()\r\n                  .toLinear()\r\n                  .mix(1 - alpha, Color.RgbLinear.Black)\r\n    const position = new Vec2(input.x, input.y)\r\n    return {\r\n        alpha,\r\n        color,\r\n        position,\r\n        rotation: 0,\r\n        scaledDiameter: brush.diameterPx * input.pressure,\r\n    }\r\n}\r\n\r\nfunction createInputPoint(brush: State, input: BrushDelay.Input): Interp.InputPoint {\r\n    const alpha = brush.flowPct * input.pressure\r\n    const color =\r\n        alpha === 1\r\n            ? brush.color.toRgb().toLinear()\r\n            : brush.color\r\n                  .toRgb()\r\n                  .toLinear()\r\n                  .mix(1 - alpha, Color.RgbLinear.Black)\r\n    const position = new Vec2(input.x, input.y)\r\n    return {\r\n        alpha,\r\n        color,\r\n        position,\r\n        pressure: input.pressure,\r\n        rotation: 0,\r\n    }\r\n}\r\n","import * as Interp from \"./interpolation\"\r\nimport * as BrushDelay from \"./brushDelay\"\r\nimport * as BrushShader from \"../canvas/brushShader\"\r\nimport * as Camera from \"./camera\"\r\nimport * as Color from \"color\"\r\nimport { Vec2, clamp } from \"../util\"\r\nimport { TransformedPointerInput } from \"../canvas\"\r\n\r\nexport type Msg =\r\n    | SetDiameterMsg\r\n    | SetSoftnessMsg\r\n    | SetOpacityMsg\r\n    | SetSpacingMsg\r\n    | SetPressureAffectsOpacityMsg\r\n    | SetPressureAffectsSizeMsg\r\n    | SetDelayMsg\r\n\r\nexport const enum MsgType {\r\n    SetDiameterMsg,\r\n    SetSoftnessMsg,\r\n    SetOpacityMsg,\r\n    SetSpacingMsg,\r\n    SetPressureAffectsOpacityMsg,\r\n    SetPressureAffectsSizeMsg,\r\n    SetDelayMsg,\r\n}\r\n\r\nclass SetDiameterMsg {\r\n    readonly type: MsgType.SetDiameterMsg = MsgType.SetDiameterMsg\r\n    private nominal: void\r\n    constructor(readonly diameterPx: number) {}\r\n}\r\nclass SetSoftnessMsg {\r\n    readonly type: MsgType.SetSoftnessMsg = MsgType.SetSoftnessMsg\r\n    private nominal: void\r\n    constructor(readonly softnessPct: number) {}\r\n}\r\nclass SetOpacityMsg {\r\n    readonly type: MsgType.SetOpacityMsg = MsgType.SetOpacityMsg\r\n    private nominal: void\r\n    constructor(readonly opacityPct: number) {}\r\n}\r\nclass SetSpacingMsg {\r\n    readonly type: MsgType.SetSpacingMsg = MsgType.SetSpacingMsg\r\n    private nominal: void\r\n    constructor(readonly spacingPct: number) {}\r\n}\r\nclass SetPressureAffectsOpacityMsg {\r\n    readonly type: MsgType.SetPressureAffectsOpacityMsg = MsgType.SetPressureAffectsOpacityMsg\r\n    private nominal: void\r\n    constructor(readonly pressureAffectsOpacity: boolean) {}\r\n}\r\nclass SetPressureAffectsSizeMsg {\r\n    readonly type: MsgType.SetPressureAffectsSizeMsg = MsgType.SetPressureAffectsSizeMsg\r\n    private nominal: void\r\n    constructor(readonly pressureAffectsSize: boolean) {}\r\n}\r\nclass SetDelayMsg {\r\n    readonly type: MsgType.SetDelayMsg = MsgType.SetDelayMsg\r\n    private nominal: void\r\n    constructor(readonly delayMs: number) {}\r\n}\r\n\r\nexport class MsgSender {\r\n    constructor(private sendMessage: (msg: Msg) => void) {}\r\n    readonly setDelay = (ms: number): void => {\r\n        this.sendMessage(new SetDelayMsg(ms))\r\n    }\r\n    readonly setDiameter = (px: number): void => {\r\n        this.sendMessage(new SetDiameterMsg(px))\r\n    }\r\n    readonly setSoftness = (softness: number): void => {\r\n        this.sendMessage(new SetSoftnessMsg(softness))\r\n    }\r\n    readonly setOpacity = (opacity: number): void => {\r\n        this.sendMessage(new SetOpacityMsg(opacity))\r\n    }\r\n    readonly setSpacing = (px: number): void => {\r\n        this.sendMessage(new SetSpacingMsg(px))\r\n    }\r\n    readonly setPressureAffectsOpacity = (setPressureAffectsOpacity: boolean): void => {\r\n        this.sendMessage(new SetPressureAffectsOpacityMsg(setPressureAffectsOpacity))\r\n    }\r\n    readonly setPressureAffectsSize = (setPressureAffectsSize: boolean): void => {\r\n        this.sendMessage(new SetPressureAffectsSizeMsg(setPressureAffectsSize))\r\n    }\r\n}\r\n\r\nfunction pointerToBrushInput(\r\n    _camera: Camera.State,\r\n    input: TransformedPointerInput\r\n): BrushDelay.Input {\r\n    // TODO: offset, zoom, and stuff\r\n    return { x: input.x, y: input.y, pressure: input.pressure }\r\n}\r\n\r\nexport type EphemeralState = {\r\n    readonly interpState: Interp.State\r\n    readonly delayState: BrushDelay.State\r\n} | null\r\n\r\nexport function initTempState(): EphemeralState {\r\n    return null\r\n}\r\n\r\nexport interface State extends Interp.Interpolatable {\r\n    readonly diameterPx: number\r\n    readonly softness: number\r\n    readonly flowPct: number\r\n    readonly spacingPct: number\r\n    readonly pressureAffectsOpacity: boolean\r\n    readonly pressureAffectsSize: boolean\r\n    readonly delay: BrushDelay.Config\r\n}\r\n\r\nexport function init(): State {\r\n    return {\r\n        diameterPx: 15,\r\n        softness: 0.3,\r\n        flowPct: 0.3,\r\n        spacingPct: 0.05,\r\n        pressureAffectsOpacity: false,\r\n        pressureAffectsSize: true,\r\n        delay: BrushDelay.delay(5),\r\n    }\r\n}\r\n\r\nexport function update(state: State, msg: Msg): State {\r\n    switch (msg.type) {\r\n        case MsgType.SetDiameterMsg:\r\n            return { ...state, diameterPx: clamp(0.1, 500, msg.diameterPx) }\r\n        case MsgType.SetSoftnessMsg:\r\n            return { ...state, softness: clamp(0, 1, msg.softnessPct) }\r\n        case MsgType.SetOpacityMsg:\r\n            return { ...state, flowPct: clamp(0.01, 1, msg.opacityPct) }\r\n        case MsgType.SetSpacingMsg:\r\n            return { ...state, spacingPct: clamp(0.01, 1, msg.spacingPct) }\r\n        case MsgType.SetPressureAffectsOpacityMsg:\r\n            return { ...state, pressureAffectsOpacity: msg.pressureAffectsOpacity }\r\n        case MsgType.SetPressureAffectsSizeMsg:\r\n            return { ...state, pressureAffectsSize: msg.pressureAffectsSize }\r\n        case MsgType.SetDelayMsg:\r\n            return { ...state, delay: BrushDelay.delay(clamp(0, 500, msg.delayMs)) }\r\n        default:\r\n            const never: never = msg\r\n            throw { \"unexpected message\": msg }\r\n    }\r\n}\r\n\r\nexport function onClick(\r\n    camera: Camera.State,\r\n    state: State,\r\n    input: TransformedPointerInput\r\n): [EphemeralState, BrushShader.BrushPoint] {\r\n    const interpState = Interp.init(createInputPoint(state, input))\r\n    const delayState = BrushDelay.init(input.time, pointerToBrushInput(camera, input))\r\n    return [{ interpState, delayState }, createBrushPoint(state, input)]\r\n}\r\n\r\nexport function onDrag(\r\n    camera: Camera.State,\r\n    state: State,\r\n    tempState: EphemeralState,\r\n    inputs: readonly TransformedPointerInput[]\r\n): [EphemeralState, readonly BrushShader.BrushPoint[]] {\r\n    if (tempState === null) {\r\n        const res = onClick(camera, state, inputs[0])\r\n        return [res[0], [res[1]]]\r\n    } else {\r\n        let interpState: Interp.State = tempState.interpState\r\n        let brushPoints: readonly BrushShader.BrushPoint[] = []\r\n        let delayState = tempState.delayState\r\n        for (let i = 0; i < inputs.length; i++) {\r\n            const input = pointerToBrushInput(camera, inputs[i])\r\n\r\n            const updateResult = BrushDelay.updateWithInput(\r\n                state.delay,\r\n                delayState,\r\n                inputs[i].time,\r\n                input\r\n            )\r\n\r\n            const interpReslt = Interp.interpolate(\r\n                state,\r\n                interpState,\r\n                createInputPoint(state, updateResult[1])\r\n            )\r\n            delayState = updateResult[0]\r\n            interpState = interpReslt[0]\r\n            brushPoints = brushPoints.concat(interpReslt[1])\r\n        }\r\n\r\n        return [{ delayState, interpState }, brushPoints]\r\n    }\r\n}\r\n\r\nexport function onFrame(\r\n    state: State,\r\n    tempState: EphemeralState,\r\n    currentTime: number\r\n): [EphemeralState, readonly BrushShader.BrushPoint[]] {\r\n    if (tempState === null || state.delay.duration < 0) {\r\n        return [null, []]\r\n    }\r\n\r\n    const [delayState, newBrushInput] = BrushDelay.update(\r\n        state.delay,\r\n        tempState.delayState,\r\n        currentTime\r\n    )\r\n\r\n    const [interpState, brushPoints] = Interp.interpolate(\r\n        state,\r\n        tempState.interpState,\r\n        createInputPoint(state, newBrushInput)\r\n    )\r\n\r\n    return [{ delayState, interpState }, brushPoints]\r\n}\r\n\r\nexport function onRelease(\r\n    camera: Camera.State,\r\n    state: State,\r\n    tempState: EphemeralState,\r\n    input: TransformedPointerInput\r\n): [EphemeralState, readonly BrushShader.BrushPoint[]] {\r\n    if (tempState === null) {\r\n        return [null, []]\r\n    }\r\n\r\n    return [null, []]\r\n}\r\n\r\nfunction createBrushPoint(state: State, input: BrushDelay.Input): BrushShader.BrushPoint {\r\n    return {\r\n        alpha: state.flowPct * input.pressure,\r\n        color: Color.RgbLinear.Black,\r\n        position: new Vec2(input.x, input.y),\r\n        rotation: 0,\r\n        scaledDiameter: state.diameterPx * input.pressure,\r\n    }\r\n}\r\n\r\nfunction createInputPoint(state: State, input: BrushDelay.Input): Interp.InputPoint {\r\n    return {\r\n        alpha: state.flowPct * input.pressure,\r\n        color: Color.RgbLinear.Black,\r\n        position: new Vec2(input.x, input.y),\r\n        pressure: input.pressure,\r\n        rotation: 0,\r\n    }\r\n}\r\n","import { TransformedPointerInput } from \"../canvas\"\r\n\r\nexport interface DragState {\r\n    readonly originalScale: number\r\n    readonly clickPoint: TransformedPointerInput\r\n    readonly prevPoint: TransformedPointerInput\r\n}\r\n\r\nexport type Msg = SetZoomMsg | SetOffsetMsg | SetRotationMsg\r\n\r\nexport const enum MsgType {\r\n    SetZoomMsg,\r\n    SetOffsetMsg,\r\n    SetRotationMsg,\r\n}\r\n\r\nclass SetZoomMsg {\r\n    readonly type: MsgType.SetZoomMsg = MsgType.SetZoomMsg\r\n    private nominal: void\r\n    constructor(readonly zoomPct: number) {}\r\n}\r\nclass SetOffsetMsg {\r\n    readonly type: MsgType.SetOffsetMsg = MsgType.SetOffsetMsg\r\n    private nominal: void\r\n    constructor(readonly offsetX: number, readonly offsetY: number) {}\r\n}\r\nclass SetRotationMsg {\r\n    readonly type: MsgType.SetRotationMsg = MsgType.SetRotationMsg\r\n    private nominal: void\r\n    constructor(readonly rotationTurns: number) {}\r\n}\r\n\r\nexport class MsgSender {\r\n    constructor(private sendMessage: (msg: Msg) => void) {}\r\n\r\n    readonly setRotation = (pct: number) => {\r\n        this.sendMessage(new SetRotationMsg(pct))\r\n    }\r\n    readonly setOffset = (x: number, y: number) => {\r\n        this.sendMessage(new SetOffsetMsg(x, y))\r\n    }\r\n    readonly setZoom = (pct: number) => {\r\n        this.sendMessage(new SetZoomMsg(pct))\r\n    }\r\n}\r\n\r\nexport class State {\r\n    static init: State = new State(0, 0, 1, 0)\r\n    private nominal: void\r\n    readonly offsetX: number\r\n    readonly offsetY: number\r\n    readonly zoomPct: number\r\n    readonly rotateTurns: number\r\n\r\n    private constructor(offsetX: number, offsetY: number, zoomPct: number, rotateTurns: number) {\r\n        this.offsetX = offsetX\r\n        this.offsetY = offsetY\r\n        this.zoomPct = Math.max(0.01, zoomPct)\r\n        this.rotateTurns = rotateTurns\r\n    }\r\n\r\n    update(msg: Msg): State {\r\n        switch (msg.type) {\r\n            case MsgType.SetZoomMsg:\r\n                return new State(this.offsetX, this.offsetY, msg.zoomPct, this.rotateTurns)\r\n            case MsgType.SetOffsetMsg:\r\n                return new State(msg.offsetX, msg.offsetY, this.zoomPct, this.rotateTurns)\r\n            case MsgType.SetRotationMsg:\r\n                return new State(this.offsetX, this.offsetY, this.zoomPct, msg.rotationTurns)\r\n            default:\r\n                const never: never = msg\r\n                throw { \"unexpected msg\": msg }\r\n        }\r\n    }\r\n\r\n    zoomUpdate(dragState: DragState, input: TransformedPointerInput): State {\r\n        const xd = input.x - dragState.clickPoint.x\r\n        let addedPct = xd / 500\r\n        if (addedPct >= 0) {\r\n            addedPct = addedPct ** 2\r\n        } else {\r\n            addedPct = -((-addedPct) ** 2)\r\n        }\r\n        const zoomPct = dragState.originalScale + addedPct\r\n        console.log({\r\n            originalScale: dragState.originalScale,\r\n            clickX: dragState.clickPoint.x,\r\n            x: input.originalX,\r\n            addedPct: addedPct,\r\n        })\r\n        return new State(this.offsetX, this.offsetY, Math.min(5000, zoomPct), this.rotateTurns)\r\n    }\r\n\r\n    rotateUpdate(dragState: DragState, input: TransformedPointerInput): State {\r\n        throw \"todo: should be turns, not rad\"\r\n        // const rotationRad = Math.atan2(\r\n        //     input.y - dragState.clickPoint.y,\r\n        //     input.x - dragState.clickPoint.x\r\n        // )\r\n        // return new State(this.offsetX, this.offsetY, this.zoomPct, rotationRad)\r\n    }\r\n\r\n    moveUpdate(dragState: DragState, input: TransformedPointerInput): State {\r\n        const xd = input.x - dragState.prevPoint.x\r\n        const yd = input.y - dragState.prevPoint.y\r\n        return new State(this.offsetX + xd, this.offsetY + yd, this.zoomPct, this.rotateTurns)\r\n    }\r\n}\r\n","import { Stack } from \"./stack\"\r\n\r\nexport class ZipperList<a> {\r\n    static singleton<a>(value: a): ZipperList<a> {\r\n        return new ZipperList(Stack.empty(), value, Stack.empty())\r\n    }\r\n\r\n    static fromArray<a>(arr: readonly a[]): ZipperList<a> | null {\r\n        if (arr.length === 0) {\r\n            return null\r\n        }\r\n\r\n        return ZipperList.unsafeFromArray(arr)\r\n    }\r\n\r\n    static unsafeFromArray<a>(arr: readonly a[]): ZipperList<a> {\r\n        let right: Stack.Stack<a> = Stack.empty()\r\n        for (let i = arr.length - 1; i > 0; i--) {\r\n            right = right.cons(arr[i])\r\n        }\r\n\r\n        return new ZipperList(Stack.empty(), arr[0], right)\r\n    }\r\n\r\n    private constructor(\r\n        private readonly __left: Stack.Stack<a>,\r\n        readonly focus: a,\r\n        private readonly __right: Stack.Stack<a>\r\n    ) {}\r\n\r\n    getLeft(): a[] {\r\n        return this.__left.reverse().toArray()\r\n    }\r\n\r\n    getRight(): a[] {\r\n        return this.__right.toArray()\r\n    }\r\n\r\n    hasLeft(): boolean {\r\n        return this.__left.isNonEmpty()\r\n    }\r\n\r\n    hasRight(): boolean {\r\n        return this.__right.isNonEmpty()\r\n    }\r\n\r\n    focusLeft(): ZipperList<a> {\r\n        if (this.__left.isNonEmpty()) {\r\n            return new ZipperList(this.__left.tail, this.__left.head, this.__right.cons(this.focus))\r\n        } else {\r\n            return this\r\n        }\r\n    }\r\n\r\n    focusRight(): ZipperList<a> {\r\n        if (this.__right.isNonEmpty()) {\r\n            return new ZipperList(\r\n                this.__left.cons(this.focus),\r\n                this.__right.head,\r\n                this.__right.tail\r\n            )\r\n        } else {\r\n            return this\r\n        }\r\n    }\r\n\r\n    focusf(f: (val: a) => boolean): ZipperList<a> {\r\n        if (f(this.focus)) return this\r\n\r\n        let attempt: ZipperList<a> = this\r\n\r\n        // try left\r\n        while (attempt.hasLeft()) {\r\n            attempt = attempt.focusLeft()\r\n            if (f(attempt.focus)) return attempt\r\n        }\r\n\r\n        attempt = this\r\n\r\n        // try right\r\n        while (attempt.hasRight()) {\r\n            attempt = attempt.focusRight()\r\n            if (f(attempt.focus)) return attempt\r\n        }\r\n\r\n        return this\r\n    }\r\n\r\n    toArray(): a[] {\r\n        const arr: a[] = []\r\n        let stack = this.__left.reverse()\r\n        while (stack.isNonEmpty()) {\r\n            arr.push(stack.head)\r\n            stack = stack.tail\r\n        }\r\n\r\n        arr.push(this.focus)\r\n\r\n        stack = this.__right\r\n\r\n        while (stack.isNonEmpty()) {\r\n            arr.push(stack.head)\r\n            stack = stack.tail\r\n        }\r\n        return arr\r\n    }\r\n}\r\n","import * as Brush from \"./brush\"\r\nimport * as Eraser from \"./eraser\"\r\nimport * as Camera from \"./camera\"\r\nimport * as BrushShader from \"../canvas/brushShader\"\r\nimport { Blend } from \"../webgl\"\r\nimport { TransformedPointerInput } from \"../canvas\"\r\n\r\nexport const enum ToolMsgType {\r\n    SetToolMsg,\r\n    BrushMsg,\r\n    EraserMsg,\r\n    CameraMsg,\r\n}\r\n\r\nexport type ToolMsg = SetToolMsg | BrushMsg | EraserMsg | CameraMsg\r\n\r\nclass SetToolMsg {\r\n    readonly type: ToolMsgType.SetToolMsg = ToolMsgType.SetToolMsg\r\n    private nominal: void\r\n    constructor(readonly subType: ToolType) {}\r\n}\r\nclass BrushMsg {\r\n    readonly type: ToolMsgType.BrushMsg = ToolMsgType.BrushMsg\r\n    private nominal: void\r\n    constructor(readonly msg: Brush.Msg) {}\r\n}\r\nclass EraserMsg {\r\n    readonly type: ToolMsgType.EraserMsg = ToolMsgType.EraserMsg\r\n    private nominal: void\r\n    constructor(readonly msg: Eraser.Msg) {}\r\n}\r\nclass CameraMsg {\r\n    readonly type: ToolMsgType.CameraMsg = ToolMsgType.CameraMsg\r\n    private nominal: void\r\n    constructor(readonly msg: Camera.Msg) {}\r\n}\r\n\r\nexport class MsgSender {\r\n    readonly brush: Brush.MsgSender\r\n    readonly eraser: Eraser.MsgSender\r\n    readonly camera: Camera.MsgSender\r\n\r\n    readonly setTool = (type: ToolType) => {\r\n        this.sendMessage(new SetToolMsg(type))\r\n    }\r\n\r\n    constructor(private sendMessage: (msg: ToolMsg) => void) {\r\n        this.brush = new Brush.MsgSender(msg => sendMessage(new BrushMsg(msg)))\r\n        this.eraser = new Eraser.MsgSender(msg => sendMessage(new EraserMsg(msg)))\r\n        this.camera = new Camera.MsgSender(msg => sendMessage(new CameraMsg(msg)))\r\n    }\r\n}\r\n\r\nexport const enum ToolType {\r\n    Brush,\r\n    Eraser,\r\n    Move,\r\n    Zoom,\r\n    Rotate,\r\n}\r\n\r\nexport interface Tool {\r\n    readonly brush: Brush.State\r\n    readonly eraser: Eraser.State\r\n    readonly camera: Camera.State\r\n    readonly current: ToolType\r\n}\r\n\r\nclass BrushState {\r\n    readonly type: ToolType.Brush = ToolType.Brush\r\n    private nominal: void\r\n    constructor(readonly state: Brush.EphemeralState) {}\r\n}\r\nclass EraserState {\r\n    readonly type: ToolType.Eraser = ToolType.Eraser\r\n    private nominal: void\r\n    constructor(readonly state: Eraser.EphemeralState) {}\r\n}\r\nclass MoveState {\r\n    readonly type: ToolType.Move = ToolType.Move\r\n    private nominal: void\r\n    constructor(readonly state: Camera.DragState | null) {}\r\n}\r\nclass ZoomState {\r\n    readonly type: ToolType.Zoom = ToolType.Zoom\r\n    private nominal: void\r\n    constructor(readonly state: Camera.DragState | null) {}\r\n}\r\nclass RotateState {\r\n    readonly type: ToolType.Rotate = ToolType.Rotate\r\n    private nominal: void\r\n    constructor(readonly state: Camera.DragState | null) {}\r\n}\r\n\r\nexport type EphemeralState = BrushState | EraserState | MoveState | ZoomState | RotateState\r\n\r\nexport const enum EphemeralStateType {\r\n    BrushState,\r\n    EraserState,\r\n    MoveState,\r\n    ZoomState,\r\n    RotateState,\r\n}\r\n\r\nexport function init(): Tool {\r\n    return {\r\n        brush: Brush.init(),\r\n        eraser: Eraser.init(),\r\n        camera: Camera.State.init,\r\n        current: ToolType.Brush,\r\n    }\r\n}\r\n\r\nexport function initEphemeral(): EphemeralState {\r\n    return brushToolInit()\r\n}\r\n\r\nfunction brushToolInit(): EphemeralState {\r\n    return new BrushState(Brush.initTempState())\r\n}\r\n\r\nfunction eraserToolInit(): EphemeralState {\r\n    return new EraserState(Eraser.initTempState())\r\n}\r\n\r\nfunction moveToolInit(): EphemeralState {\r\n    return new MoveState(null)\r\n}\r\n\r\nfunction zoomToolInit(): EphemeralState {\r\n    return new ZoomState(null)\r\n}\r\n\r\nfunction rotateToolInit(): EphemeralState {\r\n    return new RotateState(null)\r\n}\r\n\r\nexport function update(tool: Tool, msg: ToolMsg): Tool {\r\n    switch (msg.type) {\r\n        case ToolMsgType.SetToolMsg:\r\n            switch (msg.subType) {\r\n                case ToolType.Brush:\r\n                    return { ...tool, current: ToolType.Brush }\r\n                case ToolType.Eraser:\r\n                    return { ...tool, current: ToolType.Eraser }\r\n                case ToolType.Move:\r\n                    return { ...tool, current: ToolType.Move }\r\n                case ToolType.Zoom:\r\n                    return { ...tool, current: ToolType.Zoom }\r\n                case ToolType.Rotate:\r\n                    return { ...tool, current: ToolType.Rotate }\r\n                default:\r\n                    throw { \"unexpected tool type: \": msg.type }\r\n            }\r\n        case ToolMsgType.BrushMsg:\r\n            return { ...tool, brush: Brush.update(tool.brush, msg.msg) }\r\n        case ToolMsgType.EraserMsg:\r\n            return { ...tool, eraser: Eraser.update(tool.eraser, msg.msg) }\r\n        case ToolMsgType.CameraMsg:\r\n            return { ...tool, camera: tool.camera.update(msg.msg) }\r\n        default:\r\n            const never: never = msg\r\n            throw { \"unexpected msg\": msg }\r\n    }\r\n}\r\n\r\nfunction syncEphemeral(tool: Tool, ephemeral: EphemeralState): EphemeralState {\r\n    if (ephemeral.type === tool.current) {\r\n        return ephemeral\r\n    }\r\n    switch (tool.current) {\r\n        case ToolType.Brush:\r\n            return brushToolInit()\r\n        case ToolType.Eraser:\r\n            return eraserToolInit()\r\n        case ToolType.Move:\r\n            return moveToolInit()\r\n        case ToolType.Rotate:\r\n            return rotateToolInit()\r\n        case ToolType.Zoom:\r\n            return zoomToolInit()\r\n        default:\r\n            const never: never = tool.current\r\n            throw { \"Unknown tool type: \": tool.current }\r\n    }\r\n}\r\n\r\nexport function onClick(\r\n    tool: Tool,\r\n    ephemeral_: EphemeralState,\r\n    pointer: TransformedPointerInput\r\n): readonly [Tool, EphemeralState, readonly BrushShader.BrushPoint[]] {\r\n    const ephemeral = syncEphemeral(tool, ephemeral_)\r\n\r\n    switch (ephemeral.type) {\r\n        case ToolType.Brush: {\r\n            const [value, brushPoint] = Brush.onClick(tool.camera, tool.brush, pointer)\r\n            return [tool, new BrushState(value), [brushPoint]]\r\n        }\r\n        case ToolType.Eraser: {\r\n            const [value, brushPoint] = Eraser.onClick(tool.camera, tool.eraser, pointer)\r\n            return [tool, new EraserState(value), [brushPoint]]\r\n        }\r\n        case ToolType.Move: {\r\n            if (ephemeral.state !== null) {\r\n                return [tool, ephemeral, []]\r\n            }\r\n\r\n            const dragState: Camera.DragState = {\r\n                clickPoint: pointer,\r\n                prevPoint: pointer,\r\n                originalScale: tool.camera.zoomPct,\r\n            }\r\n            const camera = tool.camera.moveUpdate(dragState, pointer)\r\n            return [{ ...tool, camera }, new MoveState(dragState), []]\r\n        }\r\n        case ToolType.Zoom: {\r\n            if (ephemeral.state !== null) {\r\n                return [tool, ephemeral, []]\r\n            }\r\n\r\n            const dragState: Camera.DragState = {\r\n                clickPoint: pointer,\r\n                prevPoint: pointer,\r\n                originalScale: tool.camera.zoomPct,\r\n            }\r\n            const camera = tool.camera.zoomUpdate(dragState, pointer)\r\n            return [{ ...tool, camera }, new ZoomState(dragState), []]\r\n        }\r\n        case ToolType.Rotate: {\r\n            if (ephemeral.state !== null) {\r\n                return [tool, ephemeral, []]\r\n            }\r\n\r\n            const dragState: Camera.DragState = {\r\n                clickPoint: pointer,\r\n                prevPoint: pointer,\r\n                originalScale: tool.camera.zoomPct,\r\n            }\r\n            const camera = tool.camera.rotateUpdate(dragState, pointer)\r\n            return [{ ...tool, camera }, new RotateState(dragState), []]\r\n        }\r\n        default:\r\n            const never: never = ephemeral\r\n            throw { \"unxpected state\": ephemeral }\r\n    }\r\n}\r\n\r\nexport function onDrag(\r\n    tool: Tool,\r\n    ephemeral_: EphemeralState,\r\n    pointers: readonly TransformedPointerInput[]\r\n): readonly [Tool, EphemeralState, readonly BrushShader.BrushPoint[]] {\r\n    const ephemeral = syncEphemeral(tool, ephemeral_)\r\n\r\n    switch (ephemeral.type) {\r\n        case ToolType.Brush: {\r\n            const [value, brushPoints] = Brush.onDrag(\r\n                tool.camera,\r\n                tool.brush,\r\n                ephemeral.state,\r\n                pointers\r\n            )\r\n            return [tool, new BrushState(value), brushPoints]\r\n        }\r\n        case ToolType.Eraser: {\r\n            const [value, brushPoints] = Eraser.onDrag(\r\n                tool.camera,\r\n                tool.eraser,\r\n                ephemeral.state,\r\n                pointers\r\n            )\r\n            return [tool, new EraserState(value), brushPoints]\r\n        }\r\n        case ToolType.Move: {\r\n            if (ephemeral.state === null) {\r\n                return [tool, ephemeral, []]\r\n            }\r\n            const pointer = pointers[pointers.length - 1]\r\n            const camera = tool.camera.moveUpdate(ephemeral.state, pointer)\r\n            const dragState: Camera.DragState = {\r\n                clickPoint: ephemeral.state.clickPoint,\r\n                prevPoint: pointer,\r\n                originalScale: ephemeral.state.originalScale,\r\n            }\r\n            return [{ ...tool, camera }, new MoveState(dragState), []]\r\n        }\r\n        case ToolType.Zoom: {\r\n            if (ephemeral.state === null) {\r\n                return [tool, ephemeral, []]\r\n            }\r\n            const pointer = pointers[pointers.length - 1]\r\n            const camera = tool.camera.zoomUpdate(ephemeral.state, pointer)\r\n            const dragState: Camera.DragState = {\r\n                clickPoint: ephemeral.state.clickPoint,\r\n                prevPoint: pointer,\r\n                originalScale: ephemeral.state.originalScale,\r\n            }\r\n            return [{ ...tool, camera }, new ZoomState(dragState), []]\r\n        }\r\n        case ToolType.Rotate: {\r\n            if (ephemeral.state === null) {\r\n                return [tool, ephemeral, []]\r\n            }\r\n            const pointer = pointers[pointers.length - 1]\r\n            const camera = tool.camera.rotateUpdate(ephemeral.state, pointer)\r\n            const dragState: Camera.DragState = {\r\n                clickPoint: ephemeral.state.clickPoint,\r\n                prevPoint: pointer,\r\n                originalScale: ephemeral.state.originalScale,\r\n            }\r\n            return [{ ...tool, camera }, new RotateState(dragState), []]\r\n        }\r\n        default:\r\n            const never: never = ephemeral\r\n            throw { \"unxpected state\": ephemeral }\r\n    }\r\n}\r\n\r\nexport function onRelease(\r\n    tool: Tool,\r\n    ephemeral_: EphemeralState,\r\n    pointer: TransformedPointerInput\r\n): readonly [Tool, EphemeralState, readonly BrushShader.BrushPoint[]] {\r\n    const ephemeral = syncEphemeral(tool, ephemeral_)\r\n\r\n    switch (ephemeral.type) {\r\n        case ToolType.Brush: {\r\n            const [value, brushPoints] = Brush.onRelease(\r\n                tool.camera,\r\n                tool.brush,\r\n                ephemeral.state,\r\n                pointer\r\n            )\r\n            return [tool, new BrushState(value), brushPoints]\r\n        }\r\n        case ToolType.Eraser: {\r\n            const [value, brushPoints] = Eraser.onRelease(\r\n                tool.camera,\r\n                tool.eraser,\r\n                ephemeral.state,\r\n                pointer\r\n            )\r\n            return [tool, new EraserState(value), brushPoints]\r\n        }\r\n        case ToolType.Move: {\r\n            if (ephemeral.state === null) {\r\n                return [tool, ephemeral, []]\r\n            }\r\n\r\n            const camera = tool.camera.moveUpdate(ephemeral.state, pointer)\r\n            return [{ ...tool, camera }, new MoveState(null), []]\r\n        }\r\n        case ToolType.Zoom: {\r\n            if (ephemeral.state === null) {\r\n                return [tool, ephemeral, []]\r\n            }\r\n\r\n            const camera = tool.camera.zoomUpdate(ephemeral.state, pointer)\r\n            return [{ ...tool, camera }, new ZoomState(null), []]\r\n        }\r\n        case ToolType.Rotate: {\r\n            if (ephemeral.state === null) {\r\n                return [tool, ephemeral, []]\r\n            }\r\n\r\n            const camera = tool.camera.rotateUpdate(ephemeral.state, pointer)\r\n            return [{ ...tool, camera }, new RotateState(null), []]\r\n        }\r\n        default:\r\n            const never: never = ephemeral\r\n            throw { \"unxpected state\": ephemeral }\r\n    }\r\n}\r\n\r\nexport function onFrame(\r\n    tool: Tool,\r\n    ephemeral_: EphemeralState,\r\n    currentTime: number\r\n): [EphemeralState, readonly BrushShader.BrushPoint[]] {\r\n    const ephemeral = syncEphemeral(tool, ephemeral_)\r\n\r\n    switch (ephemeral.type) {\r\n        case ToolType.Brush: {\r\n            const [value, brushPoints] = Brush.onFrame(tool.brush, ephemeral.state, currentTime)\r\n            if (value === ephemeral.state && brushPoints.length === 0) {\r\n                return [ephemeral, brushPoints]\r\n            } else {\r\n                return [new BrushState(value), brushPoints]\r\n            }\r\n        }\r\n        case ToolType.Eraser: {\r\n            const [value, brushPoints] = Eraser.onFrame(tool.eraser, ephemeral.state, currentTime)\r\n            if (value === ephemeral.state && brushPoints.length === 0) {\r\n                return [ephemeral, brushPoints]\r\n            } else {\r\n                return [new EraserState(value), brushPoints]\r\n            }\r\n        }\r\n        default:\r\n            return [ephemeral, []]\r\n    }\r\n}\r\n\r\nexport function getBlendMode(tool: Tool): Blend.Mode {\r\n    switch (tool.current) {\r\n        case ToolType.Brush:\r\n            return Blend.Mode.Normal\r\n        case ToolType.Eraser:\r\n            return Blend.Mode.Erase\r\n        default:\r\n            return Blend.Mode.Normal\r\n    }\r\n}\r\n\r\nexport function getSoftness(tool: Tool): number {\r\n    switch (tool.current) {\r\n        case ToolType.Brush:\r\n            return tool.brush.softness\r\n        case ToolType.Eraser:\r\n            return tool.eraser.softness\r\n        default:\r\n            return 0\r\n    }\r\n}\r\n","import { Op, Events, onChange, onPaste, _, shallowEqual, statelessComponent } from \"ivi\"\r\nimport { div, input, VALUE } from \"ivi-html\"\r\nimport * as styles from \"./brush.scss\"\r\nimport {\r\n    Menu,\r\n    ColorWheel,\r\n    Labeled,\r\n    Slider,\r\n    InlineLabeled,\r\n    Switch,\r\n    ColorDisplay,\r\n    Surface,\r\n} from \"./views\"\r\nimport * as Brush from \"../tools/brush\"\r\nimport * as Color from \"color\"\r\nimport { ColorMode, colorModeToString } from \"../util\"\r\n\r\nexport interface DetailsProps {\r\n    readonly messageSender: Brush.MsgSender\r\n    readonly tool: Brush.State\r\n}\r\n\r\nexport const Details = statelessComponent<DetailsProps>(props => {\r\n    const sender = props.messageSender\r\n    const brush = props.tool\r\n\r\n    function onColorText(text: string) {\r\n        const rgb = Color.Rgb.fromCss(text)\r\n        if (rgb === null) {\r\n            return\r\n        }\r\n\r\n        sender.setColor(Color.rgbToHsluv(rgb))\r\n    }\r\n\r\n    return Surface(\r\n        div(styles.detailsContainer, _, [\r\n            div(\r\n                _,\r\n                { style: { margin: \"0.5rem 0\" } },\r\n                Menu({\r\n                    choices: brush.colorMode,\r\n                    show: colorModeToString,\r\n                    onSelect: sender.setColorMode,\r\n                })\r\n            ),\r\n            ColorWheel({\r\n                color: brush.color,\r\n                colorType: brush.colorMode.focus,\r\n                onChange: sender.setColor,\r\n            }),\r\n            div(\r\n                _,\r\n                { style: { margin: \"0.5rem 0\", width: \"100%\" } },\r\n                ColorDisplay({\r\n                    color: brush.color,\r\n                    colorSecondary: brush.colorSecondary,\r\n                    onClick: sender.swapColorFrom,\r\n                })\r\n            ),\r\n            div(\r\n                _,\r\n                { style: { margin: \"0.5rem 0\" } },\r\n                Events(\r\n                    onPaste(ev => onColorText((ev.target as any).value)),\r\n                    Events(\r\n                        onChange(ev => onColorText((ev.target as any).value)),\r\n                        input(styles.textInput, {\r\n                            type: \"text\",\r\n                            style: { width: \"100%\" },\r\n                            value: VALUE(brush.color.toStyle()),\r\n                        })\r\n                    )\r\n                )\r\n            ),\r\n            Labeled({\r\n                label: \"Size\",\r\n                value: brush.diameterPx.toFixed(1) + \"px\",\r\n                children: Slider({\r\n                    percentage: brush.diameterPx / 500,\r\n                    onChange: pct => sender.setDiameter(pct * 500),\r\n                }),\r\n            }),\r\n            Labeled({\r\n                label: \"Softness\",\r\n                value: brush.softness.toFixed(2),\r\n                children: Slider({\r\n                    percentage: brush.softness,\r\n                    onChange: sender.setSoftness,\r\n                }),\r\n            }),\r\n            Labeled({\r\n                label: \"Flow\",\r\n                value: brush.flowPct.toFixed(2),\r\n                children: Slider({\r\n                    percentage: brush.flowPct,\r\n                    onChange: sender.setOpacity,\r\n                }),\r\n            }),\r\n            Labeled({\r\n                label: \"Spacing\",\r\n                value: brush.spacingPct.toFixed(2) + \"%\",\r\n                children: Slider({\r\n                    percentage: brush.spacingPct,\r\n                    onChange: sender.setSpacing,\r\n                }),\r\n            }),\r\n            ColorSliders({\r\n                color: brush.color,\r\n                colorType: brush.colorMode.focus,\r\n                sender: sender,\r\n            }),\r\n            InlineLabeled({\r\n                label: \"Pressure-Opacity\",\r\n                children: Switch({\r\n                    checked: brush.pressureAffectsOpacity,\r\n                    onCheck: sender.setPressureAffectsOpacity,\r\n                }),\r\n            }),\r\n            InlineLabeled({\r\n                label: \"Pressure-Size\",\r\n                children: Switch({\r\n                    checked: brush.pressureAffectsSize,\r\n                    onCheck: sender.setPressureAffectsSize,\r\n                }),\r\n            }),\r\n            Labeled({\r\n                label: \"Delay\",\r\n                value: brush.delay.duration.toFixed(0) + \"ms\",\r\n                children: Slider({\r\n                    percentage: brush.delay.duration / 500,\r\n                    onChange: pct => sender.setDelay(pct * 500),\r\n                }),\r\n            }),\r\n        ])\r\n    )\r\n}, shallowEqual)\r\n\r\nfunction ColorSliders({\r\n    sender,\r\n    color,\r\n    colorType,\r\n}: {\r\n    readonly sender: Brush.MsgSender\r\n    readonly colorType: ColorMode\r\n    readonly color: Color.Hsluv\r\n}): Op {\r\n    switch (colorType) {\r\n        case ColorMode.Hsluv:\r\n            return HsluvSliders(sender, color)\r\n        case ColorMode.Hsv:\r\n            return HsvSliders(sender, Color.rgbToHsv(color.toRgb()))\r\n        default:\r\n            const never: never = colorType\r\n            throw { \"unexpected color type\": colorType }\r\n    }\r\n}\r\n\r\nfunction HsluvSliders(sender: Brush.MsgSender, color: Color.Hsluv): Op {\r\n    return [\r\n        Labeled({\r\n            label: \"Hue\",\r\n            value: color.h.toFixed(2),\r\n            children: Slider({\r\n                percentage: color.h / 360,\r\n                onChange: pct => sender.setColor(color.with({ h: pct * 360 })),\r\n            }),\r\n        }),\r\n        Labeled({\r\n            label: \"Saturation\",\r\n            value: color.s.toFixed(2),\r\n            children: Slider({\r\n                percentage: color.s / 100,\r\n                onChange: pct => sender.setColor(color.with({ s: pct * 100 })),\r\n            }),\r\n        }),\r\n        Labeled({\r\n            label: \"Luminosity\",\r\n            value: color.l.toFixed(2),\r\n            children: Slider({\r\n                percentage: color.l / 100,\r\n                onChange: pct => sender.setColor(color.with({ l: pct * 100 })),\r\n            }),\r\n        }),\r\n    ]\r\n}\r\n\r\nfunction HsvSliders(sender: Brush.MsgSender, color: Color.Hsv): Op {\r\n    return [\r\n        Labeled({\r\n            label: \"Hue\",\r\n            value: color.h.toFixed(2),\r\n            children: Slider({\r\n                percentage: color.h,\r\n                onChange: pct => sender.setColor(Color.rgbToHsluv(color.with({ h: pct }).toRgb())),\r\n            }),\r\n        }),\r\n        Labeled({\r\n            label: \"Saturation\",\r\n            value: color.s.toFixed(2),\r\n            children: Slider({\r\n                percentage: color.s,\r\n                onChange: pct => sender.setColor(Color.rgbToHsluv(color.with({ s: pct }).toRgb())),\r\n            }),\r\n        }),\r\n        Labeled({\r\n            label: \"Value\",\r\n            value: color.v.toFixed(2),\r\n            children: Slider({\r\n                percentage: color.v,\r\n                onChange: pct => sender.setColor(Color.rgbToHsluv(color.with({ v: pct }).toRgb())),\r\n            }),\r\n        }),\r\n    ]\r\n}\r\n","import { _, shallowEqual, statelessComponent } from \"ivi\"\r\nimport { div } from \"ivi-html\"\r\nimport * as styles from \"./eraser.scss\"\r\nimport { Surface, Labeled, Slider, InlineLabeled, Switch } from \"./views\"\r\nimport * as Eraser from \"../tools/eraser\"\r\n\r\nexport interface DetailsProps {\r\n    readonly messageSender: Eraser.MsgSender\r\n    readonly tool: Eraser.State\r\n}\r\n\r\nexport const Details = statelessComponent<DetailsProps>(props => {\r\n    const sender = props.messageSender\r\n    const brush = props.tool\r\n\r\n    return Surface(\r\n        div(styles.detailsContainer, _, [\r\n            Labeled({\r\n                label: \"Size\",\r\n                value: brush.diameterPx.toFixed(1) + \"px\",\r\n                children: Slider({\r\n                    percentage: brush.diameterPx / 500,\r\n                    onChange: pct => sender.setDiameter(pct * 500),\r\n                }),\r\n            }),\r\n            Labeled({\r\n                label: \"Softness\",\r\n                value: brush.softness.toFixed(2),\r\n                children: Slider({\r\n                    percentage: brush.softness,\r\n                    onChange: sender.setSoftness,\r\n                }),\r\n            }),\r\n            Labeled({\r\n                label: \"Flow\",\r\n                value: brush.flowPct.toFixed(2),\r\n                children: Slider({\r\n                    percentage: brush.flowPct,\r\n                    onChange: sender.setOpacity,\r\n                }),\r\n            }),\r\n            Labeled({\r\n                label: \"Spacing\",\r\n                value: brush.spacingPct.toFixed(2) + \"%\",\r\n                children: Slider({\r\n                    percentage: brush.spacingPct,\r\n                    onChange: sender.setSpacing,\r\n                }),\r\n            }),\r\n            InlineLabeled({\r\n                label: \"Pressure-Opacity\",\r\n                children: Switch({\r\n                    checked: brush.pressureAffectsOpacity,\r\n                    onCheck: sender.setPressureAffectsOpacity,\r\n                }),\r\n            }),\r\n            InlineLabeled({\r\n                label: \"Pressure-Size\",\r\n                children: Switch({\r\n                    checked: brush.pressureAffectsSize,\r\n                    onCheck: sender.setPressureAffectsSize,\r\n                }),\r\n            }),\r\n            Labeled({\r\n                label: \"Delay\",\r\n                value: brush.delay.duration.toFixed(0) + \"ms\",\r\n                children: Slider({\r\n                    percentage: brush.delay.duration / 500,\r\n                    onChange: pct => sender.setDelay(pct * 500),\r\n                }),\r\n            }),\r\n        ])\r\n    )\r\n}, shallowEqual)\r\n","import { _, shallowEqual, statelessComponent } from \"ivi\"\r\nimport { div } from \"ivi-html\"\r\n\r\nimport * as Tools from \"../tools\"\r\nimport * as Brush from \"./brush\"\r\nimport * as Eraser from \"./eraser\"\r\nimport { SinkableButton, surfaceLook, Icons } from \"./views\"\r\nimport * as styles from \"./toolbar.scss\"\r\n\r\nexport interface TransientState {\r\n    readonly isDetailsExpanded: boolean\r\n}\r\n\r\nexport interface ToolbarProps {\r\n    readonly msgSender: Tools.MsgSender\r\n    readonly tool: Tools.Tool\r\n    readonly transientState: TransientState\r\n}\r\n\r\nexport const Toolbar = statelessComponent<ToolbarProps>(props => {\r\n    const currentToolType = props.tool.current\r\n    const setTool = props.msgSender.setTool\r\n\r\n    return div(styles.toolBarContainer, { style: { \"z-index\": 1 } }, [\r\n        div(surfaceLook + \" \" + styles.leftBar, _, [\r\n            SinkableButton({\r\n                isDown: currentToolType === Tools.ToolType.Brush,\r\n                onClick: () => setTool(Tools.ToolType.Brush),\r\n                children: Icons.brush24px,\r\n            }),\r\n            SinkableButton({\r\n                isDown: currentToolType === Tools.ToolType.Eraser,\r\n                onClick: () => setTool(Tools.ToolType.Eraser),\r\n                children: Icons.edit24px,\r\n            }),\r\n            SinkableButton({\r\n                isDown: currentToolType === Tools.ToolType.Zoom,\r\n                onClick: () => setTool(Tools.ToolType.Zoom),\r\n                children: Icons.search24px,\r\n            }),\r\n        ]),\r\n        !props.transientState.isDetailsExpanded\r\n            ? null\r\n            : (() => {\r\n                  switch (currentToolType) {\r\n                      case Tools.ToolType.Brush:\r\n                          return Brush.Details({\r\n                              messageSender: props.msgSender.brush,\r\n                              tool: props.tool.brush,\r\n                          })\r\n                      case Tools.ToolType.Eraser:\r\n                          return Eraser.Details({\r\n                              messageSender: props.msgSender.eraser,\r\n                              tool: props.tool.eraser,\r\n                          })\r\n                      default:\r\n                          return null\r\n                  }\r\n              })(),\r\n    ])\r\n}, shallowEqual)\r\n","export abstract class Seed {\r\n    abstract asInt(): number\r\n\r\n    abstract step(): Seed\r\n\r\n    abstract display(): string\r\n\r\n    nextInt(): [number, Seed] {\r\n        return [this.asInt(), this.step()]\r\n    }\r\n\r\n    nextFloat(): [number, Seed] {\r\n        const floatResult = this.asInt() / 4294967295\r\n        return [floatResult, this.step()]\r\n    }\r\n\r\n    next2Floats(): [number, number, Seed] {\r\n        const [first, state2] = this.nextFloat()\r\n        const [second, state3] = state2.nextFloat()\r\n        return [first, second, state3]\r\n    }\r\n\r\n    next3Floats(): [number, number, number, Seed] {\r\n        const [first, state2] = this.nextFloat()\r\n        const [second, state3] = state2.nextFloat()\r\n        const [third, state4] = state3.nextFloat()\r\n        return [first, second, third, state4]\r\n    }\r\n}\r\n\r\n/*\r\n * Implementation of Xorshift 128\r\n * https://en.wikipedia.org/wiki/Xorshift\r\n */\r\n\r\nexport class XorshiftSeed extends Seed {\r\n    static create(n: number): Seed {\r\n        let seed: Seed = new XorshiftSeed(n, 0, 0, 0, null)\r\n        for (let i = 0; i < 32; i++) {\r\n            seed = seed.step()\r\n        }\r\n        return seed\r\n    }\r\n\r\n    private constructor(\r\n        private readonly a: number,\r\n        private readonly b: number,\r\n        private readonly c: number,\r\n        private readonly d: number,\r\n        private value: null | {\r\n            readonly next: XorshiftSeed\r\n            readonly asInt: number\r\n        }\r\n    ) {\r\n        super()\r\n    }\r\n\r\n    asInt(): number {\r\n        return this.force().asInt\r\n    }\r\n\r\n    step(): Seed {\r\n        return this.force().next\r\n    }\r\n\r\n    display(): string {\r\n        return `Xorshift 128 (${this.a}, ${this.b}, ${this.c}, ${this.d})`\r\n    }\r\n\r\n    private force(): {\r\n        readonly next: XorshiftSeed\r\n        readonly asInt: number\r\n    } {\r\n        if (this.value === null) {\r\n            const s = this.a\r\n            let t = this.d\r\n            t ^= t << 11\r\n            t ^= t >>> 8\r\n            t ^= s\r\n            t ^= s >>> 19\r\n            this.value = {\r\n                asInt: t >>> 0,\r\n                next: new XorshiftSeed(t, s, this.b, this.c, null),\r\n            }\r\n        }\r\n        return this.value\r\n    }\r\n}\r\n","import * as Rng from \"./rng\"\r\n\r\nexport type GenResult<a> = readonly [a, Rng.Seed]\r\n\r\nexport interface Generators<a> {\r\n    (rng: Rng.Seed): GenResult<a>\r\n}\r\n\r\nexport namespace Generators {\r\n    export function always<a>(val: a): Generators<a> {\r\n        return rng => [val, rng]\r\n    }\r\n\r\n    export function bool(rng: Rng.Seed): GenResult<boolean> {\r\n        const [pct, nextSeed] = rng.nextFloat()\r\n        return [pct < 0.5, nextSeed]\r\n    }\r\n\r\n    export function int(min: number, max: number): Generators<number> {\r\n        min = min | 0\r\n        max = max | 0\r\n        return rng => int_(min, max, rng)\r\n    }\r\n\r\n    function int_(min: number, max: number, rng: Rng.Seed): GenResult<number> {\r\n        const [pct, nextSeed] = rng.nextFloat()\r\n        const delta = max - min\r\n        return [pct * delta + min, nextSeed]\r\n    }\r\n\r\n    export function float(min: number, max: number): Generators<number> {\r\n        return rng => float_(min, max, rng)\r\n    }\r\n\r\n    function float_(min: number, max: number, rng: Rng.Seed): GenResult<number> {\r\n        const [pct, nextSeed] = rng.nextFloat()\r\n        const delta = max - min\r\n        return [pct * delta + min, nextSeed]\r\n    }\r\n\r\n    export function t2<a, b>(genA: Generators<a>, genB: Generators<b>): Generators<[a, b]> {\r\n        return rng => t2_(genA, genB, rng)\r\n    }\r\n\r\n    function t2_<a, b>(\r\n        genA: Generators<a>,\r\n        genB: Generators<b>,\r\n        rng0: Rng.Seed\r\n    ): GenResult<[a, b]> {\r\n        const [valA, rng1] = genA(rng0)\r\n        const [valB, rng2] = genB(rng1)\r\n        return [[valA, valB], rng2]\r\n    }\r\n\r\n    export function t3<a, b, c>(\r\n        genA: Generators<a>,\r\n        genB: Generators<b>,\r\n        genC: Generators<c>\r\n    ): Generators<[a, b, c]> {\r\n        return rng => t3_(genA, genB, genC, rng)\r\n    }\r\n\r\n    function t3_<a, b, c>(\r\n        genA: Generators<a>,\r\n        genB: Generators<b>,\r\n        genC: Generators<c>,\r\n        rng0: Rng.Seed\r\n    ): GenResult<[a, b, c]> {\r\n        const [valA, rng1] = genA(rng0)\r\n        const [valB, rng2] = genB(rng1)\r\n        const [valC, rng3] = genC(rng2)\r\n        return [[valA, valB, valC], rng3]\r\n    }\r\n\r\n    export function array<a>(length: number, gen: Generators<a>): Generators<a[]> {\r\n        return rng => array_(length, gen, rng)\r\n    }\r\n\r\n    function array_<a>(length: number, gen: Generators<a>, rng: Rng.Seed): GenResult<a[]> {\r\n        const arr = new Array(length)\r\n        for (let i = 0; i < length; i++) {\r\n            const [val, nextRng] = gen(rng)\r\n            arr[i] = val\r\n            rng = nextRng\r\n        }\r\n        return [arr, rng]\r\n    }\r\n\r\n    export type ObjectProps<a> = { readonly [propName in keyof a]: Generators<a[propName]> }\r\n\r\n    export function object<a>(gens: ObjectProps<a>): Generators<a> {\r\n        return rng => object_(gens, rng)\r\n    }\r\n\r\n    function object_<a>(gens: ObjectProps<a>, rng: Rng.Seed): GenResult<a> {\r\n        /* eslint-disable */\r\n        const obj = {} as a\r\n        for (const prop in gens) {\r\n            const [val, nextRng] = gens[prop](rng)\r\n            obj[prop] = val\r\n            rng = nextRng\r\n        }\r\n        /* eslint-enable */\r\n        return [obj, rng]\r\n    }\r\n\r\n    export function map<a, b>(genA: Generators<a>, f: (valA: a) => b): Generators<b> {\r\n        return rng => map_(genA, f, rng)\r\n    }\r\n\r\n    function map_<a, b>(genA: Generators<a>, f: (valA: a) => b, rng0: Rng.Seed): GenResult<b> {\r\n        const [valA, rng1] = genA(rng0)\r\n        return [f(valA), rng1]\r\n    }\r\n\r\n    export function map2<a, b, c>(\r\n        genA: Generators<a>,\r\n        genB: Generators<b>,\r\n        f: (valA: a, valB: b) => c\r\n    ): Generators<c> {\r\n        return rng => map2_(genA, genB, f, rng)\r\n    }\r\n\r\n    function map2_<a, b, c>(\r\n        genA: Generators<a>,\r\n        genB: Generators<b>,\r\n        f: (valA: a, valB: b) => c,\r\n        rng0: Rng.Seed\r\n    ): GenResult<c> {\r\n        const [valA, rng1] = genA(rng0)\r\n        const [valB, rng2] = genB(rng1)\r\n        return [f(valA, valB), rng2]\r\n    }\r\n\r\n    export function map3<a, b, c, d>(\r\n        genA: Generators<a>,\r\n        genB: Generators<b>,\r\n        genC: Generators<c>,\r\n        f: (valA: a, valB: b, valC: c) => d\r\n    ): Generators<d> {\r\n        return rng => map3_(genA, genB, genC, f, rng)\r\n    }\r\n\r\n    function map3_<a, b, c, d>(\r\n        genA: Generators<a>,\r\n        genB: Generators<b>,\r\n        genC: Generators<c>,\r\n        f: (valA: a, valB: b, valC: c) => d,\r\n        rng0: Rng.Seed\r\n    ): GenResult<d> {\r\n        const [valA, rng1] = genA(rng0)\r\n        const [valB, rng2] = genB(rng1)\r\n        const [valC, rng3] = genC(rng2)\r\n        return [f(valA, valB, valC), rng3]\r\n    }\r\n\r\n    export function map4<a, b, c, d, e>(\r\n        genA: Generators<a>,\r\n        genB: Generators<b>,\r\n        genC: Generators<c>,\r\n        genD: Generators<d>,\r\n        f: (valA: a, valB: b, valC: c, valD: d) => e\r\n    ): Generators<e> {\r\n        return rng => map4_(genA, genB, genC, genD, f, rng)\r\n    }\r\n\r\n    function map4_<a, b, c, d, e>(\r\n        genA: Generators<a>,\r\n        genB: Generators<b>,\r\n        genC: Generators<c>,\r\n        genD: Generators<d>,\r\n        f: (valA: a, valB: b, valC: c, valD: d) => e,\r\n        rng0: Rng.Seed\r\n    ): GenResult<e> {\r\n        const [valA, rng1] = genA(rng0)\r\n        const [valB, rng2] = genB(rng1)\r\n        const [valC, rng3] = genC(rng2)\r\n        const [valD, rng4] = genD(rng3)\r\n        return [f(valA, valB, valC, valD), rng4]\r\n    }\r\n\r\n    export function andThen<a, b>(\r\n        genA: Generators<a>,\r\n        f: (val: a) => Generators<b>\r\n    ): Generators<b> {\r\n        return rng => andThen_(genA, f, rng)\r\n    }\r\n\r\n    function andThen_<a, b>(\r\n        genA: Generators<a>,\r\n        f: (val: a) => Generators<b>,\r\n        rng0: Rng.Seed\r\n    ): GenResult<b> {\r\n        const [valA, rng1] = genA(rng0)\r\n        return f(valA)(rng1)\r\n    }\r\n\r\n    export function lazy<a>(createGen: () => Generators<a>): Generators<a> {\r\n        let cachedGen: Generators<a> | null = null\r\n        return rng => {\r\n            if (cachedGen === null) {\r\n                cachedGen = createGen()\r\n            }\r\n            return cachedGen(rng)\r\n        }\r\n    }\r\n}\r\n","import * as Color from \"color\"\r\nimport { Generators as Gen } from \"../rng\"\r\n\r\nexport interface Theme {\r\n    readonly color: {\r\n        readonly primary: Color.Hsluv\r\n        readonly primaryLight: Color.Hsluv\r\n        readonly primaryDark: Color.Hsluv\r\n        readonly secondary: Color.Hsluv\r\n        readonly secondaryLight: Color.Hsluv\r\n        readonly secondaryDark: Color.Hsluv\r\n        readonly onPrimary: Color.Hsluv\r\n        readonly onSecondary: Color.Hsluv\r\n        readonly onSurface: Color.Hsluv\r\n        readonly surface: Color.Hsluv\r\n        readonly background: Color.Hsluv\r\n    }\r\n    readonly shadows: {\r\n        readonly button: string\r\n        readonly surface: string\r\n        readonly menu: string\r\n    }\r\n    readonly fonts: {\r\n        readonly monospace: string\r\n        readonly normal: string\r\n    }\r\n}\r\n\r\nconst styleMap = {\r\n    \"--color-primary\": (theme: Theme) => theme.color.primary.toStyle(),\r\n    \"--color-primaryLight\": (theme: Theme) => theme.color.primaryLight.toStyle(),\r\n    \"--color-primaryDark\": (theme: Theme) => theme.color.primaryDark.toStyle(),\r\n    \"--color-secondary\": (theme: Theme) => theme.color.secondary.toStyle(),\r\n    \"--color-secondaryLight\": (theme: Theme) => theme.color.secondaryLight.toStyle(),\r\n    \"--color-secondaryDark\": (theme: Theme) => theme.color.secondaryDark.toStyle(),\r\n    \"--color-onPrimary\": (theme: Theme) => theme.color.onPrimary.toStyle(),\r\n    \"--color-onSecondary\": (theme: Theme) => theme.color.onSecondary.toStyle(),\r\n    \"--color-onSurface\": (theme: Theme) => theme.color.onSurface.toStyle(),\r\n    \"--color-surface\": (theme: Theme) => theme.color.surface.toStyle(),\r\n    \"--color-background\": (theme: Theme) => theme.color.background.toStyle(),\r\n\r\n    \"--shadows-button\": (theme: Theme) => theme.shadows.button,\r\n    \"--shadows-menu\": (theme: Theme) => theme.shadows.menu,\r\n    \"--shadows-surface\": (theme: Theme) => theme.shadows.surface,\r\n\r\n    \"--fonts-monospace\": (theme: Theme) => theme.fonts.monospace,\r\n    \"--fonts-normal\": (theme: Theme) => theme.fonts.normal,\r\n} as const\r\n\r\nexport function updateDiff(prevTheme: Theme, nextTheme: Theme): void {\r\n    for (const propName in styleMap) {\r\n        if (!styleMap.hasOwnProperty(propName)) {\r\n            continue\r\n        }\r\n\r\n        const toStyle = styleMap[propName as keyof typeof styleMap]\r\n        const prevValue = toStyle(prevTheme)\r\n        const nextValue = toStyle(nextTheme)\r\n\r\n        if (prevValue === nextValue) {\r\n            continue\r\n        }\r\n\r\n        document.body.style.setProperty(propName, nextValue)\r\n    }\r\n}\r\n\r\nexport function updateAll(theme: Theme): void {\r\n    for (const propName in styleMap) {\r\n        if (!styleMap.hasOwnProperty(propName)) {\r\n            continue\r\n        }\r\n\r\n        const toStyle = styleMap[propName as keyof typeof styleMap]\r\n        document.body.style.setProperty(propName, toStyle(theme))\r\n    }\r\n}\r\n\r\nconst hsluvGen = (maxSat: number, luminance: number) =>\r\n    Gen.map3(\r\n        Gen.float(0, 360),\r\n        Gen.float(0, maxSat),\r\n        Gen.always(luminance),\r\n        (h, s, l) => new Color.Hsluv(h, s, l)\r\n    )\r\n\r\nconst colorsGen = Gen.object({\r\n    primary: hsluvGen(100, 80),\r\n    primaryLight: hsluvGen(100, 80),\r\n    primaryDark: hsluvGen(100, 80),\r\n    secondary: hsluvGen(100, 77),\r\n    secondaryLight: hsluvGen(100, 77),\r\n    secondaryDark: hsluvGen(100, 77),\r\n    background: hsluvGen(20, 46),\r\n    surface: hsluvGen(35, 38),\r\n    onPrimary: hsluvGen(100, 0),\r\n    onSecondary: hsluvGen(100, 0),\r\n    onSurface: hsluvGen(100, 100),\r\n})\r\n\r\nconst shadowsGen = Gen.always({\r\n    button:\r\n        \"0 1px 5px 0 rgba(0, 0, 0, 0.2), 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 3px 1px -2px rgba(0, 0, 0, 0.12)\",\r\n    surface:\r\n        \"0 1px 5px 0 rgba(0, 0, 0, 0.2), 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 3px 1px -2px rgba(0, 0, 0, 0.12)\",\r\n    menu: \"2px 2px 2px rgba(0, 0, 0, 0.45), 0 5px 8px 0 rgba(0, 0, 0, 0.3)\",\r\n})\r\n\r\nconst fontsGen = Gen.always({\r\n    normal: `\"Helvetica\", \"Arial\", sans-serif`,\r\n    monospace: `\"Courier New\", Courier, monospace`,\r\n})\r\n\r\nexport const random = Gen.object<Theme>({\r\n    color: colorsGen,\r\n    shadows: shadowsGen,\r\n    fonts: fontsGen,\r\n})\r\n","import { Op, Events, onClick, _, shallowEqual, statelessComponent } from \"ivi\"\r\nimport { div, span } from \"ivi-html\"\r\nimport styles from \"./layers.scss\"\r\nimport { State, MsgSender, Id, Layer } from \"../canvas/layers\"\r\nimport { Row, Slider, Labeled, InlineLabeled, Switch, DefaultButton, Surface } from \"./views\"\r\n\r\nexport interface LayersViewProps {\r\n    readonly layers: State\r\n    readonly sender: MsgSender\r\n}\r\n\r\nexport const LayersView = statelessComponent<LayersViewProps>(({ layers, sender }) => {\r\n    const topLayers = layers.layers.children\r\n    const current = layers.current()\r\n\r\n    return div(styles.layersWrapper, _, [\r\n        Surface(\r\n            div(styles.layersControlsWrapper, _, [\r\n                Row({\r\n                    spacing: \"0.25rem\",\r\n                    children: [\r\n                        DefaultButton({\r\n                            onClick: () => sender.newLayer(current.id),\r\n                            title: \"New layer\",\r\n                            content: \"New\",\r\n                        }),\r\n                        DefaultButton({\r\n                            onClick: () => sender.removeLayer(current.id),\r\n                            title: \"Delete layer\",\r\n                            content: \"Delete\",\r\n                        }),\r\n                    ],\r\n                }),\r\n                InlineLabeled({\r\n                    label: \"Hidden\",\r\n                    children: Switch({\r\n                        checked: current.isHidden,\r\n                        onCheck: isHidden => sender.setHidden(current.id, isHidden),\r\n                    }),\r\n                }),\r\n                Labeled({\r\n                    label: \"Opacity\",\r\n                    value: current.opacity.toFixed(2),\r\n                    children: Slider({\r\n                        percentage: current.opacity,\r\n                        onChange: pct => sender.setOpacity(current.id, pct),\r\n                    }),\r\n                }),\r\n            ])\r\n        ),\r\n        div(\r\n            styles.layersListWrapper,\r\n            _,\r\n            topLayers.map(layer =>\r\n                LayerView({\r\n                    layer,\r\n                    selectedId: current.id,\r\n                    onClick: id => sender.selectLayer(id),\r\n                })\r\n            )\r\n        ),\r\n    ])\r\n}, shallowEqual)\r\n\r\ninterface LayerViewProps {\r\n    readonly selectedId: Id\r\n    readonly layer: Layer\r\n    readonly onClick: (id: Id) => void\r\n}\r\n\r\nfunction LayerView(props: LayerViewProps): Op {\r\n    const { selectedId, layer } = props\r\n    const isSelected = selectedId === layer.id\r\n    const container = isSelected ? styles.selectedLayerWrapper : styles.unselectedLayerWrapper\r\n\r\n    return Events(\r\n        onClick(() => props.onClick(layer.id)),\r\n        div(\r\n            container,\r\n            _,\r\n            Surface([\r\n                div(styles.layerLeft),\r\n                div(styles.layerRight, _, [\r\n                    div(styles.layerName, _, layer.name !== \"\" ? layer.name : \"Layer \" + layer.id),\r\n                    div(\r\n                        styles.layerOpacity,\r\n                        _,\r\n                        layer.isHidden\r\n                            ? \"Hidden\"\r\n                            : span(_, _, [\r\n                                  span(_, _, \"Opacity: \"),\r\n                                  span(_, _, layer.opacity.toFixed(2)),\r\n                              ])\r\n                    ),\r\n                ]),\r\n            ])\r\n        )\r\n    )\r\n}\r\n","declare global {\r\n    interface PointerEvent {\r\n        // According to mozzila, this method is deprecated, but I can't find a source on that.\r\n        // https://developer.mozilla.org/en-US/docs/Web/API/PointerEvent\r\n        getCoalescedEvents(): PointerEvent[]\r\n    }\r\n\r\n    interface Window {\r\n        PointerEvent: typeof PointerEvent\r\n    }\r\n}\r\n\r\nexport interface PointerInput {\r\n    readonly x: number\r\n    readonly y: number\r\n    readonly pressure: number\r\n    readonly shift: boolean\r\n    readonly alt: boolean\r\n    readonly ctrl: boolean\r\n    readonly time: number\r\n}\r\n\r\nexport interface Listeners {\r\n    click(input: PointerInput): void\r\n    move(input: readonly PointerInput[]): void\r\n    drag(input: readonly PointerInput[]): void\r\n    release(input: PointerInput): void\r\n}\r\n\r\nexport type RemoveListeners = () => void\r\n\r\nexport function listen(canvas: HTMLCanvasElement, listeners: Listeners): RemoveListeners {\r\n    if (window.PointerEvent !== undefined) {\r\n        return listenForPointers(canvas, listeners)\r\n    } else {\r\n        // Add touch as well?\r\n        return listenForMouse(canvas, listeners)\r\n    }\r\n}\r\n\r\nconst pointerSupportsPressure: { [pointerId: number]: boolean } = {}\r\n\r\nfunction checkPressureSupport(ev: PointerEvent): void {\r\n    if (ev.pressure === 0.5) return\r\n    if (pointerSupportsPressure[ev.pointerId]) return\r\n\r\n    pointerSupportsPressure[ev.pointerId] = true\r\n}\r\n\r\nfunction getPressure(ev: PointerEvent): number {\r\n    return pointerSupportsPressure[ev.pointerId]\r\n        ? ev.pressure\r\n        : ev.pressure === 0.5\r\n        ? 1.0\r\n        : ev.pressure\r\n}\r\n\r\nconst uncoalesce = (() => {\r\n    if (PointerEvent.prototype.getCoalescedEvents === undefined) {\r\n        return (ev: PointerEvent) => [ev]\r\n    }\r\n    return (ev: PointerEvent) => {\r\n        const coalescedEvents = ev.getCoalescedEvents()\r\n        return coalescedEvents\r\n    }\r\n})()\r\n\r\nfunction localizePointer(\r\n    time: number,\r\n    event: PointerEvent,\r\n    // we get the pressure off of the original event because firefox's coalesced events have a bug which causes them to always be 0\r\n    originalEvent: PointerEvent\r\n): PointerInput {\r\n    return {\r\n        x: event.x,\r\n        y: event.y,\r\n        pressure: getPressure(originalEvent),\r\n        shift: event.shiftKey,\r\n        alt: event.altKey,\r\n        ctrl: event.ctrlKey,\r\n        time,\r\n    }\r\n}\r\n\r\nfunction uncoalesceAndLocalize(time: number, originalEvent: PointerEvent): PointerInput[] {\r\n    const events = uncoalesce(originalEvent)\r\n    const result = new Array<PointerInput>(events.length)\r\n    for (let i = 0; i < events.length; i++) {\r\n        // we need to deal with pressure\r\n        result[i] = localizePointer(time, events[i], originalEvent)\r\n    }\r\n    return result\r\n}\r\n\r\nfunction listenForPointers(canvas: HTMLCanvasElement, listeners: Listeners): RemoveListeners {\r\n    const pointerDown = (ev: PointerEvent) => {\r\n        if (ev.button === 1 || ev.button === 2) {\r\n            return\r\n        }\r\n        const time = performance.now()\r\n        listeners.click(localizePointer(time, ev, ev))\r\n    }\r\n\r\n    const pointerUp = (ev: PointerEvent) => {\r\n        const time = performance.now()\r\n        listeners.release(localizePointer(time, ev, ev))\r\n    }\r\n\r\n    const pointerMove = (ev: PointerEvent) => {\r\n        const time = performance.now()\r\n        listeners.move(uncoalesceAndLocalize(time, ev))\r\n        // listeners.move([localizePointer(bounds, time, ev)])\r\n\r\n        if (ev.pressure > 0) {\r\n            listeners.drag(uncoalesceAndLocalize(time, ev))\r\n            // listeners.drag([localizePointer(bounds, time, ev)])\r\n        }\r\n    }\r\n\r\n    window.addEventListener(\"pointerdown\", checkPressureSupport)\r\n    canvas.addEventListener(\"pointerdown\", pointerDown)\r\n    window.addEventListener(\"pointerup\", pointerUp)\r\n    window.addEventListener(\"pointermove\", pointerMove)\r\n\r\n    return () => {\r\n        window.removeEventListener(\"pointerdown\", checkPressureSupport)\r\n        canvas.removeEventListener(\"pointerdown\", pointerDown)\r\n        window.removeEventListener(\"pointerup\", pointerUp)\r\n        window.removeEventListener(\"pointermove\", pointerMove)\r\n    }\r\n}\r\n\r\nfunction listenForMouse(canvas: HTMLCanvasElement, listeners: Listeners): RemoveListeners {\r\n    let isDown = false\r\n\r\n    const mouseDown = (ev: MouseEvent) => {\r\n        if (ev.button === 1 || ev.button === 2) {\r\n            return\r\n        }\r\n        const time = performance.now()\r\n        listeners.click(localizeMouse(time, ev, false))\r\n        isDown = true\r\n    }\r\n\r\n    const mouseUp = (ev: MouseEvent) => {\r\n        const time = performance.now()\r\n        listeners.release(localizeMouse(time, ev, true))\r\n        isDown = false\r\n    }\r\n    const mouseMove = (ev: MouseEvent) => {\r\n        const time = performance.now()\r\n        listeners.move([localizeMouse(time, ev, false)])\r\n\r\n        if (isDown) {\r\n            listeners.drag([localizeMouse(time, ev, false)])\r\n        }\r\n    }\r\n\r\n    canvas.addEventListener(\"mousedown\", mouseDown)\r\n    window.addEventListener(\"mouseup\", mouseUp)\r\n    window.addEventListener(\"mousemove\", mouseMove)\r\n\r\n    return () => {\r\n        canvas.removeEventListener(\"mousedown\", mouseDown)\r\n        window.removeEventListener(\"mouseup\", mouseUp)\r\n        window.removeEventListener(\"mousemove\", mouseMove)\r\n    }\r\n}\r\n\r\nfunction localizeMouse(time: number, ev: MouseEvent, isRelease: boolean): PointerInput {\r\n    return {\r\n        x: ev.x,\r\n        y: ev.y,\r\n        pressure: isRelease ? 0.0 : 1.0,\r\n        shift: ev.shiftKey,\r\n        alt: ev.altKey,\r\n        ctrl: ev.ctrlKey,\r\n        time,\r\n    }\r\n}\r\n","import { Brand, orDefault, arrUpdate, arrInsert, arrRemove } from \"../util\"\r\nimport { Stack, PushArray } from \"../collections\"\r\n\r\nexport type Id = Brand<number, \"LayerId\">\r\n\r\nexport interface CollectedLayer {\r\n    readonly id: Id\r\n    readonly name: string\r\n    readonly opacity: number\r\n}\r\n\r\nexport class LeafLayer {\r\n    static init(id: Id): LeafLayer {\r\n        return new LeafLayer(id, \"\", 1, false)\r\n    }\r\n\r\n    private constructor(\r\n        readonly id: Id,\r\n        readonly name: string,\r\n        readonly opacity: number,\r\n        readonly isHidden: boolean\r\n    ) {}\r\n\r\n    get isLeaf(): true {\r\n        return true\r\n    }\r\n\r\n    with(args: {\r\n        readonly name?: string\r\n        readonly opacity?: number\r\n        readonly isHidden?: boolean\r\n    }): LeafLayer {\r\n        const name = orDefault(args.name, this.name)\r\n        const opacity = orDefault(args.opacity, this.opacity)\r\n        const isHidden = orDefault(args.isHidden, this.isHidden)\r\n        return new LeafLayer(this.id, name, opacity, isHidden)\r\n    }\r\n}\r\n\r\nexport class GroupLayer {\r\n    static init(id: Id): GroupLayer {\r\n        return new GroupLayer(id, \"\", 1, false, [])\r\n    }\r\n\r\n    private constructor(\r\n        readonly id: Id,\r\n        readonly name: string,\r\n        readonly opacity: number,\r\n        readonly isHidden: boolean,\r\n        readonly children: readonly Layer[]\r\n    ) {}\r\n\r\n    get isLeaf(): false {\r\n        return false\r\n    }\r\n\r\n    with(args: {\r\n        readonly name?: string\r\n        readonly opacity?: number\r\n        readonly isHidden?: boolean\r\n    }): GroupLayer {\r\n        return new GroupLayer(\r\n            this.id,\r\n            orDefault(args.name, this.name),\r\n            orDefault(args.opacity, this.opacity),\r\n            orDefault(args.isHidden, this.isHidden),\r\n            this.children\r\n        )\r\n    }\r\n\r\n    withChildren(children: readonly Layer[]): GroupLayer {\r\n        return new GroupLayer(this.id, this.name, this.opacity, this.isHidden, children)\r\n    }\r\n\r\n    get(selectedPath: Stack.NonEmpty<number>): Layer {\r\n        const index = selectedPath.head\r\n        const selected = this.children[index]\r\n\r\n        if (selectedPath.tail.isNonEmpty()) {\r\n            if (selected.isLeaf) throw \"Invariant violation\"\r\n\r\n            return selected.get(selectedPath.tail)\r\n        }\r\n\r\n        return selected\r\n    }\r\n\r\n    getWithContext(selectedPath: Stack.NonEmpty<number>, opacity: number): CollectedLayer {\r\n        const index = selectedPath.head\r\n        const selected = this.children[index]\r\n\r\n        if (selectedPath.tail.isNonEmpty()) {\r\n            if (selected.isLeaf) throw \"Invariant violation\"\r\n\r\n            return selected.getWithContext(\r\n                selectedPath.tail,\r\n                this.isHidden ? 0 : opacity * this.opacity\r\n            )\r\n        }\r\n\r\n        return {\r\n            id: selected.id,\r\n            name: selected.name,\r\n            opacity: selected.isHidden ? 0 : opacity * selected.opacity,\r\n        }\r\n    }\r\n\r\n    findPath(id: Id): Stack.NonEmpty<number> | null {\r\n        const children = this.children\r\n\r\n        for (let i = 0; i < this.children.length; i++) {\r\n            const child = children[i]\r\n            if (child.isLeaf) {\r\n                if (child.id === id) return Stack.empty<number>().cons(i)\r\n            } else {\r\n                const path = child.findPath(id)\r\n                if (path !== null) return path.cons(i)\r\n            }\r\n        }\r\n\r\n        return null\r\n    }\r\n\r\n    insert(selectedPath: Stack.NonEmpty<number>, leaf: LeafLayer): GroupLayer {\r\n        const index = selectedPath.head\r\n        const selected = this.children[index]\r\n\r\n        if (selectedPath.tail.isNonEmpty()) {\r\n            if (selected.isLeaf) throw \"Invariant violation\"\r\n\r\n            const newSelected = selected.insert(selectedPath.tail, leaf)\r\n            const newChildren = arrUpdate(this.children, index, newSelected)\r\n            return this.withChildren(newChildren)\r\n        } else {\r\n            return this.withChildren(arrInsert(this.children, index, leaf))\r\n        }\r\n    }\r\n\r\n    remove(selectedPath: Stack.NonEmpty<number>): readonly [GroupLayer, Stack.Stack<number>] {\r\n        const index = selectedPath.head\r\n        const selected = this.children[index]\r\n\r\n        if (selectedPath.tail.isNonEmpty()) {\r\n            if (selected.isLeaf) throw \"Invariant violation\"\r\n\r\n            const [newSelected, newSelectedPath] = selected.remove(selectedPath.tail)\r\n            const newChildren = arrUpdate(this.children, index, newSelected)\r\n            return [this.withChildren(newChildren), newSelectedPath.cons(index)]\r\n        } else {\r\n            const newChildren = this.withChildren(arrRemove(this.children, index))\r\n            if (newChildren.children.length === 0) return [newChildren, Stack.empty()]\r\n\r\n            const newIndex = this.children.length === index + 1 ? index - 1 : index\r\n            const newSelectedPath = index === newIndex ? selectedPath : Stack.NonEmpty.of(newIndex)\r\n            return [newChildren, newSelectedPath]\r\n        }\r\n    }\r\n\r\n    update<a extends Layer>(\r\n        selectedPath: Stack.NonEmpty<number>,\r\n        updateFn: (layer: a) => a\r\n    ): GroupLayer {\r\n        const index = selectedPath.head\r\n        const selected = this.children[index]\r\n\r\n        if (selectedPath.tail.isNonEmpty()) {\r\n            if (selected.isLeaf) throw \"Invariant violation\"\r\n\r\n            const newSelected = selected.update(selectedPath.tail, updateFn)\r\n            const newChildren = arrUpdate(this.children, index, newSelected)\r\n            return this.withChildren(newChildren)\r\n        } else {\r\n            const newSelected = updateFn(selected as a)\r\n            const newChildren = arrUpdate(this.children, index, newSelected)\r\n            return this.withChildren(newChildren)\r\n        }\r\n    }\r\n\r\n    collectLeaves(array: PushArray<CollectedLayer>, opacity: number): void {\r\n        const children = this.children\r\n        for (let i = 0; i < children.length; i++) {\r\n            const layer = children[i]\r\n            const nextOpacity = layer.isHidden ? 0 : opacity * layer.opacity\r\n            if (layer.isLeaf) {\r\n                array.push({\r\n                    id: layer.id,\r\n                    name: layer.name,\r\n                    opacity: nextOpacity,\r\n                })\r\n            } else {\r\n                layer.collectLeaves(array, nextOpacity)\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nexport type Layer = LeafLayer | GroupLayer\r\n\r\nexport interface SplitLayers {\r\n    readonly above: readonly CollectedLayer[]\r\n    readonly current: CollectedLayer | null\r\n    readonly below: readonly CollectedLayer[]\r\n}\r\n\r\nexport type Msg = NewLayerMsg | RemoveMsg | SelectMsg | SetOpacityMsg | SetHiddenMsg\r\n\r\nexport const enum MsgType {\r\n    NewLayerMsg,\r\n    RemoveMsg,\r\n    SelectMsg,\r\n    SetOpacityMsg,\r\n    SetHiddenMsg,\r\n}\r\n\r\nclass NewLayerMsg {\r\n    readonly type: MsgType.NewLayerMsg = MsgType.NewLayerMsg\r\n    private nominal: void\r\n    constructor(readonly id: Id) {}\r\n}\r\nclass RemoveMsg {\r\n    readonly type: MsgType.RemoveMsg = MsgType.RemoveMsg\r\n    private nominal: void\r\n    constructor(readonly id: Id) {}\r\n}\r\nclass SelectMsg {\r\n    readonly type: MsgType.SelectMsg = MsgType.SelectMsg\r\n    private nominal: void\r\n    constructor(readonly id: Id) {}\r\n}\r\nclass SetOpacityMsg {\r\n    readonly type: MsgType.SetOpacityMsg = MsgType.SetOpacityMsg\r\n    private nominal: void\r\n    constructor(readonly id: Id, readonly opacity: number) {}\r\n}\r\nclass SetHiddenMsg {\r\n    readonly type: MsgType.SetHiddenMsg = MsgType.SetHiddenMsg\r\n    private nominal: void\r\n    constructor(readonly id: Id, readonly isHidden: boolean) {}\r\n}\r\nexport class MsgSender {\r\n    constructor(private sendMessage: (msg: Msg) => void) {}\r\n    readonly newLayer = (id: Id): void => {\r\n        this.sendMessage(new NewLayerMsg(id))\r\n    }\r\n    readonly removeLayer = (id: Id): void => {\r\n        this.sendMessage(new RemoveMsg(id))\r\n    }\r\n    readonly selectLayer = (id: Id): void => {\r\n        this.sendMessage(new SelectMsg(id))\r\n    }\r\n    readonly setOpacity = (id: Id, opacity: number): void => {\r\n        this.sendMessage(new SetOpacityMsg(id, opacity))\r\n    }\r\n    readonly setHidden = (id: Id, isHidden: boolean): void => {\r\n        this.sendMessage(new SetHiddenMsg(id, isHidden))\r\n    }\r\n}\r\n\r\nexport class State {\r\n    static init(): State {\r\n        const getNextLayerId: () => Id = (() => {\r\n            let layerId = 1\r\n            return () => layerId++ as Id\r\n        })()\r\n        const leaf = LeafLayer.init(getNextLayerId())\r\n        const group = GroupLayer.init(getNextLayerId()).withChildren([leaf])\r\n        return new State(getNextLayerId, group, Stack.empty<number>().cons(0))\r\n    }\r\n\r\n    private constructor(\r\n        readonly getNextLayerId: () => Id,\r\n        readonly layers: GroupLayer,\r\n        readonly selectedPath: Stack.NonEmpty<number>\r\n    ) {}\r\n\r\n    current(): Layer {\r\n        return this.layers.get(this.selectedPath)\r\n    }\r\n\r\n    update(msg: Msg): State {\r\n        switch (msg.type) {\r\n            case MsgType.NewLayerMsg:\r\n                return this.current().id === msg.id ? this.newLayer() : this\r\n            case MsgType.RemoveMsg:\r\n                return this.current().id === msg.id ? this.removeCurrent() : this\r\n            case MsgType.SelectMsg:\r\n                return this.current().id === msg.id ? this : this.select(msg.id)\r\n            case MsgType.SetOpacityMsg: {\r\n                const { id, opacity } = msg\r\n                const current = this.current()\r\n\r\n                return current.id === id ? this.updateCurrent(x => x.with({ opacity })) : this\r\n            }\r\n            case MsgType.SetHiddenMsg: {\r\n                const { id, isHidden } = msg\r\n                const current = this.current()\r\n\r\n                return current.id === id ? this.updateCurrent(x => x.with({ isHidden })) : this\r\n            }\r\n            default:\r\n                const never: never = msg\r\n                throw { \"unexpected msg\": msg }\r\n        }\r\n    }\r\n\r\n    split(): SplitLayers {\r\n        const children = this.layers.children\r\n        const selectedIdx = this.selectedPath.head\r\n        const above: PushArray<CollectedLayer> = []\r\n        const below: PushArray<CollectedLayer> = []\r\n        const baseOpacity = 1\r\n\r\n        for (let i = 0; i < selectedIdx; i++) {\r\n            const child = children[i]\r\n            if (child.isLeaf)\r\n                above.push({\r\n                    id: child.id,\r\n                    name: child.name,\r\n                    opacity: baseOpacity * child.opacity,\r\n                })\r\n            else child.collectLeaves(above, baseOpacity)\r\n        }\r\n\r\n        for (let i = this.selectedPath.head + 1; i < children.length; i++) {\r\n            const child = children[i]\r\n            if (child.isLeaf)\r\n                below.push({\r\n                    id: child.id,\r\n                    name: child.name,\r\n                    opacity: baseOpacity * child.opacity,\r\n                })\r\n            else child.collectLeaves(below, baseOpacity)\r\n        }\r\n\r\n        const current = this.layers.get(this.selectedPath)\r\n        if (current.isLeaf)\r\n            return {\r\n                above,\r\n                current: this.layers.getWithContext(this.selectedPath, baseOpacity),\r\n                below,\r\n            }\r\n\r\n        current.collectLeaves(below, baseOpacity)\r\n        return { above, current: null, below }\r\n    }\r\n\r\n    private select(id: Id): State {\r\n        const path = this.layers.findPath(id)\r\n        if (path === null) return this\r\n\r\n        return new State(this.getNextLayerId, this.layers, path)\r\n    }\r\n\r\n    private newLayer(): State {\r\n        const layers = this.layers.insert(this.selectedPath, LeafLayer.init(this.getNextLayerId()))\r\n\r\n        return new State(this.getNextLayerId, layers, this.selectedPath)\r\n    }\r\n\r\n    // newGroup(): LayerState {\r\n    //     throw \"todo\"\r\n    // }\r\n\r\n    private removeCurrent(): State {\r\n        const [newLayers, newSelectedPath] = this.layers.remove(this.selectedPath)\r\n\r\n        if (newSelectedPath.isNonEmpty())\r\n            return new State(this.getNextLayerId, newLayers, newSelectedPath)\r\n\r\n        const oldIndex = this.selectedPath.head\r\n        const newIndex = newLayers.children.length <= oldIndex ? oldIndex : oldIndex - 1\r\n        return new State(this.getNextLayerId, newLayers, Stack.NonEmpty.of(newIndex))\r\n    }\r\n\r\n    private updateCurrent<a extends Layer>(updateFn: (layer: a) => a): State {\r\n        return new State(\r\n            this.getNextLayerId,\r\n            this.layers.update(this.selectedPath, updateFn),\r\n            this.selectedPath\r\n        )\r\n    }\r\n}\r\n","import * as WebGL from \"../webgl\"\r\n\r\nconst VERT_SRC = `\r\nprecision highp float;\r\n\r\nattribute vec2 a_position;\r\n\r\nuniform vec2 u_resolution;\r\n\r\nvarying vec2 v_tex_coords;\r\n\r\nvoid main() {\r\n    vec2 pos = a_position / u_resolution;\r\n    pos.y = 1.0 - pos.y;\r\n    v_tex_coords = pos;\r\n    pos = pos * 2.0;\r\n    pos = pos - 1.0;\r\n    gl_Position = vec4(pos, 0.0, 1.0);\r\n    \r\n}\r\n`\r\n\r\nconst FRAG_SRC = `\r\nprecision highp float;\r\n\r\n${WebGL.DEFINE_from_linear}\r\n\r\nvarying vec2 v_tex_coords;\r\n\r\nuniform sampler2D u_texture;\r\n\r\nvoid main() {\r\n    vec4 pixel = texture2D(u_texture, v_tex_coords);\r\n    gl_FragColor = vec4(from_linear(pixel.rgb), pixel.a);\r\n}\r\n`\r\n\r\nconst AttributesInfo = new WebGL.AttributesInfo([\r\n    { name: \"a_position\", size: 2, type: WebGL.AttribType.Float },\r\n])\r\n\r\nconst Uniforms = {\r\n    u_resolution: WebGL.UniformType.F2,\r\n    u_texture: WebGL.UniformType.I1,\r\n} as const\r\n\r\nexport interface Args {\r\n    readonly uniforms: WebGL.UniformArgs<typeof Uniforms>\r\n    readonly blocks: readonly {\r\n        readonly x0: number\r\n        readonly y0: number\r\n        readonly x1: number\r\n        readonly y1: number\r\n    }[]\r\n}\r\n\r\nexport class Shader {\r\n    static create(gl: WebGLRenderingContext): Shader | null {\r\n        const program = WebGL.createProgram(gl, VERT_SRC, FRAG_SRC)\r\n        if (program === null) {\r\n            return null\r\n        }\r\n\r\n        const locations = WebGL.getUniformLocation(gl, program, Uniforms)\r\n        if (locations === null) {\r\n            return null\r\n        }\r\n\r\n        AttributesInfo.bindAttribLocations(gl, program)\r\n\r\n        return new Shader(gl, program, locations)\r\n    }\r\n\r\n    private readonly buffer: WebGLBuffer\r\n    private array: Float32Array\r\n    private capacity = 1024\r\n\r\n    private constructor(\r\n        gl: WebGLRenderingContext,\r\n        private readonly program: WebGLProgram,\r\n        private readonly locations: WebGL.UniformsInfo<typeof Uniforms>\r\n    ) {\r\n        this.buffer = gl.createBuffer()!\r\n        this.array = new Float32Array(AttributesInfo.size * 6 * this.capacity)\r\n    }\r\n\r\n    render(gl: WebGLRenderingContext, args: Args): void {\r\n        const { sfact, dfact } = WebGL.Blend.factorsNormal\r\n        gl.blendFunc(sfact, dfact)\r\n\r\n        gl.useProgram(this.program)\r\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null)\r\n        if (this.capacity < args.blocks.length) {\r\n            this.capacity = args.blocks.length\r\n            this.array = new Float32Array(AttributesInfo.size * 6 * this.capacity)\r\n        }\r\n\r\n        const array = this.array\r\n        let offset = 0\r\n        for (let i = 0; i < args.blocks.length; i++) {\r\n            const { x0, y0, x1, y1 } = args.blocks[i]\r\n            array[offset++] = x0\r\n            array[offset++] = y0\r\n            array[offset++] = x0\r\n            array[offset++] = y1\r\n            array[offset++] = x1\r\n            array[offset++] = y0\r\n\r\n            array[offset++] = x0\r\n            array[offset++] = y1\r\n            array[offset++] = x1\r\n            array[offset++] = y0\r\n            array[offset++] = x1\r\n            array[offset++] = y1\r\n        }\r\n\r\n        // buffer data\r\n        gl.bindBuffer(WebGLRenderingContext.ARRAY_BUFFER, this.buffer)\r\n        gl.bufferData(WebGLRenderingContext.ARRAY_BUFFER, array, WebGLRenderingContext.DYNAMIC_DRAW)\r\n\r\n        WebGL.updateUniforms(gl, this.locations, args.uniforms)\r\n\r\n        AttributesInfo.vertexAttrib(gl)\r\n\r\n        gl.drawArrays(WebGLRenderingContext.TRIANGLES, 0, 6 * args.blocks.length)\r\n    }\r\n\r\n    dispose(gl: WebGLRenderingContext): void {\r\n        gl.deleteBuffer(this.buffer)\r\n        gl.deleteProgram(this.program)\r\n    }\r\n}\r\n","import * as WebGL from \"../webgl\"\r\nimport { Vec2 } from \"../util\"\r\n\r\nconst VERT_SRC = `\r\nprecision highp float;\r\n\r\nattribute vec2 a_position;\r\n\r\nvarying vec2 v_position;\r\n\r\nvoid main() {\r\n  gl_Position = vec4(a_position, 0.0, 1.0);\r\n  \r\n  v_position = a_position;\r\n}\r\n`\r\n\r\nconst FRAG_SRC = `\r\nprecision highp float;\r\n\r\nvarying vec2 v_position;\r\n\r\nuniform float u_softness;\r\n\r\nvoid main() {\r\n  float radius = 1.0 - u_softness;\r\n  float dist = sqrt(dot(v_position, v_position));\r\n  float a = 1.0 - smoothstep(radius, radius + u_softness, dist);\r\n\r\n  gl_FragColor = vec4(vec3(0.0), (a));\r\n}\r\n`\r\n\r\nconst AttributesInfo = new WebGL.AttributesInfo([\r\n    { name: \"a_position\", size: 2, type: WebGL.AttribType.Float },\r\n])\r\n\r\nconst Uniforms = {\r\n    u_softness: WebGL.UniformType.F1,\r\n} as const\r\n\r\nexport interface Args {\r\n    readonly uniforms: WebGL.UniformArgs<typeof Uniforms>\r\n    readonly framebuffer: WebGLFramebuffer\r\n    readonly size: Vec2\r\n}\r\n\r\nexport class Generator {\r\n    static create(gl: WebGLRenderingContext): Generator | null {\r\n        const program = WebGL.createProgram(gl, VERT_SRC, FRAG_SRC)\r\n        if (program === null) {\r\n            return null\r\n        }\r\n\r\n        const locations = WebGL.getUniformLocation(gl, program, Uniforms)\r\n        if (locations === null) {\r\n            return null\r\n        }\r\n\r\n        AttributesInfo.bindAttribLocations(gl, program)\r\n\r\n        return new Generator(gl, program, locations)\r\n    }\r\n\r\n    private readonly buffer: WebGLBuffer\r\n    private readonly array: Float32Array\r\n\r\n    private constructor(\r\n        gl: WebGLRenderingContext,\r\n        readonly program: WebGLProgram,\r\n        private readonly locations: WebGL.UniformsInfo<typeof Uniforms>\r\n    ) {\r\n        this.buffer = gl.createBuffer()!\r\n        const array = new Float32Array(12)\r\n        array[0] = -1\r\n        array[1] = -1\r\n\r\n        array[2] = -1\r\n        array[3] = 1\r\n\r\n        array[4] = 1\r\n        array[5] = -1\r\n\r\n        array[6] = -1\r\n        array[7] = 1\r\n\r\n        array[8] = 1\r\n        array[9] = -1\r\n\r\n        array[10] = 1\r\n        array[11] = 1\r\n        this.array = array\r\n    }\r\n\r\n    generateBrushTexture(gl: WebGLRenderingContext, args: Args): void {\r\n        const { sfact, dfact } = WebGL.Blend.factorsNormal\r\n        gl.blendFunc(sfact, dfact)\r\n        gl.useProgram(this.program)\r\n        gl.viewport(0, 0, args.size.x, args.size.y)\r\n        gl.bindFramebuffer(gl.FRAMEBUFFER, args.framebuffer)\r\n        gl.clearColor(0, 0, 0, 0)\r\n        gl.clear(gl.COLOR_BUFFER_BIT)\r\n\r\n        WebGL.updateUniforms(gl, this.locations, args.uniforms)\r\n\r\n        gl.bindBuffer(WebGLRenderingContext.ARRAY_BUFFER, this.buffer)\r\n        gl.bufferData(\r\n            WebGLRenderingContext.ARRAY_BUFFER,\r\n            this.array,\r\n            WebGLRenderingContext.STATIC_DRAW\r\n        )\r\n\r\n        AttributesInfo.vertexAttrib(gl)\r\n\r\n        gl.drawArrays(WebGLRenderingContext.TRIANGLES, 0, 6)\r\n    }\r\n\r\n    dispose(gl: WebGLRenderingContext): void {\r\n        gl.deleteBuffer(this.buffer)\r\n        gl.deleteProgram(this.program)\r\n    }\r\n}\r\n","import * as WebGL from \"../webgl\"\r\n\r\nconst VERT_SRC = `\r\nprecision highp float;\r\n\r\nattribute vec2 a_position;\r\n\r\nuniform vec2 u_resolution;\r\n\r\nvarying vec2 v_tex_coords;\r\n\r\nvoid main() {\r\n    vec2 pos = a_position / u_resolution;\r\n    pos.y = 1.0 - pos.y;\r\n    pos = pos * 2.0;\r\n    pos = pos - 1.0;\r\n    gl_Position = vec4(pos, 0.0, 1.0);\r\n    \r\n    v_tex_coords = a_position / u_resolution;\r\n}\r\n`\r\n\r\nconst FRAG_SRC = `\r\nprecision highp float;\r\n\r\nvarying vec2 v_tex_coords;\r\n\r\nuniform sampler2D u_texture;\r\nuniform float u_opacity;\r\n\r\nvoid main() {\r\n    vec4 pixel = texture2D(u_texture, v_tex_coords);\r\n    gl_FragColor = pixel * u_opacity;\r\n}\r\n`\r\n\r\nconst AttributesInfo = new WebGL.AttributesInfo([\r\n    { name: \"a_position\", size: 2, type: WebGL.AttribType.Float },\r\n])\r\n\r\nconst Uniforms = {\r\n    u_texture: WebGL.UniformType.I1,\r\n    u_resolution: WebGL.UniformType.F2,\r\n    u_opacity: WebGL.UniformType.F1,\r\n} as const\r\n\r\nexport interface Args {\r\n    readonly uniforms: WebGL.UniformArgs<typeof Uniforms>\r\n    readonly framebuffer: WebGLFramebuffer\r\n    readonly blocks: readonly {\r\n        readonly x0: number\r\n        readonly y0: number\r\n        readonly x1: number\r\n        readonly y1: number\r\n    }[]\r\n}\r\n\r\nexport class Shader {\r\n    static create(gl: WebGLRenderingContext): Shader | null {\r\n        const program = WebGL.createProgram(gl, VERT_SRC, FRAG_SRC)\r\n        if (program === null) {\r\n            return null\r\n        }\r\n\r\n        const locations = WebGL.getUniformLocation(gl, program, Uniforms)\r\n\r\n        if (locations === null) {\r\n            return null\r\n        }\r\n\r\n        AttributesInfo.bindAttribLocations(gl, program)\r\n\r\n        return new Shader(gl, program, locations)\r\n    }\r\n\r\n    private readonly buffer: WebGLBuffer\r\n    private array: Float32Array\r\n    private capacity = 1024\r\n\r\n    private constructor(\r\n        gl: WebGLRenderingContext,\r\n        private readonly program: WebGLProgram,\r\n        private readonly locations: WebGL.UniformsInfo<typeof Uniforms>\r\n    ) {\r\n        this.buffer = gl.createBuffer()!\r\n        this.array = new Float32Array(AttributesInfo.size * 6 * this.capacity)\r\n    }\r\n\r\n    render(gl: WebGLRenderingContext, args: Args): void {\r\n        if (args.framebuffer == null) {\r\n            throw \"Framebuffer should be defined\"\r\n        }\r\n        const { sfact, dfact } = WebGL.Blend.factorsNormal\r\n        gl.blendFunc(sfact, dfact)\r\n        gl.useProgram(this.program)\r\n        gl.bindFramebuffer(gl.FRAMEBUFFER, args.framebuffer)\r\n        if (this.capacity < args.blocks.length) {\r\n            this.capacity = args.blocks.length\r\n            this.array = new Float32Array(AttributesInfo.size * 6 * this.capacity)\r\n        }\r\n\r\n        const array = this.array\r\n\r\n        let offset = 0\r\n        for (let i = 0; i < args.blocks.length; i++) {\r\n            const { x0, y0, x1, y1 } = args.blocks[i]\r\n            array[offset++] = x0\r\n            array[offset++] = y0\r\n            array[offset++] = x0\r\n            array[offset++] = y1\r\n            array[offset++] = x1\r\n            array[offset++] = y0\r\n\r\n            array[offset++] = x0\r\n            array[offset++] = y1\r\n            array[offset++] = x1\r\n            array[offset++] = y0\r\n            array[offset++] = x1\r\n            array[offset++] = y1\r\n        }\r\n\r\n        // buffer data\r\n        gl.bindBuffer(WebGLRenderingContext.ARRAY_BUFFER, this.buffer)\r\n        gl.bufferData(WebGLRenderingContext.ARRAY_BUFFER, array, WebGLRenderingContext.DYNAMIC_DRAW)\r\n\r\n        WebGL.updateUniforms(gl, this.locations, args.uniforms)\r\n\r\n        AttributesInfo.vertexAttrib(gl)\r\n\r\n        gl.drawArrays(WebGLRenderingContext.TRIANGLES, 0, 6 * args.blocks.length)\r\n    }\r\n\r\n    dispose(gl: WebGLRenderingContext): void {\r\n        gl.deleteBuffer(this.buffer)\r\n        gl.deleteProgram(this.program)\r\n    }\r\n}\r\n","import * as WebGL from \"../webgl\"\r\n\r\nconst VERT_SRC = `\r\nprecision highp float;\r\n\r\nattribute vec2 a_position;\r\n\r\nuniform vec2 u_resolution;\r\n\r\nvoid main() {\r\n    vec2 pos = a_position / u_resolution;\r\n    pos.y = 1.0 - pos.y;\r\n    pos = pos * 2.0;\r\n    pos = pos - 1.0;\r\n    gl_Position = vec4(pos, 0.0, 1.0);\r\n}\r\n`\r\n\r\nconst FRAG_SRC = `\r\nprecision highp float;\r\n\r\nuniform vec4 u_rgba;\r\n\r\nvoid main() {\r\n    gl_FragColor = u_rgba;\r\n}\r\n`\r\n\r\nconst AttributesInfo = new WebGL.AttributesInfo([\r\n    { name: \"a_position\", size: 2, type: WebGL.AttribType.Float },\r\n])\r\n\r\nconst Uniforms = {\r\n    u_resolution: WebGL.UniformType.F2,\r\n    u_rgba: WebGL.UniformType.F4,\r\n} as const\r\n\r\nexport interface Args {\r\n    readonly uniforms: WebGL.UniformArgs<typeof Uniforms>\r\n    readonly framebuffer: WebGLFramebuffer\r\n    readonly blocks: readonly {\r\n        readonly x0: number\r\n        readonly y0: number\r\n        readonly x1: number\r\n        readonly y1: number\r\n    }[]\r\n}\r\n\r\nexport class Shader {\r\n    static create(gl: WebGLRenderingContext): Shader | null {\r\n        const program = WebGL.createProgram(gl, VERT_SRC, FRAG_SRC)\r\n        if (program === null) {\r\n            return null\r\n        }\r\n\r\n        const locations = WebGL.getUniformLocation(gl, program, Uniforms)\r\n        if (locations === null) {\r\n            return null\r\n        }\r\n\r\n        AttributesInfo.bindAttribLocations(gl, program)\r\n\r\n        return new Shader(gl, program, locations)\r\n    }\r\n\r\n    private readonly buffer: WebGLBuffer\r\n    private array: Float32Array\r\n    private capacity = 1024\r\n\r\n    private constructor(\r\n        gl: WebGLRenderingContext,\r\n        private readonly program: WebGLProgram,\r\n        private readonly locations: WebGL.UniformsInfo<typeof Uniforms>\r\n    ) {\r\n        this.buffer = gl.createBuffer() as WebGLBuffer\r\n        this.array = new Float32Array(AttributesInfo.size * 6 * this.capacity)\r\n    }\r\n\r\n    render(gl: WebGLRenderingContext, args: Args): void {\r\n        if (args.framebuffer == null) {\r\n            throw \"Framebuffer should be defined\"\r\n        }\r\n        const { sfact, dfact } = WebGL.Blend.factorsNormal\r\n        gl.blendFunc(sfact, dfact)\r\n        gl.useProgram(this.program)\r\n        gl.bindFramebuffer(gl.FRAMEBUFFER, args.framebuffer)\r\n        if (this.capacity < args.blocks.length) {\r\n            this.capacity = args.blocks.length\r\n            this.array = new Float32Array(AttributesInfo.size * 6 * this.capacity)\r\n        }\r\n\r\n        const array = this.array\r\n\r\n        let offset = 0\r\n        for (let i = 0; i < args.blocks.length; i++) {\r\n            const { x0, y0, x1, y1 } = args.blocks[i]\r\n            array[offset++] = x0\r\n            array[offset++] = y0\r\n            array[offset++] = x0\r\n            array[offset++] = y1\r\n            array[offset++] = x1\r\n            array[offset++] = y0\r\n\r\n            array[offset++] = x0\r\n            array[offset++] = y1\r\n            array[offset++] = x1\r\n            array[offset++] = y0\r\n            array[offset++] = x1\r\n            array[offset++] = y1\r\n        }\r\n\r\n        // buffer data\r\n        gl.bindBuffer(WebGLRenderingContext.ARRAY_BUFFER, this.buffer)\r\n        gl.bufferData(WebGLRenderingContext.ARRAY_BUFFER, array, WebGLRenderingContext.DYNAMIC_DRAW)\r\n\r\n        WebGL.updateUniforms(gl, this.locations, args.uniforms)\r\n\r\n        AttributesInfo.vertexAttrib(gl)\r\n\r\n        gl.drawArrays(WebGLRenderingContext.TRIANGLES, 0, 6 * args.blocks.length)\r\n    }\r\n\r\n    dispose(gl: WebGLRenderingContext): void {\r\n        gl.deleteBuffer(this.buffer)\r\n        gl.deleteProgram(this.program)\r\n    }\r\n}\r\n","import * as Color from \"color\"\r\nimport * as WebGL from \"../webgl\"\r\nimport { Vec2, Vec4 } from \"../util\"\r\n\r\nconst INITIAL_VARRAY_SIZE = 5000\r\n\r\nconst VERT_SRC = `\r\nprecision highp float;\r\n\r\nattribute vec4 a_color;\r\nattribute vec2 a_tex_coords;\r\nattribute vec2 a_position;\r\n\r\nuniform vec2 u_resolution;\r\n\r\nvarying vec4 v_color;\r\nvarying vec2 v_tex_coords;\r\n\r\nvoid main() {\r\n    vec2 pos = (a_position / u_resolution) * vec2(2.0, -2.0) + vec2(-1.0, 1.0);\r\n    gl_Position = vec4(pos, 0.0, 1.0);\r\n\r\n    v_color = vec4(a_color.rgb * a_color.a, a_color.a);\r\n    v_tex_coords = a_tex_coords;\r\n}\r\n`\r\n\r\nconst FRAG_SRC = `\r\nprecision highp float;\r\n\r\nvarying vec4 v_color;\r\nvarying vec2 v_tex_coords;\r\n\r\nuniform sampler2D u_texture;\r\n\r\nvoid main() {\r\n    float alpha = texture2D(u_texture, v_tex_coords).a;\r\n    gl_FragColor = v_color * alpha;\r\n}\r\n`\r\n\r\n// TODO: Use elements array!\r\n\r\nexport interface BrushPoint {\r\n    readonly color: Color.RgbLinear\r\n    readonly alpha: number\r\n    readonly position: Vec2\r\n    readonly scaledDiameter: number\r\n    readonly rotation: number\r\n}\r\n\r\nconst AttributesInfo = new WebGL.AttributesInfo([\r\n    { name: \"a_color\", size: 4, type: WebGL.AttribType.Float },\r\n    { name: \"a_tex_coords\", size: 2, type: WebGL.AttribType.Float },\r\n    { name: \"a_position\", size: 2, type: WebGL.AttribType.Float },\r\n])\r\n\r\nconst Uniforms = {\r\n    u_resolution: WebGL.UniformType.F2,\r\n    u_texture: WebGL.UniformType.I1,\r\n} as const\r\n\r\nexport interface Args {\r\n    readonly uniforms: WebGL.UniformArgs<typeof Uniforms>\r\n    readonly blendMode: WebGL.Blend.Mode\r\n}\r\n\r\ninterface AffectedArea {\r\n    x0: number\r\n    y0: number\r\n    x1: number\r\n    y1: number\r\n}\r\n\r\nfunction initAffectedArea(): AffectedArea {\r\n    return {\r\n        x0: Number.MAX_VALUE,\r\n        y0: Number.MAX_VALUE,\r\n        x1: Number.MIN_VALUE,\r\n        y1: Number.MIN_VALUE,\r\n    }\r\n}\r\n\r\nexport class Shader {\r\n    static create(gl: WebGLRenderingContext): Shader | null {\r\n        const program = WebGL.createProgram(gl, VERT_SRC, FRAG_SRC)\r\n        if (program === null) {\r\n            return null\r\n        }\r\n\r\n        const locations = WebGL.getUniformLocation(gl, program, Uniforms)\r\n        if (locations === null) {\r\n            return null\r\n        }\r\n\r\n        AttributesInfo.bindAttribLocations(gl, program)\r\n\r\n        return new Shader(gl, program, locations)\r\n    }\r\n\r\n    private readonly buffer: WebGLBuffer\r\n    private array: Float32Array\r\n    private offset: number\r\n    private affectedArea: AffectedArea\r\n\r\n    private constructor(\r\n        gl: WebGLRenderingContext,\r\n        readonly program: WebGLProgram,\r\n        private readonly locations: WebGL.UniformsInfo<typeof Uniforms>\r\n    ) {\r\n        const arrayLength = AttributesInfo.size * 6 * INITIAL_VARRAY_SIZE\r\n\r\n        this.buffer = gl.createBuffer()!\r\n        this.array = new Float32Array(arrayLength)\r\n        this.offset = 0\r\n        this.affectedArea = initAffectedArea()\r\n    }\r\n\r\n    get canFlush(): boolean {\r\n        return this.offset > 0\r\n    }\r\n\r\n    addPoints(points: readonly BrushPoint[]): void {\r\n        const nextOffset = 6 * AttributesInfo.size * points.length + this.offset\r\n        while (nextOffset > this.array.length) {\r\n            this.array = doubleSize(this.array)\r\n        }\r\n\r\n        const arr = this.array\r\n        const ptsLen = points.length\r\n        let offset = this.offset\r\n        for (let i = 0; i < ptsLen; i++) {\r\n            offset = addPoint(arr, offset, points[i], this.affectedArea)\r\n        }\r\n\r\n        this.offset = offset\r\n    }\r\n\r\n    getAffectedArea(): Vec4 {\r\n        const { affectedArea } = this\r\n        return new Vec4(affectedArea.x0, affectedArea.y0, affectedArea.x1, affectedArea.y1)\r\n    }\r\n\r\n    flush(gl: WebGLRenderingContext, args: Args): void {\r\n        gl.useProgram(this.program)\r\n\r\n        const arrayView = this.array.subarray(0, this.offset)\r\n\r\n        const { sfact, dfact } = WebGL.Blend.getFactors(args.blendMode)\r\n        gl.blendFunc(sfact, dfact)\r\n\r\n        // buffer data\r\n        gl.bindBuffer(WebGLRenderingContext.ARRAY_BUFFER, this.buffer)\r\n        gl.bufferData(\r\n            WebGLRenderingContext.ARRAY_BUFFER,\r\n            arrayView,\r\n            WebGLRenderingContext.DYNAMIC_DRAW\r\n        )\r\n\r\n        WebGL.updateUniforms(gl, this.locations, args.uniforms)\r\n\r\n        AttributesInfo.vertexAttrib(gl)\r\n\r\n        const drawCount = AttributesInfo.getDrawCount(this.offset)\r\n\r\n        gl.drawArrays(WebGLRenderingContext.TRIANGLES, 0, drawCount)\r\n        this.offset = 0\r\n        this.affectedArea = initAffectedArea()\r\n    }\r\n\r\n    dispose(gl: WebGLRenderingContext): void {\r\n        gl.deleteBuffer(this.buffer)\r\n        gl.deleteProgram(this.program)\r\n    }\r\n}\r\n\r\nfunction doubleSize(arr: Float32Array): Float32Array {\r\n    const newArr = new Float32Array(arr.length * 2)\r\n\r\n    for (let i = 0; i < arr.length; i++) {\r\n        newArr[i] = arr[i]\r\n    }\r\n\r\n    return newArr\r\n}\r\n\r\nfunction addPoint(\r\n    arr: Float32Array,\r\n    offset: number,\r\n    point: BrushPoint,\r\n    affectedArea: AffectedArea\r\n): number {\r\n    // console.log(\"addPoint\", point.color.r, point.color.g, point.color.b)\r\n    const x = point.position.x\r\n    const y = point.position.y\r\n    const r = point.scaledDiameter * 0.5\r\n\r\n    // const c = Math.cos(point.rotation)\r\n    // const s = Math.sin(point.rotation)\r\n\r\n    // const rc = r * c\r\n    // const rs = r * s\r\n\r\n    // const rx = rc - rs\r\n    // const ry = rs + rc\r\n\r\n    // const x0 = x - rc + rs\r\n    // const y0 = y - rs - rc\r\n    // const x1 = x + rc - rs\r\n    // const y1 = y + rs + rc\r\n    const x0 = x - r\r\n    const y0 = y - r\r\n    const x1 = x + r\r\n    const y1 = y + r\r\n\r\n    // first tri\r\n    offset = addCorner(arr, offset, point, 0, 0, x0, y0)\r\n    offset = addCorner(arr, offset, point, 1, 0, x1, y0)\r\n    offset = addCorner(arr, offset, point, 0, 1, x0, y1)\r\n\r\n    // second tri\r\n    offset = addCorner(arr, offset, point, 1, 1, x1, y1)\r\n    offset = addCorner(arr, offset, point, 0, 1, x0, y1)\r\n    offset = addCorner(arr, offset, point, 1, 0, x1, y0)\r\n\r\n    // investigate performance: use ternaries that always assign instead of conditional assignment\r\n    // idk, might worth looking into\r\n    if (x0 < affectedArea.x0) {\r\n        affectedArea.x0 = x0\r\n    }\r\n    if (y0 < affectedArea.y0) {\r\n        affectedArea.y0 = y0\r\n    }\r\n    if (x1 > affectedArea.x1) {\r\n        affectedArea.x1 = x1\r\n    }\r\n    if (y1 > affectedArea.y1) {\r\n        affectedArea.y1 = y1\r\n    }\r\n\r\n    return offset\r\n}\r\n\r\nfunction addCorner(\r\n    arr: Float32Array,\r\n    offset: number,\r\n    point: BrushPoint,\r\n    tx: number,\r\n    ty: number,\r\n    x: number,\r\n    y: number\r\n): number {\r\n    // vec4 a_color\r\n    arr[offset++] = point.color.r\r\n    arr[offset++] = point.color.g\r\n    arr[offset++] = point.color.b\r\n    arr[offset++] = point.alpha\r\n\r\n    // vec2 a_tex_coords\r\n    arr[offset++] = tx\r\n    arr[offset++] = ty\r\n\r\n    // vec2 a_position\r\n    arr[offset++] = x\r\n    arr[offset++] = y\r\n\r\n    return offset\r\n}\r\n","import { BrushPoint } from \"./brushShader\"\r\n\r\nconst PX_PER_BLOCK_X = 32\r\nconst PX_PER_BLOCK_Y = 32\r\n\r\nexport class Block {\r\n    readonly x0: number\r\n    readonly y0: number\r\n    readonly x1: number\r\n    readonly y1: number\r\n\r\n    private nominal: void\r\n    constructor(x: number, y: number) {\r\n        this.x0 = x * PX_PER_BLOCK_X\r\n        this.y0 = y * PX_PER_BLOCK_Y\r\n        this.x1 = (x + 1) * PX_PER_BLOCK_X\r\n        this.y1 = (y + 1) * PX_PER_BLOCK_Y\r\n    }\r\n\r\n    eq(other: Block): boolean {\r\n        return this.x0 === other.x0 && this.y0 === other.y0\r\n    }\r\n}\r\n\r\nexport class BlockTracker {\r\n    private _frameBlocks: Block[]\r\n    private _strokeBlocks: Block[]\r\n\r\n    constructor() {\r\n        this._frameBlocks = []\r\n        this._strokeBlocks = []\r\n    }\r\n\r\n    /**\r\n     * Returns a readonly reference to the internally mutable and unstable frameblock array.\r\n     *\r\n     * Do not store the reference.\r\n     */\r\n    getFrameBlocks(): readonly Block[] {\r\n        return this._frameBlocks\r\n    }\r\n\r\n    /**\r\n     * Returns a readonly reference to the internally mutable and unstable strokeblock array.\r\n     *\r\n     * Do not store the reference.\r\n     */\r\n    getStrokeBlocks(): readonly Block[] {\r\n        return this._strokeBlocks\r\n    }\r\n\r\n    /**\r\n     * Track the blocks that the given brushPoints might touch.\r\n     */\r\n    addPoints(brushPoints: readonly BrushPoint[]): void {\r\n        if (brushPoints.length === 0) {\r\n            return\r\n        }\r\n\r\n        const frameBlocks = this._frameBlocks\r\n        for (let i = 0; i < brushPoints.length; i++) {\r\n            // 1. find minimum intersection point\r\n            // 2. find maximum intersection point\r\n            // 3. fill in every in between\r\n            // assume the texture is circular with its max radius being width / 2\r\n            const point = brushPoints[i]\r\n\r\n            const radius = point.scaledDiameter / 2\r\n            const xMin = point.position.x - radius\r\n            const yMin = point.position.y - radius\r\n            const xMax = point.position.x + radius\r\n            const yMax = point.position.y + radius\r\n\r\n            const xBlockMin = (xMin / PX_PER_BLOCK_X) | 0\r\n            const yBlockMin = (yMin / PX_PER_BLOCK_Y) | 0\r\n\r\n            const xBlockMax = (xMax / PX_PER_BLOCK_X) | 0\r\n            const yBlockMax = (yMax / PX_PER_BLOCK_Y) | 0\r\n\r\n            for (let y = yBlockMin; y <= yBlockMax; y++) {\r\n                for (let x = xBlockMin; x <= xBlockMax; x++) {\r\n                    const block = new Block(x, y)\r\n                    // check if it already exists\r\n                    let exists = false\r\n                    for (let i = 0; i < frameBlocks.length; i++) {\r\n                        if (frameBlocks[i].eq(block)) {\r\n                            exists = true\r\n                            break\r\n                        }\r\n                    }\r\n                    if (!exists) {\r\n                        frameBlocks.push(block)\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        const strokeBlocks = this._strokeBlocks\r\n\r\n        // union, no duplicates\r\n        for (let i = 0; i < frameBlocks.length; i++) {\r\n            const block = frameBlocks[i]\r\n            let exists = false\r\n            for (let j = 0; j < strokeBlocks.length; j++) {\r\n                if (block.eq(strokeBlocks[j])) {\r\n                    exists = true\r\n                    break\r\n                }\r\n            }\r\n            if (!exists) {\r\n                strokeBlocks.push(block)\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Call this after the stroke has ended, but before rendering the frame.\r\n     */\r\n    strokeEnded(): void {\r\n        this._frameBlocks.splice(0, this._frameBlocks.length, ...this._strokeBlocks)\r\n        this._strokeBlocks.length = 0\r\n    }\r\n\r\n    /**\r\n     * Call this after the frame has been rendered.\r\n     */\r\n    afterFrame(): void {\r\n        this._frameBlocks.length = 0\r\n    }\r\n}\r\n","import { Brand, Vec2, PushOnlyArray } from \"../util\"\r\n\r\nexport type TextureId = Brand<\"Texture Id\", number>\r\n\r\nlet nextTextureId = 1\r\n\r\nexport class Texture {\r\n    private nominal: void\r\n\r\n    readonly id: TextureId\r\n    readonly texture: WebGLTexture\r\n    readonly framebuffer: WebGLFramebuffer\r\n\r\n    constructor(texture: WebGLTexture, framebuffer: WebGLFramebuffer) {\r\n        this.id = (nextTextureId++ as any) as TextureId\r\n        this.texture = texture\r\n        this.framebuffer = framebuffer\r\n    }\r\n}\r\n\r\nexport function createTextureWithFramebuffer(\r\n    gl: WebGLRenderingContext,\r\n    allTextures: PushOnlyArray<Texture>,\r\n    textureBindings: (readonly [TextureId | null, number])[],\r\n    size: Vec2\r\n): Texture {\r\n    const texture = new Texture(\r\n        gl.createTexture() as WebGLTexture,\r\n        gl.createFramebuffer() as WebGLFramebuffer\r\n    )\r\n\r\n    allTextures.push(texture)\r\n    ensureTextureIsBound(gl, textureBindings, texture)\r\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, size.x, size.y, 0, gl.RGBA, gl.FLOAT, null)\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR)\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR)\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE)\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE)\r\n\r\n    gl.bindFramebuffer(gl.FRAMEBUFFER, texture.framebuffer)\r\n    gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, texture.texture, 0)\r\n\r\n    const frameBufferStatus = gl.checkFramebufferStatus(gl.FRAMEBUFFER)\r\n    switch (frameBufferStatus) {\r\n        case gl.FRAMEBUFFER_COMPLETE:\r\n            break\r\n        case gl.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:\r\n            console.warn(\"FRAMEBUFFER_INCOMPLETE_ATTACHMENT for texture:\", texture)\r\n            break\r\n        case gl.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:\r\n            console.warn(\"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT for texture:\", texture)\r\n            break\r\n        case gl.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:\r\n            console.warn(\"FRAMEBUFFER_INCOMPLETE_DIMENSIONS for texture:\", texture)\r\n            break\r\n        case gl.FRAMEBUFFER_UNSUPPORTED:\r\n            console.warn(\"FRAMEBUFFER_UNSUPPORTED for texture:\", texture)\r\n            break\r\n        default:\r\n            throw \"Unexpected status: \" + frameBufferStatus\r\n    }\r\n    return texture\r\n}\r\n\r\nexport function ensureTextureIsBound(\r\n    gl: WebGLRenderingContext,\r\n    textureBindings: (readonly [TextureId | null, number])[],\r\n    { texture, id }: Texture\r\n): number {\r\n    for (let i = 0; i < textureBindings.length; i++) {\r\n        if (textureBindings[i][0] === id) {\r\n            gl.activeTexture(gl.TEXTURE0 + i)\r\n            return i\r\n        }\r\n    }\r\n\r\n    // Texture isn't bound yet. We need to find an open binding\r\n\r\n    for (let i = 0; i < textureBindings.length; i++) {\r\n        if (textureBindings[i][0] === null) {\r\n            gl.activeTexture(gl.TEXTURE0 + i)\r\n            gl.bindTexture(gl.TEXTURE_2D, texture)\r\n            textureBindings[i] = [id, performance.now()]\r\n            return i\r\n        }\r\n    }\r\n\r\n    // There is no open binding. We need to replace something that's already bound.\r\n    {\r\n        let minTime = Number.MAX_VALUE\r\n        let minTimeIdx = 0\r\n        for (let i = 0; i < textureBindings.length; i++) {\r\n            const time = textureBindings[i][1]\r\n            if (time < minTime) {\r\n                minTime = time\r\n                minTimeIdx = i\r\n            }\r\n        }\r\n        gl.activeTexture(gl.TEXTURE0 + minTimeIdx)\r\n        gl.bindTexture(gl.TEXTURE_2D, texture)\r\n        textureBindings[minTimeIdx] = [id, performance.now()]\r\n        return minTimeIdx\r\n    }\r\n}\r\n","import * as Layers from \"./layers\"\r\nimport { Vec2, PushOnlyArray } from \"../util\"\r\nimport { TextureId, Texture, createTextureWithFramebuffer } from \"./texture\"\r\nimport { Shader as TextureShader } from \"./textureShader\"\r\n\r\n/*\r\n * Bind any new layers to their own textures\r\n * Determine which layers are above and what layers are below\r\n * Render brush inputs to StrokeTexture\r\n * Calculate size of StrokeTexture based on brush inputs\r\n * Render above layers to the AboveTexture (when layers change)\r\n * Render below layers to the BelowTexture (when layers change)\r\n * Render brush texture to BrushOutlineTexture (when brush change)\r\n * Render (BelowTexture, LayerTexture, StrokeTexture, AboveTexture, BrushOutlineTexture) to OutputTexture\r\n * Render OutputTexture to canvas (with transforms and in sRGB)\r\n */\r\n\r\nexport interface LayersToCombine {\r\n    readonly above: null | Layers.CollectedLayer[]\r\n    readonly below: null | Layers.CollectedLayer[]\r\n    readonly current: null | Layers.CollectedLayer\r\n}\r\n\r\nexport function getLayersToCombine(\r\n    prevLayers: Layers.SplitLayers,\r\n    nextLayers: Layers.SplitLayers\r\n): LayersToCombine {\r\n    const nextAbove = nextLayers.above\r\n    const nextBelow = nextLayers.below\r\n\r\n    let above: null | Layers.CollectedLayer[] = null\r\n    let below: null | Layers.CollectedLayer[] = null\r\n\r\n    if (layersAreDifferent(prevLayers.above, nextAbove)) {\r\n        above = []\r\n        for (let i = 0; i < nextAbove.length; i++) {\r\n            const layer = nextAbove[i]\r\n            if (layer.opacity !== 0) {\r\n                above.push(layer)\r\n            }\r\n        }\r\n    }\r\n\r\n    if (layersAreDifferent(prevLayers.below, nextBelow)) {\r\n        below = []\r\n        for (let i = nextBelow.length - 1; i >= 0; i--) {\r\n            const layer = nextBelow[i]\r\n            if (layer.opacity !== 0) {\r\n                below.push(layer)\r\n            }\r\n        }\r\n    }\r\n\r\n    return { above, below, current: nextLayers.current }\r\n}\r\n\r\nfunction layersAreDifferent(\r\n    prev: readonly Layers.CollectedLayer[],\r\n    next: readonly Layers.CollectedLayer[]\r\n): boolean {\r\n    if (prev.length !== next.length) {\r\n        return true\r\n    }\r\n    for (let i = 0; i < next.length; i++) {\r\n        if (prev[i].id !== next[i].id) {\r\n            return true\r\n        }\r\n    }\r\n    return false\r\n}\r\n\r\nexport interface CombineLayersArgs {\r\n    readonly gl: WebGLRenderingContext\r\n    readonly resolution: Vec2\r\n    readonly allTextures: PushOnlyArray<Texture>\r\n    readonly layersToRender: LayersToCombine\r\n    readonly textureShader: TextureShader\r\n    readonly textureBindings: (readonly [TextureId | null, number])[]\r\n    readonly layerTextureMap: Map<Layers.Id, Texture>\r\n    readonly textureAbove: Texture\r\n    readonly textureBelow: Texture\r\n    readonly textureCurrent: Texture\r\n}\r\n\r\nexport function combineLayers(args: CombineLayersArgs): void {\r\n    const {\r\n        gl,\r\n        allTextures,\r\n        resolution,\r\n        layersToRender,\r\n        textureShader,\r\n        textureBindings,\r\n        layerTextureMap,\r\n    } = args\r\n\r\n    const layersAbove = layersToRender.above\r\n    const layersBelow = layersToRender.below\r\n    const layersCurrent = layersToRender.current\r\n\r\n    gl.clearColor(0, 0, 0, 0)\r\n\r\n    if (layersAbove !== null) {\r\n        gl.bindFramebuffer(gl.FRAMEBUFFER, args.textureAbove.framebuffer)\r\n        gl.clear(gl.COLOR_BUFFER_BIT)\r\n        for (let i = 0; i < layersAbove.length; i++) {\r\n            const layer = layersAbove[i]\r\n            let texture = layerTextureMap.get(layer.id)\r\n            if (texture == null) {\r\n                texture = createTextureWithFramebuffer(gl, allTextures, textureBindings, resolution)\r\n                layerTextureMap.set(layer.id, texture)\r\n            }\r\n            textureShader.render(gl, {\r\n                blocks: [\r\n                    {\r\n                        x0: 0,\r\n                        y0: 0,\r\n                        x1: resolution.x,\r\n                        y1: resolution.y,\r\n                    },\r\n                ],\r\n                framebuffer: args.textureAbove.framebuffer,\r\n                uniforms: {\r\n                    u_opacity: layer.opacity,\r\n                    u_resolution: resolution,\r\n                    u_texture: ensureTextureIsBound(gl, textureBindings, texture),\r\n                },\r\n            })\r\n        }\r\n    }\r\n\r\n    if (layersBelow !== null) {\r\n        gl.bindFramebuffer(gl.FRAMEBUFFER, args.textureBelow.framebuffer)\r\n        gl.clear(gl.COLOR_BUFFER_BIT)\r\n        for (let i = 0; i < layersBelow.length; i++) {\r\n            const layer = layersBelow[i]\r\n            let texture = layerTextureMap.get(layer.id)\r\n            if (texture == null) {\r\n                texture = createTextureWithFramebuffer(gl, allTextures, textureBindings, resolution)\r\n                layerTextureMap.set(layer.id, texture)\r\n            }\r\n            textureShader.render(gl, {\r\n                blocks: [\r\n                    {\r\n                        x0: 0,\r\n                        y0: 0,\r\n                        x1: resolution.x,\r\n                        y1: resolution.y,\r\n                    },\r\n                ],\r\n                framebuffer: args.textureBelow.framebuffer,\r\n                uniforms: {\r\n                    u_opacity: layer.opacity,\r\n                    u_resolution: resolution,\r\n                    u_texture: ensureTextureIsBound(gl, textureBindings, texture),\r\n                },\r\n            })\r\n        }\r\n    }\r\n\r\n    if (layersCurrent !== null) {\r\n        let texture = layerTextureMap.get(layersCurrent.id)\r\n        if (texture == null) {\r\n            texture = createTextureWithFramebuffer(gl, allTextures, textureBindings, resolution)\r\n            layerTextureMap.set(layersCurrent.id, texture)\r\n        }\r\n        gl.bindFramebuffer(gl.FRAMEBUFFER, args.textureCurrent.framebuffer)\r\n        gl.clear(gl.COLOR_BUFFER_BIT)\r\n        textureShader.render(gl, {\r\n            blocks: [\r\n                {\r\n                    x0: 0,\r\n                    y0: 0,\r\n                    x1: resolution.x,\r\n                    y1: resolution.y,\r\n                },\r\n            ],\r\n            framebuffer: args.textureCurrent.framebuffer,\r\n            uniforms: {\r\n                u_opacity: layersCurrent.opacity,\r\n                u_resolution: resolution,\r\n                u_texture: ensureTextureIsBound(gl, textureBindings, texture),\r\n            },\r\n        })\r\n    }\r\n}\r\n\r\nfunction ensureTextureIsBound(\r\n    gl: WebGLRenderingContext,\r\n    textureBindings: (readonly [TextureId | null, number])[],\r\n    { texture, id }: Texture\r\n): number {\r\n    for (let i = 0; i < textureBindings.length; i++) {\r\n        if (textureBindings[i][0] === id) {\r\n            gl.activeTexture(gl.TEXTURE0 + i)\r\n            return i\r\n        }\r\n    }\r\n\r\n    // Texture isn't bound yet. We need to find an open binding\r\n\r\n    for (let i = 0; i < textureBindings.length; i++) {\r\n        if (textureBindings[i][0] === null) {\r\n            gl.activeTexture(gl.TEXTURE0 + i)\r\n            gl.bindTexture(gl.TEXTURE_2D, texture)\r\n            textureBindings[i] = [id, performance.now()]\r\n            return i\r\n        }\r\n    }\r\n\r\n    // There is no open binding. We need to replace something that's already bound.\r\n    {\r\n        let minTime = Number.MAX_VALUE\r\n        let minTimeIdx = 0\r\n        for (let i = 0; i < textureBindings.length; i++) {\r\n            const time = textureBindings[i][1]\r\n            if (time < minTime) {\r\n                minTime = time\r\n                minTimeIdx = i\r\n            }\r\n        }\r\n        gl.activeTexture(gl.TEXTURE0 + minTimeIdx)\r\n        gl.bindTexture(gl.TEXTURE_2D, texture)\r\n        textureBindings[minTimeIdx] = [id, performance.now()]\r\n        return minTimeIdx\r\n    }\r\n}\r\n","import * as OutputShader from \"./outputShader\"\r\nimport * as BrushTextureShader from \"./brushTextureGenerator\"\r\nimport * as TextureShader from \"./textureShader\"\r\nimport * as ClearBlocksShader from \"./clearBlocksShader\"\r\nimport * as BrushShader from \"./brushShader\"\r\nimport * as Layers from \"./layers\"\r\nimport * as BlockRender from \"./blockRender\"\r\nimport { Blend } from \"../webgl\"\r\nimport { Result, Ok, Err, Vec2, Vec4 } from \"../util\"\r\nimport { RgbLinear } from \"color\"\r\nimport { Texture, TextureId, createTextureWithFramebuffer, ensureTextureIsBound } from \"./texture\"\r\nimport * as Render from \"./render\"\r\n\r\nexport interface CreationArgs {\r\n    readonly gl: WebGLRenderingContext\r\n    readonly brushTextureGenerator: BrushTextureShader.Generator\r\n    readonly textureRenderer: TextureShader.Shader\r\n    readonly clearBlocksRenderer: ClearBlocksShader.Shader\r\n    readonly outputRenderer: OutputShader.Shader\r\n    readonly drawpointBatch: BrushShader.Shader\r\n    readonly resolution: Vec2\r\n}\r\n\r\nexport interface RenderArgs {\r\n    readonly resolution: Vec2\r\n    readonly blendMode: Blend.Mode\r\n    readonly brush: {\r\n        readonly softness: number\r\n    }\r\n    readonly nextLayers: Layers.SplitLayers\r\n}\r\n\r\nexport interface Context {\r\n    addBrushPoints(brushPoints: readonly BrushShader.BrushPoint[]): void\r\n    endStroke(): void\r\n    render(args: RenderArgs): void\r\n    dispose(): void\r\n}\r\n\r\ndeclare global {\r\n    interface WebGLContextAttributes {\r\n        readonly desynchronized: boolean\r\n    }\r\n}\r\n\r\nexport function create(\r\n    canvas: HTMLCanvasElement\r\n): Result<readonly [Context, WebGLRenderingContext], string> {\r\n    const wglArgs: WebGLContextAttributes = {\r\n        antialias: false,\r\n        depth: false,\r\n        alpha: false,\r\n        premultipliedAlpha: false,\r\n        stencil: false,\r\n        preserveDrawingBuffer: true,\r\n        desynchronized: true,\r\n    }\r\n    const gl = canvas.getContext(\"webgl\", wglArgs)\r\n    if (gl === null) {\r\n        console.error(\"Failed to initialize WebGL renderer for canvas: \", canvas)\r\n        return new Err(\"Failed to initialize WebGL\")\r\n    }\r\n    const attrs = gl.getContextAttributes()\r\n    if (!(attrs && attrs.desynchronized)) {\r\n        console.warn(\"Low latency canvas not supported. Boo!\")\r\n    }\r\n\r\n    const floatLinearFiltering = gl.getExtension(\"OES_texture_float_linear\")\r\n    if (floatLinearFiltering === null) {\r\n        console.warn(`Couldn't enable \"OES_texture_float_linear\"`)\r\n    }\r\n\r\n    const floatTexture = gl.getExtension(\"OES_texture_float\")\r\n    if (floatTexture === null) {\r\n        console.warn(`Couldn't enable \"OES_texture_float\"`)\r\n    }\r\n\r\n    // TODO: check for half-float\r\n    // TODO: check for max textures\r\n\r\n    gl.viewport(0, 0, canvas.width, canvas.height)\r\n    gl.enable(WebGLRenderingContext.BLEND)\r\n    gl.disable(WebGLRenderingContext.DEPTH_TEST)\r\n\r\n    const { sfact, dfact } = Blend.factorsNormal\r\n    gl.blendFunc(sfact, dfact)\r\n\r\n    const drawpointBatch = BrushShader.Shader.create(gl)\r\n    if (drawpointBatch === null) {\r\n        const msg = \"Failed to initialize BrushShader\"\r\n        console.error(msg)\r\n        return new Err(msg)\r\n    }\r\n\r\n    const brushTextureGenerator = BrushTextureShader.Generator.create(gl)\r\n    if (brushTextureGenerator === null) {\r\n        const msg = \"Failed to initialize BrushTextureGenerator\"\r\n        console.error(msg)\r\n        return new Err(msg)\r\n    }\r\n\r\n    const textureRenderer = TextureShader.Shader.create(gl)\r\n    if (textureRenderer === null) {\r\n        const msg = \"Failed to initialize TextureShader\"\r\n        console.error(msg)\r\n        return new Err(msg)\r\n    }\r\n\r\n    const clearBlocksRenderer = ClearBlocksShader.Shader.create(gl)\r\n    if (clearBlocksRenderer === null) {\r\n        const msg = \"Failed to initialize ClearBlocksShader\"\r\n        console.error(msg)\r\n        return new Err(msg)\r\n    }\r\n\r\n    const outputRenderer = OutputShader.Shader.create(gl)\r\n    if (outputRenderer === null) {\r\n        const msg = \"Failed to initialize OutputShader\"\r\n        console.error(msg)\r\n        return new Err(msg)\r\n    }\r\n\r\n    gl.viewport(0, 0, canvas.width, canvas.height)\r\n\r\n    const context = new InternalContext({\r\n        gl,\r\n        brushTextureGenerator,\r\n        drawpointBatch,\r\n        outputRenderer,\r\n        textureRenderer,\r\n        clearBlocksRenderer,\r\n        resolution: new Vec2(canvas.width, canvas.height),\r\n    })\r\n    return new Ok([context, gl] as const)\r\n}\r\n\r\nclass InternalContext implements Context {\r\n    readonly gl: WebGLRenderingContext\r\n    readonly brushTextureGenerator: BrushTextureShader.Generator\r\n    readonly textureRenderer: TextureShader.Shader\r\n    readonly clearBlocksRenderer: ClearBlocksShader.Shader\r\n    readonly outputRenderer: OutputShader.Shader\r\n    readonly drawpointBatch: BrushShader.Shader\r\n    readonly allTextures: Texture[]\r\n    readonly textureBindings: (readonly [TextureId | null, number])[]\r\n    readonly layerTextureMap: Map<Layers.Id, Texture>\r\n    internalCanvasSize: Vec2\r\n    stroke: Texture | null\r\n    renderBlocks: BlockRender.BlockTracker\r\n    prevLayers: Layers.SplitLayers\r\n    readonly brushTexture: Texture\r\n    readonly outputTexture: Texture\r\n    readonly combinedLayers: {\r\n        readonly above: Texture\r\n        readonly below: Texture\r\n        readonly current: Texture\r\n    }\r\n\r\n    constructor(args: CreationArgs) {\r\n        this.gl = args.gl\r\n        this.brushTextureGenerator = args.brushTextureGenerator\r\n        this.textureRenderer = args.textureRenderer\r\n        this.clearBlocksRenderer = args.clearBlocksRenderer\r\n        this.outputRenderer = args.outputRenderer\r\n        this.drawpointBatch = args.drawpointBatch\r\n        this.allTextures = []\r\n        this.textureBindings = new Array(32).fill([null, 0])\r\n        this.layerTextureMap = new Map()\r\n        this.internalCanvasSize = args.resolution\r\n        this.stroke = null\r\n        this.renderBlocks = new BlockRender.BlockTracker()\r\n        this.prevLayers = {\r\n            above: [],\r\n            below: [],\r\n            current: null,\r\n        }\r\n        {\r\n            const size = new Vec2(128, 128)\r\n            this.brushTexture = createTextureWithFramebuffer(\r\n                this.gl,\r\n                this.allTextures,\r\n                this.textureBindings,\r\n                size\r\n            )\r\n            this.brushTextureGenerator.generateBrushTexture(this.gl, {\r\n                framebuffer: this.brushTexture.framebuffer,\r\n                size: size,\r\n                uniforms: {\r\n                    u_softness: 0,\r\n                },\r\n            })\r\n        }\r\n        this.outputTexture = createTextureWithFramebuffer(\r\n            this.gl,\r\n            this.allTextures,\r\n            this.textureBindings,\r\n            args.resolution\r\n        )\r\n        const outFramebuffer = this.outputTexture.framebuffer\r\n        this.combinedLayers = {\r\n            above: createTextureWithFramebuffer(\r\n                this.gl,\r\n                this.allTextures,\r\n                this.textureBindings,\r\n                args.resolution\r\n            ),\r\n            below: createTextureWithFramebuffer(\r\n                this.gl,\r\n                this.allTextures,\r\n                this.textureBindings,\r\n                args.resolution\r\n            ),\r\n            current: createTextureWithFramebuffer(\r\n                this.gl,\r\n                this.allTextures,\r\n                this.textureBindings,\r\n                args.resolution\r\n            ),\r\n        }\r\n\r\n        // initialize background\r\n        this.gl.bindFramebuffer(WebGLRenderingContext.FRAMEBUFFER, outFramebuffer)\r\n        this.gl.viewport(0, 0, args.resolution.x, args.resolution.y)\r\n        this.gl.clearColor(0.6, 0.6, 0.6, 1)\r\n        this.gl.clear(WebGLRenderingContext.COLOR_BUFFER_BIT)\r\n        this.outputRenderer.render(this.gl, {\r\n            uniforms: {\r\n                u_resolution: args.resolution,\r\n                u_texture: ensureTextureIsBound(this.gl, this.textureBindings, this.outputTexture),\r\n            },\r\n            blocks: [\r\n                {\r\n                    x0: 0,\r\n                    y0: 0,\r\n                    x1: args.resolution.x,\r\n                    y1: args.resolution.y,\r\n                },\r\n            ],\r\n        })\r\n    }\r\n\r\n    addBrushPoints(brushPoints: readonly BrushShader.BrushPoint[]) {\r\n        this.drawpointBatch.addPoints(brushPoints)\r\n        this.renderBlocks.addPoints(brushPoints)\r\n    }\r\n\r\n    endStroke() {\r\n        endStroke(this)\r\n    }\r\n\r\n    render(args: RenderArgs) {\r\n        render(this, args)\r\n    }\r\n\r\n    dispose() {\r\n        const { gl } = this\r\n        this.brushTextureGenerator.dispose(gl)\r\n        this.textureRenderer.dispose(gl)\r\n        this.outputRenderer.dispose(gl)\r\n        this.drawpointBatch.dispose(gl)\r\n        for (const x of this.allTextures) {\r\n            gl.deleteTexture(x.texture)\r\n            if (x instanceof Texture) {\r\n                gl.deleteFramebuffer(x.framebuffer)\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nfunction endStroke(context: InternalContext): void {\r\n    const { gl, stroke, prevLayers, internalCanvasSize } = context\r\n    if (stroke === null) return\r\n    if (prevLayers.current === null) return\r\n\r\n    gl.viewport(0, 0, context.internalCanvasSize.x, context.internalCanvasSize.y)\r\n    context.textureRenderer.render(gl, {\r\n        framebuffer: context.combinedLayers.current.framebuffer,\r\n        uniforms: {\r\n            u_opacity: 1,\r\n            u_resolution: internalCanvasSize,\r\n            u_texture: ensureTextureIsBound(context.gl, context.textureBindings, stroke),\r\n        },\r\n        blocks: context.renderBlocks.getStrokeBlocks(),\r\n    })\r\n\r\n    gl.bindFramebuffer(gl.FRAMEBUFFER, stroke.framebuffer)\r\n    gl.clearColor(0, 0, 0, 0)\r\n    gl.clear(gl.COLOR_BUFFER_BIT)\r\n    context.renderBlocks.strokeEnded()\r\n}\r\n\r\nfunction render(\r\n    context: InternalContext,\r\n    { blendMode, nextLayers, resolution, brush }: RenderArgs\r\n): void {\r\n    const frameBlocks = context.renderBlocks.getFrameBlocks()\r\n    if (frameBlocks.length === 0) {\r\n        return\r\n    }\r\n\r\n    const { gl } = context\r\n\r\n    if (context.drawpointBatch.canFlush) {\r\n        if (nextLayers.current === null) {\r\n            console.warn(\"Drawpoint batch has data to flush, but no layer is currently selected\")\r\n        } else {\r\n            let currentLayerTex = context.layerTextureMap.get(nextLayers.current.id)\r\n\r\n            if (currentLayerTex == null) {\r\n                currentLayerTex = createTextureWithFramebuffer(\r\n                    context.gl,\r\n                    context.allTextures,\r\n                    context.textureBindings,\r\n                    context.internalCanvasSize\r\n                )\r\n                context.layerTextureMap.set(nextLayers.current.id, currentLayerTex)\r\n            }\r\n\r\n            const { brushTexture } = context\r\n\r\n            context.brushTextureGenerator.generateBrushTexture(gl, {\r\n                framebuffer: brushTexture.framebuffer,\r\n                size: new Vec2(128, 128),\r\n                uniforms: {\r\n                    u_softness: Math.max(brush.softness, 0.000001),\r\n                },\r\n            })\r\n            gl.viewport(0, 0, resolution.x, resolution.y)\r\n            gl.bindFramebuffer(gl.FRAMEBUFFER, currentLayerTex.framebuffer)\r\n            context.drawpointBatch.flush(gl, {\r\n                blendMode,\r\n                uniforms: {\r\n                    u_resolution: resolution,\r\n                    u_texture: ensureTextureIsBound(\r\n                        context.gl,\r\n                        context.textureBindings,\r\n                        brushTexture\r\n                    ),\r\n                },\r\n            })\r\n        }\r\n    }\r\n\r\n    const layersToCombine = Render.getLayersToCombine(context.prevLayers, nextLayers)\r\n    Render.combineLayers({\r\n        gl,\r\n        resolution,\r\n        allTextures: context.allTextures,\r\n        layerTextureMap: context.layerTextureMap,\r\n        textureBindings: context.textureBindings,\r\n        textureShader: context.textureRenderer,\r\n        layersToRender: layersToCombine,\r\n        textureAbove: context.combinedLayers.above,\r\n        textureBelow: context.combinedLayers.below,\r\n        textureCurrent: context.combinedLayers.current,\r\n    })\r\n\r\n    // render to outputTexture\r\n    const outFramebuffer = context.outputTexture.framebuffer\r\n\r\n    if (outFramebuffer == null) {\r\n        throw \"Out framebuffer should exist\"\r\n    }\r\n\r\n    gl.bindFramebuffer(gl.FRAMEBUFFER, outFramebuffer)\r\n\r\n    {\r\n        // need to clear the render blocks...\r\n        const bgColor = new RgbLinear(process.env.NODE_ENV === \"development\" ? 0.9 : 0.6, 0.6, 0.6)\r\n        context.clearBlocksRenderer.render(gl, {\r\n            framebuffer: outFramebuffer,\r\n            uniforms: {\r\n                u_resolution: resolution,\r\n                u_rgba: Vec4.fromRgba(bgColor, 1),\r\n            },\r\n            blocks: frameBlocks,\r\n        })\r\n    }\r\n\r\n    // BELOW\r\n    context.textureRenderer.render(gl, {\r\n        framebuffer: outFramebuffer,\r\n        uniforms: {\r\n            u_opacity: 1,\r\n            u_resolution: resolution,\r\n            u_texture: ensureTextureIsBound(\r\n                context.gl,\r\n                context.textureBindings,\r\n                context.combinedLayers.below\r\n            ),\r\n        },\r\n        blocks: frameBlocks,\r\n    })\r\n    if (nextLayers.current !== null) {\r\n        // CURRENT\r\n        context.textureRenderer.render(gl, {\r\n            framebuffer: outFramebuffer,\r\n            uniforms: {\r\n                u_opacity: nextLayers.current.opacity,\r\n                u_resolution: resolution,\r\n                u_texture: ensureTextureIsBound(\r\n                    context.gl,\r\n                    context.textureBindings,\r\n                    context.combinedLayers.current\r\n                ),\r\n            },\r\n            blocks: frameBlocks,\r\n        })\r\n    }\r\n    // ABOVE\r\n    context.textureRenderer.render(gl, {\r\n        framebuffer: outFramebuffer,\r\n        uniforms: {\r\n            u_opacity: 1,\r\n            u_resolution: resolution,\r\n            u_texture: ensureTextureIsBound(\r\n                context.gl,\r\n                context.textureBindings,\r\n                context.combinedLayers.above\r\n            ),\r\n        },\r\n        blocks: frameBlocks,\r\n    })\r\n\r\n    // outputTexture -> canvas\r\n    // I'm not sure if can use block rendering when rendering to canvas - unless there's something I'm missing, it seems that the canvas auto-clears itself before render\r\n    context.outputRenderer.render(gl, {\r\n        uniforms: {\r\n            u_resolution: resolution,\r\n            u_texture: ensureTextureIsBound(\r\n                context.gl,\r\n                context.textureBindings,\r\n                context.outputTexture\r\n            ),\r\n        },\r\n        blocks: frameBlocks,\r\n    })\r\n\r\n    gl.flush()\r\n    //gl.finish()\r\n    context.prevLayers = nextLayers\r\n    context.renderBlocks.afterFrame()\r\n}\r\n","import * as Layers from \"./layers\"\r\nimport * as Tools from \"../tools\"\r\nimport * as Input from \"./input\"\r\nimport * as Camera from \"../tools/camera\"\r\nimport * as Rng from \"../rng\"\r\nimport * as Theme from \"../ui/theme\"\r\nimport * as Context from \"./context\"\r\nimport { BrushPoint } from \"./brushShader\"\r\nimport { Vec2, Result, PerfTracker, turn } from \"../util\"\r\n\r\nexport interface Hooks {\r\n    // readonly onCanvasSnapshot: (snapshot: Snapshot) => void\r\n    // readonly onLayerSnapshot: (snapshot: Snapshot, layerId: number) => void\r\n    readonly onStats: (stats: readonly PerfTracker.Sample[]) => void\r\n    readonly onWebglContextCreated: (gl: WebGLRenderingContext) => void\r\n}\r\n\r\nexport interface State {\r\n    readonly rng: Rng.Seed\r\n    readonly theme: Theme.Theme\r\n    readonly tool: Tools.Tool\r\n    readonly layers: Layers.State\r\n    readonly hasPressedDown: boolean\r\n}\r\n\r\nexport interface EphemeralState {\r\n    readonly tool: Tools.EphemeralState\r\n}\r\n\r\nexport function initState(): State {\r\n    const [theme, rng] = Theme.random(Rng.XorshiftSeed.create(145264772))\r\n\r\n    return {\r\n        rng,\r\n        theme,\r\n        tool: Tools.init(),\r\n        layers: Layers.State.init(),\r\n        hasPressedDown: false,\r\n    }\r\n}\r\n\r\nexport function initEphemeral(): EphemeralState {\r\n    return {\r\n        tool: Tools.initEphemeral(),\r\n    }\r\n}\r\n\r\nexport type CanvasMsg =\r\n    | OnFrame\r\n    | OnClick\r\n    | OnRelease\r\n    | OnDrag\r\n    | RandomizeTheme\r\n    | ToolMsg\r\n    | LayersMsg\r\n\r\nexport const enum CanvasMsgType {\r\n    OnFrame,\r\n    OnClick,\r\n    OnRelease,\r\n    OnDrag,\r\n    RandomizeTheme,\r\n    ToolMsg,\r\n    LayersMsg,\r\n}\r\n\r\nclass OnFrame {\r\n    readonly type: CanvasMsgType.OnFrame = CanvasMsgType.OnFrame\r\n    private nominal: void\r\n    constructor(readonly ms: number) {}\r\n}\r\nclass OnClick {\r\n    readonly type: CanvasMsgType.OnClick = CanvasMsgType.OnClick\r\n    private nominal: void\r\n    constructor(readonly input: Input.PointerInput) {}\r\n}\r\nclass OnRelease {\r\n    readonly type: CanvasMsgType.OnRelease = CanvasMsgType.OnRelease\r\n    private nominal: void\r\n    constructor(readonly input: Input.PointerInput) {}\r\n}\r\nclass OnDrag {\r\n    readonly type: CanvasMsgType.OnDrag = CanvasMsgType.OnDrag\r\n    private nominal: void\r\n    constructor(readonly inputs: readonly Input.PointerInput[]) {}\r\n}\r\nclass RandomizeTheme {\r\n    readonly type: CanvasMsgType.RandomizeTheme = CanvasMsgType.RandomizeTheme\r\n    private nominal: void\r\n    constructor() {}\r\n}\r\nclass ToolMsg {\r\n    readonly type: CanvasMsgType.ToolMsg = CanvasMsgType.ToolMsg\r\n    private nominal: void\r\n    constructor(readonly msg: Tools.ToolMsg) {}\r\n}\r\nclass LayersMsg {\r\n    readonly type: CanvasMsgType.LayersMsg = CanvasMsgType.LayersMsg\r\n    private nominal: void\r\n    constructor(readonly msg: Layers.Msg) {}\r\n}\r\n\r\nexport const enum EffectType {\r\n    NoOpEffect,\r\n    FrameEffect,\r\n    BrushPointsEffect,\r\n    ReleaseEffect,\r\n}\r\nexport type Effect = NoOpEffect | FrameEffect | BrushPointsEffect | ReleaseEffect\r\n\r\nclass NoOpEffect {\r\n    static readonly value = new NoOpEffect()\r\n    readonly type: EffectType.NoOpEffect = EffectType.NoOpEffect\r\n    private nominal: void\r\n    private constructor() {}\r\n}\r\n\r\nclass FrameEffect {\r\n    readonly type: EffectType.FrameEffect = EffectType.FrameEffect\r\n    private nominal: void\r\n    constructor(readonly brushPoints: readonly BrushPoint[], readonly state: State) {}\r\n}\r\nclass BrushPointsEffect {\r\n    readonly type: EffectType.BrushPointsEffect = EffectType.BrushPointsEffect\r\n    private nominal: void\r\n    constructor(readonly brushPoints: readonly BrushPoint[]) {}\r\n}\r\nclass ReleaseEffect {\r\n    readonly type: EffectType.ReleaseEffect = EffectType.ReleaseEffect\r\n    private nominal: void\r\n    constructor(readonly brushPoints: readonly BrushPoint[]) {}\r\n}\r\n\r\nexport class MsgSender {\r\n    readonly tool: Tools.MsgSender\r\n    readonly layer: Layers.MsgSender\r\n\r\n    readonly onFrame = (timeMs: number): void => {\r\n        this.sendMessage(new OnFrame(timeMs))\r\n    }\r\n    readonly onClick = (input: Input.PointerInput): void => {\r\n        this.sendMessage(new OnClick(input))\r\n    }\r\n    readonly onRelease = (input: Input.PointerInput): void => {\r\n        this.sendMessage(new OnRelease(input))\r\n    }\r\n    readonly onDrag = (inputs: readonly Input.PointerInput[]): void => {\r\n        if (inputs.length === 0) {\r\n            const errorMsg = \"Expected inputs be be 1 or greater\"\r\n            console.error(errorMsg, inputs)\r\n            throw { [errorMsg]: inputs }\r\n        }\r\n        this.sendMessage(new OnDrag(inputs))\r\n    }\r\n    readonly randomizeTheme = (): void => {\r\n        this.sendMessage(new RandomizeTheme())\r\n    }\r\n\r\n    constructor(private sendMessage: (msg: CanvasMsg) => void) {\r\n        this.tool = new Tools.MsgSender(msg => sendMessage(new ToolMsg(msg)))\r\n        this.layer = new Layers.MsgSender(msg => sendMessage(new LayersMsg(msg)))\r\n    }\r\n}\r\n\r\nexport interface CanvasInfo {\r\n    readonly offset: Vec2\r\n    readonly resolution: Vec2\r\n    readonly halfResoution: Vec2\r\n}\r\n\r\nexport interface TransformedPointerInput {\r\n    readonly x: number\r\n    readonly y: number\r\n    readonly pressure: number\r\n    readonly originalX: number\r\n    readonly originalY: number\r\n    readonly time: number\r\n}\r\n\r\nfunction pointerToBrushInput(\r\n    canvasInfo: CanvasInfo,\r\n    camera: Camera.State,\r\n    input: Input.PointerInput\r\n): TransformedPointerInput {\r\n    const point = new Vec2(input.x, input.y)\r\n        .subtract(canvasInfo.offset)\r\n        .subtractScalars(camera.offsetX, camera.offsetY)\r\n        .subtract(canvasInfo.halfResoution)\r\n        .multiplyScalar(1 / camera.zoomPct)\r\n\r\n    const { x, y } = turn(-camera.rotateTurns, Vec2.zeroes, point).add(canvasInfo.halfResoution)\r\n\r\n    return {\r\n        x,\r\n        y,\r\n        pressure: input.pressure,\r\n        time: input.time,\r\n        originalX: input.x,\r\n        originalY: input.y,\r\n    }\r\n}\r\nfunction pointersToBrushInputs(\r\n    canvasInfo: CanvasInfo,\r\n    camera: Camera.State,\r\n    inputs: readonly Input.PointerInput[]\r\n): TransformedPointerInput[] {\r\n    const arr = new Array<TransformedPointerInput>(inputs.length)\r\n    for (let i = 0; i < inputs.length; i++) {\r\n        arr[i] = pointerToBrushInput(canvasInfo, camera, inputs[i])\r\n    }\r\n    return arr\r\n}\r\n\r\nexport function update(\r\n    canvasInfo: CanvasInfo,\r\n    state: State,\r\n    ephemeral: EphemeralState,\r\n    msg: CanvasMsg\r\n): readonly [State, EphemeralState, Effect] {\r\n    switch (msg.type) {\r\n        case CanvasMsgType.OnFrame: {\r\n            const [nextToolEphemeral, brushPoints] = Tools.onFrame(\r\n                state.tool,\r\n                ephemeral.tool,\r\n                msg.ms\r\n            )\r\n            const effect = new FrameEffect(brushPoints, state)\r\n            return [state, { tool: nextToolEphemeral }, effect]\r\n        }\r\n        case CanvasMsgType.OnClick: {\r\n            const [nextTool, nextToolEphemeral, brushPoints] = Tools.onClick(\r\n                state.tool,\r\n                ephemeral.tool,\r\n                pointerToBrushInput(canvasInfo, state.tool.camera, msg.input)\r\n            )\r\n            const nextState = { ...state, hasPressedDown: true, tool: nextTool }\r\n            const nextEphemeral = { tool: nextToolEphemeral }\r\n            const effect = new BrushPointsEffect(brushPoints)\r\n            return [nextState, nextEphemeral, effect]\r\n        }\r\n        case CanvasMsgType.OnRelease: {\r\n            const [nextTool, nextToolEphemeral, brushPoints] = Tools.onRelease(\r\n                state.tool,\r\n                ephemeral.tool,\r\n                pointerToBrushInput(canvasInfo, state.tool.camera, msg.input)\r\n            )\r\n            const nextState = { ...state, hasPressedDown: false, tool: nextTool }\r\n            const nextEphemeral = { tool: nextToolEphemeral }\r\n            const effect = new ReleaseEffect(brushPoints)\r\n            return [nextState, nextEphemeral, effect]\r\n        }\r\n        case CanvasMsgType.OnDrag: {\r\n            if (!state.hasPressedDown) {\r\n                return [state, ephemeral, NoOpEffect.value]\r\n            }\r\n            const [nextTool, nextToolEphemeral, brushPoints] = Tools.onDrag(\r\n                state.tool,\r\n                ephemeral.tool,\r\n                pointersToBrushInputs(canvasInfo, state.tool.camera, msg.inputs)\r\n            )\r\n            const nextState = { ...state, tool: nextTool }\r\n            const nextEphemeral = { tool: nextToolEphemeral }\r\n            const effect = new BrushPointsEffect(brushPoints)\r\n            return [nextState, nextEphemeral, effect]\r\n        }\r\n        case CanvasMsgType.RandomizeTheme: {\r\n            const [theme, rng] = Theme.random(state.rng)\r\n            const nextState = { ...state, rng, theme }\r\n            return [nextState, ephemeral, NoOpEffect.value]\r\n        }\r\n        case CanvasMsgType.ToolMsg: {\r\n            const nextState = { ...state, tool: Tools.update(state.tool, msg.msg) }\r\n            return [nextState, ephemeral, NoOpEffect.value]\r\n        }\r\n        case CanvasMsgType.LayersMsg: {\r\n            const nextState = { ...state, layers: state.layers.update(msg.msg) }\r\n            return [nextState, ephemeral, NoOpEffect.value]\r\n        }\r\n        default:\r\n            const never: never = msg\r\n            throw { \"unexpected msg\": msg }\r\n    }\r\n}\r\n\r\nexport class Canvas {\r\n    static create(canvas: HTMLCanvasElement, initialState: State, hooks: Hooks): Canvas | null {\r\n        const context = Context.create(canvas)\r\n        if (context.isOk()) {\r\n            if (process.env.NODE_ENV === \"development\") {\r\n                hooks.onWebglContextCreated(context.value[1])\r\n            }\r\n            return new Canvas(canvas, initialState, hooks, context.value[0])\r\n        }\r\n        console.error(\"Error in Context setup:\", context.value)\r\n        return null\r\n    }\r\n\r\n    private readonly perfTracker: PerfTracker\r\n    private splitLayers: Layers.SplitLayers\r\n\r\n    private constructor(\r\n        readonly canvasElement: HTMLCanvasElement,\r\n        initialState: State,\r\n        private readonly hooks: Hooks,\r\n        private readonly context: Context.Context\r\n    ) {\r\n        this.perfTracker = new PerfTracker({\r\n            maxSamples: 50,\r\n            onSamples: this.hooks.onStats,\r\n        })\r\n        this.splitLayers = initialState.layers.split()\r\n    }\r\n\r\n    update(newState: State): void {\r\n        this.splitLayers = newState.layers.split()\r\n    }\r\n\r\n    handle(eff: Effect): void {\r\n        switch (eff.type) {\r\n            case EffectType.NoOpEffect:\r\n                return\r\n            case EffectType.FrameEffect: {\r\n                this.perfTracker.start()\r\n                this.context.addBrushPoints(eff.brushPoints)\r\n                const resolution = new Vec2(this.canvasElement.width, this.canvasElement.height)\r\n                const state = eff.state\r\n\r\n                this.context.render({\r\n                    blendMode: Tools.getBlendMode(state.tool),\r\n                    nextLayers: this.splitLayers,\r\n                    resolution,\r\n                    brush: { softness: Tools.getSoftness(state.tool) },\r\n                })\r\n                this.perfTracker.end()\r\n                return\r\n            }\r\n            case EffectType.BrushPointsEffect: {\r\n                this.context.addBrushPoints(eff.brushPoints)\r\n                return\r\n            }\r\n            case EffectType.ReleaseEffect: {\r\n                this.context.addBrushPoints(eff.brushPoints)\r\n                this.context.endStroke()\r\n                return\r\n            }\r\n            default:\r\n                const never: never = eff\r\n                throw { \"unexpected effect\": eff }\r\n        }\r\n    }\r\n\r\n    dispose(): void {\r\n        this.context.dispose()\r\n    }\r\n}\r\n","import { Op, _, statelessComponent, shallowEqual } from \"ivi\"\r\nimport { div } from \"ivi-html\"\r\nimport * as styles from \"./miniMap.scss\"\r\nimport { Labeled, InlineLabeled, Slider } from \"./views\"\r\nimport * as Camera from \"../tools/camera\"\r\nimport { clamp } from \"../util\"\r\n\r\nexport interface MiniMapDetailsProps {\r\n    readonly camera: Camera.State\r\n    readonly sender: Camera.MsgSender\r\n}\r\n\r\nexport const MiniMapDetails = statelessComponent<MiniMapDetailsProps>(({ camera, sender }) => {\r\n    return div(styles.container, _, [\r\n        Labeled({\r\n            label: \"Zoom\",\r\n            value: (camera.zoomPct * 100).toFixed(1) + \"%\",\r\n            children: Slider({\r\n                percentage: camera.zoomPct / 4,\r\n                onChange: pct => {\r\n                    sender.setZoom(pct * 4)\r\n                },\r\n            }),\r\n        }),\r\n        Labeled({\r\n            label: \"Rotate\",\r\n            value: (camera.rotateTurns * 360).toFixed(1) + \" deg\",\r\n            children: Slider({\r\n                percentage: camera.rotateTurns,\r\n                onChange: pct => {\r\n                    console.log(camera.rotateTurns, pct)\r\n                    sender.setRotation(pct)\r\n                },\r\n            }),\r\n        }),\r\n        Labeled({\r\n            label: \"Offset X\",\r\n            value: camera.offsetX.toFixed(0) + \" px\",\r\n            children: Slider({\r\n                percentage: clamp(-5000, 5000, (camera.offsetX + 2500) / 5000),\r\n                onChange: pct => {\r\n                    sender.setOffset(pct * 5000 - 2500, camera.offsetY)\r\n                },\r\n            }),\r\n        }),\r\n        Labeled({\r\n            label: \"Offset Y\",\r\n            value: camera.offsetY.toFixed(0) + \" px\",\r\n            children: Slider({\r\n                percentage: clamp(-5000, 5000, (camera.offsetY + 2500) / 5000),\r\n                onChange: pct => {\r\n                    sender.setOffset(camera.offsetX, pct * 5000 - 2500)\r\n                },\r\n            }),\r\n        }),\r\n    ])\r\n}, shallowEqual)\r\n","import {\r\n    Op,\r\n    component,\r\n    _,\r\n    invalidate,\r\n    render,\r\n    box,\r\n    findDOMNode,\r\n    OpState,\r\n    useEffect,\r\n    Ref,\r\n    useLayoutEffect,\r\n    useUnmount,\r\n} from \"ivi\"\r\nimport { div, canvas } from \"ivi-html\"\r\nimport * as styles from \"./index.scss\"\r\nimport * as Toolbar from \"./toolbar\"\r\nimport * as Camera from \"../tools/camera\"\r\nimport * as Theme from \"./theme\"\r\nimport * as Layers from \"./layers\"\r\nimport * as Input from \"../canvas/input\"\r\nimport * as Canvas from \"../canvas\"\r\nimport * as Setup from \"./setup\"\r\nimport { SetOnce, FrameStream, CancelFrameStream, Store, PerfTracker, Vec2, Signals } from \"../util\"\r\nimport { PrimaryButton, Surface } from \"./views\"\r\nimport * as Debugging from \"./debugging\"\r\nimport { MiniMapDetails } from \"./miniMap\"\r\n\r\nfunction getDocumentResolution(): Vec2 {\r\n    return new Vec2(document.documentElement.clientWidth, document.documentElement.clientHeight)\r\n}\r\n\r\nfunction getCanvasOffset(canvas: HTMLCanvasElement): Vec2 {\r\n    return new Vec2(canvas.offsetLeft, canvas.offsetTop)\r\n}\r\n\r\nfunction getCanvasInfo({\r\n    canvasOffset,\r\n    canvasResolution,\r\n}: {\r\n    readonly canvasOffset: Vec2\r\n    readonly canvasResolution: Vec2\r\n}): Canvas.CanvasInfo {\r\n    return {\r\n        resolution: canvasResolution,\r\n        halfResoution: canvasResolution.multiplyScalar(0.5),\r\n        offset: canvasOffset,\r\n    }\r\n}\r\n\r\nconst App = component(c => {\r\n    const initialState = Canvas.initState()\r\n    const removeInputListeners = new SetOnce<Input.RemoveListeners>()\r\n    const cancelFrameStream = new SetOnce<CancelFrameStream>()\r\n    const canvasModel = new SetOnce<Canvas.Canvas>()\r\n    const debuggingGl = new SetOnce<WebGLRenderingContext>()\r\n    const perfTrackerData = Signals.create<readonly PerfTracker.Sample[]>([])\r\n    const canvasRef = box<OpState | null>(null)\r\n\r\n    const canvasResolution = new Vec2(800, 800)\r\n\r\n    let documentResolution: Vec2 = getDocumentResolution()\r\n    let canvasInfo: Canvas.CanvasInfo = getCanvasInfo({\r\n        canvasOffset: new Vec2(initialState.tool.camera.offsetX, initialState.tool.camera.offsetY),\r\n        canvasResolution,\r\n    })\r\n\r\n    const store = Store.create<\r\n        Canvas.State,\r\n        Canvas.EphemeralState,\r\n        Canvas.CanvasMsg,\r\n        Canvas.Effect\r\n    >({\r\n        initialState,\r\n        initialEphemeral: Canvas.initEphemeral(),\r\n        effectsHandler: (ef: Canvas.Effect) => canvasModel.value.handle(ef),\r\n        forceRender: () => invalidate(c),\r\n        update: (state, ephState, msg) => {\r\n            const result = Canvas.update(canvasInfo, state, ephState, msg)\r\n            canvasModel.value.update(result[0])\r\n            return result\r\n        },\r\n    })\r\n\r\n    {\r\n        function onResize() {\r\n            documentResolution = getDocumentResolution()\r\n            canvasInfo = getCanvasInfo({\r\n                canvasOffset: getCanvasOffset(findDOMNode(canvasRef) as HTMLCanvasElement),\r\n                canvasResolution,\r\n            })\r\n        }\r\n        document.addEventListener(\"resize\", onResize)\r\n        useUnmount(c, () => {\r\n            document.removeEventListener(\"resize\", onResize)\r\n        })\r\n    }\r\n\r\n    const sender = new Canvas.MsgSender(store.send)\r\n\r\n    let prevTheme: Theme.Theme | null = null\r\n    const updateTheme = useEffect<Theme.Theme>(c, nextTheme => {\r\n        if (prevTheme === null) {\r\n            Theme.updateAll(nextTheme)\r\n        } else {\r\n            Theme.updateDiff(prevTheme, nextTheme)\r\n        }\r\n        prevTheme = nextTheme\r\n    })\r\n\r\n    const setupCanvas = useLayoutEffect(c, () => {\r\n        console.log(\"Painter mounted\")\r\n        const htmlCanvas = findDOMNode<HTMLCanvasElement>(canvasRef)\r\n        if (htmlCanvas == null) {\r\n            throw \"Canvas not found\"\r\n        }\r\n\r\n        const state = store.getState()\r\n\r\n        canvasInfo = getCanvasInfo({\r\n            canvasOffset: getCanvasOffset(htmlCanvas),\r\n            canvasResolution,\r\n        })\r\n\r\n        {\r\n            const canvas = Canvas.Canvas.create(htmlCanvas, state, {\r\n                onStats: stats => {\r\n                    perfTrackerData.push(stats)\r\n                },\r\n                onWebglContextCreated: gl => {\r\n                    debuggingGl.set(gl)\r\n                },\r\n            })\r\n            if (canvas === null) {\r\n                throw \"Failed to initialize Canvas\"\r\n            }\r\n\r\n            canvasModel.set(canvas)\r\n        }\r\n\r\n        removeInputListeners.set(\r\n            Input.listen(htmlCanvas, {\r\n                click: sender.onClick,\r\n                release: sender.onRelease,\r\n                move: x => {\r\n                    /**/\r\n                },\r\n                drag: sender.onDrag,\r\n            })\r\n        )\r\n        cancelFrameStream.set(FrameStream.make(sender.onFrame))\r\n\r\n        if (process.env.NODE_ENV !== \"production\") {\r\n            Setup.setup(htmlCanvas, () => store.getState(), sender).then(() => {\r\n                invalidate(c)\r\n            })\r\n        }\r\n\r\n        return () => {\r\n            removeInputListeners.value()\r\n            cancelFrameStream.value()\r\n            canvasModel.value.dispose()\r\n            console.log(\"Painter unmounted\")\r\n        }\r\n    })\r\n\r\n    function getCanvasTransform(cam: Camera.State): string {\r\n        const translate = \"translate(\" + cam.offsetX + \"px, \" + cam.offsetY + \"px) \"\r\n        const rotate = \"rotate(\" + cam.rotateTurns + \"turn) \"\r\n        const scale = \"scale(\" + cam.zoomPct + \", \" + cam.zoomPct + \")\"\r\n        return translate + rotate + scale\r\n    }\r\n\r\n    return (): Op => {\r\n        const state = store.getState()\r\n\r\n        setupCanvas()\r\n        updateTheme(state.theme)\r\n\r\n        return div(styles.appContainer, _, [\r\n            div(styles.wrapper, _, [\r\n                Toolbar.Toolbar({\r\n                    msgSender: sender.tool,\r\n                    tool: state.tool,\r\n                    transientState: { isDetailsExpanded: true },\r\n                }),\r\n                Ref(\r\n                    canvasRef,\r\n                    canvas(styles.canvas, {\r\n                        width: canvasResolution.x,\r\n                        height: canvasResolution.y,\r\n                        style: {\r\n                            transform: getCanvasTransform(state.tool.camera),\r\n                        },\r\n                    })\r\n                ),\r\n                div(styles.layersViewContainer, _, [\r\n                    Surface(\r\n                        MiniMapDetails({\r\n                            camera: state.tool.camera,\r\n                            sender: sender.tool.camera,\r\n                        })\r\n                    ),\r\n                    Layers.LayersView({\r\n                        layers: state.layers,\r\n                        sender: sender.layer,\r\n                    }),\r\n                ]),\r\n            ]),\r\n            div(\r\n                styles.bottomLeft,\r\n                _,\r\n                PrimaryButton({\r\n                    content: \"Next theme\",\r\n                    onClick: sender.randomizeTheme,\r\n                })\r\n            ),\r\n            process.env.NODE_ENV !== \"development\"\r\n                ? null\r\n                : div(\r\n                      styles.bottomRight,\r\n                      _,\r\n                      Debugging.DebugWindow({\r\n                          gl: debuggingGl,\r\n                          state,\r\n                          perfSamplesSignal: perfTrackerData.signal,\r\n                      })\r\n                  ),\r\n        ])\r\n    }\r\n})\r\n\r\n{\r\n    const rootElement = document.getElementById(\"canvas-root\")\r\n\r\n    if (rootElement === null) {\r\n        throw \"canvas-root not found\"\r\n    }\r\n\r\n    render(App(), rootElement)\r\n}\r\n","/**\n * Event Handlers.\n *\n * Optimizing compilers should inline all this functions and completely remove unused code.\n */\nimport { doc } from \"../dom/shortcuts\";\nimport { withSchedulerTick } from \"../scheduler\";\nimport { dispatchEvent } from \"./dispatch\";\nimport { EVENT_CAPTURE_ACTIVE_OPTIONS } from \"./utils\";\nconst dispatchNativeEvent = (event, currentTarget, src) => (currentTarget.h.h(event, currentTarget.t, src));\n/**\n * Creates a native event source.\n *\n * @typeparam E Native event type.\n * @param flags See {@link NativeEventSourceFlags} for details.\n * @param name Event name\n * @param options Event handler options\n * @returns {@link NativeEventSource} instance\n */\nexport function createNativeEventSource(name, options = true) {\n    const source = {\n        next: (event) => {\n            dispatchEvent(source, event.target, event);\n        }\n    };\n    doc.addEventListener(name, withSchedulerTick((event) => { source.next(event); }), options);\n    return source;\n}\nexport function addNativeEventMiddleware(source, fn) {\n    const next = source.next;\n    source.next = (event) => { fn(event, next); };\n}\n/* tslint:disable:max-line-length */\nexport const ABORT_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"abort\"));\nexport const ACTIVATE_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"activate\"));\nexport const ARIA_REQUEST_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"ariarequest\"));\nexport const BEFORE_ACTIVATE_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"beforeactivate\"));\nexport const BEFORE_COPY_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"beforecopy\"));\nexport const BEFORE_CUT_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"beforecut\"));\nexport const BEFORE_DEACTIVATE_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"beforedeactivate\"));\nexport const BEFORE_PASTE_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"beforepaste\"));\nexport const BLUR_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"blur\"));\nexport const CAN_PLAY_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"canplay\"));\nexport const CAN_PLAYTHROUGH_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"canplaythrough\"));\nexport const CHANGE_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"change\"));\nexport const CLICK_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"click\"));\nexport const CONTEXT_MENU_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"contextmenu\"));\nexport const COPY_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"copy\"));\nexport const CUE_CHANGE_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"cuechange\"));\nexport const CUT_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"cut\"));\nexport const DOUBLE_CLICK_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"dblclick\"));\nexport const DEACTIVATE_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"deactivate\"));\nexport const DRAG_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"drag\"));\nexport const DRAG_END_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"dragend\"));\nexport const DRAG_ENTER_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"dragenter\"));\nexport const DRAG_LEAVE_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"dragleave\"));\nexport const DRAG_OVER_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"dragover\"));\nexport const DRAG_START_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"dragstart\"));\nexport const DROP_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"drop\"));\nexport const DURATION_CHANGE_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"durationchange\"));\nexport const EMPTIED_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"emptied\"));\nexport const ENCRYPTED_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"encrypted\"));\nexport const ENDED_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"ended\"));\nexport const ERROR_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"error\"));\nexport const FOCUS_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"focus\"));\nexport const GOT_POINTER_CAPTURE_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"gotpointercapture\"));\nexport const BEFORE_INPUT_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"beforeinput\"));\nexport const INPUT_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"input\"));\nexport const INVALID_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"invalid\"));\nexport const KEY_DOWN_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"keydown\"));\nexport const KEY_PRESS_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"keypress\"));\nexport const KEY_UP_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"keyup\"));\nexport const LOAD_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"load\"));\nexport const LOADED_DATA_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"loadeddata\"));\nexport const LOADED_METADATA_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"loadedmetadata\"));\nexport const LOAD_START_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"loadstart\"));\nexport const LOST_POINTER_CAPTURE_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"lostpointercapture\"));\nexport const MOUSE_DOWN_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"mousedown\"));\nexport const MOUSE_MOVE_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"mousemove\"));\nexport const MOUSE_OUT_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"mouseout\"));\nexport const MOUSE_OVER_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"mouseover\"));\nexport const MOUSE_UP_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"mouseup\"));\nexport const PASTE_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"paste\"));\nexport const PAUSE_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"pause\"));\nexport const PLAY_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"play\"));\nexport const PLAYING_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"playing\"));\nexport const POINTER_CANCEL_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"pointercancel\"));\nexport const POINTER_DOWN_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"pointerdown\"));\nexport const POINTER_MOVE_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"pointermove\"));\nexport const POINTER_OUT_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"pointerout\"));\nexport const POINTER_OVER_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"pointerover\"));\nexport const POINTER_UP_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"pointerup\"));\nexport const PROGRESS_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"progress\"));\nexport const RATE_CHANGE_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"ratechange\"));\nexport const RESET_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"reset\"));\nexport const SCROLL_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"scroll\"));\nexport const SEEKED_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"seeked\"));\nexport const SEEKING_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"seeking\"));\nexport const SELECT_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"select\"));\nexport const SELECT_START_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"selectstart\"));\nexport const STALLED_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"stalled\"));\nexport const SUBMIT_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"submit\"));\nexport const SUSPEND_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"suspend\"));\nexport const TIME_UPDATE_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"timeupdate\"));\nexport const TOUCH_CANCEL_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"touchcancel\"));\nexport const TOUCH_END_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"touchend\"));\nexport const TOUCH_MOVE_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"touchmove\"));\nexport const TOUCH_START_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"touchstart\"));\nexport const TRANSITION_CANCEL_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"transitioncancel\"));\nexport const TRANSITION_END_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"transitionend\"));\nexport const TRANSITION_RUN_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"transitionrun\"));\nexport const TRANSITION_START_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"transitionstart\"));\nexport const UNLOAD_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"unload\"));\nexport const VOLUME_CHANGE_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"volumechange\"));\nexport const WAITING_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"waiting\"));\nexport const WHEEL_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"wheel\"));\nexport const ACTIVE_TOUCH_END_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"touchend\", EVENT_CAPTURE_ACTIVE_OPTIONS));\nexport const ACTIVE_TOUCH_MOVE_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"touchmove\", EVENT_CAPTURE_ACTIVE_OPTIONS));\nexport const ACTIVE_TOUCH_START_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"touchstart\", EVENT_CAPTURE_ACTIVE_OPTIONS));\nexport const ACTIVE_WHEEL_EVENT = (process.env.IVI_TARGET === \"ssr\" ? void 0 :\n    /*#__PURE__*/ createNativeEventSource(\"wheel\", EVENT_CAPTURE_ACTIVE_OPTIONS));\n/**\n * Helper function that creates native event handler factories.\n *\n * @param s Native event source.\n * @returns Native event handler factory.\n */\nexport function nativeEventHandlerFactory(s) {\n    const bubbleDescriptor = { s, h: dispatchNativeEvent, f: 0 };\n    const captureDescriptor = { s, h: dispatchNativeEvent, f: 1 /* Capture */ };\n    return (h, capture) => ({\n        d: capture === true ? captureDescriptor : bubbleDescriptor,\n        h,\n    });\n}\nexport const onAbort = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(ABORT_EVENT));\nexport const onActivate = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(ACTIVATE_EVENT));\nexport const onAriaRequest = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(ARIA_REQUEST_EVENT));\nexport const onBeforeActivate = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(BEFORE_ACTIVATE_EVENT));\nexport const onBeforeCopy = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(BEFORE_COPY_EVENT));\nexport const onBeforeCut = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(BEFORE_CUT_EVENT));\nexport const onBeforeDeactivate = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(BEFORE_DEACTIVATE_EVENT));\nexport const onBeforePaste = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(BEFORE_PASTE_EVENT));\nexport const onBlur = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(BLUR_EVENT));\nexport const onCanPlay = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(CAN_PLAY_EVENT));\nexport const onCanPlaythrough = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(CAN_PLAYTHROUGH_EVENT));\nexport const onChange = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(CHANGE_EVENT));\nexport const onClick = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(CLICK_EVENT));\nexport const onContextMenu = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(CONTEXT_MENU_EVENT));\nexport const onCopy = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(COPY_EVENT));\nexport const onCueChange = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(CUE_CHANGE_EVENT));\nexport const onCut = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(CUT_EVENT));\nexport const onDoubleClick = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(DOUBLE_CLICK_EVENT));\nexport const onDeactivate = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(DEACTIVATE_EVENT));\nexport const onDrag = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(DRAG_EVENT));\nexport const onDragEnd = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(DRAG_END_EVENT));\nexport const onDragEnter = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(DRAG_ENTER_EVENT));\nexport const onDragLeave = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(DRAG_LEAVE_EVENT));\nexport const onDragOver = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(DRAG_OVER_EVENT));\nexport const onDragStart = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(DRAG_START_EVENT));\nexport const onDrop = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(DROP_EVENT));\nexport const onDurationChange = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(DURATION_CHANGE_EVENT));\nexport const onEmptied = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(EMPTIED_EVENT));\nexport const onEncrypted = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(ENCRYPTED_EVENT));\nexport const onEnded = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(ENDED_EVENT));\nexport const onError = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(ERROR_EVENT));\nexport const onFocus = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(FOCUS_EVENT));\nexport const onGotPointerCapture = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(GOT_POINTER_CAPTURE_EVENT));\nexport const onBeforeInput = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(BEFORE_INPUT_EVENT));\nexport const onInput = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(INPUT_EVENT));\nexport const onInvalid = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(INVALID_EVENT));\nexport const onKeyDown = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(KEY_DOWN_EVENT));\nexport const onKeyPress = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(KEY_PRESS_EVENT));\nexport const onKeyUp = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(KEY_UP_EVENT));\nexport const onLoad = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(LOAD_EVENT));\nexport const onLoadedData = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(LOADED_DATA_EVENT));\nexport const onLoadedMetadata = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(LOADED_METADATA_EVENT));\nexport const onLoadStart = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(LOAD_START_EVENT));\nexport const onLostPointerCapture = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(LOST_POINTER_CAPTURE_EVENT));\nexport const onMouseDown = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(MOUSE_DOWN_EVENT));\nexport const onMouseMove = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(MOUSE_MOVE_EVENT));\nexport const onMouseOut = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(MOUSE_OUT_EVENT));\nexport const onMouseOver = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(MOUSE_OVER_EVENT));\nexport const onMouseUp = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(MOUSE_UP_EVENT));\nexport const onPaste = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(PASTE_EVENT));\nexport const onPause = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(PAUSE_EVENT));\nexport const onPlay = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(PLAY_EVENT));\nexport const onPlaying = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(PLAYING_EVENT));\nexport const onPointerCancel = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(POINTER_CANCEL_EVENT));\nexport const onPointerDown = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(POINTER_DOWN_EVENT));\nexport const onPointerMove = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(POINTER_MOVE_EVENT));\nexport const onPointerOut = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(POINTER_OUT_EVENT));\nexport const onPointerOver = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(POINTER_OVER_EVENT));\nexport const onPointerUp = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(POINTER_UP_EVENT));\nexport const onProgress = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(PROGRESS_EVENT));\nexport const onRateChange = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(RATE_CHANGE_EVENT));\nexport const onReset = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(RESET_EVENT));\nexport const onScroll = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(SCROLL_EVENT));\nexport const onSeeked = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(SEEKED_EVENT));\nexport const onSeeking = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(SEEKING_EVENT));\nexport const onSelect = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(SELECT_EVENT));\nexport const onSelectStart = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(SELECT_START_EVENT));\nexport const onStalled = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(STALLED_EVENT));\nexport const onSubmit = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(SUBMIT_EVENT));\nexport const onSuspend = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(SUSPEND_EVENT));\nexport const onTimeUpdate = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(TIME_UPDATE_EVENT));\nexport const onTouchCancel = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(TOUCH_CANCEL_EVENT));\nexport const onTouchEnd = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(TOUCH_END_EVENT));\nexport const onTouchMove = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(TOUCH_MOVE_EVENT));\nexport const onTouchStart = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(TOUCH_START_EVENT));\nexport const onTransitionCancel = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(TRANSITION_CANCEL_EVENT));\nexport const onTransitionEnd = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(TRANSITION_END_EVENT));\nexport const onTransitionRun = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(TRANSITION_RUN_EVENT));\nexport const onTransitionStart = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(TRANSITION_START_EVENT));\nexport const onUnload = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(UNLOAD_EVENT));\nexport const onVolumeChange = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(VOLUME_CHANGE_EVENT));\nexport const onWaiting = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(WAITING_EVENT));\nexport const onWheel = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(WHEEL_EVENT));\nexport const onActiveTouchEnd = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(ACTIVE_TOUCH_END_EVENT));\nexport const onActiveTouchMove = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(ACTIVE_TOUCH_MOVE_EVENT));\nexport const onActiveTouchStart = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(ACTIVE_TOUCH_START_EVENT));\nexport const onActiveWheel = (process.env.IVI_TARGET === \"ssr\" ? /* istanbul ignore next */ () => null :\n    /*#__PURE__*/ nativeEventHandlerFactory(ACTIVE_WHEEL_EVENT));\n/* tslint:enable:max-line-length */\n//# sourceMappingURL=native_events.js.map","/**\n * box creates a boxed value.\n *\n * @typeparam T Value type.\n * @param v Value.\n * @returns Boxed value.\n */\nexport const box = (v) => ({ v });\n//# sourceMappingURL=box.js.map","/**\n * NOOP function.\n */\nexport const NOOP = () => { };\n/**\n * NOOP_FALSE function always returns `false` value.\n *\n * @returns `false` value.\n */\nexport const NOOP_FALSE = () => false;\n/**\n * NOOP_TRUE function always returns `true` value.\n *\n * @returns `true` value.\n */\nexport const NOOP_TRUE = () => true;\n//# sourceMappingURL=noop.js.map","import { useSelect } from \"./hooks\";\nimport { getDOMNode, visitNodes } from \"./reconciler\";\nexport function selector(s, areEqual) {\n    return (component) => useSelect(component, s, areEqual);\n}\n/**\n * findDOMNode finds a closest DOM node.\n *\n * @typeparam T DOM Node type.\n * @param box Boxed op node state.\n * @returns DOM Node or a `null` value.\n */\nexport const findDOMNode = (box) => box.v === null ? null : getDOMNode(box.v);\n/**\n * containsDOMElement returns `true` when `parent` contains a DOM element `element`.\n *\n * @param parent Op state node.\n * @param element DOM element.\n * @returns `true` when `parent` contains a DOM element `element`.\n */\nexport function containsDOMElement(parent, element) {\n    let result = false;\n    visitNodes(parent, (node) => {\n        if ((node.f & 2 /* Element */) !== 0) {\n            return (node.s.contains(element)) === true ?\n                (result = true, 1 /* StopImmediate */) :\n                2 /* Stop */;\n        }\n        return 0 /* Continue */;\n    });\n    return result;\n}\n/**\n * hasDOMElementChild returns `true` when `parent` has a DOM element child `child`.\n *\n * @param parent Op state node.\n * @param child DOM element.\n * @returns `true` when `parent` has a DOM element child `child`.\n */\nexport function hasDOMElementChild(parent, child) {\n    let result = false;\n    visitNodes(parent, (node) => {\n        if ((node.f & 2 /* Element */) !== 0) {\n            return (node.s === child) ?\n                (result = true, 1 /* StopImmediate */) :\n                2 /* Stop */;\n        }\n        return 0 /* Continue */;\n    });\n    return result;\n}\n//# sourceMappingURL=utils.js.map","import { UNMOUNT_TOKEN } from \"../core\";\nimport { component } from \"./factories\";\nimport { useUnmount } from \"./hooks\";\nfunction updateRef(prev, next, s) {\n    if (prev !== void 0 && prev !== next) {\n        prev.v = null;\n    }\n    next.v = s;\n    return next;\n}\nconst _Ref = component((s) => {\n    let _ref;\n    const h = (p) => ((p === UNMOUNT_TOKEN) ?\n        (_ref.v = null, void 0) :\n        (_ref = updateRef(_ref, p.r, s), p.c));\n    useUnmount(s, h);\n    return h;\n});\n/**\n * Ref creates a component that captures internal state into a boxed value.\n *\n * @param r Boxed value.\n * @param c Children operations.\n * @returns Ref node.\n */\nexport const Ref = (r, c) => _Ref({ r, c });\n//# sourceMappingURL=ref.js.map","/**\n * strictEqual returns `true` when `a` and `b` are strictly equal `===`.\n *\n * @param a\n * @param b\n * @returns `true` when `a` and `b` are strictly equal `===`.\n */\nexport const strictEqual = (a, b) => a === b;\n/**\n * shallowEqual returns `true` when objects are shallow equal.\n *\n * @param a\n * @param b\n * @returns `true` when props are shallow equal.\n */\nexport function shallowEqual(a, b) {\n    if (a !== b) {\n        const aKeys = Object.keys(a);\n        const bKeys = Object.keys(b);\n        if (aKeys.length !== bKeys.length) {\n            return false;\n        }\n        for (let i = 0; i < aKeys.length; ++i) {\n            const key = aKeys[i];\n            if (a[key] !== b[key]) {\n                return false;\n            }\n        }\n    }\n    return true;\n}\n/**\n * shallowEqualArray returns `true` when arrays are shallow equal.\n *\n * @param a\n * @param b\n * @returns `true` when arrays are shallow equal.\n */\nexport function shallowEqualArray(a, b) {\n    if (a !== b) {\n        if (a.length !== b.length) {\n            return false;\n        }\n        for (let i = 0; i < a.length; ++i) {\n            if (a[i] !== b[i]) {\n                return false;\n            }\n        }\n    }\n    return true;\n}\n//# sourceMappingURL=equal.js.map"],"sourceRoot":""}